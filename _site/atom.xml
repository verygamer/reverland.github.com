<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>Reverland的行知阁</title>
 <link href="http://reverland.org/atom.xml" rel="self"/>
 <link href="http://reverland.org"/>
 <updated>2012-10-27T22:40:38+08:00</updated>
 <id>http://reverland.org</id>
 <author>
   <name>Reverland</name>
   <email>lhtlyy@gmail.com</email>
 </author>

 
 <entry>
   <title>Scipy:高端科学计算</title>
   <link href="http://reverland.org/python/2012/10/22/scipy"/>
   <updated>2012-10-22T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/10/22/scipy</id>
   <content type="html">
&lt;h1 id=&quot;scipy&quot;&gt;Scipy:高端科学计算&lt;/h1&gt;

&lt;p&gt;作者：Adrien Chauve, Andre Espaze, Emmanuelle Gouillart, Gaël Varoquaux, Ralf Gommers&lt;/p&gt;

&lt;p&gt;翻译自：&lt;a href=&quot;scipy-lectures.github.com/intro/scipy.html&quot;&gt;scipy lecture notes&lt;/a&gt;&lt;/p&gt;

&lt;font color=&quot;red&quot;&gt;译者表示最后部分没怎么看懂，此文档维护中……&lt;/font&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Scipy&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;scipy包包含致力于科学计算中常见问题的各个工具箱。它的不同子模块相应于不同的应用。像插值，积分，优化，图像处理，，特殊函数等等。&lt;/p&gt;

&lt;p&gt;scipy可以与其它标准科学计算程序库进行比较，比如GSL(GNU C或C++科学计算库)，或者Matlab工具箱。scipy是Python中科学计算程序的核心包;它用于有效地计算numpy矩阵，来让numpy和scipy协同工作。&lt;/p&gt;

&lt;p&gt;在实现一个程序之前，值得检查下所需的数据处理方式是否已经在scipy中存在了。作为非专业程序员，科学家总是喜欢_重新发明造轮子_，导致了充满漏洞的，未经优化的，很难分享和维护的代码。相反，Scipy程序经过优化和测试，因此应该尽可能使用。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyio&quot;&gt;文件输入/输出：scipy.io&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyspecial&quot;&gt;特殊函数：scipy.special&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipylinalg&quot;&gt;线性代数运算：scipy.linalg&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyfftpack&quot;&gt;快速傅里叶变换：scipy.fftpack&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;工作示例：找到原始周期&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;工作示例：高斯图像模糊&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyoptimize&quot;&gt;优化和拟合：scipy.optimize&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipystats&quot;&gt;统计和随机数： scipy.stats&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;直方图和概率密度函数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;百分位&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;统计检测&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyinterpolate&quot;&gt;插值：scipy.interpolate&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyintegrate-fusy&quot;&gt;数值积分：scipy.integrate &lt;strong&gt;Fusy,&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipysignal&quot;&gt;信号处理：scipy.signal&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipyndimage&quot;&gt;图像处理：scipy.ndimage&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot;&gt;图像的几何变换&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot;&gt;图像滤镜&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-7&quot;&gt;数学形态学&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot;&gt;图像测量&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-9&quot;&gt;总结练习&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#footnotes&quot;&gt;Footnotes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;font color=&quot;red&quot;&gt;警告：这个教程离真正的数值计算介绍很远。因为枚举scipy中不同的子模块和函数非常无聊，我们集中精力代之以几个例子来给出如何使用`scipy`进行计算的大致思想。&lt;/font&gt;

&lt;p&gt;scipy 由一些特定功能的子模块组成：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;模块&lt;/th&gt;
      &lt;th&gt;功能&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.cluster&lt;/td&gt;
      &lt;td&gt;矢量量化 / K-均值&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.constants&lt;/td&gt;
      &lt;td&gt;物理和数学常数&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.fftpack&lt;/td&gt;
      &lt;td&gt;傅里叶变换&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.integrate&lt;/td&gt;
      &lt;td&gt;积分程序&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.interpolate&lt;/td&gt;
      &lt;td&gt;插值&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.io&lt;/td&gt;
      &lt;td&gt;数据输入输出&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.linalg&lt;/td&gt;
      &lt;td&gt;线性代数程序&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.ndimage&lt;/td&gt;
      &lt;td&gt;n维图像包&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.odr&lt;/td&gt;
      &lt;td&gt;正交距离回归&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.optimize&lt;/td&gt;
      &lt;td&gt;优化&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.signal&lt;/td&gt;
      &lt;td&gt;信号处理&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.sparse&lt;/td&gt;
      &lt;td&gt;稀疏矩阵&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.spatial&lt;/td&gt;
      &lt;td&gt;空间数据结构和算法&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.special&lt;/td&gt;
      &lt;td&gt;任何特殊数学函数&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;scipy.stats&lt;/td&gt;
      &lt;td&gt;统计&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;它们全依赖&lt;a href=&quot;http://docs.scipy.org/doc/numpy/reference/index.html#numpy&quot;&gt;numpy&lt;/a&gt;,但是每个之间基本独立。导入Numpy和这些scipy模块的标准方式是：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import numpy as np
from scipy import stats  # 其它子模块相同
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;主&lt;code&gt;scipy&lt;/code&gt;命名空间大多包含真正的numpy函数(尝试 scipy.cos 就是 np.cos)。这些仅仅是由于历史原因，通常没有理由在你的代码中使用&lt;code&gt;import scipy&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;scipyio&quot;&gt;文件输入/输出：scipy.io&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;导入和保存matlab文件:&lt;/p&gt;

    &lt;p&gt;In [1]: from scipy import io as spio&lt;/p&gt;

    &lt;p&gt;In [3]: import numpy as np&lt;/p&gt;

    &lt;p&gt;In [4]: a = np.ones((3, 3))&lt;/p&gt;

    &lt;p&gt;In [5]: spio.savemat(‘file.mat’, {‘a’: a}) # savemat expects a dictionary
  /usr/lib/python2.7/site-packages/scipy/io/matlab/mio.py:266: FutureWarning: Using oned_as default value (‘column’) This will change to ‘row’ in future versions
    oned_as=oned_as)&lt;/p&gt;

    &lt;p&gt;In [6]: data = spio.loadmat(‘file.mat’, struct_as_record=True)&lt;/p&gt;

    &lt;p&gt;In [7]: data[‘a’]
  Out[7]: 
  array([[ 1.,  1.,  1.],
         [ 1.,  1.,  1.],
         [ 1.,  1.,  1.]])&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;读取图片：&lt;/p&gt;

    &lt;p&gt;In [16]: from scipy import misc&lt;/p&gt;

    &lt;p&gt;In [17]: misc.imread(‘scikit.png’)
  Out[17]: 
  array([[[255, 255, 255, 255],
          [255, 255, 255, 255],
          [255, 255, 255, 255],
          …, 
          [255, 255, 255, 255],
          [255, 255, 255, 255],
          [255, 255, 255, 255]],&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;     [[255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      ..., 
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255]],

     [[255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      ..., 
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255]],

     ..., 
     [[255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      ..., 
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255]],

     [[255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      ..., 
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255]],

     [[255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      ..., 
      [255, 255, 255, 255],
      [255, 255, 255, 255],
      [255, 255, 255, 255]]], dtype=uint8)
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;In [18]: import matplotlib.pyplot as plt&lt;/p&gt;

    &lt;p&gt;In [19]: plt.imread(‘scikit.png’)
  Out[19]: 
  array([[[ 1.,  1.,  1.,  1.],
          [ 1.,  1.,  1.,  1.],
          [ 1.,  1.,  1.,  1.],
          …, 
          [ 1.,  1.,  1.,  1.],
          [ 1.,  1.,  1.,  1.],
          [ 1.,  1.,  1.,  1.]],&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;     [[ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      ..., 
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.]],

     [[ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      ..., 
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.]],

     ..., 
     [[ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      ..., 
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.]],

     [[ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      ..., 
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.]],

     [[ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      ..., 
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.],
      [ 1.,  1.,  1.,  1.]]], dtype=float32)
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;参见：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;载入txt文件：numpy.loadtxt()/numpy.savetxt()&lt;/li&gt;
  &lt;li&gt;智能导入文本/csv文件：numpy.genfromtxt()/numpy.recfromcsv()&lt;/li&gt;
  &lt;li&gt;高速，有效率但numpy特有的二进制格式：numpy.save()/numpy.load()&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;scipyspecial&quot;&gt;特殊函数：scipy.special&lt;/h2&gt;

&lt;p&gt;特殊函数是先验函数。&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/special.html#scipy.special&quot;&gt;scipy.special&lt;/a&gt;的文档字符串写得非常好，所以我们不在这里列出所有函数。常用的有：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;贝塞尔函数，如&lt;code&gt;scipy.special.jn()&lt;/code&gt;(整数n阶贝塞尔函数)&lt;/li&gt;
  &lt;li&gt;椭圆函数(&lt;code&gt;scipy.special.ellipj()&lt;/code&gt;雅可比椭圆函数，……)&lt;/li&gt;
  &lt;li&gt;伽马函数：&lt;code&gt;scipy.special.gamma()&lt;/code&gt;，还要注意&lt;code&gt;scipy.special.gammaln&lt;/code&gt;,这个函数给出对数坐标的伽马函数，因此有更高的数值精度。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;scipylinalg&quot;&gt;线性代数运算：scipy.linalg&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/linalg.html#scipy.linalg&quot;&gt;scipy.linalg&lt;/a&gt;模块提供标准线性代数运算，依赖于底层有效率的实现(BLAS，LAPACK)。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.det.html#scipy.linalg.det&quot;&gt;scipy.linalg.det()&lt;/a&gt;函数计算方阵的行列式：&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [22]: from scipy import linalg
  
In [23]: arr = np.array([[1, 2],
   ....:                [3, 4]])
  
In [24]: linalg.det(arr)
Out[24]: -2.0
  
In [25]: linalg.det(np.ones((3,4)))
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
&amp;lt;ipython-input-25-375ad1d49940&amp;gt; in &amp;lt;module&amp;gt;()
----&amp;gt; 1 linalg.det(np.ones((3,4)))
  
/usr/lib/python2.7/site-packages/scipy/linalg/basic.pyc in det(a, overwrite_a)
    398     a1 = np.asarray_chkfinite(a)
    399     if len(a1.shape) != 2 or a1.shape[0] != a1.shape[1]:
--&amp;gt; 400         raise ValueError('expected square matrix')
    401     overwrite_a = overwrite_a or _datacopied(a1, a)
    402     fdet, = get_flinalg_funcs(('det',), (a1,))
  
ValueError: expected square matrix
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;scipy.linalg.inv()&lt;/code&gt;函数计算方阵的逆：&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [26]: arr = np.array([[1, 2],
                [3, 4]])
  
In [27]: iarr = linalg.inv(arr)
  
In [28]: iarr
Out[28]: 
array([[-2. ,  1. ],
       [ 1.5, -0.5]])
  
In [29]: np.allclose(np.dot(arr, iarr), np.eye(2))
Out[29]: True
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;最后计算奇异阵的逆(它的行列式为0)将会引发(raise)&lt;code&gt;LinAlgError&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [32]: arr = np.array([[3, 2],
                  [6, 4]])
  
  In [33]: linalg.inv(arr)
  ---------------------------------------------------------------------------
  LinAlgError                               Traceback (most recent call last)
  &amp;lt;ipython-input-33-52c04c854a80&amp;gt; in &amp;lt;module&amp;gt;()
  ----&amp;gt; 1 linalg.inv(arr)
  
  /usr/lib/python2.7/site-packages/scipy/linalg/basic.pyc in inv(a, overwrite_a)
      346             inv_a, info = getri(lu, piv, overwrite_lu=1)
      347     if info &amp;gt; 0:
  --&amp;gt; 348         raise LinAlgError(&quot;singular matrix&quot;)
      349     if info &amp;lt; 0:
      350         raise ValueError('illegal value in %d-th argument of internal '
  
  LinAlgError: singular matrix
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;还有更多高级运算，如奇异值分解(SVD):&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [34]: arr = np.arange(9).reshape((3, 3)) + np.diag([1, 0, 1])
  
In [35]: uarr, spec, vharr = linalg.svd(arr)
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;它的结果数组谱是：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [36]: spec
  Out[36]: array([ 14.88982544,   0.45294236,   0.29654967])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;原始矩阵可以由svd的输出用&lt;code&gt;np.dot&lt;/code&gt;点乘重新组合得到：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [37]: sarr = np.diag(spec)
  
  In [38]: svd_mat = uarr.dot(sarr).dot(vharr)
  
  In [39]: np.allclose(svd_mat, arr)
  Out[39]: True
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SVD在信号处理和统计中运用很广。许多其它标准分解(QR,LU,Cholesky,Schur)，还有线性系统的解也可以从&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/linalg.html#scipy.linalg&quot;&gt;scipy.linalg&lt;/a&gt;中获得。&lt;/p&gt;

&lt;h2 id=&quot;scipyfftpack&quot;&gt;快速傅里叶变换：scipy.fftpack&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/fftpack.html#scipy.fftpack&quot;&gt;scipy.fftpack&lt;/a&gt;模块用来计算快速傅里叶变换。作为示例，一个(噪声)输入信号可能像这样：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [40]: time_step = 0.02
  
  In [41]: period = 5
  
  In [42]: time_vec = np.arange(0, 20, time_step)
  
  In [43]: sig = np.sin(2 * np.pi / period * time_vec) + \
     ....: 0.5 * np.random.randn(time_vec.size)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;观测者并不指导信号频率，仅仅等间隔取样信号sig。信号应该来自一个真实的函数所以傅里叶变换将是对称的。&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/generated/scipy.fftpack.fftfreq.html#scipy.fftpack.fftfreq&quot;&gt;scipy.fftpack.fftfreq()&lt;/a&gt;函数将生成取样频率，&lt;a href=&quot;http://docs.scipy.org/doc/scipy/reference/generated/scipy.fftpack.fft.html#scipy.fftpack.fft&quot;&gt;scipy.fftpack.fft()&lt;/a&gt;将计算快速傅里叶变换：&lt;/p&gt;

&lt;p&gt;因为功率结果是对称的，仅仅需要使用谱的正值部分来找出频率：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [48]: pidxs = np.where(sample_freq &amp;gt; 0)
  
  In [49]: freqs = sample_freq[pidxs]
  
  In [50]: power = np.abs(sig_fft)[pidxs]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;信号频率可以这样被找到：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [51]: freq = freqs[power.argmax()]
  
  In [52]: np.allclose(freq, 1./period)
  Out[52]: True
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在高频噪声将被从傅里叶变换信号中移除：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [53]: sig_fft[np.abs(sample_freq) &amp;gt; freq] = 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;得到滤波信号，可以用&lt;code&gt;scipy.fftpack.ifft&lt;/code&gt;函数计算：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [54]: main_sig = fftpack.ifft(sig_fft)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;结果可以这样可视化：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  In [55]: plt.figure()
  Out[55]: &amp;lt;matplotlib.figure.Figure at 0x4a9fb50&amp;gt;
  
  In [56]: plt.plot(time_vec, sig)
  Out[56]: [&amp;lt;matplotlib.lines.Line2D at 0x4ad3790&amp;gt;]
  
  In [57]: plt.plot(time_vec, main_sig, linewidth=3)
  /usr/lib/python2.7/site-packages/numpy/core/numeric.py:320: ComplexWarning: Casting complex values to real discards the imaginary part
    return array(a, dtype, copy=False, order=order)
  Out[57]: [&amp;lt;matplotlib.lines.Line2D at 0x4ad3dd0&amp;gt;]
  
  In [58]: plt.xlabel('Time [s]')
  Out[58]: &amp;lt;matplotlib.text.Text at 0x4aad050&amp;gt;
  
  In [59]: plt.ylabel('Amplitude')
  Out[59]: &amp;lt;matplotlib.text.Text at 0x4aadbd0&amp;gt;
  
  In [60]: plt.show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://docs.scipy.org/doc/numpy/reference/routines.fft.html#numpy.fft&quot;&gt;numpy.fft&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Numpy也有一个FFT实现(numpy.fft)。然而，通常scipy的应该优先使用，因为它使用了更有效率的底层实现。&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;工作示例：找到原始周期&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/intro/solutions/periodicity_finder.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/intro/solutions/periodicity_finder.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;工作示例：高斯图像模糊&lt;/h3&gt;

&lt;p&gt;卷积：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
f_1(t) = \int dt'K(t-t')f_0(t')
&lt;/script&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\tilde{f_1}(\omega)=\tilde{K}(\omega)\tilde{f_0}(\omega)
&lt;/script&gt;

&lt;p&gt;&lt;strong&gt;练习：登月图片消噪&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/moonlanding.png&quot; alt=&quot;moonlanding.png&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;检查提供的图像moonlanding.png，该图像被周期噪声严重污染了。在这个练习中，我们旨在使用快速傅里叶变换清除噪声。&lt;/li&gt;
  &lt;li&gt;用&lt;code&gt;plt.imread&lt;/code&gt;加载图像。&lt;/li&gt;
  &lt;li&gt;使用&lt;code&gt;scipy.fftpack&lt;/code&gt;中的2-D傅里叶函数找到并绘制图像的谱线(傅里叶变换)。可视化这个谱线对你有问题吗？如果有，为什么？&lt;/li&gt;
  &lt;li&gt;这个谱包含高频和低频成分。噪声是在谱线的高频部分中，所以设置一些成分为0(使用数组切片)。&lt;/li&gt;
  &lt;li&gt;应用逆傅里叶变换来看最后的图像。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn056/20121022/2330/p_large_PyL8_4bee00000f241263.jpg&quot; alt=&quot;我的消除噪声实例……&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;scipyoptimize&quot;&gt;优化和拟合：scipy.optimize&lt;/h2&gt;

&lt;p&gt;优化是找到最小值或等式的数值解的问题。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;scipy.optimization&lt;/code&gt;子模块提供了函数最小值(标量或多维)、曲线拟合和寻找等式的根的有用算法。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from scipy import optimize
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;找到标量函数的最小值&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;让我们定义以下函数&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [2]: def f(x):
   ...:     return x**2 + 10 * np.sin(x)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后绘制它：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [3]: x = np.arange(-10, 10, 0.1)

In [4]: plt.plot(x, f(x))
Out[4]: [&amp;lt;matplotlib.lines.Line2D at 0x3e2a4d0&amp;gt;]

In [5]: plt.show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/scipy_optimize_example1.png&quot; alt=&quot;optimization&quot; /&gt;&lt;/p&gt;

&lt;p&gt;该函数在大约-1.3有个全局最小值,在3.8有个局部最小值。&lt;/p&gt;

&lt;p&gt;找到这个函数最小值一般而有效的方法是从初始点使用梯度下降法。BFGS算法&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;是做这个的好方法：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [6]: optimize.fmin_bfgs(f, 0)
Optimization terminated successfully.
         Current function value: -7.945823
         Iterations: 5
         Function evaluations: 24
         Gradient evaluations: 8
Out[6]: array([-1.30644003])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个方法一个可能的问题在于，如果函数有局部最小值，算法会因初始点不同找到这些局部最小而不是全局最小:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [7]: optimize.fmin_bfgs(f, 3, disp=0)
Out[7]: array([ 3.83746663])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果我们不知道全局最小值的邻近值来选定初始点，我们需要借助于耗费资源些的全局优化。为了找到全局最小点，最简单的算法是蛮力算法&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;，该算法求出给定格点的每个函数值。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [10]: grid = (-10, 10, 0.1)

In [11]: xmin_global = optimize.brute(f, (grid,))

In [12]: xmin_global
Out[12]: array([-1.30641113])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;对于大点的格点，&lt;code&gt;scipy.optimize.brute()&lt;/code&gt;变得非常慢。&lt;code&gt;scipy.optimize.anneal()&lt;/code&gt;提供了使用模拟退火的替代函数。对已知的不同类别全局优化问题存在更有效率的算法，但这已经超出scipy的范围。一些有用全局优化软件包是&lt;a href=&quot;http://openopt.org/Welcome&quot;&gt;OpenOpt&lt;/a&gt;、&lt;a href=&quot;https://github.com/xuy/pyipopt&quot;&gt;IPOPT&lt;/a&gt;、&lt;a href=&quot;http://pagmo.sourceforge.net/pygmo/index.html&quot;&gt;PyGMO&lt;/a&gt;和&lt;a href=&quot;http://pyevolve.sourceforge.net/&quot;&gt;PyEvolve&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;为了找到局部最小，我们把变量限制在&lt;code&gt;(0, 10)&lt;/code&gt;之间，使用&lt;code&gt;scipy.optimize.fminbound()&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [13]: xmin_local = optimize.fminbound(f, 0, 10)

In [14]: xmin_local
Out[14]: 3.8374671194983834
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;在高级章节部分&lt;a href=&quot;http://scipy-lectures.github.com/advanced/mathematical_optimization/index.html#mathematical-optimization&quot;&gt;数学优化：找到函数最小值&lt;/a&gt;中有关于寻找函数最小值更详细的讨论。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;找到标量函数的根&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;为了寻找根，例如令&lt;code&gt;f(x)=0&lt;/code&gt;的点，对以上的用来示例的函数&lt;code&gt;f&lt;/code&gt;我们可以使用&lt;code&gt;scipy.optimize.fsolve()&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [17]: root = optimize.fsolve(f, 1)  # 我们的初始猜测是1

In [18]: root
Out[18]: array([ 0.])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注意仅仅一个根被找到。检查f的图像在-2.5附近有第二个根。我们可以通过调整我们的初始猜测找到这一确切值：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [19]: root = optimize.fsolve(f, -2.5)

In [20]: root
Out[20]: array([-2.47948183])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;曲线拟合&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;假设我们有从被噪声污染的f中抽样到的数据：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [21]: xdata = np.linspace(-10, 10, num=20)

In [22]: ydata = f(xdata) + np.random.randn(xdata.size)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果我们知道函数形式(当前情况是&lt;code&gt;x^2 + sin(x)&lt;/code&gt;)，但是不知道幅度。我们可以通过最小二乘拟合拟合来找到幅度。首先我们定义一个用来拟合的函数：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [23]: def f2(x, a, b):
   ....:     return a*x**2 + b*np.sin(x)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后我们可以使用&lt;code&gt;scipy.optimize.curve_fit()&lt;/code&gt;来找到a和b：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [24]: guess = [2, 2]

In [25]: params, params_covariance = optimize.curve_fit(f2, xdata, ydata, guess)

In [26]: params
Out[26]: array([  1.00439471,  10.04911441])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在我们找到了f的最小值和根并且对它使用了曲线拟合。我们将一切放在一个单独的图像中:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/scipy_optimize_example2.png&quot; alt=&quot;function&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;Scipy&amp;gt;=0.11中提供所有最小化和根寻找算法的统一接口&lt;code&gt;scipy.optimize.minimize()&lt;/code&gt;,&lt;code&gt;scipy.optimize.minimize_scalar()&lt;/code&gt;和&lt;code&gt;scipy.optimize.root()&lt;/code&gt;。它们允许通过method关键字方便地比较不同算法。&lt;/p&gt;

&lt;p&gt;你可以在&lt;code&gt;scipy.optimize&lt;/code&gt;中找到用来解决多维问题的相同功能的算法。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;练习：曲线拟合温度数据&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;在阿拉斯加每个月的温度上下限，从一月开始，以摄氏单位给出。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;max:&lt;/th&gt;
      &lt;th&gt;17,  19,  21,  28,  33,  38, 37,  37,  31,  23,  19,  18&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;min:&lt;/td&gt;
      &lt;td&gt;-62, -59, -56, -46, -32, -18, -9, -13, -25, -46, -52, -58&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;绘制这些温度限&lt;/li&gt;
  &lt;li&gt;定义函数来描述最小和最大温度。提示：这个函数以一年为周期。提示：包括时间偏移。&lt;/li&gt;
  &lt;li&gt;对数据使用这个函数&lt;code&gt;scipy.optimize.curve_fit()&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;绘制结果。是否拟合合理？如果不合理，为什么？&lt;/li&gt;
  &lt;li&gt;拟合精度的最大最小温度的时间偏移是否一样？&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;练习：2维最小化&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/pyplots/scipy_optimize_sixhump.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;六峰值驼背函数：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
f(x,y) = (4 - 2.1x^2 + \frac{x^4}{3})x^2 + xy + (4y^2 - 4)y^2
&lt;/script&gt;

&lt;p&gt;有全局和多个局部最小。找到这个函数的全局最小。&lt;/p&gt;

&lt;p&gt;提示：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;变量应该限制在&lt;code&gt;-2 &amp;lt; x &amp;lt; 2 , -1 &amp;lt; y &amp;lt; 1&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;使用&lt;code&gt;numpy.meshgrid()&lt;/code&gt;和&lt;code&gt;plt.imshow&lt;/code&gt;来可视地搜寻区域。&lt;/li&gt;
  &lt;li&gt;使用&lt;code&gt;scipy.optimize.fmin_bfgs()&lt;/code&gt;或其它多维极小化器。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这里有多少极小值？这些点上的函数值是多少？如果初始猜测是&lt;code&gt;(x, y) = (0, 0)&lt;/code&gt;会发生什么？&lt;/p&gt;

&lt;p&gt;参见总结练习&lt;a href=&quot;http://scipy-lectures.github.com/intro/summary-exercises/optimize-fit.html#summary-exercise-optimize&quot;&gt;非线性最小二乘拟合：在点抽取地形激光雷达数据上的应用&lt;/a&gt;，来看另一个，更高级的例子。&lt;/p&gt;

&lt;h2 id=&quot;scipystats&quot;&gt;统计和随机数： scipy.stats&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;scipy.stats&lt;/code&gt;包括统计工具和随机过程的概率过程。各个随机过程的随机数生成器可以从&lt;code&gt;numpy.random&lt;/code&gt;中找到。&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;直方图和概率密度函数&lt;/h3&gt;

&lt;p&gt;给定一个随机过程的观察值，它们的直方图是随机过程的pdf(概率密度函数)的估计器：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [1]: import numpy as np

In [2]: a = np.random.normal(size=1000)

In [3]: bins = np.arange(-4, 5)

In [4]: bins
Out[4]: array([-4, -3, -2, -1,  0,  1,  2,  3,  4])

In [5]: histogram = np.histogram(a, bins=bins, normed=True)[0]

In [6]: bins = 0.5*(bins[1:] + bins[:-1])

In [7]: bins
Out[7]: array([-3.5, -2.5, -1.5, -0.5,  0.5,  1.5,  2.5,  3.5])

In [8]: from scipy import stats

In [9]: b = stats.norm.pdf(bins)  # norm是正态分布

In [10]: import matplotlib.pyplot as plt

In [11]: plt.plot(bins, histogram)
Out[11]: [&amp;lt;matplotlib.lines.Line2D at 0x3378b10&amp;gt;]

In [12]: plt.plot(bins, b)
Out[12]: [&amp;lt;matplotlib.lines.Line2D at 0x3378fd0&amp;gt;]

In [13]: plt.show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果我们知道随机过程属于给定的随机过程族，比如正态过程。我们可以对观测值进行最大似然拟合来估计基本分布参数。这里我们对观测值拟合一个正态过程：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [14]: loc, std = stats.norm.fit(a)

In [15]: loc
Out[15]: 0.0052651057415999758

In [16]: std
Out[16]: 0.97945439802779732
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;练习：概率分布&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;从参数为1的伽马分布生成1000个随机数,然后绘制这些样点的直方图。你能够在其上绘制pdf吗(应该匹配)？&lt;/p&gt;

&lt;p&gt;另外：这些分布有些有用的方法。通过阅读它们的文档字符串或使用IPython的tab补全来探索它们。你能够通过对你的随机变量使用拟合找到形状参数1吗？&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;百分位&lt;/h3&gt;

&lt;p&gt;中位数是来观测值之下一半之上一半的值。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [3]: np.median(a)
Out[3]: -0.047679175711778043
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;它也被叫作50百分位点，因为有50%的观测值在它之下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [6]: stats.scoreatpercentile(a, 50)
Out[6]: -0.047679175711778043
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;同样我们可以计算百分之九十百分点：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [7]: stats.scoreatpercentile(a, 90)
Out[7]: 1.2541592439997036
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;百分位是CDF的一个估计器(累积分布函数)。&lt;/p&gt;

&lt;h3 id=&quot;section-4&quot;&gt;统计检测&lt;/h3&gt;

&lt;p&gt;统计检测是决策指示。例如，我们有两个样本集，我们假设它们由高斯过程生成。我们可以使用&lt;a href=&quot;http://en.wikipedia.org/wiki/Student%27s_t-test&quot;&gt;T检验&lt;/a&gt;来决定是否两个样本值显著不同：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [8]: a = np.random.normal(0, 1, size=100)

In [9]: b = np.random.normal(1, 1, size=10)

In [10]: stats.ttest_ind(a, b)
Out[10]: (array(-2.4119199601156796), 0.01755485116571583)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;输出结果由以下部分组成：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;T统计量：它是这么一种标志，与不同两个随机过程之间成比例并且幅度和差异的显著程度有关&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
  &lt;li&gt;p值：两个过程相同的概率。如果接近1,这两个过程是几乎完全相同的。越靠近零，两个过程越可能有不同的均值。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;scipyinterpolate&quot;&gt;插值：scipy.interpolate&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;scipy.interpolate&lt;/code&gt;对从实验数据拟合函数来求值没有测量值存在的点非常有用。这个模块基于来自&lt;a href=&quot;http://www.netlib.org/&quot;&gt;netlib&lt;/a&gt;项目的&lt;a href=&quot;http://www.netlib.org/dierckx/index.html&quot;&gt;FITPACK Fortran 子程序&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;通过想象接近正弦函数的实验数据：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [1]: measured_time = np.linspace(0, 1, 10)

In [2]: noise = (np.random.random(10)*2 - 1) * 1e-1

In [3]: measures = np.sin(2 * np.pi * measured_time) + noise
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;scipy.interpolate.interp1d&lt;/code&gt;类会构建线性插值函数：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [4]: from scipy.interpolate import interp1d

In [5]: linear_interp = interp1d(measured_time, measures)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后&lt;code&gt;scipy.interpolate.linear_interp&lt;/code&gt;实例需要被用来求得感兴趣时间点的值：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [6]: computed_time = np.linspace(0, 1, 50)

In [7]: linear_results = linear_interp(computed_time)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;三次插值也能通过提供可选关键字参数&lt;code&gt;kind&lt;/code&gt;来选择：&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [8]: cubic_interp = interp1d(measured_time, measures, kind='cubic')

In [9]: cubic_results = cubic_interp(computed_time)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;结果现在被集合在以下Matplotlib图像中：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/scipy_interpolation.png&quot; alt=&quot;interpolate&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/pyplots/scipy_interpolation.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;scipy.interpolate.interp2d&lt;/code&gt;与&lt;code&gt;scipy.interpolate.interp1d&lt;/code&gt;相似，但是面向二维数组。注意，对_interp_族，计算时间必须在测量时间范围内。参见&lt;a href=&quot;http://scipy-lectures.github.com/intro/summary-exercises/stats-interpolate.html#summary-exercise-stat-interp&quot;&gt;Maximum wind speed prediction at the Sprogø station&lt;/a&gt;的总结练习获得更高级的插值示例。&lt;/p&gt;

&lt;h2 id=&quot;scipyintegrate-fusy&quot;&gt;数值积分：scipy.integrate &lt;strong&gt;Fusy,&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;最通用的积分程序是&lt;code&gt;scipy.integrate.quad()&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [10]: from scipy.integrate import quad

In [11]: res, err = quad(np.sin, 0, np.pi/2)

In [12]: np.allclose(res, 1)
Out[12]: True

In [13]: np.allclose(err, 1 - res)
Out[13]: True
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;其它可用的积分方案有&lt;code&gt;fixed_quad&lt;/code&gt;,&lt;code&gt;quadrature&lt;/code&gt;,&lt;code&gt;romberg&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;scipy.integrate&lt;/code&gt;也是用来积分常微分方程(ODE)的功能程序。特别是，&lt;code&gt;scipy.integrate.odeint()&lt;/code&gt;是个使用LSODA(Livermore Solver for Ordinary Differential equations with Automatic method switching for stiff and non-stiff problems)通用积分器。参见&lt;a href=&quot;http://people.sc.fsu.edu/~jburkardt/f77_src/odepack/odepack.html&quot;&gt;ODEPACK Fortran library&lt;/a&gt;获得更多细节。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;odeint&lt;/code&gt;解决这种形式的一阶ODE系统：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;``dy/dt = rhs(y1, y2, .., t0,...)``
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;作为简介，让我们解决ODE&lt;code&gt;dy/dt = -2y&lt;/code&gt;,区间&lt;code&gt;t = 0..4&lt;/code&gt;,初始条件&lt;code&gt;y(t=0) = 1&lt;/code&gt;。首先函数计算导数的位置需要被定义：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [17]: def calc_derivative(ypos, time, counter_arr):
   ....:     counter_arr += 1
   ....:     return -2 * ypos                                               
   ....:     
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;一个额外的参数&lt;code&gt;counter_arr&lt;/code&gt;被添加，用来说明函数可能在单个时间步中被多次调用，直到解收敛。计数数组被定义成：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [18]: counter = np.zeros((1,), dtype=np.uint16)            
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;弹道将被计算：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [19]: from scipy.integrate import odeint                                 
In [20]: time_vec = np.linspace(0, 4, 40)                                   
In [21]: yvec, info = odeint(calc_derivative, 1, time_vec,
   ....: args=(counter,), full_output=Tru)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;因此导函数可以被调用40次(即时间步长数)，&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [22]: counter
Out[22]: array([129], dtype=uint16)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;十个最初的时间点(time step)每个的累积迭代次数，可以这样获得：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [23]: info['nfe'][:10]
Out[23]: array([31, 35, 43, 49, 53, 57, 59, 63, 65, 69], dtype=int32)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注意到在第一个时间步的解需要更多的迭代。解&lt;code&gt;yvec&lt;/code&gt;的轨道现在可以被画出：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/odeint_introduction.png&quot; alt=&quot;ODE&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/pyplots/odeint_introduction.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;另一个使用&lt;code&gt;scipy.integrate.odeint()&lt;/code&gt;的例子是一个阻尼弹簧-质点振荡器(二阶振荡)。附加在弹簧上质点的位置服从二阶常微分方程&lt;code&gt;y'' + eps wo y' + wo^2 y= 0&lt;/code&gt;。其中&lt;code&gt;wo^2 = k/m&lt;/code&gt;,k是弹簧常数，m是质量，&lt;code&gt;eps=c/(2 m wo)&lt;/code&gt;，c是阻尼系数。(译者：为什么不用latex……)对于这个例子，我们选择如下参数：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [24]: mass = 0.5  # kg

In [25]: kspring = 4  # N/m

In [26]: cviscous = 0.4  # N s/m
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;所以系统将是阻尼振荡，因为：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [27]: eps = cviscous / (2 * mass * np.sqrt(kspring/mass))

In [28]: eps &amp;lt; 1
Out[28]: True
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;对于&lt;code&gt;scipy,integrate.odeint()&lt;/code&gt;求解器，二阶方程需要被转化成一个包含向量&lt;code&gt;Y =y,y'&lt;/code&gt;的两个一阶方程的系统。定义&lt;code&gt;nu = 2 eps * wo = c / m&lt;/code&gt;和&lt;code&gt;om = wo^2 = k/m&lt;/code&gt;很方便：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [29]: nu_coef = cviscous /mass

In [30]: om_coef = kspring / mass
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;因此函数将计算速度和加速度通过：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [31]: def calc_deri(yvec, time, nuc, omc):
   ....:     return (yvec[1], -nuc * yvec[1] - omc * yvec[0])
   ....: 

In [32]: time_vec = np.linspace(0, 10, 100)

In [33]: yarr = odeint(calc_deri, (1, 0), time_vec, args=(nu_coef, om_coef))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最终的位置和速度在如下Matplotlib图像中显示：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/odeint_damped_spring_mass.png&quot; alt=&quot;ode2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/pyplots/odeint_damped_spring_mass.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Scipy中不存在偏微分方程(PDE)求解器,一些解决PDE问题的Python软件包可以得到，像&lt;a href=&quot;http://www.ctcms.nist.gov/fipy/&quot;&gt;fipy&lt;/a&gt;和&lt;a href=&quot;http://code.google.com/p/sfepy/&quot;&gt;SfePy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(译者注:&lt;a href=&quot;http://hyry.dip.jp:8000/pydoc/scipy_intro.html#id5&quot;&gt;Python科学计算中洛伦兹吸引子微分方程的求解&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;scipysignal&quot;&gt;信号处理：scipy.signal&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;In [34]: from scipy import signal
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;scipy.signal.detrend()&lt;/code&gt;：移除信号的线性趋势：&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [35]: t = np.linspace(0, 5, 100)
  
In [36]: x = t + np.random.normal(size=100)
  
In [39]: import pylab as pl
  
In [40]: pl.plot(t, x, linewidth=3)
Out[40]: [&amp;lt;matplotlib.lines.Line2D at 0x3903c90&amp;gt;]
  
In [41]: pl.plot(t, signal.detrend(x), linewidth=3)
Out[41]: [&amp;lt;matplotlib.lines.Line2D at 0x3b38810&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/demo_detrend.png&quot; alt=&quot;detrend&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/pyplots/demo_detrend.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code&gt;scipy.signal.resample()&lt;/code&gt;:使用FFT重采样n个点。&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [42]: t = np.linspace(0, 5, 100)
  
In [43]: x = np.sin(t)
  
In [44]: pl.plot(t, x, linewidth=3)
Out[44]: [&amp;lt;matplotlib.lines.Line2D at 0x3f08a90&amp;gt;]
  
In [45]: pl.plot(t[::2], signal.resample(x, 50), 'ko')
Out[45]: [&amp;lt;matplotlib.lines.Line2D at 0x3f12950&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://scipy-lectures.github.com/_images/demo_resample.png&quot; alt=&quot;resample&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://scipy-lectures.github.com/plot_directive/pyplots/demo_resample.py&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Signal中有许多窗函数：scipy.signal.hamming(), scipy.signal.bartlett(), scipy.signal.blackman()…&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Signal中有滤波器(中值滤波scipy.signal.medfilt(), 维纳滤波scipy.signal.wiener())，但是我们将在图像部分讨论。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;scipyndimage&quot;&gt;图像处理：scipy.ndimage&lt;/h2&gt;

&lt;p&gt;scipy中致力于图像处理的子模块是&lt;code&gt;scipy,ndimage&lt;/code&gt;。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [49]: from scipy import ndimage
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;图像处理程序可以根据它们执行的操作类别来分类。&lt;/p&gt;

&lt;h3 id=&quot;section-5&quot;&gt;图像的几何变换&lt;/h3&gt;

&lt;p&gt;改变方向，分辨率……&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [50]: from scipy import misc

In [51]: lena = misc.lena()

In [52]: shifted_lena = ndimage.shift(lena, (50, 50))

In [53]: shifted_lena2 = ndimage.shift(lena, (50, 50), mode='nearest')

In [54]: rotated_lena = ndimage.rotate(lena, 30)

In [55]: cropped_lena = lena[50:-50, 50:-50]

In [56]: zoomed_lena = ndimage.zoom(lena, 2)

In [57]: zoomed_lena.shape
Out[57]: (1024, 1024)

In [63]: pl.subplot(321)
Out[63]: &amp;lt;matplotlib.axes.AxesSubplot at 0x4c00d90&amp;gt;

In [64]: pl.imshow(lena, cmap=cm.gray)
Out[64]: &amp;lt;matplotlib.image.AxesImage at 0x493aad0&amp;gt;

In [65]: pl.subplot(322)
Out[65]: &amp;lt;matplotlib.axes.AxesSubplot at 0x4941a10&amp;gt;

In [66]: #等等
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-6&quot;&gt;图像滤镜&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;In [76]: from scipy import misc

In [77]: lena = misc.lena()

In [78]: import numpy as np

In [79]: noisy_lena = np.copy(lena).astype(np.float)

In [80]: noisy_lena += lena.std()*0.5*np.random.standard_normal(lena.shape)

In [81]: blurred_lena = ndimage.gaussian_filter(noisy_lena, sigma=3)

In [82]: median_lena = ndimage.median_filter(blurred_lena, size=5)

In [83]: from scipy import signal

In [84]: wiener_lena = signal.wiener(blurred_lena, (5,5))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;许多其它&lt;code&gt;scipy.ndimage.filters&lt;/code&gt;和&lt;code&gt;scipy.signal&lt;/code&gt;中的滤镜可以被应用到图像中。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;比较不同滤镜图像的直方图&lt;/p&gt;

&lt;h3 id=&quot;section-7&quot;&gt;数学形态学&lt;/h3&gt;

&lt;p&gt;数学形态学是源于几何论的数学形态学。它具有结合结构的特点并变换几何结构。二值图(黑白图)，特别能被用该理论转换：要转换的集合是邻近的非零值像素。这个理论也被拓展到灰度图中。&lt;/p&gt;

&lt;p&gt;基本的数学形态操作使用一个_结构元素(structuring element)_来改变其它几何结构。&lt;/p&gt;

&lt;p&gt;让我们首先生成一个结构元素：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [129]: el = ndimage.generate_binary_structure(2, 1)

In [130]: el
Out[130]: 
array([[False,  True, False],
       [ True,  True,  True],
       [False,  True, False]], dtype=bool)

In [131]: el.astype(np.int)
Out[131]: 
array([[0, 1, 0],
       [1, 1, 1],
       [0, 1, 0]])
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;腐蚀&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [132]: a = np.zeros((7,7), dtype=int)
  
In [133]: a[1:6, 2:5] = 1
  
In [134]: a
Out[134]: 
array([[0, 0, 0, 0, 0, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 0, 0, 0, 0, 0]])
  
In [135]: ndimage.binary_erosion(a).astype(a.dtype)
Out[135]: 
array([[0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 1, 0, 0, 0],
       [0, 0, 0, 1, 0, 0, 0],
       [0, 0, 0, 1, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0]])
  
In [xxx]:# 腐蚀移除对象使结构更小
 
In [136]: ndimage.binary_erosion(a, structure=np.ones((5,5))).astype(a.dtype)
Out[136]: 
array([[0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0]])
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;膨胀&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [137]: a = np.zeros((5,5))
  
In [138]: a[2, 2] = 1
  
In [139]: a
Out[139]: 
array([[ 0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  1.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.]])
  
In [140]: ndimage.binary_dilation(a).astype(a.dtype)
Out[140]: 
array([[ 0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  1.,  0.,  0.],
       [ 0.,  1.,  1.,  1.,  0.],
       [ 0.,  0.,  1.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.]])
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;开操作(opening)&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [141]: a = np.zeros((5,5), dtype=np.int)
  
In [142]: a[1:4, 1:4] = 1; a[4, 4] = 1
  
In [143]: a
Out[143]: 
array([[0, 0, 0, 0, 0],
       [0, 1, 1, 1, 0],
       [0, 1, 1, 1, 0],
       [0, 1, 1, 1, 0],
       [0, 0, 0, 0, 1]])
  
In [144]: # 开操作可以移除小的对象
  
In [145]: ndimage.binary_opening(a, structure=np.ones((3,3))).astype(np.int)Out[145]: 
array([[0, 0, 0, 0, 0],
       [0, 1, 1, 1, 0],
       [0, 1, 1, 1, 0],
       [0, 1, 1, 1, 0],
       [0, 0, 0, 0, 0]])
  
In [146]: # 开操作也能平滑边角
  
In [147]: ndimage.binary_opening(a).astype(np.int)
Out[147]: 
array([[0, 0, 0, 0, 0],
       [0, 0, 1, 0, 0],
       [0, 1, 1, 1, 0],
       [0, 0, 1, 0, 0],
       [0, 0, 0, 0, 0]])
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;闭操作(closing): &lt;code&gt;ndimage.binary_closing&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;查看开操作腐蚀，然后膨胀的量&lt;/p&gt;

&lt;p&gt;一个开操作移除小的结构，而一个闭操作填补小的空洞。这种操作因此可被用来“清理”图像。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [149]: a = np.zeros((50, 50))

In [150]: a[10:-10, 10:-10] = 1

In [151]: a += 0.25*np.random.standard_normal(a.shape)

In [152]: mask = a&amp;gt;=0.5

In [153]: opened_mask = ndimage.binary_opening(mask)

In [154]: closed_mask = ndimage.binary_closing(opened_mask)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;验证重构区域比初始区域更小。(如果闭操作在开操作之前则相反)&lt;/p&gt;

&lt;p&gt;对灰度值图像，腐蚀(或者是膨胀)相当于用被集中在所关心像素点的结构元素所覆盖像素的最小(或最大)值替代当前像素点。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [173]: a = np.zeros((7,7), dtype=np.int)

In [174]: a[1:6, 1:6] = 3

In [175]: a[4,4] = 2; a[2,3] = 1

In [176]: a
Out[176]: 
array([[0, 0, 0, 0, 0, 0, 0],
       [0, 3, 3, 3, 3, 3, 0],
       [0, 3, 3, 1, 3, 3, 0],
       [0, 3, 3, 3, 3, 3, 0],
       [0, 3, 3, 3, 2, 3, 0],
       [0, 3, 3, 3, 3, 3, 0],
       [0, 0, 0, 0, 0, 0, 0]])

In [177]: ndimage.grey_erosion(a, size=(3,3))
Out[177]: 
array([[0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 1, 1, 1, 0, 0],
       [0, 0, 3, 2, 2, 0, 0],
       [0, 0, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 0, 0]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-8&quot;&gt;图像测量&lt;/h3&gt;

&lt;p&gt;让我们首先生成一个漂亮的合成图像：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [178]: x, y = np.indices((100, 100))

In [179]: sig = np.sin(2*np.pi*x/50.)*np.sin(2*np.pi*y/50.)*(1+x*y/50.**2)**2

In [180]: mask = sig &amp;gt; 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在我们查找图像中对象的各种信息：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [181]: labels, nb = ndimage.label(mask)

In [182]: nb
Out[182]: 8

In [183]: areas = ndimage.sum(mask, labels, xrange(1, labels.max()+1))

In [184]: areas
Out[184]: array([ 190.,   45.,  424.,  278.,  459.,  190.,  549.,  424.])

In [185]: maxima = ndimage.maximum(sig, labels, xrange(1, labels.max()+1))
In [186]: maxima
Out[186]: 
array([  1.80238238,   1.13527605,   5.51954079,   2.49611818,
         6.71673619,   1.80238238,  16.76547217,   5.51954079])

In [187]: ndimage.find_objects(labels==4)
Out[187]: [(slice(30L, 48L, None), slice(30L, 48L, None))]

In [188]: sl = ndimage.find_objects(labels==4)

In [189]: import pylab as pl

In [190]: pl.imshow(sig[sl[0]])  
Out[190]: &amp;lt;matplotlib.image.AxesImage at 0xb2fdcd0&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;参见总结练习&lt;a href=&quot;http://scipy-lectures.github.com/intro/summary-exercises/image-processing.html#summary-exercise-image-processing&quot;&gt;Image processing application: counting bubbles and unmolten grains&lt;/a&gt;获取更多高级示例。&lt;/p&gt;

&lt;h2 id=&quot;section-9&quot;&gt;总结练习&lt;/h2&gt;

&lt;p&gt;(译者：我不是很懂……)&lt;/p&gt;

&lt;p&gt;总结练习主要使用Numpy，Scipy和Matplotlib。它们提供一些现实生活中用Python计算的示例。既然基本的Numpy和scipy使用已经被介绍了，欢迎有兴趣的用户尝试这些练习。&lt;/p&gt;

&lt;p&gt;练习：&lt;/p&gt;

&lt;p&gt;建议的解决方案：&lt;/p&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/BFGS_method&quot;&gt;BFGS算法&lt;/a&gt;&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Brute-force_search&quot;&gt;Brute-Force方法&lt;/a&gt;&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;……这解释，我真不懂。但t统计量是什么我知道……&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;numpy 0.17可能会有bug&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>优化代码(Python)</title>
   <link href="http://reverland.org/python/2012/10/19/python"/>
   <updated>2012-10-19T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/10/19/python</id>
   <content type="html">
&lt;h1 id=&quot;section&quot;&gt;优化代码&lt;/h1&gt;

&lt;p&gt;翻译自：&lt;a href=&quot;http://scipy-lectures.github.com/advanced/optimizing/index.html&quot;&gt;http://scipy-lectures.github.com/advanced/optimizing/index.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;作者:Gaël Varoquaux&lt;/p&gt;

&lt;p&gt;License:Creative Commons Attribution 3.0 United States License (CC-by) http://creativecommons.org/licenses/by/3.0/us&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;过早的优化是罪恶的根源。&lt;/p&gt;

  &lt;p&gt;——Donald. Knuth&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这个章节涉及使Python代码运行更快的策略。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;先决条件&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;line_profiler(&lt;a href=&quot;http://packages.python.org/line_profiler/&quot;&gt;http://packages.python.org/line_profiler/&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;优化工作流&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#profilepython&quot;&gt;剖析(profile)Python代码&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#timeit&quot;&gt;Timeit&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#profiler&quot;&gt;分析器(Profiler)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#line-profiler&quot;&gt;Line-profiler&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;让代码更快&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;算法优化&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#svd&quot;&gt;SVD的示例&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;写更快的数值代码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-1&quot;&gt;优化工作流&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;让它工作：以简单_清晰_的方式书写代码。&lt;/li&gt;
  &lt;li&gt;让它可靠的动作：书写自动化的测试实例，确认你的算法是正确的。如果你中止它，测试将捕捉到中断。&lt;/li&gt;
  &lt;li&gt;优化代码：通过剖析(profile)简单的用例来发现瓶颈，并且加速这些瓶颈，找到更好的算法或实现。记住在剖析一个现实的实例和代码的简洁与执行速度之间权衡。对于有效率的工作，最好让剖析运行约十秒。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;profilepython&quot;&gt;剖析(profile)Python代码&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;非测量，不优化&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;测量&lt;/em&gt;：剖析(profiling)， 计时(timing)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;timeit&quot;&gt;Timeit&lt;/h3&gt;

&lt;p&gt;在Ipython中，使用&lt;code&gt;timeit&lt;/code&gt;(&lt;a href=&quot;http://docs.python.org/library/timeit.html&quot;&gt;http://docs.python.org/library/timeit.html&lt;/a&gt;)来计算基本运算时间。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [1]: import numpy as np

In [2]: a = np.arange(1000)

In [3]: %timeit a ** 2
100000 loops, best of 3: 3.55 us per loop

In [4]: %timeit a ** 2.1
10000 loops, best of 3: 105 us per loop

In [5]: %timeit a * a
100000 loops, best of 3: 3.5 us per loop
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;使用这个指引你的策略选择。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;对于长时间运行的调用，使用&lt;code&gt;%time&lt;/code&gt;代替&lt;code&gt;%timeit&lt;/code&gt;;虽然精确度降低但运行更快。&lt;/p&gt;

&lt;h3 id=&quot;profiler&quot;&gt;分析器(Profiler)&lt;/h3&gt;

&lt;p&gt;当你有个很大的程序去分析时会有用，例如以下文件：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mport&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;scipy&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linalg&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sklearn.decomposition&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fastica&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# from mdp import fastica&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linalg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;svd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pca&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;results&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fastica&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pca&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;whiten&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在IPython中我们可以测量脚本运行时间：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [6]: %run -t demo.py

IPython CPU timings (estimated):
  User   :      11.03 s.
  System :       0.43 s.
Wall time:      13.12 s.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后分析(profile)它：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;1169 function calls in 10.765 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        2   10.693    5.346   10.699    5.350 decomp_svd.py:14(svd)
      144    0.040    0.000    0.040    0.000 {numpy.core.multiarray.dot}
        1    0.015    0.015    0.015    0.015 {method 'random_sample' of 'mtrand.RandomState' objects}
       20    0.005    0.000    0.007    0.000 function_base.py:526(asarray_chkfinite)
        1    0.003    0.003   10.764   10.764 demo.py:1(&amp;lt;module&amp;gt;)
       18    0.002    0.000    0.002    0.000 decomp.py:197(eigh)
       17    0.001    0.000    0.001    0.000 fastica_.py:219(gprime)
       40    0.001    0.000    0.001    0.000 {method 'any' of 'numpy.ndarray' objects}
       17    0.001    0.000    0.001    0.000 fastica_.py:215(g)
        1    0.001    0.001    0.008    0.008 fastica_.py:88(_ica_par)
        1    0.001    0.001   10.764   10.764 {execfile}
       52    0.000    0.000    0.001    0.000 twodim_base.py:220(diag)
       18    0.000    0.000    0.003    0.000 fastica_.py:40(_sym_decorrelation)
       18    0.000    0.000    0.000    0.000 {method 'mean' of 'numpy.ndarray' objects}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;显然&lt;code&gt;svd&lt;/code&gt;(在_decomp.py_中)是占用我们时间最多的东西，即瓶颈。我们得找到一种方法来让这一步运行更快，或者避免这一步(算法优化)。加速代码剩下的部分并无益处。&lt;/p&gt;

&lt;h3 id=&quot;line-profiler&quot;&gt;Line-profiler&lt;/h3&gt;

&lt;p&gt;分析器(profiler)很棒：它告诉我们那个函数费时最多，但并不是它在哪里调用。&lt;/p&gt;

&lt;p&gt;对此，我们使用&lt;a href=&quot;http://packages.python.org/line_profiler/&quot;&gt;line_profiler&lt;/a&gt;：在原文件中，我们用&lt;code&gt;@profile&lt;/code&gt;修饰一些我们想要检查的函数(不用导入它)：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;&lt;span class=&quot;nd&quot;&gt;@profile&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linalg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;svd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pca&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;results&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fastica&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pca&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;whiten&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后我们使用&lt;a href=&quot;packages.python.org/line_profiler/kernprof.py&quot;&gt;kernprof.py&lt;/a&gt;程序，用-l和-v：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;lyy@arch ~ % kernprof.py -l -v demo.py
Wrote profile results to demo.py.lprof
Timer unit: 1e-06 s

File: demo.py
Function: test at line 6
Total time: 10.5932 s

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     6                                           @profile
     7                                           def test():
     8         1        11070  11070.0      0.1          data = np.random.random((5000, 100))
     9         1     10530291 10530291.0     99.4          u, s, v = linalg.svd(data)
    10         1        31026  31026.0      0.3          pca = np.dot(u[:10, :], data)
    11         1        20766  20766.0      0.2          results = fastica(pca.T)

kernprof.py -l -v demo.py  12.57s user 0.25s system 99% cpu 12.891 total
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;SVD占用了大部分时间&lt;/em&gt;。我们需要优化这行。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;让代码更快&lt;/h2&gt;

&lt;p&gt;一旦我们确认了瓶颈，我们需要让相应的代码运行更快。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;算法优化&lt;/h3&gt;

&lt;p&gt;首先寻找算法优化：有没有运算更少或更好的方式？&lt;/p&gt;

&lt;p&gt;对于更高层次地看待问题，充分理解算法后的数学很有帮助。然而，寻找简单的改变并不寻常，像_移动计算&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;和在循环外分配内存&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;_,会带来很大益处。&lt;/p&gt;

&lt;h4 id=&quot;svd&quot;&gt;SVD的示例&lt;/h4&gt;

&lt;p&gt;在以上每个例子中，SVD——&lt;a href=&quot;http://en.wikipedia.org/wiki/Singular_value_decomposition&quot;&gt;奇异值分解&lt;/a&gt;——是占用时间最多的。确实，当输入矩阵大小为n时算法计算代价大约是$n^3$。&lt;/p&gt;

&lt;p&gt;然而，这些例子中，我们都没有使用SVD的输出，但是仅仅使用它最开始返回的参数最初很少的几行。如果我们使用scipy的&lt;code&gt;svd&lt;/code&gt;实现，我们可以获得一个不完整的SVD版本。注意这个在scipy中的线性代数实现比numpy中的更加丰富，应该优先使用。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [4]: %timeit np.linalg.svd(data)
1 loops, best of 3: 10.8 s per loop

In [5]: from scipy import linalg

In [6]: %timeit linalg.svd(data)
1 loops, best of 3: 10.4 s per loop

In [7]: %timeit linalg.svd(data, full_matrices=False)
1 loops, best of 3: 278 ms per loop

In [8]: %timeit np.linalg.svd(data, full_matrices=False)
1 loops, best of 3: 276 ms per loop
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;真正的不完全SVD，例如仅仅计算前十个特征向量，可以用arpack&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;计算，可以在&lt;code&gt;scipy.sparse.linalg.eigsh&lt;/code&gt;获得。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;计算线性代数&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;对于确定的算法，许多瓶颈将是线性代数计算。在本例中，使用正确的函数解决正确的问题是关键。例如，一个对称矩阵的本征值问题比一个普通矩阵更容易解决。同样的，很多时候，你可以避免反转矩阵，并且使用代价更小(并更数值稳定)的运算。&lt;/p&gt;

&lt;p&gt;了解你的线性代数计算。当有疑问时，探索scipy.linalg，并且用%timeit 来对你的数据尝试不同的选择。&lt;/p&gt;

&lt;h2 id=&quot;section-4&quot;&gt;写更快的数值代码&lt;/h2&gt;

&lt;p&gt;一个完整的关于使用numpy的讨论可以在&lt;a href=&quot;http://scipy-lectures.github.com/advanced/advanced_numpy/index.html#advanced-numpy&quot;&gt;Advanced Numpy&lt;/a&gt;章节中找到，或者在van der Walt等人的文章&lt;a href=&quot;http://hal.inria.fr/inria-00564007/en&quot;&gt;The NumPy array: a structure for efficient numerical computation&lt;/a&gt;中。这里我们仅仅讨论加速代码运行速度常见的技巧。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;向量化循环&lt;/p&gt;

    &lt;p&gt;找到技巧来避免使用numpy数组循环。对此，掩码(masks)数组和索引(indices)数组会更有用。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;广播&lt;/p&gt;

    &lt;p&gt;使用&lt;a href=&quot;http://scipy-lectures.github.com/intro/numpy/operations.html#broadcasting&quot;&gt;广播(broadcasting)&lt;/a&gt;来在结合它们之前对数组尽可能少的运算。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;在适当的位置运算&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [9]: a = np.zeros(1e7)
In [11]: %timeit global a ; a *= 0
10 loops, best of 3: 29.1 ms per loop
  
in [12]: %timeit global a ; a = 0*a
10 loops, best of 3: 54.3 ms per loop
 
**注意：**我们需要个`global a`让timeit工作，因为它被赋给a，因此将它视作一个局部变量。
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;善待内存：使用视图(views)而非拷贝(copies)&lt;/p&gt;

    &lt;p&gt;拷贝一个大数组就像对它们进行简单的数值计算一样耗费资源&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [18]: a = np.zeros(1e7)
  
In [19]: %timeit a.copy()
10 loops, best of 3: 69 ms per loop
  
In [20]: %timeit a + 1
10 loops, best of 3: 56.2 ms per loop
&lt;/code&gt;&lt;/pre&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;小心缓存影响(cache effects)&lt;/p&gt;

    &lt;p&gt;内存存取当是成组时是省资源的：以连续的方式存取一个大数组比随机存取更快。这意味着除其它事项外更小的元素间距更快(参见&lt;a href=&quot;http://scipy-lectures.github.com/advanced/advanced_numpy/index.html#cache-effects&quot;&gt;CPU cache effects&lt;/a&gt;)&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

    &lt;p&gt;In [21]: c = np.zeros((1e4, 1e4), order=’C’)&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [22]: %timeit c.sum(axis=0)
1 loops, best of 3: 3.62 s per loop
  
In [23]: %timeit c.sum(axis=1)
10 loops, best of 3: 171 ms per loop
  
In [24]: c.strides
Out[24]: (80000, 8)

In [25]: c = np.zeros((1e4, 1e4), order='F')
  
In [26]: %timeit c.sum(axis=0)
1 loops, best of 3: 166 ms per loop
  
In [27]: %timeit c.sum(axis=1)
1 loops, best of 3: 3.63 s per loop
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;这就是为何Fortran顺序或C顺序可能对运算的影响很大：&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;in [28]: a = np.random.rand(20, 2**18)
  
in [29]: b = np.random.rand(20, 2**18)
  
in [30]: %timeit np.dot(b, a.T)
1 loops, best of 3: 278 ms per loop
  
in [31]: c = np.ascontiguousarray(a.T)
  
in [32]: %timeit np.dot(b, c)
1 loops, best of 3: 1.94 s per loop
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;注意拷贝数据来解决这个影响不值得：&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;In [34]: %timeit c = np.ascontiguousarray(a.T)
10 loops, best of 3: 45.4 ms per loop
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;使用numexpr来自动为这种效应优化会很有用。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用编译好的代码&lt;/p&gt;

    &lt;p&gt;一旦你确定所有高层次的优化都已经摸索过了，最后手段是将热点，也就是耗费时间最多的代码或函数，变成编译好的代码。对于编译代码，最优的选择是使用&lt;a href=&quot;http://www.cython.org/&quot;&gt;Cython&lt;/a&gt;:它很轻松地让你将已知的Python代码转换成编译好的代码，并且对numpy数组很好利用&lt;a href=&quot;http://docs.cython.org/src/tutorial/numpy.html&quot;&gt;numpy支持&lt;/a&gt;产生有效率的代码，例如通过循环展开(unrolling loops)。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Waring:&lt;/strong&gt;对上述所有流程，分析(profile)并且计时(time)你的选择。不要以理论为依据来进行优化。&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;存疑&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;我不懂&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/ARPACK&quot;&gt;Arpack——fortran数值计算库&lt;/a&gt;&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;python科学计算里numpy部分讲得非常清楚，第二种间距小的明显快了很多。&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>Scikit Learn: 在python中机器学习</title>
   <link href="http://reverland.org/python/2012/10/14/scikit-learn-machine-learning-in-python"/>
   <updated>2012-10-14T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/10/14/scikit-learn-machine-learning-in-python</id>
   <content type="html">
&lt;h1 id=&quot;scikit-learn-python&quot;&gt;Scikit Learn: 在python中机器学习&lt;/h1&gt;

&lt;div class=&quot;alert alert-danger&quot;&gt;
  &lt;p&gt;&lt;strong&gt;&lt;em&gt;Warning&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;警告：渣翻译，很多我自己都没看懂.但我会慢慢看慢慢修改，此文档维护中……&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;翻译自：&lt;a href=&quot;http://scipy-lectures.github.com/advanced/scikit-learn/index.html&quot;&gt;Scikit Learn:Machine Learning in Python&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;作者:	Fabian Pedregosa, Gael Varoquaux&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;先决条件&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Numpy, Scipy&lt;/li&gt;
  &lt;li&gt;IPython&lt;/li&gt;
  &lt;li&gt;matplotlib&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://scikit-learn.org&quot;&gt;scikit-learn&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;载入示例数据&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#digits-datasets&quot;&gt;一个改变数据集大小的示例：数码数据集(digits datasets)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;学习和预测&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;分类&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#kknn&quot;&gt;K最近邻(KNN)分类器&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;训练集和测试集&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#svms&quot;&gt;分类支持向量机(SVMs)&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;线性支持向量机&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-5&quot;&gt;使用核&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-6&quot;&gt;聚类：将观测值聚合&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#k&quot;&gt;k均值聚类&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-7&quot;&gt;应用到图像压缩&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-8&quot;&gt;用主成分分析降维&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-9&quot;&gt;将一切放在一起：人脸识别&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-10&quot;&gt;线性模型：从回归到稀疏&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-11&quot;&gt;稀疏模型&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-12&quot;&gt;同一问题的不同算法&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-13&quot;&gt;模型选择：选择估计器和它们的参数&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-14&quot;&gt;格点搜索和交叉验证估计器&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-15&quot;&gt;格点搜索&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-16&quot;&gt;交叉验证估计器&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#footnotes&quot;&gt;Footnotes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
  &lt;p&gt;警告：在0.9版中(2011年9月发行)，scikit-learn的导入路径从&lt;code&gt;scikits.learn&lt;/code&gt;更改为&lt;code&gt;sklearn&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;section&quot;&gt;载入示例数据&lt;/h2&gt;

&lt;p&gt;首先我们载入一些用来玩耍的数据。我们将使用的数据是非常简单的著名的花朵数据——安德森鸢尾花卉数据集。&lt;/p&gt;

&lt;p&gt;我们有一百五十个鸢尾花的一些尺寸的观测值：萼片长度、宽度，花瓣长度和宽度。还有它们的亚属：山鸢尾（Iris setosa）、变色鸢尾（Iris versicolor）和维吉尼亚鸢尾（Iris virginica）&lt;/p&gt;

&lt;p&gt;向python对象载入数据：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [1]: from sklearn import datasets
In [2]: iris = datasets.load_iris()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;数据存储在&lt;code&gt;.data&lt;/code&gt;项中，是一个&lt;code&gt;(n_samples, n_features)&lt;/code&gt;数组。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [3]: iris.data.shape
Out[3]: (150, 4)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;每个观察对象的种类存贮在数据集的&lt;code&gt;.target&lt;/code&gt;属性中。这是一个长度为&lt;code&gt;n_samples&lt;/code&gt;的整数一维数组:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [5]: iris.target.shape
Out[5]: (150,)

In [6]: import numpy as np

In [7]: np.unique(iris.target)
Out[7]: array([0, 1, 2])
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;digits-datasets&quot;&gt;一个改变数据集大小的示例：数码数据集(digits datasets)&lt;/h4&gt;

&lt;p&gt;数码数据集&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;包括1797个图像，每一个都是个代表手写数字的8x8像素图像&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [8]: digits = datasets.load_digits()

In [9]: digits.images.shape
Out[9]: (1797, 8, 8)

In [10]: import pylab as pl

In [11]: pl.imshow(digits.images[0], cmap=pl.cm.gray_r) 
Out[11]: &amp;lt;matplotlib.image.AxesImage at 0x3285b90&amp;gt;

In [13]: pl.show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;为了在scikit中使用这个数据集，我们把每个8x8图像转换成长度为64的矢量。(译者注：或者直接用&lt;code&gt;digits.data&lt;/code&gt;)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [12]: data = digits.images.reshape((digits.images.shape[0], -1))
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-1&quot;&gt;学习和预测&lt;/h3&gt;

&lt;p&gt;现在我们已经获得一些数据，我们想要从中学习和预测一个新的数据。在&lt;code&gt;scikit-learn&lt;/code&gt;中，我们通过创建一个&lt;code&gt;估计器(estimator)&lt;/code&gt;从已经存在的数据学习，并且调用它的&lt;code&gt;fit(X,Y)&lt;/code&gt;方法。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [14]: from sklearn import svm

In [15]: clf = svm.LinearSVC()

In [16]: clf.fit(iris.data, iris.target) # learn from the data 
Out[16]: 
LinearSVC(C=1.0, class_weight=None, dual=True, fit_intercept=True,
     intercept_scaling=1, loss='l2', multi_class='ovr', penalty='l2',
     tol=0.0001, verbose=0)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;一旦我们已经从数据学习，我们可以使用我们的模型来预测未观测数据最可能的结果。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [17]: clf.predict([[ 5.0,  3.6,  1.3,  0.25]])
Out[17]: array([0], dtype=int32)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;注意：&lt;/strong&gt;我们可以通过它以下划线结束的属性存取模型的参数：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [18]: clf.coef_  
Out[18]: 
array([[ 0.18424352,  0.45122644, -0.8079467 , -0.45071302],
       [ 0.05190619, -0.89423619,  0.40519245, -0.93781587],
       [-0.85087844, -0.98667529,  1.38088883,  1.86538111]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-2&quot;&gt;分类&lt;/h2&gt;

&lt;h3 id=&quot;kknn&quot;&gt;K最近邻(KNN)分类器&lt;/h3&gt;

&lt;p&gt;最简单的可能的分类器是最近邻：给定一个新的观测值，将n维空间中最靠近它的训练样本标签给它。其中n是每个样本中特性(features)数。&lt;/p&gt;

&lt;p&gt;k最近邻&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;分类器内部使用基于球树(ball tree)&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;来代表它训练的样本。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;KNN分类示例&lt;/strong&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [19]: # Create and fit a nearest-neighbor classifier

In [20]: from sklearn import neighbors

In [21]: knn = neighbors.KNeighborsClassifier()

In [22]: knn.fit(iris.data, iris.target) 
Out[22]: 
KNeighborsClassifier(algorithm='auto', leaf_size=30, n_neighbors=5, p=2,
           warn_on_equidistant=True, weights='uniform')

In [23]: knn.predict([[0.1, 0.2, 0.3, 0.4]])
Out[23]: array([0])
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;section-3&quot;&gt;训练集和测试集&lt;/h4&gt;

&lt;p&gt;当验证学习算法时，不要用一个用来拟合估计器的数据来验证估计器的预测非常重要。确实，通过kNN估计器，我们将总是获得关于训练集完美的预测。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [24]: perm = np.random.permutation(iris.target.size)

In [25]: iris.data = iris.data[perm]

In [26]: iris.target = iris.target[perm]

In [27]: knn.fit(iris.data[:100], iris.target[:100]) 
Out[27]: 
KNeighborsClassifier(algorithm='auto', leaf_size=30, n_neighbors=5, p=2,
           warn_on_equidistant=True, weights='uniform')

In [28]: knn.score(iris.data[100:], iris.target[100:]) 
/usr/lib/python2.7/site-packages/sklearn/neighbors/classification.py:129: NeighborsWarning: kneighbors: neighbor k+1 and neighbor k have the same distance: results will be dependent on data order.
  neigh_dist, neigh_ind = self.kneighbors(X)
Out[28]: 0.95999999999999996
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Bonus的问题：为什么我们使用随机的排列？&lt;/p&gt;

&lt;h3 id=&quot;svms&quot;&gt;分类支持向量机(SVMs)&lt;/h3&gt;

&lt;h4 id=&quot;section-4&quot;&gt;线性支持向量机&lt;/h4&gt;

&lt;p&gt;SVMs&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;尝试构建一个两个类别的最大间隔超平面。它选择输入的子集，调用支持向量即离分离的超平面最近的样本点。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [60]: from sklearn import svm

In [61]: svc = svm.SVC(kernel='linear')

In [62]: svc.fit(iris.data, iris.target)
Out[62]: 
SVC(C=1.0, cache_size=200, class_weight=None, coef0=0.0, degree=3, gamma=0.0,
  kernel='linear', probability=False, shrinking=True, tol=0.001,
  verbose=False)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;scikit-learn&lt;/code&gt;中有好几种支持向量机实现。最普遍使用的是&lt;code&gt;svm.SVC&lt;/code&gt;，&lt;code&gt;svm.NuSVC&lt;/code&gt;和&lt;code&gt;svm.LinearSVC&lt;/code&gt;;“SVC”代表支持向量分类器(Support Vector Classifier)(也存在回归SVMs，在&lt;code&gt;scikit-learn&lt;/code&gt;中叫作“SVR”)。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;训练一个数字数据集的&lt;code&gt;svm.SVC&lt;/code&gt;。省略最后10%并且检验观测值的预测表现。&lt;/p&gt;

&lt;h4 id=&quot;section-5&quot;&gt;使用核&lt;/h4&gt;

&lt;p&gt;类别不总是可以用超平面分离，所以人们指望有些可能是多项式或指数实例的非线性决策函数：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;线性核&lt;/p&gt;

    &lt;p&gt;svc = svm.SVC(kernel=’linear’)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;多项式核&lt;/p&gt;

    &lt;p&gt;svc = svm.SVC(kernel=’poly’,
  …               degree=3)
  # degree: polynomial degree&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;RBF核(径向基函数)&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

    &lt;p&gt;svc = svm.SVC(kernel=’rbf’)
   # gamma: inverse of size of
   # radial kernel&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;以上提到的哪些核对数字数据集有更好的预测性能？(译者：前两个)&lt;/p&gt;

&lt;h2 id=&quot;section-6&quot;&gt;聚类：将观测值聚合&lt;/h2&gt;

&lt;p&gt;给定鸢尾花数据集，如果我们知道这有三种鸢尾花，但是无法得到它们的标签，我们可以尝试&lt;em&gt;非监督学习&lt;/em&gt;：我们可以通过某些标准&lt;em&gt;聚类&lt;/em&gt;观测值到几个组别里。&lt;/p&gt;

&lt;h3 id=&quot;k&quot;&gt;k均值聚类&lt;/h3&gt;

&lt;p&gt;最简答的聚类算法是k均值算法。这将一个数据分成k个集群，以最小化观测值(n维空间中)到聚类中心的均值来分配每个观测点到集群;然后均值重新被计算。这个操作递归运行直到聚类收敛，在&lt;code&gt;max_iter&lt;/code&gt;回合内到最大值。&lt;sup id=&quot;fnref:7&quot;&gt;&lt;a href=&quot;#fn:7&quot; rel=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;(一个替代的k均值算法实现在scipy中的&lt;code&gt;cluster&lt;/code&gt;包中。这个&lt;code&gt;scikit-learn&lt;/code&gt;实现与之不同，通过提供对象API和几个额外的特性，包括智能初始化。)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [82]: from sklearn import cluster, datasets

In [83]: iris = datasets.load_iris()

In [84]: k_means = cluster.KMeans(k=3)

In [85]: k_means.fit(iris.data) 
Out[85]: 
KMeans(copy_x=True, init='k-means++', k=3, max_iter=300, n_init=10, n_jobs=1,
    precompute_distances=True,
    random_state=&amp;lt;mtrand.RandomState object at 0x7f4d860642d0&amp;gt;, tol=0.0001,
    verbose=0)

In [86]: print k_means.labels_[::10]
[1 1 1 1 1 2 2 2 2 2 0 0 0 0 0]

In [87]: print iris.target[::10]
[0 0 0 0 0 1 1 1 1 1 2 2 2 2 2]
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;section-7&quot;&gt;应用到图像压缩&lt;/h4&gt;

&lt;p&gt;译者注：Lena是经典的图像处理实例图像, 8位灰度色深, 尺寸512 x 512&lt;/p&gt;

&lt;p&gt;聚类可以被看作是一种从信息中选择一小部分观测值。例如，这个可以被用来海报化一个图像(将连续变化的色调转换成更少几个色调)：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [95]: from scipy import misc

In [96]: lena = misc.lena().astype(np.float32)

In [97]: X = lena.reshape((-1, 1)) # We need an (n_sample, n_feature) array

In [98]: k_means = cluster.KMeans(5)

In [99]: k_means.fit(X)
Out[99]: 
KMeans(copy_x=True, init='k-means++', k=5, max_iter=300, n_init=10, n_jobs=1,
    precompute_distances=True,
    random_state=&amp;lt;mtrand.RandomState object at 0x7f4d860642d0&amp;gt;, tol=0.0001,
    verbose=0)

In [100]: values = k_means.cluster_centers_.squeeze()

In [101]: labels = k_means.labels_

In [102]: lena_compressed = np.choose(labels, values)

In [103]: lena_compressed.shape = lena.shape
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;译者注：想看效果？&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [31]: import matplotlib.pyplot as plt

In [32]: plt.gray()

In [33]: plt.imshow(lena_compressed)
Out[33]: &amp;lt;matplotlib.image.AxesImage at 0x4b2c510&amp;gt;

In [34]: plt.show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;原图类似。&lt;/p&gt;

&lt;p&gt;![Image]&lt;/p&gt;

&lt;h2 id=&quot;section-8&quot;&gt;用主成分分析降维&lt;/h2&gt;

&lt;p&gt;以上根据观测值标记的点云在一个方向非常平坦，所以一个特性几乎可以用其它两个确切地计算。PCA发现哪个方向的数据不是平的并且它可以通过在一个子空间投影来降维。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;警告：&lt;/strong&gt;PCA将在模块&lt;code&gt;decomposition&lt;/code&gt;或&lt;code&gt;pca&lt;/code&gt;中，这取决于你scikit-learn的版本。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [75]: from sklearn import decomposition

In [76]: pca = decomposition.PCA(n_components=2)

In [77]: pca.fit(iris.data)
Out[77]: PCA(copy=True, n_components=2, whiten=False)

In [78]: X = pca.transform(iris.data)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在我们可以可视化(降维过的)鸢尾花数据集：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [79]: import pylab as pl

In [80]: pl.scatter(X[:, 0], X[:, 1], c=iris.target)
Out[80]: &amp;lt;matplotlib.collections.PathCollection at 0x4104310&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PCA不仅在可视化高维数据集时非常有用。它可以用来作为帮助加速对高维数据不那么有效率的监督方法&lt;sup id=&quot;fnref:6&quot;&gt;&lt;a href=&quot;#fn:6&quot; rel=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;的预处理步骤。&lt;/p&gt;

&lt;h2 id=&quot;section-9&quot;&gt;将一切放在一起：人脸识别&lt;/h2&gt;

&lt;p&gt;一个实例使用主成分分析来降维和支持向量机来分类进行人脸识别。&lt;/p&gt;

&lt;p&gt;译者注：让程序自动下载(确保联网，文件较大，要等待很久)或者手动下载&lt;a href=&quot;http://vis-www.cs.umass.edu/lfw/lfw-funneled.tgz&quot;&gt;数据&lt;/a&gt;并放到&lt;code&gt;./scikit_learn_data/lfw_home/&lt;/code&gt;下。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&quot;&quot;&quot;
Stripped-down version of the face recognition example by Olivier Grisel

http://scikit-learn.org/dev/auto_examples/applications/face_recognition.html

## original shape of images: 50, 37
&quot;&quot;&quot;
import numpy as np
import pylab as pl
from sklearn import cross_validation, datasets, decomposition, svm

# ..
# .. load data ..
lfw_people = datasets.fetch_lfw_people(min_faces_per_person=70, resize=0.4)
perm = np.random.permutation(lfw_people.target.size)
lfw_people.data = lfw_people.data[perm]
lfw_people.target = lfw_people.target[perm]
faces = np.reshape(lfw_people.data, (lfw_people.target.shape[0], -1))
train, test = iter(cross_validation.StratifiedKFold(lfw_people.target, k=4)).next()
X_train, X_test = faces[train], faces[test]
y_train, y_test = lfw_people.target[train], lfw_people.target[test]

# ..
# .. dimension reduction ..
pca = decomposition.RandomizedPCA(n_components=150, whiten=True)
pca.fit(X_train)
X_train_pca = pca.transform(X_train)
X_test_pca = pca.transform(X_test)

# ..
# .. classification ..
clf = svm.SVC(C=5., gamma=0.001)
clf.fit(X_train_pca, y_train)

# ..
# .. predict on new images ..
for i in range(10):
    print lfw_people.target_names[clf.predict(X_test_pca[i])[0]]
    _ = pl.imshow(X_test[i].reshape(50, 37), cmap=pl.cm.gray)
    _ = raw_input()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;全部代码：&lt;a href=&quot;http://scipy-lectures.github.com/_downloads/faces.py&quot;&gt;face.py&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-10&quot;&gt;线性模型：从回归到稀疏&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;糖尿病数据集&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;糖尿病数据集包含442个病人的测量而得的10项生理指标(年龄，性别，体重，血压)，和一年后疾病进展的指示：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [104]: diabetes = datasets.load_diabetes()

In [105]: diabetes_X_train = diabetes.data[:-20]

In [106]: diabetes_X_test  = diabetes.data[-20:]

In [107]: diabetes_y_train = diabetes.target[:-20]

In [108]: diabetes_y_test  = diabetes.target[-20:]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个手头的任务是用来从生理指标预测疾病。&lt;/p&gt;

&lt;h3 id=&quot;section-11&quot;&gt;稀疏模型&lt;/h3&gt;

&lt;p&gt;为了改善问题的条件(无信息变量，减少维度的不利影响，作为一个特性(feature)选择的预处理，等等)，我们只关注有信息的特性将没有信息的特性设置为0.这个罚则函数法&lt;sup id=&quot;fnref:8&quot;&gt;&lt;a href=&quot;#fn:8&quot; rel=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;,叫作&lt;em&gt;套索(Lasso)&lt;/em&gt;&lt;sup id=&quot;fnref:9&quot;&gt;&lt;a href=&quot;#fn:9&quot; rel=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;，可以将一些系数设置为0.这些方法叫作&lt;em&gt;稀疏方法(sparse method)&lt;/em&gt;，稀疏化可以被视作奥卡姆剃刀：相对于复杂模型更倾向于简单的。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [109]: from sklearn import linear_model

In [110]: regr = linear_model.Lasso(alpha=.3)

In [111]: regr.fit(diabetes_X_train, diabetes_y_train)
Out[111]: 
Lasso(alpha=0.3, copy_X=True, fit_intercept=True, max_iter=1000,
   normalize=False, positive=False, precompute='auto', tol=0.0001,
   warm_start=False)

In [112]: regr.coef_ # very sparse coefficients
Out[112]: 
array([   0.        ,   -0.        ,  497.34075682,  199.17441034,
         -0.        ,   -0.        , -118.89291545,    0.        ,
        430.9379595 ,    0.        ])

In [113]: regr.score(diabetes_X_test, diabetes_y_test) 
Out[113]: 0.55108354530029791
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个分数和线性回归(最小二乘法)非常相似：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [114]: lin = linear_model.LinearRegression()

In [115]: lin.fit(diabetes_X_train, diabetes_y_train) 
Out[115]: LinearRegression(copy_X=True, fit_intercept=True, normalize=False)

In [116]: lin.score(diabetes_X_test, diabetes_y_test) 
Out[116]: 0.58507530226905713
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&quot;section-12&quot;&gt;同一问题的不同算法&lt;/h4&gt;

&lt;p&gt;同一数学问题可以用不同算法解决。例如,sklearn中的&lt;em&gt;Lasso&lt;/em&gt;对象使用坐标下降(coordinate descent)方法&lt;sup id=&quot;fnref:10&quot;&gt;&lt;a href=&quot;#fn:10&quot; rel=&quot;footnote&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;解决套索回归，这在大数据集时非常有效率。然而，sklearn也提供了&lt;em&gt;LassoLARS&lt;/em&gt;对象，使用LARS这种在解决权重向量估计非常稀疏，观测值很少的问题很有效率的方法。&lt;/p&gt;

&lt;h2 id=&quot;section-13&quot;&gt;模型选择：选择估计器和它们的参数&lt;/h2&gt;

&lt;h3 id=&quot;section-14&quot;&gt;格点搜索和交叉验证估计器&lt;/h3&gt;

&lt;h4 id=&quot;section-15&quot;&gt;格点搜索&lt;/h4&gt;

&lt;p&gt;scikit-learn提供了一个对象，该对象给定数据，在拟合一个参数网格的估计器时计算分数，并且选择参数最大化交叉验证分数。这个对象在构建时采用一个估计器并且暴露一个估计器API：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [117]: from sklearn import svm, grid_search

In [118]: gammas = np.logspace(-6, -1, 10)

In [119]: svc = svm.SVC()

In [120]: clf = grid_search.GridSearchCV(estimator=svc, param_grid=dict(gamma=gammas),n_jobs=-1)

In [121]: clf.fit(digits.data[:1000], digits.target[:1000]) 
Out[121]: 
GridSearchCV(cv=None,
       estimator=SVC(C=1.0, cache_size=200, class_weight=None, coef0=0.0, degree=3, gamma=0.0,
  kernel='rbf', probability=False, shrinking=True, tol=0.001,
  verbose=False),
       fit_params={}, iid=True, loss_func=None, n_jobs=-1,
       param_grid={'gamma': array([  1.00000e-06,   3.59381e-06,   1.29155e-05,   4.64159e-05,
         1.66810e-04,   5.99484e-04,   2.15443e-03,   7.74264e-03,
         2.78256e-02,   1.00000e-01])},
       pre_dispatch='2*n_jobs', refit=True, score_func=None, verbose=0)

In [122]: clf.best_score
/usr/lib/python2.7/site-packages/sklearn/utils/__init__.py:79: DeprecationWarning: Function best_score is deprecated; GridSearchCV.best_score is deprecated and will be removed in version 0.12. Please use ``GridSearchCV.best_score_`` instead.
  warnings.warn(msg, category=DeprecationWarning)
Out[122]: 0.98600097103091122

In [123]: clf.best_estimator.gamma
/usr/lib/python2.7/site-packages/sklearn/utils/__init__.py:79: DeprecationWarning: Function best_estimator is deprecated; GridSearchCV.best_estimator is deprecated and will be removed in version 0.12. Please use ``GridSearchCV.best_estimator_`` instead.
  warnings.warn(msg, category=DeprecationWarning)
Out[123]: 0.0021544346900318843
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;默认&lt;code&gt;GridSearchCV&lt;/code&gt;使用三次(3-fold)交叉验证。然而，如果它探测到一个分类器被传递，而不是一个回归量，它使用分层的3次。&lt;/p&gt;

&lt;h4 id=&quot;section-16&quot;&gt;交叉验证估计器&lt;/h4&gt;

&lt;p&gt;交叉验证在一个algorithm by algorithm基础上可以更有效地设定参数。这就是为何，对给定的估计器，scikit-learn使用“CV”估计器，通过交叉验证自动设定参数。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [125]: from sklearn import linear_model, datasets

In [126]: lasso = linear_model.LassoCV()

In [127]: diabetes = datasets.load_diabetes()

In [128]: X_diabetes = diabetes.data

In [129]: y_diabetes = diabetes.target

In [130]: lasso.fit(X_diabetes, y_diabetes)
Out[130]: 
LassoCV(alphas=array([ 2.14804,  2.00327, ...,  0.0023 ,  0.00215]),
    copy_X=True, cv=None, eps=0.001, fit_intercept=True, max_iter=1000,
    n_alphas=100, normalize=False, precompute='auto', tol=0.0001,
    verbose=False)

In [131]: # The estimator chose automatically its lambda:

In [132]: lasso.alpha 
Out[132]: 0.013180196198701137
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这些估计器是相似的，以‘CV’为它们名字的后缀。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;练习&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;对糖尿病数据集，找到最优的正则化参数alpha。(0.016249161908773888)&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://scikit-learn.org/0.11/auto_examples/datasets/plot_digits_last_image.html&quot;&gt;什么手写数字数据集&lt;/a&gt;&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/K-nearest_neighbor_algorithm&quot;&gt;KNN分类算法&lt;/a&gt;&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Ball_tree&quot;&gt;Ball tree数据结构&lt;/a&gt;&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://zh.wikipedia.org/wiki/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA&quot;&gt;支持向量机&lt;/a&gt;&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Radial_basis_function&quot;&gt;径向基函数&lt;/a&gt;&lt;a href=&quot;#fnref:5&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/K-means_clustering&quot;&gt;看看wikipedia吧&lt;/a&gt;&lt;a href=&quot;#fnref:7&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Supervised_learning&quot;&gt;监督学习&lt;/a&gt;&lt;a href=&quot;#fnref:6&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:8&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Penalty_method&quot;&gt;Penalty methods&lt;/a&gt;&lt;a href=&quot;#fnref:8&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:9&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Least_squares#LASSO_method&quot;&gt;LASSO method&lt;/a&gt;&lt;a href=&quot;#fnref:9&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:10&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Coordinate_descent&quot;&gt;Coordinate descent&lt;/a&gt;&lt;a href=&quot;#fnref:10&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>Always Look on the Bright Side of Life</title>
   <link href="http://reverland.org/Life/2012/10/14/always-look-on-the-bright-side-of-life"/>
   <updated>2012-10-14T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/10/14/always-look-on-the-bright-side-of-life</id>
   <content type="html">
&lt;p&gt;blahblahblah,这几天看了三部电影，随便感慨下。&lt;/p&gt;

&lt;h2 id=&quot;always-look-on-the-bright-side-of-life&quot;&gt;Always Look on the Bright Side of Life&lt;/h2&gt;

&lt;p&gt;也许执念太深，从一年前开始看到无所事事的人就极度不爽，也无法忍受自己浪费一分一秒，然而事情总是这样：你越想抓住什么，什么就越从你的指缝间溜走得越快。&lt;/p&gt;

&lt;p&gt;一年来总是给自己一些莫名奇妙的压力，天天为各种各样的琐事烦得一塌糊涂。结果身体一直也不好，要不要感冒每个月就像大姨妈一样来一次？&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;有很多人和事，只觉得他们二逼，然而搅扰的自己也无法静下心。也许只是我自己太在意。&lt;/p&gt;

&lt;p&gt;我想黑我们学校，黑自己专业，黑这学校很多人很久了。然而最终还是忍住，也许世界就该这样，或者你爱怎样就怎样。没必要因此搅扰得自己不安。&lt;/p&gt;

&lt;p&gt;也许我就该笑笑，依旧回头走我的路，如果路被人堵上，换另一条继续走，条条大路通罗马。&lt;/p&gt;

&lt;p&gt;也许我就该放下许多执念，在心灵上解放自我，在行动上自我解放。&lt;/p&gt;

&lt;p&gt;也许我就该随波逐流，无所谓得失，让该来的来，让该去的去，万事随缘。&lt;/p&gt;

&lt;p&gt;每天入夜，当我怨恨时，我不断暗示自己，神赐你一颗平和的心，不要怨恨。&lt;/p&gt;

&lt;p&gt;当我为周围的风吹草动胆颤心惊时，不断鼓舞自己，神赐给你的是一个刚强的心，无所畏惧。&lt;/p&gt;

&lt;p&gt;让心平和下来吧，&lt;/p&gt;

&lt;p&gt;一直想考研，跨掉自己的专业，离开熟悉的学校，寻找更好的环境和人&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;但没必要逼自己，让心平和下来吧&lt;/p&gt;

&lt;p&gt;好好锻炼身体，考不上明年再来。&lt;/p&gt;

&lt;p&gt;再考不上再做打算。&lt;/p&gt;

&lt;p&gt;留得青山在，不怕没柴烧。&lt;/p&gt;

&lt;p&gt;总是看见生活光明的一面。&lt;/p&gt;

&lt;embed src=&quot;http://www.xiami.com/widget/0_2018536/singlePlayer.swf&quot; type=&quot;application/x-shockwave-flash&quot; width=&quot;257&quot; height=&quot;33&quot; wmode=&quot;transparent&quot; /&gt;

&lt;blockquote&gt;
  &lt;p&gt;some things in life are bad,生命中总有些不如意&lt;/p&gt;

  &lt;p&gt;they can really make you mad, 它们真的能让你抓狂&lt;/p&gt;

  &lt;p&gt;other things just make you swear and curse.还有些使你诅咒和咒骂&lt;/p&gt;

  &lt;p&gt;when you’re chewing on life’s gristle 当你咀嚼生活的乏味&lt;/p&gt;

  &lt;p&gt;don’t grumble, give a whistle. 别抱怨 ,吹个口哨&lt;/p&gt;

  &lt;p&gt;and this’ll help things turn out for the best.这能帮事情变好 &lt;/p&gt;

  &lt;p&gt;and…. 还有&lt;/p&gt;

  &lt;p&gt;always look on the bright side of life,(whistle) 总是看到好的一面&lt;/p&gt;

  &lt;p&gt;always look on the bright side of life,(whistle) 总是看到好的一面&lt;/p&gt;

  &lt;p&gt;if life seems jolly rotten, 如果生活看起来非常糟糕&lt;/p&gt;

  &lt;p&gt;there’s something you’ve forgotten, 肯定有什么事你忘了&lt;/p&gt;

  &lt;p&gt;and that’s to laugh and smile and dance and sing.那些关于高兴、微笑、舞蹈和歌唱的事情 &lt;/p&gt;

  &lt;p&gt;when you’re feeling in the dumps,当你觉得一团糟 &lt;/p&gt;

  &lt;p&gt;don’t be silly chumps. 别象个榆木疙瘩&lt;/p&gt;

  &lt;p&gt;just purse your lips and whistle, that’s the thing.缩起你的嘴，吹个口哨，就这样&lt;/p&gt;

  &lt;p&gt;and… 还有&lt;/p&gt;

  &lt;p&gt;always look on the bright side of life.(whistle) 总是看到好的一面&lt;/p&gt;

  &lt;p&gt;come on… 来吧&lt;/p&gt;

  &lt;p&gt;always look on the bright side of life…总是看到好的一面 &lt;/p&gt;

  &lt;p&gt;for life is quite absurd, 因为生活如此荒诞&lt;/p&gt;

  &lt;p&gt;and death’s the final word, 死亡是最终的结局&lt;/p&gt;

  &lt;p&gt;you must always face the curtain with a bow. 你总得鞠躬谢幕&lt;/p&gt;

  &lt;p&gt;forget about your sin, 忘了你的罪&lt;/p&gt;

  &lt;p&gt;give the audience a grin, 给观众一个开怀的笑&lt;/p&gt;

  &lt;p&gt;enjoy it - it’s your last chance anyhow.享受它，不管怎么说这是你最后的机会 &lt;/p&gt;

  &lt;p&gt;so always look on the bright side of death, 所以总是看到好的一面&lt;/p&gt;

  &lt;p&gt;just before you draw your terminal breath, 就在你最后一次呼吸之前&lt;/p&gt;

  &lt;p&gt;life’s a piece of shit, 生活是坨屎&lt;/p&gt;

  &lt;p&gt;when you look at it, 当你看着它的时候&lt;/p&gt;

  &lt;p&gt;life’s a laugh and death’s a joke, it’s true. 生活是一次大笑，死亡是个玩笑，真的&lt;/p&gt;

  &lt;p&gt;you’ll see it’s all a show,你会看到这都是一场戏 &lt;/p&gt;

  &lt;p&gt;keep ‘em laughing as you go. 当你上演时保持是喜剧&lt;/p&gt;

  &lt;p&gt;just remember that the last laugh is on you.记住要笑到最后 &lt;/p&gt;

  &lt;p&gt;and always look on the bright side of life, 总是看到好的一面&lt;/p&gt;

  &lt;p&gt;always look on the right side of life, 看生活好的一面&lt;/p&gt;

  &lt;p&gt;come on guys, cheer up. 来吧伙伴，庆祝一下&lt;/p&gt;

  &lt;p&gt;always look on the bright side of life. 总看到好的一面&lt;/p&gt;

  &lt;p&gt;worse things happen at sea, you know. 世界末日离你还远，知道吗？&lt;/p&gt;

  &lt;p&gt;always look on the bright side of life. 总是看到好的一面&lt;/p&gt;

  &lt;p&gt;i mean - what have you got to lose? 我是说——你将会失去什么？&lt;/p&gt;

  &lt;p&gt;you know, you come from nothing, 你知道，你本来就一无所有&lt;/p&gt;

  &lt;p&gt;you’re going back to nothing. 你会再回到虚无&lt;/p&gt;

  &lt;p&gt;what have you lost? nothing 你将会失去什么？什么也没有&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;aal-izz-well&quot;&gt;Aal izz well&lt;/h2&gt;

&lt;p&gt;你在做自己不喜欢的事情吗？&lt;/p&gt;

&lt;p&gt;你总是担心太多吗？&lt;/p&gt;

&lt;p&gt;兰彻导师说：追随自己的心，不断追求卓越，其它的都会追随而来的。&lt;/p&gt;

&lt;p&gt;兰彻导师说：我们心很怯懦，需要我们“欺骗”，Aal izz well(一切都好)。&lt;/p&gt;

&lt;p&gt;三年前和玩伴在他的mp4上看了一半，只是觉的好笑，如今看着确是完全不同的感觉。&lt;/p&gt;

&lt;p&gt;一切都好，一语胜千言。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;纵使抛弃一切终归还有执着&lt;/h2&gt;

&lt;p&gt;“人人都愿意相信自已愿意相信的东西。”&lt;/p&gt;

&lt;p&gt;不断想起大一在图书馆的日日夜夜&lt;/p&gt;

&lt;p&gt;翻看那些心理学、社会科学的书籍，&lt;/p&gt;

&lt;p&gt;甚至很多成功学的书(我现在依然非常喜欢卡耐基的书)。&lt;/p&gt;

&lt;p&gt;里头很多观点、看法、假说，深深植入我的心里。&lt;/p&gt;

&lt;p&gt;我会怀念，整个学校我最喜欢的地方。&lt;/p&gt;

&lt;p&gt;怀念那里的光影，味道，声音。&lt;/p&gt;

&lt;p&gt;还有无法忘怀的记忆。&lt;/p&gt;

&lt;p&gt;有些执着我永远不愿放弃，&lt;/p&gt;

&lt;p&gt;不过是想让自己的心冷静下来，&lt;/p&gt;

&lt;p&gt;该来的终将到来。&lt;/p&gt;

&lt;p&gt;有意思的喜剧。&lt;/p&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;&lt;del&gt;真尼玛扯淡，几次跑步回去就觉的嗓子疼，然后他妈的就生病来着。我他妈的每次保持一个月一晚一小时的习惯都被一场接一场莫名奇妙的感冒什么的给毁了。我还记得冬天跑步手被冻伤过，还记得从没什么人到天气转暖到处是人的操场，然而现实的冷水泼的比谁都厉害。&lt;/del&gt;&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;希望不要误解，对每个人好坏都是不同的，我不想黑任何人。&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>创新项目要结束了</title>
   <link href="http://reverland.org/Life/2012/09/20/"/>
   <updated>2012-09-20T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/09/</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;序&lt;/h2&gt;

&lt;p&gt;最近室友在忙着写简历找工作(其实也没忙着，该dota还dota，该看电视剧的还是电视剧，总之貌似很闲，难道我大江大……)，我想很久怎么写自己简历了，可是愈发感觉自己碌碌无为，啥也不会。也从各路大牛网站看过好几份Resume或者CV来着，更加感到自己弱爆了，真应了fengya90之前说的，出去就是被秒的份。今天还看了同学的浙大同级同学简历，算了，我真是弱爆了。&lt;/p&gt;

&lt;p&gt;大概大多数人看来，我就是混了三年，保研什么都扯淡了，成绩垃圾得一塌糊，学术完全无力，工作兼职更是扯淡，也没担过当啥重任。不管从哪里看，大概都是彻头彻尾的loser。&lt;/p&gt;

&lt;p&gt;但不说了，目测创新项目要结题了。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;创新项目之大坑&lt;/h2&gt;

&lt;p&gt;大学生创新项目逐渐变成了一个大坑……，如何从一个国家级项目沦落到校级项目又如何立项之后导师也被换了就不细说了。话说新导师不错啊，可是他中途接手别人的项目也很蛋疼……&lt;/p&gt;

&lt;p&gt;总之，五个人开始填这个大坑。嘛，这dota&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;阵容，我怎么评价么。&lt;/p&gt;

&lt;p&gt;总之，我就是苦逼的技术支持。一出问题就被召唤……&lt;/p&gt;

&lt;p&gt;开始技术支持的时候我刚接触linux不久&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;，实际上想做另一个偏计算机的项目，不过无所谓了，于是开始了这个NdFeB磁特性的项目。&lt;/p&gt;

&lt;p&gt;本来我没什么热情的，但竟然是在理学院数学实验室机房，做计算。关键是几台linux机器，嘛，真棒。我以前只在我的计算机上和化工学院研究生实验室看到过，没想到自己做的项目和linux有关。虽然是学校的机器上都是古老而难懂的RHEL5。&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;竟然还有幸使用学院十八万一年购入的NB软件——&lt;a href=&quot;http://www.quantumwise.com/&quot;&gt;Atomistix ToolKit (ATK)&lt;/a&gt;,顺便说下使用了一年，我只想说真尼玛感觉没开源软件好用，不过技术支持不错。&lt;/p&gt;

&lt;p&gt;紧接着，我们就发现这多大一个坑了：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;学长对计算机及软件一知半解，多靠学长的学长或学姐(没见到过)留下的笔记和口口相传来进行计算。但他们理论比我们好多了，帮助我们解决了一些问题。但还是有很多坑……&lt;/li&gt;
  &lt;li&gt;老师中途接手项目，完全不熟悉这个软件，也不很熟悉这个项目&lt;/li&gt;
  &lt;li&gt;我们接着换导师前的导师的研究生的项目继续往下做，直接使用前辈建好的模型再根据自己需要修改。可是这个模型太大了，几百个原子……计算机吃不消，经常内存都不够，有次半个月没算出来。&lt;/li&gt;
  &lt;li&gt;一堆参数不知道怎么设定，发现前辈留下的log都是各种不收敛……&lt;/li&gt;
  &lt;li&gt;有买来的atk的REHL那台机器上的atk/vnl经常出错，学院一堆机器经常有些莫名奇妙的问题&lt;/li&gt;
  &lt;li&gt;有atk那台的机器卡爆了……&lt;/li&gt;
  &lt;li&gt;各种因为不了解软件及原理本身的而造成的错误&lt;/li&gt;
  &lt;li&gt;各种手误，还有不良的管理习惯，比如说新建的那一堆文件夹，结果我现在都不知道各个文件夹都放的什么东西了。&lt;/li&gt;
  &lt;li&gt;软件自身问题，比如算法bug&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-2&quot;&gt;但我学到了很多&lt;/h2&gt;

&lt;p&gt;不像有的导师直接帮学生都发好文章了，我组的同学，特别那些要出国要考研要论文的同志们就苦逼了……&lt;/p&gt;

&lt;p&gt;像我这种苦逼考研党倒不在乎，可是作为技术支持永远也别想闲下来不管……&lt;/p&gt;

&lt;p&gt;我们的项目在各种坑中颠簸了一年现在还没出论文，从老师开始口口声声的发国外到先发JNU学报上，到某写论文的出国党主力dps差点放弃不搞。&lt;/p&gt;

&lt;p&gt;现在快结束了，跳过一个软件算法bug，希望明天算出来有个好结果。&lt;/p&gt;

&lt;p&gt;一年，我还是学到了很多哦，收获不浅。&lt;/p&gt;

&lt;p&gt;我学到的很多也用上了，这真让我惊奇，&lt;strong&gt;我从来没想过自己在折腾中学到的很多东西，竟然真的用上了。&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;将学院几台linux机器几乎和自己机器集成起来了。&lt;/li&gt;
  &lt;li&gt;配置好ssh和vnc，在寝室我可以通过ssh，vnc很方便的查看计算进度，结果，和其它任何操作。&lt;/li&gt;
  &lt;li&gt;利用dolphin的fish特性可视化ssh，这玩意太好用了。远端就像本地一样。&lt;/li&gt;
  &lt;li&gt;打开了vnc服务教他们怎么用浏览器使用远程桌面，可是windows用户还是更习惯去实验室用windows……&lt;/li&gt;
  &lt;li&gt;建立了ftp服务方便几台机器的文件共享。&lt;/li&gt;
  &lt;li&gt;熟悉了怎么在linux下编译软件，怎么使用软件&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。编译配置mpich尝试集群并行计算，最后发现专有软件真尼玛坑，要集群还要付钱……&lt;/li&gt;
  &lt;li&gt;在自己机器archlinux上装上了atk/vnl……然后半个月不到尼玛就过期不让用了……&lt;/li&gt;
  &lt;li&gt;熟悉了vim各种高效操作，改各种文件改的真欢，连vimdiff都用上了……&lt;/li&gt;
  &lt;li&gt;脚本化计算，让计算能够排队……&lt;/li&gt;
  &lt;li&gt;完全习惯用终端或者从其它linux或windows机器上ssh上去用cli操作，因为内存被atk吃空的那台机器卡爆了&lt;/li&gt;
  &lt;li&gt;最后因为atk/vnl什么莫名奇妙不能可视化图形的毛病，发现atkpython中已经集成了matplotlib和numpy，自己手动可视化。不过windows用户还是更习惯用Origin……&lt;/li&gt;
  &lt;li&gt;正好学了点python，然后竟然在一些关键问题上比如win和linux在python中路径，序列切片的问题用上了。&lt;/li&gt;
  &lt;li&gt;很多问题简直凭借常年在linux系统下的经验和直觉解决的。&lt;/li&gt;
  &lt;li&gt;忽然想到有次帮别人制作presentation的图连gimp都用上了。不过当时对gimp比较熟悉，完全无压力。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-3&quot;&gt;创新项目对我的影响&lt;/h2&gt;

&lt;p&gt;我想说，我没有打酱油，这就很满意了。事实上要是像有的同学创新项目一样都没做什么老师都帮忙发论文什么的我反而感觉可惜了，也很庆幸竟然做了这么个大坑项目。&lt;/p&gt;

&lt;p&gt;我还想说，我努力不让别人失望，希望我做到了。&lt;/p&gt;

&lt;p&gt;因为&lt;a href=&quot;http://www.quantumwise.com/&quot;&gt;Atomistix ToolKit (ATK)&lt;/a&gt;这个大坑，还有其它一些莫名奇妙的原因我变成pythoner了，而且将来想用python作为工具从事数据挖掘和机器学习的工作。&lt;/p&gt;

&lt;p&gt;更加熟悉了linux系统，竟然还把某台上的REHL偷天换日更新成CentOS了，vim和各种终端操作更加熟练。&lt;/p&gt;

&lt;p&gt;ssh/vnc配置使用自不必说。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.quantumwise.com/&quot;&gt;Atomistix ToolKit (ATK)&lt;/a&gt;基于某python的DFT(密度泛函理论)实现反过来促进了我对物理的兴趣，我本身是学物理的嘛，不过貌似被大学教育把兴趣几乎抹杀了。&lt;/p&gt;

&lt;p&gt;还有其它一些关于团队和做事的思考，不写。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-4&quot;&gt;一些纪念截图&lt;/h2&gt;

&lt;p&gt;在archlinux装的atk/vnl&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn065/20120306/1650/p_large_kKj5_1476000000551260.jpg&quot; alt=&quot;在archlinux装的atk/vnl&quot; /&gt;&lt;/p&gt;

&lt;p&gt;经常内存就这么满了&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrfmn.com/fmn058/20120625/1850/p_large_l0Vh_0cab00011abb1261.jpg&quot; alt=&quot;经常内存就这么满了&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我用python画出来的自旋平行态密度,和下图一样因算法问题算得根本就不对……&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn057/20120919/2245/p_large_C5Mt_608a00001d3b1262.jpg&quot; alt=&quot;我用python画出来的自旋平行态密度&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我用python画出来的自旋反平行态密度&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn056/20120919/2245/p_large_b12B_608a00001d3c1262.jpg&quot; alt=&quot;我用python画出来的自旋反平行态密度&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我们的模型,我用gimp处理的，还有个彩版的。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn061/20120921/0725/p_large_BcP2_109300000ba71262.jpg&quot; alt=&quot;模型&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-5&quot;&gt;鸣谢&lt;/h2&gt;

&lt;p&gt;感谢指导老师的支持，各位组员的共同努力，特别感谢某出国党的坚持，希望明天有个不错的结果，最后写论文什么就没我什么事了&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;2012年09月21日 星期五 18时23分32秒&lt;/p&gt;

&lt;p&gt;还好，大家争取两天把论文写完。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;FootNotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;I hate Dota&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;其实也两三个月了，大概我换archlinux单系统那段时间吧&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;我是相对与arch说的新旧……莫喷。&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;当然第一件是看文档看教程了，然后才是google搜索(baidu弱爆了)&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;要是用latex或者markdown写我会不会抢着写……&lt;a href=&quot;#fnref:5&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>科学计算工具和工作流</title>
   <link href="http://reverland.org/python/2012/09/12/"/>
   <updated>2012-09-12T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/09/</id>
   <content type="html">
&lt;h1 id=&quot;scientific-computing-with-tools-and-workflow&quot;&gt;Scientific computing with tools and workflow&lt;/h1&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;好长的标题……&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;从&lt;a href=&quot;http://scipy-lectures.github.com/intro/intro.html&quot;&gt;scipy lecture notes&lt;/a&gt;引言翻译。这是篇python 做科学计算的水文……&lt;/p&gt;

&lt;p&gt;作者:Fernando Perez, Emmanuelle Gouillart, Gaël Varoquaux。感谢他们贡献了如此棒的教材。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#python&quot;&gt;为什么Python？&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;科学家的需求&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;要求&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;已经存在的解决方案&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#python-1&quot;&gt;python科学工具&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ipython&quot;&gt;交互工作流:IPython和文本编辑器&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;命令行交互&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;在编辑器中拟定算法&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;python&quot;&gt;为什么Python？&lt;/h2&gt;

&lt;h3 id=&quot;section&quot;&gt;科学家的需求&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;获取数据(模拟，试验操控)&lt;/li&gt;
  &lt;li&gt;操作和处理数据&lt;/li&gt;
  &lt;li&gt;可视化结果……让我们理解我们在做什么！&lt;/li&gt;
  &lt;li&gt;交流结果：产生用来做报告或出版的图像，写演示文稿。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-1&quot;&gt;要求&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;对相应经典数值方法和基本作用已经存在丰富的程序块：我们不想再次为绘制曲线、傅利叶变换或者拟合算法重新编程。不要重复发明轮子。&lt;/li&gt;
  &lt;li&gt;简单易学：计算机科学不是我们的课程也不是工作。我们想要在几分钟内绘制曲线、平滑信号和做傅利叶变换。&lt;/li&gt;
  &lt;li&gt;易于和合作者、学生、顾客交流，让代码在试验室或公司内部都生动起来：代码应该像本书一样易读。因此，语言应该包含尽量少的语法符号或不必要的规范，使数学家和科学家读者能够理解代码。&lt;/li&gt;
  &lt;li&gt;有效率地编码和快速执行……但是不必说如果我们花太多时间来编写它，非常快的代码也变得无用。所以，我们需要同样短的开发时间和短的执行时间。&lt;/li&gt;
  &lt;li&gt;一个单独的环境/语言解决所有事情。如果可能，避免为每个新问题学习新的软件。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-2&quot;&gt;已经存在的解决方案&lt;/h3&gt;

&lt;p&gt;科学家们用什么工作？&lt;/p&gt;

&lt;p&gt;&lt;em&gt;编译语言：C,C++,Fortran等等&lt;/em&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;优点：
    &lt;ul&gt;
      &lt;li&gt;非常快。高度优化的编译器。对大量计算，很难超越这些语言。&lt;/li&gt;
      &lt;li&gt;为这些语言已经写了一些高度优化的科学库。例如：BLAS(向量/矩阵运算库)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;缺点：
    &lt;ul&gt;
      &lt;li&gt;难用：在开发时没有交互，命令式的编译步骤，累赘的语法(&lt;code&gt;&amp;amp;, ::, }}, ;&lt;/code&gt;等等)，人工内存管理(C中很棘手)。这些对非计算机科学家是&lt;em&gt;难懂的语言&lt;/em&gt;。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;脚本语言：Matlab&lt;/em&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;优点：
    &lt;ul&gt;
      &lt;li&gt;在许多领域有丰富的数值算法库。因为这些库经常用编译语言写成而有快的执行速度。&lt;/li&gt;
      &lt;li&gt;友好的开发环境：全面而且组织良好的帮助，集成的编辑器等。&lt;/li&gt;
      &lt;li&gt;商业支持&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;缺点：
    &lt;ul&gt;
      &lt;li&gt;基本语言太弱了，高级用户将很受限。&lt;/li&gt;
      &lt;li&gt;不免费&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;其它脚本语言：Scilab, Octave, Igor, R, IDL等等&lt;/em&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;优点：
    &lt;ul&gt;
      &lt;li&gt;开源、免费,或者至少比Matlab便宜。&lt;/li&gt;
      &lt;li&gt;有些功能非常高级(R中的统计，Igor中的绘图等等)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;缺点：
    &lt;ul&gt;
      &lt;li&gt;比Matlab中可用算法少，语言不高级。&lt;/li&gt;
      &lt;li&gt;有些软件专注于一个领域。例如:Gnuplot或xmgrace绘制曲线。这些程序非常强大，但是它们被限制在一种类型的使用上，例如绘图。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;Python怎么样&lt;/em&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;优点：
    &lt;ul&gt;
      &lt;li&gt;非常丰富的科学计算库(尽管稍微比Matlab少那么一点点)&lt;/li&gt;
      &lt;li&gt;很好的思考语言，允许写出非常易读和组织很好的代码：“所码即所想” 。&lt;/li&gt;
      &lt;li&gt;相当之多科学计算任务之外的库(网络服务器管理、串口访问等等。)&lt;/li&gt;
      &lt;li&gt;自由免费和开源，使用广泛，活跃的社区。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;缺点：
    &lt;ul&gt;
      &lt;li&gt;不怎么友好的开发环境和某些软件相比，比如Matlab。(更加geek向一些)。&lt;/li&gt;
      &lt;li&gt;并非所有的算法可以在专业软件和工具箱中找到。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;python-1&quot;&gt;python科学工具&lt;/h2&gt;

&lt;p&gt;不像Matlab，Scilab和R，Python并不预先绑定一套科学计算模块。以下是用来搭建科学计算环境的基本构建模块：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Python&lt;/em&gt;，一个通用和现代的计算语言
    &lt;ul&gt;
      &lt;li&gt;Python语言：数据结构(字符串、整型)，控制流，数据集合(列表、字典)，模式等等。&lt;/li&gt;
      &lt;li&gt;标准库的模块&lt;/li&gt;
      &lt;li&gt;大量用Python写成特殊用途的模块或应用：网络协议，网络框架等等，还有科学计算。&lt;/li&gt;
      &lt;li&gt;开发工具(自动测试，文档生成)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;IPython&lt;/em&gt;，一个高级&lt;em&gt;Python shell&lt;/em&gt; &lt;a href=&quot;http://ipython.scipy.org/moin/&quot;&gt;http://ipython.scipy.org/moin/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;Numpy&lt;/em&gt;，提供强大的数值数组对象和操作它们的程序。&lt;a href=&quot;http://www.numpy.org/&quot;&gt;http://www.numpy.org/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;Scipy&lt;/em&gt;：高水准的数据处理程序。优化、回归、插值等等。&lt;a href=&quot;http://www.scipy.org/&quot;&gt;http://www.scipy.org/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;Matplotlib&lt;/em&gt;：二维可视化，“出版水准”的绘图。&lt;a href=&quot;http://matplotlib.sourceforge.net/&quot;&gt;http://matplotlib.sourceforge.net/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Mayavi&lt;/em&gt;：三维可视化。&lt;a href=&quot;http://code.enthought.com/projects/mayavi/&quot;&gt;http://code.enthought.com/projects/mayavi/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ipython&quot;&gt;交互工作流:IPython和文本编辑器&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;交互工作来测试和理解算法&lt;/strong&gt;：在这一部分，我们描述一个使用&lt;a href=&quot;http://ipython.org/&quot;&gt;IPython&lt;/a&gt;交互工作流，这很方便探索和理解算法。&lt;/p&gt;

&lt;p&gt;Python是一种通用语言。因此，没有一个得天独厚的工作环境,使用它的方式不只一种。尽管这让初学者很难找到自己的路，但让Python可能被用来在服务器上或嵌入设备上写程序。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;注解&lt;/strong&gt;：这部分的参考文档：&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;IPython用户手册&lt;/strong&gt;：&lt;a href=&quot;http://ipython.org/ipython-doc/dev/index.html&quot;&gt;http://ipython.org/ipython-doc/dev/index.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;section-3&quot;&gt;命令行交互&lt;/h3&gt;

&lt;p&gt;启动&lt;em&gt;ipython&lt;/em&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [1]: print('Hello world')
Hello world
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;获得帮助&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [2]: print?
Type:               builtin_function_or_method
Base Class:         &amp;lt;type 'builtin_function_or_method'&amp;gt;
String Form:        &amp;lt;built-in function print&amp;gt;
Namespace:          Python builtin
Docstring:
    print(value, ..., sep=' ', end='\n', file=sys.stdout)

    Prints the values to a stream, or to sys.stdout by default.
    Optional keyword arguments:
    file: a file-like object (stream); defaults to the current sys.stdout.
    sep:  string inserted between values, default a space.
    end:  string appended after the last value, default a newline.
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-4&quot;&gt;在编辑器中拟定算法&lt;/h3&gt;

&lt;p&gt;在文本编辑器中创建一个文件&lt;code&gt;my_file.py&lt;/code&gt;。在EPD(Enthought Python Distribution)&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;中，你可以使用从开始菜单使用&lt;em&gt;Scite&lt;/em&gt;。在Python(x,y)中&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;，你可以使用Spyder。在Ubuntu下，如果你还没有喜欢的编辑器，我们建议安装&lt;em&gt;Stani’s Python editor&lt;/em&gt;。在这个文件中，添加以下行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;s = 'Hello world'
print(s)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在，你可以在IPython中运行和探索结果变量：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [3]: %run my_file.py
Hello word

In [4]: s
Out[4]: 'Hello word'

In [5]: %whos
Variable   Type    Data/Info

----------------------------
s          str     Hello word
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;从脚本到函数&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;虽然只用一个接一个指令的脚本工作很诱惑，但请逐渐将脚本改进成一套函数：&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;一个脚本不可复用，但函数可以。&lt;/li&gt;
    &lt;li&gt;以函数式思考益于将问题分解。&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;在python2.7以后不会这样显示了。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;Enthought公司配置好的一套环境，教育网邮箱可以免费申请使用。&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;另一个配置好的环境。&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>Matplotlib Tutorial(译)</title>
   <link href="http://reverland.org/python/2012/09/07/matplotlib-tutorial"/>
   <updated>2012-09-07T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/09/07/matplotlib-tutorial</id>
   <content type="html">
&lt;h1 id=&quot;matplotlib-tutorial&quot;&gt;Matplotlib Tutorial(译)&lt;/h1&gt;

&lt;p&gt;翻译自:&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/&quot;&gt;Matplotlib tutorial&lt;/a&gt;Nicolas P. Rougier - Euroscipy 2012&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;引言&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#ipython--pylab&quot;&gt;Ipython 和 pylab模式&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pylab&quot;&gt;pylab&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;简单绘图&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;使用默认&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;示例默认&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;更改色彩和线宽&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot;&gt;设置边界&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot;&gt;设置刻度&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-7&quot;&gt;设置刻度标签&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#spine&quot;&gt;移动轴线(spine)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot;&gt;添加图例&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-9&quot;&gt;注解某些点&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-10&quot;&gt;魔鬼在于细节&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#figuressubplotsaxesticks&quot;&gt;图像，子区，子图，刻度(Figures,Subplots,Axes,Ticks)&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#figure&quot;&gt;图像(Figure)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#subplots&quot;&gt;子区(subplots)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#axes&quot;&gt;子图(axes)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ticks&quot;&gt;刻度(ticks)&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#tick-locator&quot;&gt;刻度定位器(Tick Locator)&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-11&quot;&gt;其它种类绘图&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-12&quot;&gt;常规绘图&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#scatter-plots&quot;&gt;散点图(scatter plots)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#bar-plots&quot;&gt;条形图(bar plots)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#contour-plots&quot;&gt;等高线图(contour plots)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#imshow&quot;&gt;Imshow&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pie-charts&quot;&gt;饼图(Pie charts)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#quiver-plots&quot;&gt;矢量图(quiver plots)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#grids&quot;&gt;网格(grids)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-13&quot;&gt;多图绘制&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-14&quot;&gt;极轴图&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-15&quot;&gt;三维绘图&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-16&quot;&gt;绘制文本&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-17&quot;&gt;此教程之外&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-18&quot;&gt;教程&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#matplotlib&quot;&gt;matplotlib文档&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-19&quot;&gt;代码文档&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#galleries&quot;&gt;画廊(Galleries)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-20&quot;&gt;邮件列表&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-21&quot;&gt;快速参考&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-22&quot;&gt;线条属性&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-23&quot;&gt;线型&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-24&quot;&gt;标记&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-25&quot;&gt;色彩表&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这个教程基于可以从&lt;a href=&quot;http://scipy-lectures.github.com/&quot;&gt;scipy lecture note&lt;/a&gt;得到的 Mike Müller的&lt;a href=&quot;http://scipy-lectures.github.com/intro/matplotlib/matplotlib.html&quot;&gt;教程&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;源代码可从&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/matplotlib.rst&quot;&gt;这里&lt;/a&gt;获得。图像在&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/&quot;&gt;figures&lt;/a&gt;文件夹内，所有的脚本位于&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/&quot;&gt;scripts&lt;/a&gt;文件夹。&lt;/p&gt;

&lt;p&gt;所有的代码和材料以&lt;a href=&quot;http://creativecommons.org/licenses/by/3.0/us&quot;&gt;Creative Commons Attribution 3.0 United States License (CC-by)&lt;/a&gt;发布。&lt;/p&gt;

&lt;p&gt;特别感谢Bill Wing和Christoph Deil的检查和校正。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;引言&lt;/h2&gt;

&lt;p&gt;matplotlib大概是被使用最多的二维绘图Python包。它不仅提供一个非常快捷的用python可视化数据的方法，而且提供了出版质量的多种格式图像。我们将要探索matplotlib包含最常见情况的交互模式。&lt;/p&gt;

&lt;h3 id=&quot;ipython--pylab&quot;&gt;Ipython 和 pylab模式&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://ipython.org/&quot;&gt;IPython&lt;/a&gt;是一个增强的Python交互shell，它拥有很多有趣的特性包括被命名的输入与输出，可使用shell命令，增强的调试和许多其它特性。当我们在命令参数中用&lt;code&gt;-pylab&lt;/code&gt;(自从IPython0.12版变成&lt;code&gt;--pylab&lt;/code&gt;),它容许交互的matplotlib会话有像Matlab/Mathematica样的功能。&lt;/p&gt;

&lt;h3 id=&quot;pylab&quot;&gt;pylab&lt;/h3&gt;

&lt;p&gt;pylab提供了一个针对matplotlib面向对象绘图库的程序界面。它模仿Matlab(TM)开发。因此，pylab大部分的绘图命令和参数和Matlab(TM)相似。重要的命令被交互示例解释。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;简单绘图&lt;/h2&gt;

&lt;p&gt;在这一部分，我们想在同一个图片中绘制正弦和余弦函数。从默认设置开始，我们将一步一步地改进使它看上去更棒。&lt;/p&gt;

&lt;p&gt;首先获得正弦和余弦函数的数据：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

X = np.linspace(-np.pi, np.pi, 256,endpoint=True)
C,S = np.cos(X), np.sin(X)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;X现在是一个numpy数组，包含从-π到+π(包含π)等差分布的256个值。C是正弦(256个值)，S是余弦(256个值)。&lt;/p&gt;

&lt;p&gt;运行这个例子，你可以在IPython交互会话键入它们&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[lyy@arch ~]$ ipython2 --pylab
Python 2.7.3 (default, Apr 24 2012, 00:00:54) 
Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.

IPython 0.13 -- An enhanced Interactive Python.
?         -&amp;gt; Introduction and overview of IPython's features.
%quickref -&amp;gt; Quick reference.
help      -&amp;gt; Python's own help system.
object?   -&amp;gt; Details about 'object', use 'object??' for extra details.

Welcome to pylab, a matplotlib-based Python environment [backend: Qt4Agg].
For more information, type 'help(pylab)'.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;或者你可以下载每个示例然后使用普通的的python运行它：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ python exercice_1.py
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你可以点击相应图片的获得每一步的源码。&lt;/p&gt;

&lt;h3 id=&quot;section-2&quot;&gt;使用默认&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_1.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_1.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;matplotlib有一套允许定制各种属性的默认设置。你可以几乎控制matplotlib中的每一个默认属性：图像大小，每英寸点数，线宽，色彩和样式，子图(axes)，坐标轴和网格属性，文字和字体属性，等等。虽然matplotlib的默认设置在大多数情况下相当好，你却可能想要在一些特别的情形下更改一些属性。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

X = np.linspace(-np.pi, np.pi, 256,endpoint=True)
C,S = np.cos(X), np.sin(X)

plot(X,C)
plot(X,S)

show()
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-3&quot;&gt;示例默认&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_2.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_2.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;在以下脚本中，我们示例(并注释)所有影响图像外观的图像设定。这些设定被显式地设置成它们的默认值，但是现在你可以交互地尝试这些值来探索它们的作用(参考之后的&lt;a href=&quot;#&quot;&gt;线条属性&lt;/a&gt;和&lt;a href=&quot;#&quot;&gt;线条样式&lt;/a&gt;)。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# Import everything from matplotlib (numpy is accessible via 'np' alias)
from pylab import *

# Create a new figure of size 8x6 points, using 80 dots per inch
figure(figsize=(8,6), dpi=80)

# Create a new subplot from a grid of 1x1
subplot(1,1,1)

X = np.linspace(-np.pi, np.pi, 256,endpoint=True)
C,S = np.cos(X), np.sin(X)

# Plot cosine using blue color with a continuous line of width 1 (pixels)
plot(X, C, color=&quot;blue&quot;, linewidth=1.0, linestyle=&quot;-&quot;)

# Plot sine using green color with a continuous line of width 1 (pixels)
plot(X, S, color=&quot;green&quot;, linewidth=1.0, linestyle=&quot;-&quot;)

# Set x limits
xlim(-4.0,4.0)

# Set x ticks
xticks(np.linspace(-4,4,9,endpoint=True))

# Set y limits
ylim(-1.0,1.0)

# Set y ticks
yticks(np.linspace(-1,1,5,endpoint=True))

# Save figure using 72 dots per inch
# savefig(&quot;exercice_2.png&quot;,dpi=72)

# Show result on screen
show()
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-4&quot;&gt;更改色彩和线宽&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_3.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_3.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;首先，我们想要余弦是蓝色而正弦是红色，它们的线条都稍厚一点。我们将也稍微更改图片大小来使它更宽一点。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;figure(figsize=(10,6), dpi=80)
plot(X, C, color=&quot;blue&quot;, linewidth=2.5, linestyle=&quot;-&quot;)
plot(X, S, color=&quot;red&quot;,  linewidth=2.5, linestyle=&quot;-&quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-5&quot;&gt;设置边界&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_4.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_4.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;当前的图像边界有点太紧了一点，而且我们想要预留一点空间使数据点更清晰。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;xlim(X.min()*1.1, X.max()*1.1)
ylim(C.min()*1.1, C.max()*1.1)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-6&quot;&gt;设置刻度&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_5.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_5.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;当前刻度并不理想，因为它们不显示正余弦中我们感兴趣的值(+/-π,+/-π/2)。我们将更改它们让它们只显式这些值。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;xticks( [-np.pi, -np.pi/2, 0, np.pi/2, np.pi])
yticks([-1, 0, +1])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-7&quot;&gt;设置刻度标签&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_6.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_6.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;刻度已经放置合适但是他们的标签并不很清楚，我们可以猜出3.142是π但是最好让它更直接。当我们设置刻度值时，我们也可以在第二个参数列表中提供相应的标签。注意，我们用latex获得更好渲染的标签。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;xticks([-np.pi, -np.pi/2, 0, np.pi/2, np.pi],
       [r'$-\pi$', r'$-\pi/2$', r'$0$', r'$+\pi/2$', r'$+\pi$'])

yticks([-1, 0, +1],
       [r'$-1$', r'$0$', r'$+1$'])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;spine&quot;&gt;移动轴线(spine)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_7.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_7.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;轴线(spines)是连接刻度标志和标示数据区域边界的线。它们现在可以被放置在任意地方，它们在子图的边缘。我们将改变这点，因为我们想让它们位于中间。因为一共有四个轴线(上/下/左/右)。我们将通过将它们的颜色设置成None，舍弃位于顶部和右部轴线。然后我们把底部和左部的轴线移动到数据空间坐标中的零点。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ax = gca()
ax.spines['right'].set_color('none')
ax.spines['top'].set_color('none')
ax.xaxis.set_ticks_position('bottom')
ax.spines['bottom'].set_position(('data',0))
ax.yaxis.set_ticks_position('left')
ax.spines['left'].set_position(('data',0))
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-8&quot;&gt;添加图例&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_8.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_8.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;让我们在图片左上角添加一个图例。这仅仅需要向plot命令添加关键字参数label(之后将被图例框使用)。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;plot(X, C, color=&quot;blue&quot;, linewidth=2.5, linestyle=&quot;-&quot;, label=&quot;cosine&quot;)
plot(X, S, color=&quot;red&quot;,  linewidth=2.5, linestyle=&quot;-&quot;, label=&quot;sine&quot;)

legend(loc='upper left')
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-9&quot;&gt;注解某些点&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_9.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_9.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;让我们现在使用annotate命令注解一些我们感兴趣的点。我们选择2π/3作为我们想要注解的正弦和余弦值。我们将在曲线上做一个标记和一个垂直的虚线。然后，使用annotate命令来显示一个箭头和一些文本。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;t = 2*np.pi/3
plot([t,t],[0,np.cos(t)], color ='blue', linewidth=2.5, linestyle=&quot;--&quot;)
scatter([t,],[np.cos(t),], 50, color ='blue')

annotate(r'$sin(\frac{2\pi}{3})=\frac{\sqrt{3}}{2}$',
         xy=(t, np.sin(t)), xycoords='data',
         xytext=(+10, +30), textcoords='offset points', fontsize=16,
         arrowprops=dict(arrowstyle=&quot;-&amp;gt;&quot;, connectionstyle=&quot;arc3,rad=.2&quot;))

plot([t,t],[0,np.sin(t)], color ='red', linewidth=2.5, linestyle=&quot;--&quot;)
scatter([t,],[np.sin(t),], 50, color ='red')

annotate(r'$cos(\frac{2\pi}{3})=-\frac{1}{2}$',
         xy=(t, np.cos(t)), xycoords='data',
         xytext=(-90, -50), textcoords='offset points', fontsize=16,
         arrowprops=dict(arrowstyle=&quot;-&amp;gt;&quot;, connectionstyle=&quot;arc3,rad=.2&quot;))
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-10&quot;&gt;魔鬼在于细节&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/exercice_10.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/exercice_10.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;由于蓝色和红色的线，刻度标签现在很难看清。。我们可以让它们更大并且调整它们的属性使它们的背景半透明。这将让我们把数据和标签都看清。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;for label in ax.get_xticklabels() + ax.get_yticklabels():
    label.set_fontsize(16)
    label.set_bbox(dict(facecolor='white', edgecolor='None', alpha=0.65 ))
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;figuressubplotsaxesticks&quot;&gt;图像，子区，子图，刻度(Figures,Subplots,Axes,Ticks)&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Note:这一段很绕，我不知道该怎么翻译好。在matplotlib中axes容器处于核心地位。翻译成子图因为在《Python科学计算》中作者这样称呼.subplot翻译成子区&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;目前我们已经隐式地使用了图像(figure)和子图(axes)的创建。这对快速绘图很方便。我们通过显式使用figure，subplot，axes可以控制更多图像的呈现。一个图像(figure)意味着用户界面的整个窗口。在一个图像中可以有些子区(subplot)。subplot将绘图放置在常规的网格位置上而axes允许更自由的放置。它们都非常有用，取决于你的意图。我们已经隐式地使用了figure和subplot。当我们调用plot时，matplotlib调用gca来获取当前axes反过来调用gcf()获取当前图像(figure)。如果没有当前图像(figure)，它调用figure()创建一个，严格地说，是创建一个subplot(111)。让我们详细看看。&lt;/p&gt;

&lt;h3 id=&quot;figure&quot;&gt;图像(Figure)&lt;/h3&gt;

&lt;p&gt;图像是一个图形用户界面的窗口，以”Figure #”作为标题。相对于Python通常是0索引的，图像是从一开始的。这显然是matlab风格。这里有几个决定图像外观的参数：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;参数&lt;/th&gt;
      &lt;th&gt;默认&lt;/th&gt;
      &lt;th&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;num&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;图像编号&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;figsize&lt;/td&gt;
      &lt;td&gt;figure.figsize&lt;/td&gt;
      &lt;td&gt;图像大小(宽度，高度)(英寸)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;dpi&lt;/td&gt;
      &lt;td&gt;figure.dpi&lt;/td&gt;
      &lt;td&gt;每英寸分辨率&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;facecolor&lt;/td&gt;
      &lt;td&gt;figure.facecolor&lt;/td&gt;
      &lt;td&gt;背景色&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;edgecolor&lt;/td&gt;
      &lt;td&gt;figure.edgecolor&lt;/td&gt;
      &lt;td&gt;绘图背景边沿色&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;frameon&lt;/td&gt;
      &lt;td&gt;True&lt;/td&gt;
      &lt;td&gt;绘制框架与否&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;默认可以在资源文件&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;指定，并将在大多数时间被使用。只有图像的编号频繁变动。&lt;/p&gt;

&lt;p&gt;当你使用图形用户界面时，你可以通过点击右上角&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;的&lt;code&gt;x&lt;/code&gt;来关闭一个图像。但也可以用一种编程方式调用close来关闭一个图像。取决于参数它关闭(1)当前图像(无参数)，(2)一个指定的图像(以图像编号或图像实例作为参数),(3)所有图像(以all作为参数)。&lt;/p&gt;

&lt;p&gt;和其它对象一样，你可以通过&lt;code&gt;setp&lt;/code&gt;或&lt;code&gt;set_somethin&lt;/code&gt;方法来设置图像属性。&lt;/p&gt;

&lt;h3 id=&quot;subplots&quot;&gt;子区(subplots)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/subplot-horizontal.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/subplot-horizontal.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/subplot-vertical.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/subplot-vertical.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/subplot-grid.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/subplot-grid.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;你可以通过subplot在正常网格中布置图像。你需要指定行数和列数和区域的编号。注意&lt;a href=&quot;http://matplotlib.sourceforge.net/users/gridspec.html&quot;&gt;gridspec&lt;/a&gt;命令是个更强大的选择。&lt;/p&gt;

&lt;h3 id=&quot;axes&quot;&gt;子图(axes)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/gridspec.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/gridspec.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/axes.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/axes.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/axes-2.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/axes-2.png&quot; alt=&quot;using defaults&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;子图和子区(subplot)非常相似，但是允许把图片放置到图像(figure)中的任何地方。所以如果我们想要在一个大图片中嵌套一个小点的图片，我们通过子图(axes)来完成它。&lt;/p&gt;

&lt;h3 id=&quot;ticks&quot;&gt;刻度(ticks)&lt;/h3&gt;

&lt;p&gt;良好格式化的刻度是准备发表的图片中的重要部分。Matplotlib为刻度提供完全可配置的系统。刻度定位器指定刻度出现的位置，刻度格式器让刻度看起来如你所愿。主刻度和次要刻度可以分别放置和格式化，每个默认主刻度并不显示，也就是，它们只有一个空列表，因为它们作为空定位器(NullLocator)(参见下面)。&lt;/p&gt;

&lt;h4 id=&quot;tick-locator&quot;&gt;刻度定位器(Tick Locator)&lt;/h4&gt;

&lt;p&gt;这有几个针对不同种类需求的各种定位器：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Class&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;NullLocator&lt;/td&gt;
      &lt;td&gt;没有刻度.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-NullLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IndexLocator&lt;/td&gt;
      &lt;td&gt;每到一个基数的倍数点放置一个刻度&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-IndexLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;FixedLocator&lt;/td&gt;
      &lt;td&gt;刻度位置是固定的&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-FixedLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LinearLocator&lt;/td&gt;
      &lt;td&gt;决定刻度位置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-LinearLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MultipleLocator&lt;/td&gt;
      &lt;td&gt;在每个基于基数倍数的整数点放置刻度&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-MultipleLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;AutoLocator&lt;/td&gt;
      &lt;td&gt;在不错的位置选择不超过n个间隔&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-AutoLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;LogLocator&lt;/td&gt;
      &lt;td&gt;以log坐标决定刻度位置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/ticks-LogLocator.png&quot; alt=&quot;&quot; /&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;所有这些定位器源于matplotlib基类matplotlib.ticker.Locator。你可以源于它创建你自己的定位器。处理时间刻度可能非常棘手。因此，matplotlib在matplotlib.dates中提供了特殊的定位器。&lt;/p&gt;

&lt;h2 id=&quot;section-11&quot;&gt;其它种类绘图&lt;/h2&gt;

&lt;h3 id=&quot;section-12&quot;&gt;常规绘图&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/plot_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/plot_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从下面的代码开始，尝试重新生成上边的填充图形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

n = 256
X = np.linspace(-np.pi,np.pi,n,endpoint=True)
Y = np.sin(2*X)

plot (X, Y+1, color='blue', alpha=1.00)
plot (X, Y-1, color='blue', alpha=1.00)
show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你需要使用&lt;a href=&quot;http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.fill_between&quot;&gt;fill_between&lt;/a&gt;命令。&lt;/p&gt;

&lt;p&gt;点击图片获取答案。&lt;/p&gt;

&lt;h3 id=&quot;scatter-plots&quot;&gt;散点图(scatter plots)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/scatter_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/scatter_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，注意标记大小，颜色和透明度。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

n = 1024
X = np.random.normal(0,1,n)
Y = np.random.normal(0,1,n)

scatter(X,Y)
show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：色彩由(X,Y)角度给出。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;bar-plots&quot;&gt;条形图(bar plots)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/bar_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/bar_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

n = 12
X = np.arange(n)
Y1 = (1-X/float(n)) * np.random.uniform(0.5,1.0,n)
Y2 = (1-X/float(n)) * np.random.uniform(0.5,1.0,n)

bar(X, +Y1, facecolor='#9999ff', edgecolor='white')
bar(X, -Y2, facecolor='#ff9999', edgecolor='white')

for x,y in zip(X,Y1):
    text(x+0.4, y+0.05, '%.2f' % y, ha='center', va= 'bottom')

ylim(-1.25,+1.25)
show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示:你要注意文本对齐。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;contour-plots&quot;&gt;等高线图(contour plots)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/contour_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/contour_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，注意色彩表。(参见&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/#colormaps&quot;&gt;色彩表&lt;/a&gt;)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

def f(x,y): return (1-x/2+x**5+y**3)*np.exp(-x**2-y**2)

n = 256
x = np.linspace(-3,3,n)
y = np.linspace(-3,3,n)
X,Y = np.meshgrid(x,y)

contourf(X, Y, f(X,Y), 8, alpha=.75, cmap='jet')
C = contour(X, Y, f(X,Y), 8, colors='black', linewidth=.5)
show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你需要使用&lt;a href=&quot;http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.clabel&quot;&gt;clabel&lt;/a&gt;命令。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;imshow&quot;&gt;Imshow&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/imshow_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/imshow_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

def f(x,y): return (1-x/2+x**5+y**3)*np.exp(-x**2-y**2)

n = 10
x = np.linspace(-3,3,4*n)
y = np.linspace(-3,3,3*n)
X,Y = np.meshgrid(x,y)
imshow(f(X,Y)), show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示:你需要注意imshow命令中图像的_来源_，并且使用色&lt;a href=&quot;http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.colorbar&quot;&gt;彩条&lt;/a&gt;(colorbar)。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;pie-charts&quot;&gt;饼图(Pie charts)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/pie_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/pie_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

n = 20
Z = np.random.uniform(0,1,n)
pie(Z), show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你需要改变Z。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;quiver-plots&quot;&gt;矢量图(quiver plots)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/quiver_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/quiver_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

n = 8
X,Y = np.mgrid[0:n,0:n]
quiver(X,Y), show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你需要画两次箭头。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;grids&quot;&gt;网格(grids)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/grid_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/grid_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

axes = gca()
axes.set_xlim(0,4)
axes.set_ylim(0,3)
axes.set_xticklabels([])
axes.set_yticklabels([])

show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;section-13&quot;&gt;多图绘制&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/multiplot_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/multiplot_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

subplot(2,2,1)
subplot(2,2,3)
subplot(2,2,4)

show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你可以对不同部分使用几个subplot命令。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;section-14&quot;&gt;极轴图&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/polar_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/polar_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *

axes([0,0,1,1])

N = 20
theta = np.arange(0.0, 2*np.pi, 2*np.pi/N)
radii = 10*np.random.rand(N)
width = np.pi/4*np.random.rand(N)
bars = bar(theta, radii, width=width, bottom=0.0)

for r,bar in zip(radii, bars):
    bar.set_facecolor( cm.jet(r/10.))
    bar.set_alpha(0.5)

show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你仅仅需要修改_axes_这行。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;section-15&quot;&gt;三维绘图&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/plot3d_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/plot3d_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;从以下代码开始，尝试生成上边的图形，添加标签和红色条形。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from pylab import *
from mpl_toolkits.mplot3d import Axes3D

fig = figure()
ax = Axes3D(fig)
X = np.arange(-4, 4, 0.25)
Y = np.arange(-4, 4, 0.25)
X, Y = np.meshgrid(X, Y)
R = np.sqrt(X**2 + Y**2)
Z = np.sin(R)

ax.plot_surface(X, Y, Z, rstride=1, cstride=1, cmap='hot')

show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;提示：你需要使用&lt;a href=&quot;http://matplotlib.sourceforge.net/api/pyplot_api.html#matplotlib.pyplot.contourf&quot;&gt;contourf&lt;/a&gt;命令。&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h3 id=&quot;section-16&quot;&gt;绘制文本&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/scripts/text_ex.py&quot;&gt;&lt;img src=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/figures/text_ex.png&quot; alt=&quot;reguler plots&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;试着从头做这个！提示：看一看&lt;a href=&quot;http://matplotlib.sourceforge.net/examples/api/logo2.html&quot;&gt;matplotlib logo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;点击图像获取答案。&lt;/p&gt;

&lt;h2 id=&quot;section-17&quot;&gt;此教程之外&lt;/h2&gt;

&lt;p&gt;matplotlib受益于丰富的文档和巨大的用户和开发者社区。这有几个有关的链接：&lt;/p&gt;

&lt;h3 id=&quot;section-18&quot;&gt;教程&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/pyplot_tutorial.html&quot;&gt;pyplot教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/image_tutorial.html&quot;&gt;图像教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/index_text.html&quot;&gt;文本教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/artists.html&quot;&gt;artist对象教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/path_tutorial.html&quot;&gt;路径教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/transforms_tutorial.html&quot;&gt;变换教程&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;matplotlib&quot;&gt;matplotlib文档&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/index.html&quot;&gt;用户手册&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/faq/index.html&quot;&gt;常见问题&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/users/screenshots.html&quot;&gt;截图&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-19&quot;&gt;代码文档&lt;/h3&gt;

&lt;p&gt;代码相当好的文档化了，你可以在python会话中快速查询指定命令&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from pylab import *
&amp;gt;&amp;gt;&amp;gt; help(plot)
Help on function plot in module matplotlib.pyplot:

plot(*args, **kwargs)
   Plot lines and/or markers to the
   :class:`~matplotlib.axes.Axes`.  *args* is a variable length
   argument, allowing for multiple *x*, *y* pairs with an
   optional format string.  For example, each of the following is
   legal::

       plot(x, y)         # plot x and y using default line style and color
       plot(x, y, 'bo')   # plot x and y using blue circle markers
       plot(y)            # plot y using x as index array 0..N-1
       plot(y, 'r+')      # ditto, but with red plusses

   If *x* and/or *y* is 2-dimensional, then the corresponding columns
   will be plotted.
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;galleries&quot;&gt;画廊(Galleries)&lt;/h3&gt;

&lt;p&gt;当你搜寻如何绘制指定图像时，&lt;a href=&quot;http://matplotlib.sourceforge.net/gallery.html&quot;&gt;matplotlib gallery&lt;/a&gt;也相当有用。每个例子和它的源码一同被提供。&lt;/p&gt;

&lt;p&gt;一个较小的画廊在&lt;a href=&quot;http://www.loria.fr/~rougier/coding/gallery/&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-20&quot;&gt;邮件列表&lt;/h3&gt;

&lt;p&gt;最后，这里有一个&lt;a href=&quot;https://lists.sourceforge.net/lists/listinfo/matplotlib-users&quot;&gt;用户邮件列表&lt;/a&gt;，那里你可以寻求帮助。一个&lt;a href=&quot;https://lists.sourceforge.net/lists/listinfo/matplotlib-devel&quot;&gt;开发者邮件列表&lt;/a&gt;是更加技术性的。&lt;/p&gt;

&lt;h2 id=&quot;section-21&quot;&gt;快速参考&lt;/h2&gt;

&lt;p&gt;没什么好翻译的，看原文吧……&lt;a href=&quot;http://www.loria.fr/~rougier/teaching/matplotlib/#quick-references&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-22&quot;&gt;线条属性&lt;/h3&gt;

&lt;h3 id=&quot;section-23&quot;&gt;线型&lt;/h3&gt;

&lt;h3 id=&quot;section-24&quot;&gt;标记&lt;/h3&gt;

&lt;h3 id=&quot;section-25&quot;&gt;色彩表&lt;/h3&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;资源文件？&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;有时是左上角&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>SymPy Tutorial(译)</title>
   <link href="http://reverland.org/python/2012/08/30/sympy-tutorial"/>
   <updated>2012-08-30T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/08/30/sympy-tutorial</id>
   <content type="html">
&lt;h1 id=&quot;sympy-tutorial&quot;&gt;SymPy Tutorial&lt;/h1&gt;

&lt;p&gt;翻译自：&lt;a href=&quot;http://docs.sympy.org/dev/tutorial.html&quot;&gt;SymPy Tutorial&lt;/a&gt;,其实有人译过了，但我看着不爽……你看我的不爽可以参考他的&lt;a href=&quot;http://blankdesktop.blogbus.com/logs/74200705.html&quot;&gt;SymPy简明教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;引言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#sympy&quot;&gt;SymPy第一步&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#isympy&quot;&gt;isympy控制台&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#sympy-1&quot;&gt;用SymPy做计算器&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;符号&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;代数&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;演算&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;极限&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot;&gt;微分&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot;&gt;级数展开&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-7&quot;&gt;求和&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot;&gt;积分&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-9&quot;&gt;复数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-10&quot;&gt;函数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-11&quot;&gt;微分方程&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-12&quot;&gt;代数方程&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-13&quot;&gt;线性代数&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-14&quot;&gt;矩阵&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-15&quot;&gt;模式匹配&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-16&quot;&gt;打印&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-17&quot;&gt;注意&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-18&quot;&gt;更多文档&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-19&quot;&gt;翻译&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#footnotes&quot;&gt;FootNotes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;引言&lt;/h2&gt;

&lt;p&gt;SymPy是一个符号数学Python库。它的目标是成为一个全功能的计算机代数系统，同时保持代码的精简而易于理解和课扩展。SymPy完全由Python写成，不需要任何外部库。 &lt;/p&gt;

&lt;p&gt;这个教程概述和简介SymPy。阅读它能让你知道SymPy可以为你做什么。如果你想了解更多，阅读&lt;a href=&quot;http://docs.sympy.org/0.7.1/guide.html#guide&quot;&gt;SymPy用户指南&lt;/a&gt;和&lt;a href=&quot;http://docs.sympy.org/0.7.1/modules/index.html#module-docs&quot;&gt;SymPy模块参考&lt;/a&gt;。或者直接阅读&lt;a href=&quot;https://github.com/sympy/sympy/&quot;&gt;源码&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;sympy&quot;&gt;SymPy第一步&lt;/h2&gt;

&lt;p&gt;下载它最简单的方法是去&lt;a href=&quot;http://code.google.com/p/sympy/&quot;&gt;http://code.google.com/p/sympy/&lt;/a&gt;从“推荐下载”下载最新的压缩包。&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;
&lt;img src=&quot;http://fmn.rrimg.com/fmn061/20120901/1800/p_large_M3yG_5d30000027c61261.jpg&quot; alt=&quot;downloads&quot; /&gt;&lt;/p&gt;

&lt;p&gt;解压：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tar xzf sympy-0.7.1.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后用Python解释器尝试它：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[lyy@arch ~]cd sympy-0.7.1
[lyy@arch ~]$ python2
Python 2.7.3 (default, Apr 24 2012, 00:00:54) 
[GCC 4.7.0 20120414 (prerelease)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; from sympy import Symbol, cos
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; (1/cos(x)).series(x, 0, 10)
1 + x**2/2 + 5*x**4/24 + 61*x**6/720 + 277*x**8/8064 + O(x**10)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你可以如上展示使用SymPy。如果你在你的程序中使用它的话，这确实是推荐的方法。你也可以用&lt;code&gt;./setup.py install&lt;/code&gt;像所有其它Python模块一样安装它，或者仅仅在你心爱的发行版中安装相应的包，等等。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;在archlinux中安装SymPy&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[lyy@arch ~]$ sudo pacman -S python2-sympy
警告：python2-sympy-0.7.1-4 已经为最新 -- 重新安装
正在解决依赖关系...
正在查找内部冲突...

目标 (1)： python2-sympy-0.7.1-4

全部安装大小：25.12 MiB
净更新大小：0.00 MiB

进行安装吗？ [Y/n] 
(1/1) 正在检查软件包完整性      [###############################] 100%
(1/1) 正在加载软件包文件        [###############################] 100%
(1/1) 正在检查文件冲突          [###############################] 100%
(1/1) 正在检查可用硬盘空间      [###############################] 100%
(1/1) 正在更新 python2-sympy
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;其它安装SymPy的方法，查阅SymPy主页上的&lt;a href=&quot;http://code.google.com/p/sympy/wiki/DownloadInstallation?tm=2&quot;&gt;下载&lt;/a&gt;标签。&lt;/p&gt;

&lt;h3 id=&quot;isympy&quot;&gt;isympy控制台&lt;/h3&gt;

&lt;p&gt;为了试验新功能，或当搞清楚如何做事时，你可以使用我们对IPython的特殊封装&lt;code&gt;isympy&lt;/code&gt;(它位于&lt;code&gt;/bin/isympy&lt;/code&gt;中，如果你正在从源码文件夹运行的话)，它仅仅是一个已经导入相关sympy模块的标准python shell，定义了符号&lt;code&gt;x,y,z&lt;/code&gt;和一些其它东西：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[lyy@arch ~]$ cd sympy 
[lyy@arch ~]$ ./bin/isympy 
IPython console for SymPy 0.7.1 (Python 2.7.3-64-bit) (ground types: python)

These commands were executed:
&amp;gt;&amp;gt;&amp;gt; from __future__ import division
&amp;gt;&amp;gt;&amp;gt; from sympy import *
&amp;gt;&amp;gt;&amp;gt; x, y, z, t = symbols('x y z t')
&amp;gt;&amp;gt;&amp;gt; k, m, n = symbols('k m n', integer=True)
&amp;gt;&amp;gt;&amp;gt; f, g, h = symbols('f g h', cls=Function)

Documentation can be found at http://www.sympy.org

In [1]: (1/cos(x)).series(x, 0, 10)
Out[1]: 
     2      4       6        8           
    x    5⋅x    61⋅x    277⋅x            
1 + ── + ──── + ───── + ────── + O(x**10)
    2     24     720     8064  
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;sympy-1&quot;&gt;用SymPy做计算器&lt;/h3&gt;

&lt;p&gt;SymPy有三种内建的数值类型：浮点数、有理数和整数。&lt;/p&gt;

&lt;p&gt;有理数类用一对整数表示一个有理数：分子和分母，所以&lt;code&gt;Rational(1,2)&lt;/code&gt;代表1/2,&lt;code&gt;Rational(5,2)&lt;/code&gt;代表5/2等等。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import *
&amp;gt;&amp;gt;&amp;gt; a = Rational(1,2)

&amp;gt;&amp;gt;&amp;gt; a
1/2

&amp;gt;&amp;gt;&amp;gt; a*2
1

&amp;gt;&amp;gt;&amp;gt; Rational(2)**50/Rational(10)**50
1/88817841970012523233890533447265625
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;当计算整型数据时小心处理，因为他们会截取整数部分。这就是为何：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; 1/2
0

&amp;gt;&amp;gt;&amp;gt; 1.0/2
0.5
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然而你可以这样做&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from __future__ import division

&amp;gt;&amp;gt;&amp;gt; 1/2 
0.5
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;真正的除法将要成为python3k的标准，isympy中也是。&lt;/p&gt;

&lt;p&gt;我们也有些特殊的常数，像e和pi，它们被视为符号(1+pi将不被数值求解，它将保持为1+pi)，并且我们可以有任意精度：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; pi**2
pi**2

&amp;gt;&amp;gt;&amp;gt; pi.evalf()
3.14159265358979

&amp;gt;&amp;gt;&amp;gt; (pi+exp(1)).evalf()
5.85987448204884
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;就像你看到的，&lt;code&gt;evalf&lt;/code&gt;将表达式求解为浮点数。&lt;/p&gt;

&lt;p&gt;这还有一个类表示数学上的无限，叫作&lt;code&gt;oo&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; oo &amp;gt; 99999
True
&amp;gt;&amp;gt;&amp;gt; oo + 1
oo
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-1&quot;&gt;符号&lt;/h3&gt;

&lt;p&gt;和其它计算机代数系统相比，在SymPy中你不得不显式地声明符号变量：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import *
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; y = Symbol('y')
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后你可以使用它们：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; x+y+x-y
2*x

&amp;gt;&amp;gt;&amp;gt; (x+y)**2
(x + y)**2

&amp;gt;&amp;gt;&amp;gt; ((x+y)**2).expand()
x**2 + 2*x*y + y**2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;使用&lt;code&gt;subs(old, new)&lt;/code&gt;用其它符号和数代换它们：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; ((x+y)**2).subs(x, 1)
(y + 1)**2

&amp;gt;&amp;gt;&amp;gt; ((x+y)**2).subs(x, y)
4*y**2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;对于剩余的教程，我们假设我们已经运行了：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; import sys
&amp;gt;&amp;gt;&amp;gt; oldhook = sys.displayhook
&amp;gt;&amp;gt;&amp;gt; sys.displayhook = pprint
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这样就有漂亮的打印。参见之后的&lt;a href=&quot;#section-16&quot;&gt;打印&lt;/a&gt;部分。如果你安装了unicode字体，你的输出可能看起来有点不同。(将看起来稍微好些)&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;代数&lt;/h2&gt;

&lt;p&gt;对部分分式分解，使用&lt;code&gt;apart(expr, x)&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; 1/((x+2)*(x+1))
       1       
───────────────
(x + 1)⋅(x + 2)
&amp;gt;&amp;gt;&amp;gt; apart(1/((x+2)*(x+1)), x)
    1       1  
- ───── + ─────
  x + 2   x + 1
&amp;gt;&amp;gt;&amp;gt; (x+1)/(x-1)
x + 1
─────
x - 1
&amp;gt;&amp;gt;&amp;gt; apart((x+1)/(x-1), x)
      2  
1 + ─────
    x - 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;把它们重新结合起来，使用&lt;code&gt;together(expr, x)&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; z = Symbol('z')
&amp;gt;&amp;gt;&amp;gt; together(1/x + 1/y + 1/z)
x⋅y + x⋅z + y⋅z
───────────────
     x⋅y⋅z     
&amp;gt;&amp;gt;&amp;gt; together(apart((x+1)/(x-1), x), x)
x + 1
─────
x - 1
&amp;gt;&amp;gt;&amp;gt; together(apart(1/( (x+2)*(x+1) ), x), x)
       1       
───────────────
(x + 1)⋅(x + 2)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-3&quot;&gt;演算&lt;/h2&gt;

&lt;h3 id=&quot;section-4&quot;&gt;极限&lt;/h3&gt;

&lt;p&gt;极限在sympy中使用很简单，它们的语法是&lt;code&gt;limit(function, variable, point)&lt;/code&gt;，所以计算当x趋近于0时f(x)的极限，你可以给出&lt;code&gt;limit(f, x, 0)&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import *
&amp;gt;&amp;gt;&amp;gt; x=Symbol(&quot;x&quot;)
&amp;gt;&amp;gt;&amp;gt; limit(sin(x)/x, x, 0)
1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你也可以计算在无穷的极限：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; limit(sin(x)/x,x,0)
1
&amp;gt;&amp;gt;&amp;gt; limit(x,x,oo)
∞ 对于一些不寻常的极限例子，你可以阅读这个测试文件[test_demidovich.py](https://github.com/sympy/sympy/blob/master/sympy/series/tests/test_demidovich.py)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-5&quot;&gt;微分&lt;/h3&gt;

&lt;p&gt;你可以使用&lt;code&gt;diff(func, var)&lt;/code&gt;微分任何SymPy表达式。例如：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import *
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; diff(sin(x), x)
cos(x)
&amp;gt;&amp;gt;&amp;gt; diff(sin(2*x), x)
2⋅cos(2⋅x)
&amp;gt;&amp;gt;&amp;gt; diff(tan(x), x)
   2       
tan (x) + 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你可以检查正确性：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; limit((tan(x+y)-tan(x))/y, y, 0)
   2       
tan (x) + 1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;高阶微分可以使用&lt;code&gt;diff(func, var, n)&lt;/code&gt;来计算：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; diff(sin(2*x), x, 1)
2⋅cos(2⋅x)
&amp;gt;&amp;gt;&amp;gt; diff(sin(2*x), x, 2)
-4⋅sin(2⋅x)
&amp;gt;&amp;gt;&amp;gt; diff(sin(2*x), x, 3)
-8⋅cos(2⋅x)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-6&quot;&gt;级数展开&lt;/h3&gt;

&lt;p&gt;使用&lt;code&gt;.series(var, point, order)&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; cos(x).series(x, 0, 10)
     2    4     6      8            
    x    x     x      x             
1 - ── + ── - ─── + ───── + O(x**10)
    2    24   720   40320 
&amp;gt;&amp;gt;&amp;gt; (1/cos(x)).series(x, 0, 10)
     2      4       6        8           
    x    5⋅x    61⋅x    277⋅x            
1 + ── + ──── + ───── + ────── + O(x**10)
    2     24     720     8064            
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;另一个简单的例子：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Integral, Symbol, pprint
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; y = Symbol('y')
&amp;gt;&amp;gt;&amp;gt; e = 1/(x + y)
&amp;gt;&amp;gt;&amp;gt; s = e.series(x, 0, 5)
&amp;gt;&amp;gt;&amp;gt; print(s)
1/y - x/y**2 + x**2/y**3 - x**3/y**4 + x**4/y**5 + O(x**5)
&amp;gt;&amp;gt;&amp;gt; pprint(s)
          2    3    4          
1   x    x    x    x           
─ - ── + ── - ── + ── + O(x**5)
y    2    3    4    5          
    y    y    y    y           
None
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-7&quot;&gt;求和&lt;/h3&gt;

&lt;p&gt;计算给定求和变量界限的f的总和(Summation)。&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;summation(f, (i, a, b))&lt;/code&gt;变量i从a到b计算f的和，也就是，&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;                            b
                          ____
                          \   `
summation(f, (i, a, b)) =  )    f
                          /___,
                          i = a
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果不能计算总和，它将打印相应的求和公式。求值可引入额外的极限计算：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import summation, oo, symbols, log
&amp;gt;&amp;gt;&amp;gt; i, n, m = symbols('i n m', integer=True)
&amp;gt;&amp;gt;&amp;gt; summation(2*i - 1, (i, 1, n))
 2
n 
&amp;gt;&amp;gt;&amp;gt; summation(1/2**i, (i, 0, oo))
2
&amp;gt;&amp;gt;&amp;gt; summation(1/log(n)**n, (n, 2, oo))
  ∞           
 ___          
 \  `         
  \      -n   
  /   log  (n)
 /__,         
n = 2         
&amp;gt;&amp;gt;&amp;gt; summation(i, (i, 0, n), (n, 0, m))
 3    2    
m    m    m
── + ── + ─
6    2    3
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; from sympy import factorial
&amp;gt;&amp;gt;&amp;gt; summation(x**n/factorial(n), (n, 0, oo))
 x
ℯ 
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-8&quot;&gt;积分&lt;/h3&gt;

&lt;p&gt;通过&lt;code&gt;integrate()&lt;/code&gt;功能(facility)，SymPy对基本和特殊函数定与不定积分有卓越的支持。
该功能使用有力的扩展Risch-Norman算法，启发算法和模式匹配：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import integrate, erf, exp, sin, log, oo, pi, sinh, symbols
&amp;gt;&amp;gt;&amp;gt; x, y = symbols('x,y')
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你可以对基本函数积分：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; integrate(6*x**5, x)
 6
x 
&amp;gt;&amp;gt;&amp;gt; integrate(sin(x), x)
-cos(x)
&amp;gt;&amp;gt;&amp;gt; integrate(log(x), x)
x⋅log(x) - x
&amp;gt;&amp;gt;&amp;gt; integrate(2*x + sinh(x), x)
 2          
x  + cosh(x)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;特殊函数也可以简单的处理：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; integrate(exp(-x**2)*erf(x), x)
  ⎽⎽⎽    2   
╲╱ π ⋅erf (x)
─────────────
      4      
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;还可以计算定积分：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; integrate(x**3, (x, -1, 1))
0
&amp;gt;&amp;gt;&amp;gt; integrate(sin(x), (x, 0, pi/2))
1
&amp;gt;&amp;gt;&amp;gt; integrate(cos(x), (x, -pi/2, pi/2))
2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;反常积分也被支持：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; integrate(exp(-x), (x, 0, oo))
1
&amp;gt;&amp;gt;&amp;gt; integrate(log(x), (x, 0, 1))
-1
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-9&quot;&gt;复数&lt;/h3&gt;

&lt;p&gt;除了复数单元&lt;code&gt;I&lt;/code&gt;是虚数，符号可以被用属性创建(例如 real,positive,complex,等等)这将影响它们的表现：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Symbol, exp, I
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')  # a plain x with no attributes
&amp;gt;&amp;gt;&amp;gt; exp(I*x).expand()
 ⅈ⋅x
ℯ   
&amp;gt;&amp;gt;&amp;gt; exp(I*x).expand(complex=True)
   -im(x)               -im(x)           
ⅈ⋅ℯ      ⋅sin(re(x)) + ℯ      ⋅cos(re(x))
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x', real=True)
&amp;gt;&amp;gt;&amp;gt; exp(I*x).expand(complex=True)
ⅈ⋅sin(x) + cos(x)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-10&quot;&gt;函数&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;三角函数:&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import asin, asinh, cos, sin, sinh, symbols, I
&amp;gt;&amp;gt;&amp;gt; x, y = symbols('x,y')
&amp;gt;&amp;gt;&amp;gt; sin(x+y).expand(trig=True)
sin(x)⋅cos(y) + sin(y)⋅cos(x)
&amp;gt;&amp;gt;&amp;gt; cos(x+y).expand(trig=True)
-sin(x)⋅sin(y) + cos(x)⋅cos(y)
&amp;gt;&amp;gt;&amp;gt; sin(I*x)
ⅈ⋅sinh(x)
&amp;gt;&amp;gt;&amp;gt; sinh(I*x)
ⅈ⋅sin(x)
&amp;gt;&amp;gt;&amp;gt; asinh(I)
ⅈ⋅π
───
 2 
&amp;gt;&amp;gt;&amp;gt; asinh(I*x)
ⅈ⋅asin(x)
&amp;gt;&amp;gt;&amp;gt; sin(x).series(x, 0, 10)
     3     5     7       9             
    x     x     x       x              
x - ── + ─── - ──── + ────── + O(x**10)
    6    120   5040   362880           
&amp;gt;&amp;gt;&amp;gt; sinh(x).series(x, 0, 10)
     3     5     7       9             
    x     x     x       x              
x + ── + ─── + ──── + ────── + O(x**10)
    6    120   5040   362880           
&amp;gt;&amp;gt;&amp;gt; asin(x).series(x, 0, 10)
     3      5      7       9           
    x    3⋅x    5⋅x    35⋅x            
x + ── + ──── + ──── + ───── + O(x**10)
    6     40    112     1152           
&amp;gt;&amp;gt;&amp;gt; asinh(x).series(x, 0, 10)
     3      5      7       9           
    x    3⋅x    5⋅x    35⋅x            
x - ── + ──── - ──── + ───── + O(x**10)
    6     40    112     1152    
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;球谐函数：&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Ylm
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import theta, phi
&amp;gt;&amp;gt;&amp;gt; Ylm(1, 0, theta, phi)
  ⎽⎽⎽       
╲╱ 3 ⋅cos(θ)
────────────
      ⎽⎽⎽   
  2⋅╲╱ π    
&amp;gt;&amp;gt;&amp;gt; Ylm(1, 1, theta, phi)
   ⎽⎽⎽  ⅈ⋅φ       
-╲╱ 6 ⋅ℯ   ⋅sin(θ)
──────────────────
         ⎽⎽⎽      
     4⋅╲╱ π       
&amp;gt;&amp;gt;&amp;gt; Ylm(2, 1, theta, phi)
   ⎽⎽⎽⎽  ⅈ⋅φ              
-╲╱ 30 ⋅ℯ   ⋅sin(θ)⋅cos(θ)
──────────────────────────
             ⎽⎽⎽          
         4⋅╲╱ π       
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;阶乘和伽马函数：&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import factorial, gamma, Symbol
&amp;gt;&amp;gt;&amp;gt; x = Symbol(&quot;x&quot;)
&amp;gt;&amp;gt;&amp;gt; n = Symbol(&quot;n&quot;, integer=True)
&amp;gt;&amp;gt;&amp;gt; factorial(x)
x!
&amp;gt;&amp;gt;&amp;gt; factorial(n)
n!
&amp;gt;&amp;gt;&amp;gt; gamma(x + 1).series(x, 0, 3) # i.e. factorial(x)
                    2  2             2  2          
                   π ⋅x    EulerGamma ⋅x           
1 - EulerGamma⋅x + ───── + ────────────── + O(x**3)
                     12          2     
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;zeta函数：&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import zeta
&amp;gt;&amp;gt;&amp;gt; zeta(4, x)
ζ(4, x)
&amp;gt;&amp;gt;&amp;gt; zeta(4, 1)
 4
π 
──
90
&amp;gt;&amp;gt;&amp;gt; zeta(4, 2)
      4
     π 
-1 + ──
     90
&amp;gt;&amp;gt;&amp;gt; zeta(4, 3)
        4
  17   π 
- ── + ──
  16   90
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;多项式：&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import assoc_legendre, chebyshevt, legendre, hermite
&amp;gt;&amp;gt;&amp;gt; chebyshevt(2, x)
   2    
2⋅x  - 1
&amp;gt;&amp;gt;&amp;gt; chebyshevt(4, x)
   4      2    
8⋅x  - 8⋅x  + 1
&amp;gt;&amp;gt;&amp;gt; legendre(2, x)
   2    
3⋅x    1
──── - ─
 2     2
&amp;gt;&amp;gt;&amp;gt; legendre(8, x)
      8         6         4        2      
6435⋅x    3003⋅x    3465⋅x    315⋅x     35
─────── - ─────── + ─────── - ────── + ───
  128        32        64       32     128
&amp;gt;&amp;gt;&amp;gt; assoc_legendre(2, 1, x)
        ⎽⎽⎽⎽⎽⎽⎽⎽⎽⎽
       ╱    2     
-3⋅x⋅╲╱  - x  + 1 
&amp;gt;&amp;gt;&amp;gt; assoc_legendre(2, 2, x)
     2    
- 3⋅x  + 3
&amp;gt;&amp;gt;&amp;gt; hermite(3, x)
   3       
8⋅x  - 12⋅x
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-11&quot;&gt;微分方程&lt;/h3&gt;

&lt;p&gt;在 isympy中：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Function, Symbol, dsolve
&amp;gt;&amp;gt;&amp;gt; f = Function('f')
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; f(x).diff(x, x) + f(x)
         2      
        d       
f(x) + ───(f(x))
         2      
       dx       
&amp;gt;&amp;gt;&amp;gt; dsolve(f(x).diff(x, x) + f(x), f(x))
f(x) = C₁⋅cos(x) + C₂⋅sin(x)
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-12&quot;&gt;代数方程&lt;/h3&gt;

&lt;p&gt;在isympy中：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import solve, symbols
&amp;gt;&amp;gt;&amp;gt; x, y = symbols('x,y')
&amp;gt;&amp;gt;&amp;gt; solve(x**4 - 1, x)
[1, -1, -ⅈ, ⅈ]
&amp;gt;&amp;gt;&amp;gt; solve([x + 5*y - 2, -3*x + 6*y - 15], [x, y])
{x: -3, y: 1}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-13&quot;&gt;线性代数&lt;/h2&gt;

&lt;h3 id=&quot;section-14&quot;&gt;矩阵&lt;/h3&gt;

&lt;p&gt;矩阵从Matrix类创建：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Matrix, Symbol
&amp;gt;&amp;gt;&amp;gt; Matrix([[1,0], [0,1]])
⎡1  0⎤
⎢    ⎥
⎣0  1⎦
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;它可以包含符号：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; y = Symbol('y')
&amp;gt;&amp;gt;&amp;gt; A = Matrix([[1,x], [y,1]])
&amp;gt;&amp;gt;&amp;gt; A
⎡1  x⎤
⎢    ⎥
⎣y  1⎦
&amp;gt;&amp;gt;&amp;gt; A**2
⎡x⋅y + 1    2⋅x  ⎤
⎢                ⎥
⎣  2⋅y    x⋅y + 1⎦
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;更多有关矩阵信息，参见线性代数教程。&lt;/p&gt;

&lt;h2 id=&quot;section-15&quot;&gt;模式匹配&lt;/h2&gt;

&lt;p&gt;使用&lt;code&gt;.match()&lt;/code&gt;方法，和Wild类对表达式实行模式匹配。这个方法将返回一个发生替换的字典，如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Symbol, Wild
&amp;gt;&amp;gt;&amp;gt; x = Symbol('x')
&amp;gt;&amp;gt;&amp;gt; p = Wild('p')
&amp;gt;&amp;gt;&amp;gt; (5*x**2).match(p*x**2)
{p: 5}
&amp;gt;&amp;gt;&amp;gt; q = Wild('q')
&amp;gt;&amp;gt;&amp;gt; (x**2).match(p*x**q)
{p: 1, q: 2}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果匹配失败，将返回&lt;code&gt;None&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; print (x+1).match(p**x)
None
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;可以指定&lt;code&gt;Wild&lt;/code&gt;类的排除参数去保证一些东西不出现在结果之中：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; p = Wild('p', exclude=[1,x])
&amp;gt;&amp;gt;&amp;gt; print (x+1).match(x+p) # 1 is excluded
None
&amp;gt;&amp;gt;&amp;gt; print (x+1).match(p+1) # x is excluded
None
&amp;gt;&amp;gt;&amp;gt; print (x+1).match(x+2+p) # -1 is not excluded
{p_: -1}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-16&quot;&gt;打印&lt;/h2&gt;

&lt;p&gt;这里有许多打印表达式的方法：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;标准&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;这就是&lt;code&gt;str(expression)&lt;/code&gt;返回的，看起来想这样：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Integral
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; print x**2
x**2
&amp;gt;&amp;gt;&amp;gt; print 1/x
1/x
&amp;gt;&amp;gt;&amp;gt; print Integral(x**2, x)
Integral(x**2, x)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;漂亮的打印&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;pprint&lt;/code&gt;函数产生好看的ascii艺术打印：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Integral, pprint
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; pprint(x**2)
 2
x 
None
&amp;gt;&amp;gt;&amp;gt; pprint(1/x)
1
─
x
None
&amp;gt;&amp;gt;&amp;gt; pprint(Integral(x**2, x))
⌠      
⎮  2   
⎮ x  dx
⌡      
None
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果你安装了unicode字体，&lt;code&gt;pprint&lt;/code&gt;函数将默认使用它。你可以使用&lt;code&gt;use_unicode&lt;/code&gt;函数改变这个选项。：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; pprint(Integral(x**2, x), use_unicode=False)
  /     
 |      
 |  2   
 | x  dx
 |      
/       
None
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;更多好看的unicode打印另见维基&lt;a href=&quot;https://github.com/sympy/sympy/wiki/Pretty-Printing&quot;&gt;Pretty Printing&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;小技巧：在Python解释器中默认使用漂亮的打印，使用：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ python
Python 2.5.2 (r252:60911, Jun 25 2008, 17:58:32)
[GCC 4.3.1] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; from sympy import init_printing, var, Integral
&amp;gt;&amp;gt;&amp;gt; init_printing(use_unicode=False, wrap_line=False, no_global=True)
&amp;gt;&amp;gt;&amp;gt; var(&quot;x&quot;)
x
&amp;gt;&amp;gt;&amp;gt; x**3/3
 3
x
--
3
&amp;gt;&amp;gt;&amp;gt; Integral(x**2, x) #doctest: +NORMALIZE_WHITESPACE
  /
 |
 |  2
 | x  dx
 |
/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Python打印&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy.printing.python import python
&amp;gt;&amp;gt;&amp;gt; from sympy import Integral
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; print python(x**2)
x = Symbol('x')
e = x**2
&amp;gt;&amp;gt;&amp;gt; print python(1/x)
x = Symbol('x')
e = 1/x
&amp;gt;&amp;gt;&amp;gt; print python(Integral(x**2, x))
x = Symbol('x')
e = Integral(x**2, x)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;LaTeX打印&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Integral, latex
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; latex(x**2)
x^{2}
&amp;gt;&amp;gt;&amp;gt; latex(x**2, mode='inline')
$x^{2}$
&amp;gt;&amp;gt;&amp;gt; latex(x**2, mode='equation')
\begin{equation}x^{2}\end{equation}
&amp;gt;&amp;gt;&amp;gt; latex(x**2, mode='equation*')
\begin{equation*}x^{2}\end{equation*}
&amp;gt;&amp;gt;&amp;gt; latex(1/x)
\frac{1}{x}
&amp;gt;&amp;gt;&amp;gt; latex(Integral(x**2, x))
\int x^{2}\,dx
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;MathML&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy.printing.mathml import mathml
&amp;gt;&amp;gt;&amp;gt; from sympy import Integral, latex
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; print mathml(x**2)
&amp;lt;apply&amp;gt;&amp;lt;power/&amp;gt;&amp;lt;ci&amp;gt;x&amp;lt;/ci&amp;gt;&amp;lt;cn&amp;gt;2&amp;lt;/cn&amp;gt;&amp;lt;/apply&amp;gt;
&amp;gt;&amp;gt;&amp;gt; print mathml(1/x)
&amp;lt;apply&amp;gt;&amp;lt;power/&amp;gt;&amp;lt;ci&amp;gt;x&amp;lt;/ci&amp;gt;&amp;lt;cn&amp;gt;-1&amp;lt;/cn&amp;gt;&amp;lt;/apply&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Pylet&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from sympy import Integral, preview
&amp;gt;&amp;gt;&amp;gt; from sympy.abc import x
&amp;gt;&amp;gt;&amp;gt; preview(Integral(x**2, x))
This is pdfTeX, Version 3.1415926-2.4-1.40.13 (TeX Live 2012/Arch Linux)
 restricted \write18 enabled.
entering extended mode
(/tmp/tmpGYREx_.tex
LaTeX2e &amp;lt;2011/06/27&amp;gt;
Babel &amp;lt;v3.8m&amp;gt; and hyphenation patterns for english, dumylang, nohyphenation, ge
rman-x-2012-05-30, ngerman-x-2012-05-30, afrikaans, ancientgreek, ibycus, arabi
c, armenian, basque, bulgarian, catalan, pinyin, coptic, croatian, czech, danis
h, dutch, ukenglish, usenglishmax, esperanto, estonian, ethiopic, farsi, finnis
h, french, friulan, galician, german, ngerman, swissgerman, monogreek, greek, h
ungarian, icelandic, assamese, bengali, gujarati, hindi, kannada, malayalam, ma
rathi, oriya, panjabi, tamil, telugu, indonesian, interlingua, irish, italian, 
kurmanji, latin, latvian, lithuanian, mongolian, mongolianlmc, bokmal, nynorsk,
 polish, portuguese, romanian, romansh, russian, sanskrit, serbian, serbianc, s
lovak, slovenian, spanish, swedish, turkish, turkmen, ukrainian, uppersorbian, 
welsh, loaded.
(/usr/share/texmf-dist/tex/latex/base/article.cls
Document Class: article 2007/10/19 v1.4h Standard LaTeX document class
(/usr/share/texmf-dist/tex/latex/base/size12.clo))
(/usr/share/texmf-dist/tex/latex/amsmath/amsmath.sty
For additional information on amsmath, use the `?' option.
(/usr/share/texmf-dist/tex/latex/amsmath/amstext.sty
(/usr/share/texmf-dist/tex/latex/amsmath/amsgen.sty))
(/usr/share/texmf-dist/tex/latex/amsmath/amsbsy.sty)
(/usr/share/texmf-dist/tex/latex/amsmath/amsopn.sty))
(/usr/share/texmf-dist/tex/latex/eulervm/eulervm.sty)
No file tmpGYREx_.aux.
(/usr/share/texmf-dist/tex/latex/eulervm/uzeur.fd)
(/usr/share/texmf-dist/tex/latex/eulervm/uzeus.fd)
(/usr/share/texmf-dist/tex/latex/eulervm/uzeuex.fd) [1] (./tmpGYREx_.aux) )
Output written on tmpGYREx_.dvi (1 page, 320 bytes).
Transcript written on tmpGYREx_.log.
This is dvipng 1.14 Copyright 2002-2010 Jan-Ake Larsson
[1] 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果pyglet被安装了，一个包含LaTeX渲染后表达式的pyglet窗口将被打开：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn059/20120903/1210/p_large_ViwY_2fcc000000bf1262.jpg&quot; alt=&quot;pyglet&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-17&quot;&gt;注意&lt;/h3&gt;

&lt;p&gt;isympy自动调用&lt;code&gt;pprint&lt;/code&gt;,这就是为什么默认情况下你看到的是漂亮的打印。&lt;/p&gt;

&lt;p&gt;注意有一个可用的打印模块&lt;code&gt;sympy.printing&lt;/code&gt;。其它通过这个模块的打印方法是：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;pretty(expr)&lt;/code&gt;,&lt;code&gt;pretty_print(expr)&lt;/code&gt;,&lt;code&gt;pprint(expr)&lt;/code&gt;:分别漂亮的表示&lt;code&gt;expr&lt;/code&gt;.这是和之前描述的第二层表示是一样的。&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;latex(expr)&lt;/code&gt;, &lt;code&gt;print_latex(expr)&lt;/code&gt;：分别返回和打印&lt;code&gt;expr&lt;/code&gt;的&lt;a href=&quot;http://www.latex-project.org/&quot;&gt;LaTeX&lt;/a&gt;表示。&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;mathml(expr)&lt;/code&gt;,&lt;code&gt;print_mathml(expr)&lt;/code&gt;：分别返回和打印&lt;code&gt;expr&lt;/code&gt;的&lt;a href=&quot;http://www.w3.org/Math/&quot;&gt;MathML&lt;/a&gt;表示。&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;print_gtk(expr)&lt;/code&gt;：在&lt;a href=&quot;http://helm.cs.unibo.it/mml-widget/&quot;&gt;Gtkmathview&lt;/a&gt;打印&lt;code&gt;expr&lt;/code&gt;，这是一个呈现MathML代码的GTK部件。&lt;a href=&quot;http://helm.cs.unibo.it/mml-widget/&quot;&gt;Gtkmathview&lt;/a&gt;要求安装。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-18&quot;&gt;更多文档&lt;/h2&gt;

&lt;p&gt;现在该学更多有关SymPy的知识了。浏览&lt;a href=&quot;http://docs.sympy.org/dev/guide.html#guide&quot;&gt;SymPy用户指南&lt;/a&gt;和&lt;a href=&quot;http://docs.sympy.org/dev/modules/index.html#module-docs&quot;&gt;SymPy模块参考&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;一定也浏览我们的公共&lt;a href=&quot;http://wiki.sympy.org/&quot;&gt;wiki.sympy.org&lt;/a&gt;，那里包含了很多我们和我们的用户贡献的示例，教程，cookbook，请自由地编辑它。&lt;/p&gt;

&lt;h2 id=&quot;section-19&quot;&gt;翻译&lt;/h2&gt;

&lt;p&gt;这个教程还有其它语言：&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.sympy.org/dev/tutorial.de.html&quot;&gt;德语&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;FootNotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;不介意非稳定版我觉得git更方便一些，当然linux包管理器更方便,所以先用你的包管理器安装它。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;Compute the summation of f with respect to the given summation variable over the given limits.&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>SciPy入门指南(译)</title>
   <link href="http://reverland.org/python/2012/08/24/scipy"/>
   <updated>2012-08-24T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/08/24/scipy</id>
   <content type="html">
&lt;h1 id=&quot;scipy&quot;&gt;SciPy入门指南&lt;/h1&gt;

&lt;p&gt;这个教程是为了帮助初学者掌握scipy并且肯能快地实际使用。&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#scipynumpymatplotlib&quot;&gt;什么是scipy、numpy、matplotlib？&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;它们是用来干什么的？&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipy-1&quot;&gt;如何使用scipy工作&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#scipy-2&quot;&gt;学习使用scipy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;示例会话&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;交互工作&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;运行脚本&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#import&quot;&gt;一些关于导入(import)的笔记&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn056/20120825/1810/p_large_LzVl_40d700008a811261.jpg&quot; alt=&quot;optimization&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;scipynumpymatplotlib&quot;&gt;什么是scipy、numpy、matplotlib？&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;Python&lt;/em&gt;是一种通用语言。它被解释运行，是动态类型语言，并且非常适合交互工作和快速实现原型，然而又足够强大用来写大型应用。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;NumPy&lt;/em&gt;是一个定义了数值数组和矩阵类型和它们的基本运算的语言扩展。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;SciPy&lt;/em&gt;是另一种使用NumPy来做高等数学、信号处理、优化、统计和许多其它科学任务的语言扩展。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Matplotlib&lt;/em&gt;是一个帮助绘图的语言扩展。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;它们是用来干什么的？&lt;/h2&gt;

&lt;p&gt;SciPy和其它这些能用来完成许多任务：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;首先它们很适于用来进行严重依赖数学和数值运算的计算,它们可以原生地使用数组、矩阵和对数组和矩阵的运算，求出特征根，计算积分，解决微分方程。&lt;/p&gt;

    &lt;p&gt;NumPy的数组类(被用来实现矩阵类的基础)是考虑速度的实现，所以存取NumPy数组比存取Python列表速度更快。此外，NumPy实现一种&lt;em&gt;数组语言&lt;/em&gt;，以致于不需要大多数循环。例如，普通Python(C等等也是相似的):&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;  a = range(10000000)
  b = range(10000000)
  c = []
  for i in range(len(a)):
    c.append(a[i] + b[i])
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;这个循环将在几GHz的处理器上耗时5到10秒，而NumPy：&lt;/p&gt;

    &lt;pre&gt;&lt;code&gt;  import numpy as np
  a = np.arange(10000000)
  b = np.arange(10000000)
  c = a + b
&lt;/code&gt;&lt;/pre&gt;

    &lt;p&gt;不仅这个更加简洁和易读，而且相比几乎是瞬间的，甚至NumPy的导入都比普通Python中的循环更快。为什么？Python是一种动态类型的解释语言，这意味着在每次循环迭代时它都必须检查运算对象a和b的类型来选则&lt;code&gt;+&lt;/code&gt;正确的意义。(在python中&lt;code&gt;+&lt;/code&gt;被用到许多地方，比如连接字符串、可以有不同元素类型的列表)当’+’的操作对象之一是一个NumPy数组时，NumPy的&lt;code&gt;add&lt;/code&gt;函数将被Python自动选择，仅仅检测一次类型。然后它通过编译C函数执行”真正的”加法循环。这和普通python中的解释循环相比是非常快的。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;有许多通用的或特定用途的数值代码使用了numpy和scipy。参考&lt;a href=&quot;http://scipy.org/Topical_Software&quot;&gt;局部软件索引&lt;/a&gt;来查看部分列表。Python有许多用来创建交互应用的高级的模块(例如&lt;a href=&quot;http://scipy.org/TraitsUI&quot;&gt;TraitsUI&lt;/a&gt;和&lt;a href=&quot;http://scipy.org/Cookbook/wxPython_dialogs&quot;&gt;wxPython&lt;/a&gt;)。和scipy一同使用这些是最快的创建科学应用的方法。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;使用&lt;a href=&quot;http://ipython.scipy.org/&quot;&gt;ipython&lt;/a&gt;使得交互工作更加简单。数据处理，数值模型探索，在运行中尝试运算可以很快地从一个想法得到结果(参考&lt;a href=&quot;https://cirl.berkeley.edu/fperez/papers/ipython-cise-final.pdf&quot;&gt;artical on ipython&lt;/a&gt;)。&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/&quot;&gt;matplotlib&lt;/a&gt;模块制造高质量的绘图，通过它你可以把你的数据和模型转化为展示或文章用的图像。不必在一个程序中做数值计算，保存数据，然后用另一个绘图。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;scipy-1&quot;&gt;如何使用scipy工作&lt;/h2&gt;

&lt;p&gt;Python是一门语言，它有几个用户界面。没有一个单独的程序可以开始并且给一个集成的用户体验。取而代之的是各种使用python的方法。&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;最普遍的方法是使用高级python交互shell来输入命令和运行脚本。脚本可以用任何编辑器来写，例如&lt;a href=&quot;http://stani.be/python/spe/&quot;&gt;SPE&lt;/a&gt;,PyScripter,甚至notepad，emacs或者vi/vim。&lt;/p&gt;

&lt;p&gt;scipy和numpy默认都没有提供绘图函数。它们仅仅是数值工具。推荐的绘图工具包是&lt;a href=&quot;http://matplotlib.sourceforge.net/&quot;&gt;matplotlib&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;在Windows、Mac OS X和Linux下，所有这些工具都被&lt;a href=&quot;http://www.enthought.com/products/epd.php&quot;&gt;Enthought Python发行版&lt;/a&gt;提供，获取更多关于安装这些的指导参考此站点&lt;a href=&quot;http://www.scipy.org/Installing_SciPy&quot;&gt;安装scipy&lt;/a&gt;部分。&lt;/p&gt;

&lt;h2 id=&quot;scipy-2&quot;&gt;学习使用scipy&lt;/h2&gt;

&lt;p&gt;最快的使用scipy工作的方法可能就是这个&lt;a href=&quot;http://www.scipy.org/Additional_Documentation/Astronomy_Tutorial&quot;&gt;交互数据分析教程&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;去学习Python语言，python教程可以让你迅速熟悉python语法和对象。你可以从&lt;a href=&quot;http://docs.python.org/download.html&quot;&gt;http://docs.python.org/download.html&lt;/a&gt;下载这个教程。&lt;/p&gt;

&lt;p&gt;Dave Kuhlman的numpy和scipy教程是另一个很好的介绍：&lt;a href=&quot;http://www.rexx.com/~dkuhlman/scipy\_course\_01.html&quot;&gt;http://www.rexx.com/~dkuhlman/scipy_course_01.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;本站点上的&lt;a href=&quot;http://docs.scipy.org/&quot;&gt;文档&lt;/a&gt;和&lt;a href=&quot;http://www.scipy.org/Cookbook&quot;&gt;Cookbook&lt;/a&gt;部分提供更多学习材料。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;示例会话&lt;/h2&gt;

&lt;h3 id=&quot;section-2&quot;&gt;交互工作&lt;/h3&gt;

&lt;p&gt;让我们看看在矩形窗函数的傅利叶变换。我们将使用一个交互python shell——ipython来做这个。因为我们想要通过交互绘图呈现结果，我们将启动使用&lt;code&gt;--pylab&lt;/code&gt;参数启动ipython，这个参数允许使用&lt;a href=&quot;http://matplotlib.sourceforge.net/&quot;&gt;matplotlib&lt;/a&gt;交互。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ipython --pylab
Python 2.5.1 (r251:54863, May  2 2007, 16:27:44)
Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
IPython 0.7.3 -- An enhanced Interactive Python.
?       -&amp;gt; Introduction to IPython's features.
%magic  -&amp;gt; Information about IPython's 'magic' % functions.
help    -&amp;gt; Python's own help system.
object? -&amp;gt; Details about 'object'. ?object also works, ?? prints more.
  Welcome to pylab, a matplotlib-based Python environment.
  For more information, type 'help(pylab)'.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ipython提供了许多方便的特性，想tab补全python函数和一个优秀的帮助系统。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [1]: %logstart
Activating auto-logging. Current session state plus future input saved.
Filename       : ipython_log.py
Mode           : rotate
Output logging : False
Raw input log  : False
Timestamping   : False
State          : active
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个激活一个登录会话到一个文件。登录文件格式允许在以后就像一个python脚本一样被简单的执行，或编辑进一个程序。ipython也记录所有的输入输出(并把它们保存在叫In和Out的列表中)，因此你可以启动有追溯的登录。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [2]: from scipy import *
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;因为numpy和scipy不是构建在python中的，你必须显示地告诉python加载它们的特性。Scipy提供numpy所以当导入scipy时导入它是不必要的。&lt;/p&gt;

&lt;p&gt;现在开始实际的数学：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [3]: a = zeros(1000)
In [4]: a[:100]=1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;第一行正如你所期望的那样简单地创建了一个有1000个0的数组;numpy默认使这些0是双精度浮点数，但是如果我想要单精度或复数，我可以指定&lt;code&gt;zeors&lt;/code&gt;的额外参数。第二行把一百个元素设置成-1.&lt;/p&gt;

&lt;p&gt;然后我想要对这个数组进行傅利叶变换，scipy提供&lt;code&gt;fft&lt;/code&gt;函数来完成这些：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;b = fft(a)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;为了看看b是什么样的，我将使用matplotlib库。如果你使用”–pylab”启动ipython将不需要导入matplotlib。否则你应导入它:&lt;code&gt;from pylab import *&lt;/code&gt;但是你将没有交互功能(当你创建时自动绘图)。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [6]: plot(abs(b))
Out[6]: [&amp;lt;matplotlib.lines.Line2D instance at 0xb7b9144c&amp;gt;]
In [7]: show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn056/20120825/1810/p_large_34di_40d700008a7f1261.jpg&quot; alt=&quot;fft&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这将出现一个显示b的图像的窗口，如果你启动ipython时使用&lt;code&gt;--pylab&lt;/code&gt;的话&lt;code&gt;show&lt;/code&gt;命令是不必要的。&lt;/p&gt;

&lt;p&gt;我注意到如果我把b的0频移动到中间看起来更好。我可以通过连接b的后半部分和前半部分来实现，但是我记不清concatenate的语法了:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;In [8]: concatenate?
Type:           builtin_function_or_method
Base Class:     &amp;lt;type 'builtin_function_or_method'&amp;gt;
String Form:    &amp;lt;built-in function concatenate&amp;gt;
Namespace:      Interactive
Docstring:
    concatenate((a1, a2, ...), axis=0)
    Join arrays together.
    The tuple of sequences (a1, a2, ...) are joined along the given axis
    (default is the first one) into a single numpy array.
    Example:
    &amp;gt;&amp;gt;&amp;gt; concatenate( ([0,1,2], [5,6,7]) )
    array([0, 1, 2, 5, 6, 7])
In [9]: f=arange(-500,500,1)
In [10]: grid(True)
In [11]: plot(f,abs(concatenate((b[500:],b[:500]))))
Out[11]: [&amp;lt;matplotlib.lines.Line2D instance at 0xb360ca4c&amp;gt;]
In [12]: show()
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn062/20120825/1810/p_large_fk20_40d700008a801261.jpg&quot; alt=&quot;scipy-2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这得到了我想要的图像。我可以使用交互控制上下移动和缩放图片，并且为包含在出版物中产生postscript输出(如果你想要学习更多绘图知识，建议你阅读&lt;a href=&quot;http://matplotlib.sourceforge.net/tutorial.html&quot;&gt;matplotlib教程&lt;/a&gt;)。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;运行脚本&lt;/h3&gt;

&lt;p&gt;当你一遍又一遍重复做着相同的工作，把一些命令保存在文件中并把它们作为脚本在ipython中运行将很有用。你可以使用”Ctrl-D”退出当前的ipython会话并且编辑&lt;code&gt;ipython_log.py&lt;/code&gt;文件。当你想要执行这个文件中的指令时，你可以打开一个新的ipython会话输入命令&lt;code&gt;%run -i ipython_log.py&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;当编辑一个脚本文件时，在ipython中尝试一些命令也很方便。这将允许你在保存和运行之前，对一些简单的情况逐行尝试你的脚本。&lt;/p&gt;

&lt;h3 id=&quot;import&quot;&gt;一些关于导入(import)的笔记&lt;/h3&gt;

&lt;p&gt;如果你仅仅初学scipy和与其伴侣，以下的东西对你并不那么重要，不要太操心。但是当你开发一些大型的应用时最好记住它。&lt;/p&gt;

&lt;p&gt;对交互工作(在ipython中)和一些小型的脚本使用&lt;code&gt;from scipy import *&lt;/code&gt;没什么。这样将会有个优点就是所有的功能在当前命名空间都是立即可用的。然而，对大型的程序和软件包来说，建议只导入你真正需要的函数和模块。让我们考虑这种情况：你(为了无论什么理由)想要比较numpy和scipy的&lt;code&gt;fft&lt;/code&gt;函数。在你的脚本中你应这样写：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# import from module numpy.fft
from numpy.fft import fft
# import scipy's fft implementation and rename it;
# Note: `from scipy import fft` actually imports numpy.fft.fft (check with
# `scipy.fft?` in Ipython or look at .../site-packages/scipy/__init__.py)
from scipy.fftpack import fft as scipy_fft
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个优势就是，当你查看代码时，你可以显式的知道你在导入什么，代码便因此变得清晰和可读。而且，这通常比通过&lt;code&gt;import *&lt;/code&gt;导入所有东西更快，特别是如果你是从一个像scipy一样特别大的库中导入。&lt;/p&gt;

&lt;p&gt;然而，如果你使用许多不同的numpy函数，如果你显式导入每一个函数导入声明将变得非常长。但是你可以导入整个包来代替使用&lt;code&gt;import *&lt;/code&gt;。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;from numpy import *  # bad
from numpy import abs, concatenate, sin, pi, dot, amin, amax, asarray, cov, diag, zeros, empty, exp, eye, kaiser # very long
import numpy         # good
# use numpy.fft.fft() on array 'a'
b = numpy.fft.fft(a)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;没关系，因为通常&lt;code&gt;import numpy&lt;/code&gt;非常快。另一方面，scipy相当大(有很多子包)。因此&lt;code&gt;from scipy import *&lt;/code&gt;第一次导入可能非常慢(所有接下来的导入声明将会更迅速地执行，因为实际上没有再次导入)。这是为什么当你导入scipy时子包的导入默认被禁止(像scipy.fft)，这样它才能像&lt;code&gt;import numpy&lt;/code&gt;一样快。如果你想使用比如说scipy.fft，你不得不显式的导入它(这无论如何是个好的想法)。如果你想要一次加载所有子包，你将不得不&lt;code&gt;import scipy; scipy.pkgbuild()&lt;/code&gt;。使用ipython的交互会话，你可以通过scipy profile调用它(&lt;code&gt;ipython -p scipy&lt;/code&gt;),为你读取scipy的配置文件(通常在~/.ipython/ipythonrc-scipy)和加载所有scipy。对在即时交互环境使用scipy和matplotlib绘图，你可以用像这样的命令&lt;code&gt;ipython --pylab -p scipy&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;获得更多有关全面概述包结构和”pythonic”导入惯例的信息，看一看&lt;a href=&quot;http://www.python.org/doc/2.5.4/tut/node8.html#SECTION008400000000000000000&quot;&gt;Python教程的这一部分&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;是这样？还是我理解错了？&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>试验性NumPy教程(译)</title>
   <link href="http://reverland.org/python/2012/08/22/numpy"/>
   <updated>2012-08-22T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/python/2012/08/22/numpy</id>
   <content type="html">
&lt;h1 id=&quot;numpy&quot;&gt;试验性的Numpy教程&lt;/h1&gt;

&lt;p&gt;原文来自&lt;a href=&quot;http://scipy.org/Tentative_NumPy_Tutorial&quot;&gt;Tentative NumPy Tutorial&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;目录&lt;/strong&gt;&lt;/p&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;先决条件&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;基础篇&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;一个例子&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot;&gt;创建数组&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot;&gt;打印数组&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot;&gt;基本运算&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ufunc&quot;&gt;通用函数(ufunc)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot;&gt;索引，切片和迭代&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-7&quot;&gt;形状操作&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot;&gt;更改数组的形状&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#stack&quot;&gt;组合(stack)不同的数组&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#split&quot;&gt;将一个数组分割(split)成几个小数组&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-9&quot;&gt;复制和视图&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-10&quot;&gt;完全不拷贝&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#view&quot;&gt;视图(view)和浅复制&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-11&quot;&gt;深复制&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#method&quot;&gt;函数和方法(method)总览&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-12&quot;&gt;进阶&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#rule&quot;&gt;广播法则(rule)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-13&quot;&gt;花哨的索引和索引技巧&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-14&quot;&gt;通过数组索引&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-15&quot;&gt;通过布尔数组索引&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ix&quot;&gt;ix_()函数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-16&quot;&gt;用字符串索引&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-17&quot;&gt;线性代数&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-18&quot;&gt;简单数组运算&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-19&quot;&gt;矩阵类&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-20&quot;&gt;索引：比较矩阵和二维数组&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-21&quot;&gt;技巧和提示&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-22&quot;&gt;“自动”改变形状&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#stacking&quot;&gt;向量组合(stacking)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#histogram&quot;&gt;直方图(histogram)&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-23&quot;&gt;参考文献&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;先决条件&lt;/h2&gt;

&lt;p&gt;在阅读这个教程之前，你多少需要知道点python。如果你想重新回忆下，请看看&lt;a href=&quot;http://docs.python.org/tut/&quot;&gt;Python Tutorial&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;如果你想要运行教程中的示例，你至少需要在你的电脑上安装了以下一些软件:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.python.org/&quot;&gt;Python&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://numpy.scipy.org/&quot;&gt;NumPy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这些是可能对你有帮助的:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://ipython.scipy.org/&quot;&gt;ipython&lt;/a&gt;是一个净强化的交互Python Shell，对探索NumPy的特性非常方便。&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://matplotlib.sourceforge.net/&quot;&gt;matplotlib&lt;/a&gt;将允许你绘图&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://scipy.org/&quot;&gt;Scipy&lt;/a&gt;在NumPy的基础上提供了很多科学模块&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-1&quot;&gt;基础篇&lt;/h2&gt;

&lt;p&gt;NumPy的主要对象是同种元素的多维数组。这是一个所有的元素都是一种类型、通过一个正整数元组索引的元素表格(通常是元素是数字)。在NumPy中维度(dimensions)叫做轴(axes)，轴的个数叫做秩(rank)。&lt;/p&gt;

&lt;p&gt;例如，在3D空间一个点的坐标&lt;code&gt;[1, 2, 3]&lt;/code&gt;是一个秩为1的数组，因为它只有一个轴。那个轴长度为3.又例如，在以下例子中，数组的秩为2(它有两个维度).第一个维度长度为2,第二个维度长度为3.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[[ 1., 0., 0.],
 [ 0., 1., 2.]]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NumPy的数组类被称作&lt;em&gt;ndarray&lt;/em&gt;。通常被称作数组。注意numpy.array和标准Python库类array.array并不相同，后者只处理一维数组和提供少量功能。更多重要ndarray对象属性有：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;ndarray.ndim&lt;/p&gt;

    &lt;p&gt;数组轴的个数，在python的世界中，轴的个数被称作秩&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ndarray.shape&lt;/p&gt;

    &lt;p&gt;数组的维度。这是一个指示数组在每个维度上大小的整数元组。例如一个n排m列的矩阵，它的shape属性将是(2,3),这个元组的长度显然是秩，即维度或者ndim属性&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ndarray.size&lt;/p&gt;

    &lt;p&gt;数组元素的总个数，等于shape属性中元组元素的乘积。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ndarray.dtype&lt;/p&gt;

    &lt;p&gt;一个用来描述数组中元素类型的对象，可以通过创造或指定dtype使用标准Python类型。另外NumPy提供它自己的数据类型。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ndarray.itemsize&lt;/p&gt;

    &lt;p&gt;数组中每个元素的字节大小。例如，一个元素类型为float64的数组itemsiz属性值为8(=64/8),又如，一个元素类型为complex32的数组item属性为4(=32/8).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ndarray.data&lt;/p&gt;

    &lt;p&gt;包含实际数组元素的缓冲区，通常我们不需要使用这个属性，因为我们总是通过索引来使用数组中的元素。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-2&quot;&gt;一个例子&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from numpy  import *
&amp;gt;&amp;gt;&amp;gt; a = arange(15).reshape(3, 5)
&amp;gt;&amp;gt;&amp;gt; a
array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
&amp;gt;&amp;gt;&amp;gt; a.shape
(3, 5)
&amp;gt;&amp;gt;&amp;gt; a.ndim
2
&amp;gt;&amp;gt;&amp;gt; a.dtype.name
'int32'
&amp;gt;&amp;gt;&amp;gt; a.itemsize
4
&amp;gt;&amp;gt;&amp;gt; a.size
15
&amp;gt;&amp;gt;&amp;gt; type(a)
numpy.ndarray
&amp;gt;&amp;gt;&amp;gt; b = array([6, 7, 8])
&amp;gt;&amp;gt;&amp;gt; b
array([6, 7, 8])
&amp;gt;&amp;gt;&amp;gt; type(b)
numpy.ndarray
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-3&quot;&gt;创建数组&lt;/h3&gt;

&lt;p&gt;有好几种创建数组的方法。&lt;/p&gt;

&lt;p&gt;例如，你可以使用&lt;code&gt;array&lt;/code&gt;函数从常规的Python列表和元组创造数组。所创建的数组类型由原序列中的元素类型推导而来。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from numpy  import *
&amp;gt;&amp;gt;&amp;gt; a = array( [2,3,4] )
&amp;gt;&amp;gt;&amp;gt; a
array([2, 3, 4])
&amp;gt;&amp;gt;&amp;gt; a.dtype
dtype('int32')
&amp;gt;&amp;gt;&amp;gt; b = array([1.2, 3.5, 5.1])
&amp;gt;&amp;gt;&amp;gt; b.dtype
dtype('float64')  一个常见的错误包括用多个数值参数调用`array`而不是提供一个由数值组成的列表作为一个参数。

&amp;gt;&amp;gt;&amp;gt; a = array(1,2,3,4)    # WRONG

&amp;gt;&amp;gt;&amp;gt; a = array([1,2,3,4])  # RIGHT
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;数组将序列包含序列转化成二维的数组，序列包含序列包含序列转化成三维数组等等。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; b = array( [ (1.5,2,3), (4,5,6) ] )
&amp;gt;&amp;gt;&amp;gt; b
array([[ 1.5,  2. ,  3. ],
       [ 4. ,  5. ,  6. ]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;数组类型可以在创建时显示指定&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; c = array( [ [1,2], [3,4] ], dtype=complex )
&amp;gt;&amp;gt;&amp;gt; c
array([[ 1.+0.j,  2.+0.j],
       [ 3.+0.j,  4.+0.j]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;通常，数组的元素开始都是未知的，但是它的大小已知。因此，NumPy提供了一些使用占位符创建数组的函数。这最小化了扩展数组的需要和高昂的运算代价。&lt;/p&gt;

&lt;p&gt;函数&lt;code&gt;function&lt;/code&gt;创建一个全是0的数组，函数&lt;code&gt;ones&lt;/code&gt;创建一个全1的数组，函数&lt;code&gt;empty&lt;/code&gt;创建一个内容随机并且依赖与内存状态的数组。默认创建的数组类型(dtype)都是float64。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; zeros( (3,4) )
array([[0.,  0.,  0.,  0.],
       [0.,  0.,  0.,  0.],
       [0.,  0.,  0.,  0.]])
&amp;gt;&amp;gt;&amp;gt; ones( (2,3,4), dtype=int16 )                # dtype can also be specified
array([[[ 1, 1, 1, 1],
        [ 1, 1, 1, 1],
        [ 1, 1, 1, 1]],
       [[ 1, 1, 1, 1],
        [ 1, 1, 1, 1],
        [ 1, 1, 1, 1]]], dtype=int16)
&amp;gt;&amp;gt;&amp;gt; empty( (2,3) )
array([[  3.73603959e-262,   6.02658058e-154,   6.55490914e-260],
       [  5.30498948e-313,   3.14673309e-307,   1.00000000e+000]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;为了创建一个数列，NumPy提供一个类似arange的函数返回数组而不是列表:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; arange( 10, 30, 5 )
array([10, 15, 20, 25])
&amp;gt;&amp;gt;&amp;gt; arange( 0, 2, 0.3 )                 # it accepts float arguments
array([ 0. ,  0.3,  0.6,  0.9,  1.2,  1.5,  1.8])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;当&lt;code&gt;arange&lt;/code&gt;使用浮点数参数时，由于有限的浮点数精度，通常无法预测获得的元素个数。因此，最好使用函数&lt;code&gt;linspace&lt;/code&gt;去接收我们想要的元素个数来代替用range来指定步长。&lt;/p&gt;

&lt;p&gt;其它函数array, zeros, zeros_like, ones, ones_like, empty, empty_like, arange, linspace, rand, randn, fromfunction, fromfile参考：&lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;NumPy示例&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-4&quot;&gt;打印数组&lt;/h3&gt;

&lt;p&gt;当你打印一个数组，NumPy以类似嵌套列表的形式显示它，但是呈以下布局：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;最后的轴从左到右打印&lt;/li&gt;
  &lt;li&gt;次后的轴从顶向下打印&lt;/li&gt;
  &lt;li&gt;剩下的轴从顶向下打印，每个切片通过一个空行与下一个隔开&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一维数组被打印成行，二维数组成矩阵，三维数组成矩阵列表。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(6)                         # 1d array
&amp;gt;&amp;gt;&amp;gt; print a
[0 1 2 3 4 5]
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; b = arange(12).reshape(4,3)           # 2d array
&amp;gt;&amp;gt;&amp;gt; print b
[[ 0  1  2]
 [ 3  4  5]
 [ 6  7  8]
 [ 9 10 11]]
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; c = arange(24).reshape(2,3,4)         # 3d array
&amp;gt;&amp;gt;&amp;gt; print c
[[[ 0  1  2  3]
  [ 4  5  6  7]
  [ 8  9 10 11]]

 [[12 13 14 15]
  [16 17 18 19]
  [20 21 22 23]]]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;查看形状操作一节获得有关reshape的更多细节&lt;/p&gt;

&lt;p&gt;如果一个数组用来打印太大了，NumPy自动省略中间部分而只打印角落&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; print arange(10000)
[   0    1    2 ..., 9997 9998 9999]
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; print arange(10000).reshape(100,100)
[[   0    1    2 ...,   97   98   99]
 [ 100  101  102 ...,  197  198  199]
 [ 200  201  202 ...,  297  298  299]
 ...,
 [9700 9701 9702 ..., 9797 9798 9799]
 [9800 9801 9802 ..., 9897 9898 9899]
 [9900 9901 9902 ..., 9997 9998 9999]]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;禁用NumPy的这种行为并强制打印整个数组，你可以设置printoptions参数来更改打印选项。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; set_printoptions(threshold='nan')
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-5&quot;&gt;基本运算&lt;/h3&gt;

&lt;p&gt;数组的算术运算是按元素的。新的数组被创建并且被结果填充。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = array( [20,30,40,50] )
&amp;gt;&amp;gt;&amp;gt; b = arange( 4 )
&amp;gt;&amp;gt;&amp;gt; b
array([0, 1, 2, 3])
&amp;gt;&amp;gt;&amp;gt; c = a-b
&amp;gt;&amp;gt;&amp;gt; c
array([20, 29, 38, 47])
&amp;gt;&amp;gt;&amp;gt; b**2
array([0, 1, 4, 9])
&amp;gt;&amp;gt;&amp;gt; 10*sin(a)
array([ 9.12945251, -9.88031624,  7.4511316 , -2.62374854])
&amp;gt;&amp;gt;&amp;gt; a&amp;lt;35
array([True, True, False, False], dtype=bool)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;不像许多矩阵语言，NumPy中的乘法运算符&lt;code&gt;*&lt;/code&gt;指示按元素计算，矩阵乘法可以使用&lt;code&gt;dot&lt;/code&gt;函数或创建矩阵对象实现(参见教程中的矩阵章节)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A = array( [[1,1],
...             [0,1]] )
&amp;gt;&amp;gt;&amp;gt; B = array( [[2,0],
...             [3,4]] )
&amp;gt;&amp;gt;&amp;gt; A*B                         # elementwise product
array([[2, 0],
       [0, 4]])
&amp;gt;&amp;gt;&amp;gt; dot(A,B)                    # matrix product
array([[5, 4],
       [3, 4]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;有些操作符像&lt;code&gt;+=&lt;/code&gt;和&lt;code&gt;*=&lt;/code&gt;被用来更改已存在数组而不创建一个新的数组。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = ones((2,3), dtype=int)
&amp;gt;&amp;gt;&amp;gt; b = random.random((2,3))
&amp;gt;&amp;gt;&amp;gt; a *= 3
&amp;gt;&amp;gt;&amp;gt; a
array([[3, 3, 3],
       [3, 3, 3]])
&amp;gt;&amp;gt;&amp;gt; b += a
&amp;gt;&amp;gt;&amp;gt; b
array([[ 3.69092703,  3.8324276 ,  3.0114541 ],
       [ 3.18679111,  3.3039349 ,  3.37600289]])
&amp;gt;&amp;gt;&amp;gt; a += b                                  # b is converted to integer type
&amp;gt;&amp;gt;&amp;gt; a
array([[6, 6, 6],
       [6, 6, 6]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;当运算的是不同类型的数组时，结果数组和更普遍和精确的已知(这种行为叫做upcast)。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = ones(3, dtype=int32)
&amp;gt;&amp;gt;&amp;gt; b = linspace(0,pi,3)
&amp;gt;&amp;gt;&amp;gt; b.dtype.name
'float64'
&amp;gt;&amp;gt;&amp;gt; c = a+b
&amp;gt;&amp;gt;&amp;gt; c
array([ 1.        ,  2.57079633,  4.14159265])
&amp;gt;&amp;gt;&amp;gt; c.dtype.name
'float64'
&amp;gt;&amp;gt;&amp;gt; d = exp(c*1j)
&amp;gt;&amp;gt;&amp;gt; d
array([ 0.54030231+0.84147098j, -0.84147098+0.54030231j,
       -0.54030231-0.84147098j])
&amp;gt;&amp;gt;&amp;gt; d.dtype.name
'complex128' 许多非数组运算，如计算数组所有元素之和，被作为ndarray类的方法实现

&amp;gt;&amp;gt;&amp;gt; a = random.random((2,3))
&amp;gt;&amp;gt;&amp;gt; a
array([[ 0.6903007 ,  0.39168346,  0.16524769],
       [ 0.48819875,  0.77188505,  0.94792155]])
&amp;gt;&amp;gt;&amp;gt; a.sum()
3.4552372100521485
&amp;gt;&amp;gt;&amp;gt; a.min()
0.16524768654743593
&amp;gt;&amp;gt;&amp;gt; a.max()
0.9479215542670073
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这些运算默认应用到数组好像它就是一个数字组成的列表，无关数组的形状。然而，指定&lt;code&gt;axis&lt;/code&gt;参数你可以吧运算应用到数组指定的轴上：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; b = arange(12).reshape(3,4)
&amp;gt;&amp;gt;&amp;gt; b
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; b.sum(axis=0)                            # sum of each column
array([12, 15, 18, 21])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; b.min(axis=1)                            # min of each row
array([0, 4, 8])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; b.cumsum(axis=1)                         # cumulative sum along each row
array([[ 0,  1,  3,  6],
       [ 4,  9, 15, 22],
       [ 8, 17, 27, 38]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ufunc&quot;&gt;通用函数(ufunc)&lt;/h3&gt;

&lt;p&gt;NumPy提供常见的数学函数如&lt;code&gt;sin&lt;/code&gt;,&lt;code&gt;cos&lt;/code&gt;和&lt;code&gt;exp&lt;/code&gt;。在NumPy中，这些叫作“通用函数”(ufunc)。在NumPy里这些函数作用按数组的元素运算，产生一个数组作为输出。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; B = arange(3)
&amp;gt;&amp;gt;&amp;gt; B
array([0, 1, 2])
&amp;gt;&amp;gt;&amp;gt; exp(B)
array([ 1.        ,  2.71828183,  7.3890561 ])
&amp;gt;&amp;gt;&amp;gt; sqrt(B)
array([ 0.        ,  1.        ,  1.41421356])
&amp;gt;&amp;gt;&amp;gt; C = array([2., -1., 4.])
&amp;gt;&amp;gt;&amp;gt; add(B, C)
array([ 2.,  0.,  6.])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;更多函数all, alltrue, any, apply along axis, argmax, argmin, argsort, average, bincount, ceil, clip, conj, conjugate, corrcoef, cov, cross, cumprod, cumsum, diff, dot, floor, inner, inv, lexsort, max, maximum, mean, median, min, minimum, nonzero, outer, prod, re, round, sometrue, sort, std, sum, trace, transpose, var, vdot, vectorize, where 参见:&lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;NumPy示例&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-6&quot;&gt;索引，切片和迭代&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;一维&lt;/em&gt;数组可以被索引、切片和迭代，就像&lt;a href=&quot;http://docs.python.org/tutorial/introduction.html#SECTION005140000000000000000&quot;&gt;列表&lt;/a&gt;和其它Python序列。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(10)**3
&amp;gt;&amp;gt;&amp;gt; a
array([  0,   1,   8,  27,  64, 125, 216, 343, 512, 729])
&amp;gt;&amp;gt;&amp;gt; a[2]
8
&amp;gt;&amp;gt;&amp;gt; a[2:5]
array([ 8, 27, 64])
&amp;gt;&amp;gt;&amp;gt; a[:6:2] = -1000    # equivalent to a[0:6:2] = -1000; from start to position 6, exclusive, set every 2nd element to -1000
&amp;gt;&amp;gt;&amp;gt; a
array([-1000,     1, -1000,    27, -1000,   125,   216,   343,   512,   729])
&amp;gt;&amp;gt;&amp;gt; a[ : :-1]                                 # reversed a
array([  729,   512,   343,   216,   125, -1000,    27, -1000,     1, -1000])
&amp;gt;&amp;gt;&amp;gt; for i in a:
...         print i**(1/3.),
...
nan 1.0 nan 3.0 nan 5.0 6.0 7.0 8.0 9.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;多维&lt;/em&gt;数组可以每个轴有一个索引。这些索引由一个逗号分割的元组给出。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; def f(x,y):
...         return 10*x+y
...
&amp;gt;&amp;gt;&amp;gt; b = fromfunction(f,(5,4),dtype=int)
&amp;gt;&amp;gt;&amp;gt; b
array([[ 0,  1,  2,  3],
       [10, 11, 12, 13],
       [20, 21, 22, 23],
       [30, 31, 32, 33],
       [40, 41, 42, 43]])
&amp;gt;&amp;gt;&amp;gt; b[2,3]
23
&amp;gt;&amp;gt;&amp;gt; b[0:5, 1]                       # each row in the second column of b
array([ 1, 11, 21, 31, 41])
&amp;gt;&amp;gt;&amp;gt; b[ : ,1]                        # equivalent to the previous example
array([ 1, 11, 21, 31, 41])
&amp;gt;&amp;gt;&amp;gt; b[1:3, : ]                      # each column in the second and third row of b
array([[10, 11, 12, 13],
       [20, 21, 22, 23]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;当少于轴数的索引被提供时，确失的索引被认为是整个切片：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; b[-1]                                  # the last row. Equivalent to b[-1,:]
array([40, 41, 42, 43])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;b[i]&lt;/code&gt;中括号中的表达式被当作&lt;code&gt;i&lt;/code&gt;和一系列&lt;code&gt;:&lt;/code&gt;，来代表剩下的轴。NumPy也允许你使用“点”像&lt;code&gt;b[i,...]&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;点&lt;/em&gt;(…)代表许多产生一个完整的索引元组必要的分号。如果x是秩为5的数组(即它有5个轴)，那么:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;x[1,2,…] 等同于 x[1,2,:,:,:],&lt;/li&gt;
  &lt;li&gt;x[…,3] 等同于 x[:,:,:,:,3]&lt;/li&gt;
  &lt;li&gt;x[4,…,5,:] 等同 x[4,:,:,5,:]. &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;      &lt;span class=&quot;c&quot;&gt;# a 3D array (two stacked 2D arrays)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;               &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]],&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;              &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;102&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;               &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;110&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;113&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;                          &lt;span class=&quot;c&quot;&gt;# same as c[1,:,:] or c[1]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;101&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;102&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;110&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;112&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;113&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;                          &lt;span class=&quot;c&quot;&gt;# same as c[:,:,2]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([[&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;102&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;113&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;em&gt;迭代&lt;/em&gt;多维数组是就第一个轴而言的:&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; for row in b:
...         print row
...
[0 1 2 3]
[10 11 12 13]
[20 21 22 23]
[30 31 32 33]
[40 41 42 43]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然而，如果一个人想对每个数组中元素进行运算，我们可以使用flat属性，该属性是数组元素的一个迭代器:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; for element in b.flat:
...         print element,
...
0 1 2 3 10 11 12 13 20 21 22 23 30 31 32 33 40 41 42 43
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;更多[], …, newaxis, ndenumerate, indices, index exp 参考&lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;NumPy示例&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-7&quot;&gt;形状操作&lt;/h2&gt;

&lt;h3 id=&quot;section-8&quot;&gt;更改数组的形状&lt;/h3&gt;

&lt;p&gt;一个数组的形状由它每个轴上的元素个数给出：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = floor(10*random.random((3,4)))
&amp;gt;&amp;gt;&amp;gt; a
array([[ 7.,  5.,  9.,  3.],
       [ 7.,  2.,  7.,  8.],
       [ 6.,  8.,  3.,  2.]])
&amp;gt;&amp;gt;&amp;gt; a.shape
(3, 4)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;一个数组的形状可以被多种命令修改：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a.ravel() # flatten the array
array([ 7.,  5.,  9.,  3.,  7.,  2.,  7.,  8.,  6.,  8.,  3.,  2.])
&amp;gt;&amp;gt;&amp;gt; a.shape = (6, 2)
&amp;gt;&amp;gt;&amp;gt; a.transpose()
array([[ 7.,  9.,  7.,  7.,  6.,  3.],
       [ 5.,  3.,  2.,  8.,  8.,  2.]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;由&lt;code&gt;ravel()&lt;/code&gt;展平的数组元素的顺序通常是“C风格”的，就是说，最右边的索引变化得最快，所以元素a[0,0]之后是a[0,1]。如果数组被改变形状(reshape)成其它形状，数组仍然是“C风格”的。NumPy通常创建一个以这个顺序保存数据的数组，所以&lt;code&gt;ravel()&lt;/code&gt;将总是不需要复制它的参数&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。但是如果数组是通过切片其它数组或有不同寻常的选项时，它可能需要被复制。函数&lt;code&gt;reshape()&lt;/code&gt;和&lt;code&gt;ravel()&lt;/code&gt;还可以被同过一些可选参数构建成FORTRAN风格的数组，即最左边的索引变化最快。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;reshape&lt;/code&gt;函数改变参数形状并返回它，而&lt;code&gt;resize&lt;/code&gt;函数改变数组自身。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a
array([[ 7.,  5.],
       [ 9.,  3.],
       [ 7.,  2.],
       [ 7.,  8.],
       [ 6.,  8.],
       [ 3.,  2.]])
&amp;gt;&amp;gt;&amp;gt; a.resize((2,6))
&amp;gt;&amp;gt;&amp;gt; a
array([[ 7.,  5.,  9.,  3.,  7.,  2.],
       [ 7.,  8.,  6.,  8.,  3.,  2.]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果在改变形状操作中一个维度被给做-1，其维度将自动被计算&lt;/p&gt;

&lt;p&gt;更多 shape, reshape, resize, ravel 参考&lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;NumPy示例&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;stack&quot;&gt;组合(stack)不同的数组&lt;/h3&gt;

&lt;p&gt;几种方法可以沿不同轴将数组堆叠在一起：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = floor(10*random.random((2,2)))
&amp;gt;&amp;gt;&amp;gt; a
array([[ 1.,  1.],
       [ 5.,  8.]])
&amp;gt;&amp;gt;&amp;gt; b = floor(10*random.random((2,2)))
&amp;gt;&amp;gt;&amp;gt; b
array([[ 3.,  3.],
       [ 6.,  0.]])
&amp;gt;&amp;gt;&amp;gt; vstack((a,b))
array([[ 1.,  1.],
       [ 5.,  8.],
       [ 3.,  3.],
       [ 6.,  0.]])
&amp;gt;&amp;gt;&amp;gt; hstack((a,b))
array([[ 1.,  1.,  3.,  3.],
       [ 5.,  8.,  6.,  0.]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;函数&lt;code&gt;column_stack&lt;/code&gt;以列将一维数组合成二维数组，它等同与&lt;code&gt;vstack&lt;/code&gt;对一维数组。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; column_stack((a,b))   # With 2D arrays
array([[ 1.,  1.,  3.,  3.],
       [ 5.,  8.,  6.,  0.]])
&amp;gt;&amp;gt;&amp;gt; a=array([4.,2.])
&amp;gt;&amp;gt;&amp;gt; b=array([2.,8.])
&amp;gt;&amp;gt;&amp;gt; a[:,newaxis]  # This allows to have a 2D columns vector
array([[ 4.],
       [ 2.]])
&amp;gt;&amp;gt;&amp;gt; column_stack((a[:,newaxis],b[:,newaxis]))
array([[ 4.,  2.],
       [ 2.,  8.]])
&amp;gt;&amp;gt;&amp;gt; vstack((a[:,newaxis],b[:,newaxis])) # The behavior of vstack is different
array([[ 4.],
       [ 2.],
       [ 2.],
       [ 8.]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;row_stack&lt;/code&gt;函数，另一方面，将一维数组以行组合成二维数组。&lt;/p&gt;

&lt;p&gt;对那些维度比二维更高的数组，&lt;code&gt;hstack&lt;/code&gt;沿着第二个轴组合，&lt;code&gt;vstack&lt;/code&gt;沿着第一个轴组合,&lt;code&gt;concatenate&lt;/code&gt;允许可选参数给出组合时沿着的轴。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;在复杂情况下，&lt;code&gt;r_[]&lt;/code&gt;和&lt;code&gt;c_[]&lt;/code&gt;对创建沿着一个方向组合的数很有用，它们允许范围符号(“:”):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; r_[1:4,0,4]
array([1, 2, 3, 0, 4])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;当使用数组作为参数时，&lt;code&gt;r_&lt;/code&gt;和&lt;code&gt;c_&lt;/code&gt;的默认行为和&lt;code&gt;vstack&lt;/code&gt;和&lt;code&gt;hstack&lt;/code&gt;很像，但是允许可选的参数给出组合所沿着的轴的代号。&lt;/p&gt;

&lt;p&gt;更多函数hstack , vstack, column_stack , row_stack , concatenate , c_ , r_ 
参见&lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;NumPy示例&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;split&quot;&gt;将一个数组分割(split)成几个小数组&lt;/h3&gt;

&lt;p&gt;使用&lt;code&gt;hsplit&lt;/code&gt;你能将数组沿着它的水平轴分割，或者指定返回相同形状数组的个数，或者指定在哪些列后发生分割:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = floor(10*random.random((2,12)))
&amp;gt;&amp;gt;&amp;gt; a
array([[ 8.,  8.,  3.,  9.,  0.,  4.,  3.,  0.,  0.,  6.,  4.,  4.],
       [ 0.,  3.,  2.,  9.,  6.,  0.,  4.,  5.,  7.,  5.,  1.,  4.]])
&amp;gt;&amp;gt;&amp;gt; hsplit(a,3)   # Split a into 3
[array([[ 8.,  8.,  3.,  9.],
       [ 0.,  3.,  2.,  9.]]), array([[ 0.,  4.,  3.,  0.],
       [ 6.,  0.,  4.,  5.]]), array([[ 0.,  6.,  4.,  4.],
       [ 7.,  5.,  1.,  4.]])]
&amp;gt;&amp;gt;&amp;gt; hsplit(a,(3,4))   # Split a after the third and the fourth column
[array([[ 8.,  8.,  3.],
       [ 0.,  3.,  2.]]), array([[ 9.],
       [ 9.]]), array([[ 0.,  4.,  3.,  0.,  0.,  6.,  4.,  4.],
       [ 6.,  0.,  4.,  5.,  7.,  5.,  1.,  4.]])]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;vsplit&lt;/code&gt;沿着纵向的轴分割，&lt;code&gt;array split&lt;/code&gt;允许指定沿哪个轴分割。&lt;/p&gt;

&lt;h2 id=&quot;section-9&quot;&gt;复制和视图&lt;/h2&gt;

&lt;p&gt;当运算和处理数组时，它们的数据有时被拷贝到新的数组有时不是。这通常是新手的困惑之源。这有三种情况:&lt;/p&gt;

&lt;h3 id=&quot;section-10&quot;&gt;完全不拷贝&lt;/h3&gt;

&lt;p&gt;简单的赋值不拷贝数组对象或它们的数据。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(12)
&amp;gt;&amp;gt;&amp;gt; b = a            # no new object is created
&amp;gt;&amp;gt;&amp;gt; b is a           # a and b are two names for the same ndarray object
True
&amp;gt;&amp;gt;&amp;gt; b.shape = 3,4    # changes the shape of a
&amp;gt;&amp;gt;&amp;gt; a.shape
(3, 4)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Python 传递不定对象作为参考&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;，所以函数调用不拷贝数组。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; def f(x):
...     print id(x)
...
&amp;gt;&amp;gt;&amp;gt; id(a)                           # id is a unique identifier of an object
148293216
&amp;gt;&amp;gt;&amp;gt; f(a)
148293216
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;view&quot;&gt;视图(view)和浅复制&lt;/h3&gt;

&lt;p&gt;不同的数组对象分享同一个数据。视图方法创造一个新的数组对象指向同一数据。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; c = a.view()
&amp;gt;&amp;gt;&amp;gt; c is a
False
&amp;gt;&amp;gt;&amp;gt; c.base is a                        # c is a view of the data owned by a
True
&amp;gt;&amp;gt;&amp;gt; c.flags.owndata
False
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; c.shape = 2,6                      # a's shape doesn't change
&amp;gt;&amp;gt;&amp;gt; a.shape
(3, 4)
&amp;gt;&amp;gt;&amp;gt; c[0,4] = 1234                      # a's data changes
&amp;gt;&amp;gt;&amp;gt; a
array([[   0,    1,    2,    3],
       [1234,    5,    6,    7],
       [   8,    9,   10,   11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;切片数组返回它的一个视图：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; s = a[ : , 1:3]     # spaces added for clarity; could also be written &quot;s = a[:,1:3]&quot;
&amp;gt;&amp;gt;&amp;gt; s[:] = 10           # s[:] is a view of s. Note the difference between s=10 and s[:]=10
&amp;gt;&amp;gt;&amp;gt; a
array([[   0,   10,   10,    3],
       [1234,   10,   10,    7],
       [   8,   10,   10,   11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-11&quot;&gt;深复制&lt;/h2&gt;

&lt;p&gt;这个复制方法完全复制数组和它的数据。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; d = a.copy()                          # a new array object with new data is created
&amp;gt;&amp;gt;&amp;gt; d is a
False
&amp;gt;&amp;gt;&amp;gt; d.base is a                           # d doesn't share anything with a
False
&amp;gt;&amp;gt;&amp;gt; d[0,0] = 9999
&amp;gt;&amp;gt;&amp;gt; a
array([[   0,   10,   10,    3],
       [1234,   10,   10,    7],
       [   8,   10,   10,   11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;method&quot;&gt;函数和方法(method)总览&lt;/h3&gt;

&lt;p&gt;这是个NumPy函数和方法分类排列目录。这些名字链接到&lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;NumPy示例&lt;/a&gt;,你可以看到这些函数起作用。&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;创建数组&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;arange, array, copy, empty, empty_like, eye, fromfile, fromfunction, identity, linspace, logspace, mgrid, ogrid, ones, ones_like, r , zeros, zeros_like 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;转化&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;astype, atleast 1d, atleast 2d, atleast 3d, mat 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;操作&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;array split, column stack, concatenate, diagonal, dsplit, dstack, hsplit, hstack, item, newaxis, ravel, repeat, reshape, resize, squeeze, swapaxes, take, transpose, vsplit, vstack 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;询问&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;all, any, nonzero, where 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;排序&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;argmax, argmin, argsort, max, min, ptp, searchsorted, sort 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;运算&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;choose, compress, cumprod, cumsum, inner, fill, imag, prod, put, putmask, real, sum 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;基本统计&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cov, mean, std, var 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;基本线性代数&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cross, dot, outer, svd, vdot
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-12&quot;&gt;进阶&lt;/h2&gt;

&lt;h3 id=&quot;rule&quot;&gt;广播法则(rule)&lt;/h3&gt;

&lt;p&gt;广播法则能使通用函数有意义地处理不具有相同形状的输入。&lt;/p&gt;

&lt;p&gt;广播第一法则是，如果所有的输入数组维度不都相同，一个“1”将被重复地添加在维度较小的数组上直至所有的数组拥有一样的维度。&lt;/p&gt;

&lt;p&gt;广播第二法则确定长度为1的数组沿着特殊的方向表现地好像它有沿着那个方向最大形状的大小。对数组来说，沿着那个维度的数组元素的值理应相同。&lt;/p&gt;

&lt;p&gt;应用广播法则之后，所有数组的大小必须匹配。更多细节可以从这个&lt;a href=&quot;http://scipy.org/EricsBroadcastingDoc&quot;&gt;文档&lt;/a&gt;找到。&lt;/p&gt;

&lt;h2 id=&quot;section-13&quot;&gt;花哨的索引和索引技巧&lt;/h2&gt;

&lt;p&gt;NumPy比普通Python序列提供更多的索引功能。除了索引整数和切片，正如我们之前看到的，数组可以被整数数组和布尔数组索引。&lt;/p&gt;

&lt;h3 id=&quot;section-14&quot;&gt;通过数组索引&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(12)**2                          # the first 12 square numbers
&amp;gt;&amp;gt;&amp;gt; i = array( [ 1,1,3,8,5 ] )                 # an array of indices
&amp;gt;&amp;gt;&amp;gt; a[i]                                       # the elements of a at the positions i
array([ 1,  1,  9, 64, 25])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; j = array( [ [ 3, 4], [ 9, 7 ] ] )         # a bidimensional array of indices
&amp;gt;&amp;gt;&amp;gt; a[j]                                       # the same shape as j
array([[ 9, 16],
       [81, 49]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;当被索引数组a是多维的时，每一个唯一的索引数列指向a的第一维[^5]。以下示例通过将图片标签用调色版转换成色彩图像展示了这种行为。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; palette = array( [ [0,0,0],                # black
...                    [255,0,0],              # red
...                    [0,255,0],              # green
...                    [0,0,255],              # blue
...                    [255,255,255] ] )       # white
&amp;gt;&amp;gt;&amp;gt; image = array( [ [ 0, 1, 2, 0 ],           # each value corresponds to a color in the palette
...                  [ 0, 3, 4, 0 ]  ] )
&amp;gt;&amp;gt;&amp;gt; palette[image]                            # the (2,4,3) color image
array([[[  0,   0,   0],
        [255,   0,   0],
        [  0, 255,   0],
        [  0,   0,   0]],
       [[  0,   0,   0],
        [  0,   0, 255],
        [255, 255, 255],
        [  0,   0,   0]]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;我们也可以给出不不止一维的索引，每一维的索引数组必须有相同的形状。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(12).reshape(3,4)
&amp;gt;&amp;gt;&amp;gt; a
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
&amp;gt;&amp;gt;&amp;gt; i = array( [ [0,1],                        # indices for the first dim of a
...              [1,2] ] )
&amp;gt;&amp;gt;&amp;gt; j = array( [ [2,1],                        # indices for the second dim
...              [3,3] ] )
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[i,j]                                     # i and j must have equal shape
array([[ 2,  5],
       [ 7, 11]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[i,2]
array([[ 2,  6],
       [ 6, 10]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[:,j]                                     # i.e., a[ : , j]
array([[[ 2,  1],
        [ 3,  3]],
       [[ 6,  5],
        [ 7,  7]],
       [[10,  9],
        [11, 11]]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;自然，我们可以把i和j放到序列中(比如说列表)然后通过list索引。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; l = [i,j]
&amp;gt;&amp;gt;&amp;gt; a[l]                                       # equivalent to a[i,j]
array([[ 2,  5],
       [ 7, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然而，我们不能把i和j放在一个数组中，因为这个数组将被解释成索引a的第一维。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; s = array( [i,j] )
&amp;gt;&amp;gt;&amp;gt; a[s]                                       # not what we want
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
&amp;lt;ipython-input-100-b912f631cc75&amp;gt; in &amp;lt;module&amp;gt;()
----&amp;gt; 1 a[s]

IndexError: index (3) out of range (0&amp;lt;=index&amp;lt;2) in dimension 0
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[tuple(s)]                                # same as a[i,j]
array([[ 2,  5],
       [ 7, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;另一个常用的数组索引用法是搜索时间序列最大值&lt;sup id=&quot;fnref:6&quot;&gt;&lt;a href=&quot;#fn:6&quot; rel=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; time = linspace(20, 145, 5)                 # time scale
&amp;gt;&amp;gt;&amp;gt; data = sin(arange(20)).reshape(5,4)         # 4 time-dependent series
&amp;gt;&amp;gt;&amp;gt; time
array([  20.  ,   51.25,   82.5 ,  113.75,  145.  ])
&amp;gt;&amp;gt;&amp;gt; data
array([[ 0.        ,  0.84147098,  0.90929743,  0.14112001],
       [-0.7568025 , -0.95892427, -0.2794155 ,  0.6569866 ],
       [ 0.98935825,  0.41211849, -0.54402111, -0.99999021],
       [-0.53657292,  0.42016704,  0.99060736,  0.65028784],
       [-0.28790332, -0.96139749, -0.75098725,  0.14987721]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; ind = data.argmax(axis=0)                   # index of the maxima for each series
&amp;gt;&amp;gt;&amp;gt; ind
array([2, 0, 3, 1])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; time_max = time[ ind]                       # times corresponding to the maxima
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; data_max = data[ind, xrange(data.shape[1])] # =&amp;gt; data[ind[0],0], data[ind[1],1]...
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; time_max
array([  82.5 ,   20.  ,  113.75,   51.25])
&amp;gt;&amp;gt;&amp;gt; data_max
array([ 0.98935825,  0.84147098,  0.99060736,  0.6569866 ])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; all(data_max == data.max(axis=0))
True
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你也可以使用数组索引作为目标来赋值：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(5)
&amp;gt;&amp;gt;&amp;gt; a
array([0, 1, 2, 3, 4])
&amp;gt;&amp;gt;&amp;gt; a[[1,3,4]] = 0
&amp;gt;&amp;gt;&amp;gt; a
array([0, 0, 2, 0, 0])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然而，当一个索引列表包含重复时，赋值被多次完成，保留最后的值：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(5)
&amp;gt;&amp;gt;&amp;gt; a[[0,0,2]]=[1,2,3]
&amp;gt;&amp;gt;&amp;gt; a
array([2, 1, 3, 3, 4])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这足够合理，但是小心如果你想用Python的&lt;code&gt;+=&lt;/code&gt;结构，可能结果并非你所期望：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(5)
&amp;gt;&amp;gt;&amp;gt; a[[0,0,2]]+=1
&amp;gt;&amp;gt;&amp;gt; a
array([1, 1, 3, 3, 4])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;即使0在索引列表中出现两次，索引为0的元素仅仅增加一次。这是因为Python要求&lt;code&gt;a+=1&lt;/code&gt;和&lt;code&gt;a=a+1&lt;/code&gt;等同。&lt;/p&gt;

&lt;h3 id=&quot;section-15&quot;&gt;通过布尔数组索引&lt;/h3&gt;

&lt;p&gt;当我们使用整数数组索引数组时，我们提供一个索引列表去选择。通过布尔数组索引的方法是不同的我们显式地选择数组中我们想要和不想要的元素。&lt;/p&gt;

&lt;p&gt;我们能想到的使用布尔数组的索引最自然方式就是使用和原数组一样形状的布尔数组。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(12).reshape(3,4)
&amp;gt;&amp;gt;&amp;gt; b = a &amp;gt; 4
&amp;gt;&amp;gt;&amp;gt; b                                          # b is a boolean with a's shape
array([[False, False, False, False],
       [False, True, True, True],
       [True, True, True, True]], dtype=bool)
&amp;gt;&amp;gt;&amp;gt; a[b]                                       # 1d array with the selected elements
array([ 5,  6,  7,  8,  9, 10, 11])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个属性在赋值时非常有用：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a[b] = 0                                   # All elements of 'a' higher than 4 become 0
&amp;gt;&amp;gt;&amp;gt; a
array([[0, 1, 2, 3],
       [4, 0, 0, 0],
       [0, 0, 0, 0]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你可以参考&lt;a href=&quot;http://scipy.org/Tentative_NumPy_Tutorial/Mandelbrot_Set_Example&quot;&gt;曼德博集合示例&lt;/a&gt;看看如何使用布尔索引来生成曼德博集合的图像。&lt;/p&gt;

&lt;p&gt;第二种通过布尔来索引的方法更近似于整数索引；对数组的每个维度我们给一个一维布尔数组来选择我们想要的切片。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(12).reshape(3,4)
&amp;gt;&amp;gt;&amp;gt; b1 = array([False,True,True])             # first dim selection
&amp;gt;&amp;gt;&amp;gt; b2 = array([True,False,True,False])       # second dim selection
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[b1,:]                                   # selecting rows
array([[ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[b1]                                     # same thing
array([[ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[:,b2]                                   # selecting columns
array([[ 0,  2],
       [ 4,  6],
       [ 8, 10]])
&amp;gt;&amp;gt;&amp;gt;
&amp;gt;&amp;gt;&amp;gt; a[b1,b2]                                  # a weird thing to do
array([ 4, 10])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注意一维数组的长度必须和你想要切片的维度或轴的长度一致，在之前的例子中，b1是一个秩为1长度为三的数组(a的行数)，b2(长度为4)与a的第二秩(列)相一致。&lt;sup id=&quot;fnref:7&quot;&gt;&lt;a href=&quot;#fn:7&quot; rel=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;h3 id=&quot;ix&quot;&gt;ix_()函数&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;ix_&lt;/code&gt;函数可以为了获得&lt;a href=&quot;http://zh.wikipedia.org/wiki/%E5%A4%9A%E5%85%83%E7%BB%84&quot;&gt;多元组&lt;/a&gt;的结果而用来结合不同向量。例如，如果你想要用所有向量a、b和c元素组成的三元组来计算&lt;code&gt;a+b*c&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = array([2,3,4,5])
&amp;gt;&amp;gt;&amp;gt; b = array([8,5,4])
&amp;gt;&amp;gt;&amp;gt; c = array([5,4,6,8,3])
&amp;gt;&amp;gt;&amp;gt; ax,bx,cx = ix_(a,b,c)
&amp;gt;&amp;gt;&amp;gt; ax
array([[[2]],

       [[3]],

       [[4]],

       [[5]]])
&amp;gt;&amp;gt;&amp;gt; bx
array([[[8],
        [5],
        [4]]])
&amp;gt;&amp;gt;&amp;gt; cx
array([[[5, 4, 6, 8, 3]]])
&amp;gt;&amp;gt;&amp;gt; ax.shape, bx.shape, cx.shape
((4, 1, 1), (1, 3, 1), (1, 1, 5))
&amp;gt;&amp;gt;&amp;gt; result = ax+bx*cx
&amp;gt;&amp;gt;&amp;gt; result
array([[[42, 34, 50, 66, 26],
        [27, 22, 32, 42, 17],
        [22, 18, 26, 34, 14]],
       [[43, 35, 51, 67, 27],
        [28, 23, 33, 43, 18],
        [23, 19, 27, 35, 15]],
       [[44, 36, 52, 68, 28],
        [29, 24, 34, 44, 19],
        [24, 20, 28, 36, 16]],
       [[45, 37, 53, 69, 29],
        [30, 25, 35, 45, 20],
        [25, 21, 29, 37, 17]]])
&amp;gt;&amp;gt;&amp;gt; result[3,2,4]
17
&amp;gt;&amp;gt;&amp;gt; a[3]+b[2]*c[4]
17
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你也可以实行如下简化：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;def ufunc_reduce(ufct, *vectors):
    vs = ix_(*vectors)
    r = ufct.identity
    for v in vs:
        r = ufct(r,v)
    return r
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;然后这样使用它：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; ufunc_reduce(add,a,b,c)
array([[[15, 14, 16, 18, 13],
        [12, 11, 13, 15, 10],
        [11, 10, 12, 14,  9]],
       [[16, 15, 17, 19, 14],
        [13, 12, 14, 16, 11],
        [12, 11, 13, 15, 10]],
       [[17, 16, 18, 20, 15],
        [14, 13, 15, 17, 12],
        [13, 12, 14, 16, 11]],
       [[18, 17, 19, 21, 16],
        [15, 14, 16, 18, 13],
        [14, 13, 15, 17, 12]]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个reduce与ufunc.reduce(比如说add.reduce)相比的优势在于它利用了广播法则，避免了创建一个输出大小乘以向量个数的参数数组。&lt;sup id=&quot;fnref:8&quot;&gt;&lt;a href=&quot;#fn:8&quot; rel=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-16&quot;&gt;用字符串索引&lt;/h3&gt;

&lt;p&gt;参见&lt;a href=&quot;http://www.scipy.org/RecordArrays&quot;&gt;RecordArray&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;section-17&quot;&gt;线性代数&lt;/h2&gt;

&lt;p&gt;继续前进，基本线性代数包含在这里。&lt;/p&gt;

&lt;h3 id=&quot;section-18&quot;&gt;简单数组运算&lt;/h3&gt;

&lt;p&gt;参考numpy文件夹中的linalg.py获得更多信息&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; from numpy import *
&amp;gt;&amp;gt;&amp;gt; from numpy.linalg import *

&amp;gt;&amp;gt;&amp;gt; a = array([[1.0, 2.0], [3.0, 4.0]])
&amp;gt;&amp;gt;&amp;gt; print a
[[ 1.  2.]
 [ 3.  4.]]

&amp;gt;&amp;gt;&amp;gt; a.transpose()
array([[ 1.,  3.],
       [ 2.,  4.]])

&amp;gt;&amp;gt;&amp;gt; inv(a)
array([[-2. ,  1. ],
       [ 1.5, -0.5]])

&amp;gt;&amp;gt;&amp;gt; u = eye(2) # unit 2x2 matrix; &quot;eye&quot; represents &quot;I&quot;
&amp;gt;&amp;gt;&amp;gt; u
array([[ 1.,  0.],
       [ 0.,  1.]])
&amp;gt;&amp;gt;&amp;gt; j = array([[0.0, -1.0], [1.0, 0.0]])

&amp;gt;&amp;gt;&amp;gt; dot (j, j) # matrix product
array([[-1.,  0.],
       [ 0., -1.]])

&amp;gt;&amp;gt;&amp;gt; trace(u)  # trace
 2.0

&amp;gt;&amp;gt;&amp;gt; y = array([[5.], [7.]])
&amp;gt;&amp;gt;&amp;gt; solve(a, y)
array([[-3.],
       [ 4.]])

&amp;gt;&amp;gt;&amp;gt; eig(j)
(array([ 0.+1.j,  0.-1.j]),
array([[ 0.70710678+0.j,  0.70710678+0.j],
       [ 0.00000000-0.70710678j,  0.00000000+0.70710678j]]))
Parameters:
    square matrix

Returns
    The eigenvalues, each repeated according to its multiplicity.

    The normalized (unit &quot;length&quot;) eigenvectors, such that the
    column ``v[:,i]`` is the eigenvector corresponding to the
    eigenvalue ``w[i]`` .
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-19&quot;&gt;矩阵类&lt;/h3&gt;

&lt;p&gt;这是一个关于矩阵类的简短介绍。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A = matrix('1.0 2.0; 3.0 4.0')
&amp;gt;&amp;gt;&amp;gt; A
[[ 1.  2.]
 [ 3.  4.]]
&amp;gt;&amp;gt;&amp;gt; type(A)  # file where class is defined
&amp;lt;class 'numpy.matrixlib.defmatrix.matrix'&amp;gt;

&amp;gt;&amp;gt;&amp;gt; A.T  # transpose
[[ 1.  3.]
 [ 2.  4.]]

&amp;gt;&amp;gt;&amp;gt; X = matrix('5.0 7.0')
&amp;gt;&amp;gt;&amp;gt; Y = X.T
&amp;gt;&amp;gt;&amp;gt; Y
[[5.]
 [7.]]

&amp;gt;&amp;gt;&amp;gt; print A*Y  # matrix multiplication
[[19.]
 [43.]]

&amp;gt;&amp;gt;&amp;gt; print A.I  # inverse
[[-2.   1. ]
 [ 1.5 -0.5]]

&amp;gt;&amp;gt;&amp;gt; solve(A, Y)  # solving linear equation
matrix([[-3.],
        [ 4.]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;section-20&quot;&gt;索引：比较矩阵和二维数组&lt;/h3&gt;

&lt;p&gt;注意NumPy中数组和矩阵有些重要的区别。NumPy提供了两个基本的对象：一个N维数组对象和一个通用函数对象。其它对象都是建构在它们之上的。特别的，矩阵是继承自NumPy数组对象的二维数组对象。对数组和矩阵，索引都必须包含合适的一个或多个这些组合：整数标量、省略号(ellipses)、整数列表;布尔值，整数或布尔值构成的元组，和一个一维整数或布尔值数组。矩阵可以被用作矩阵的索引，但是通常需要数组、列表或者其它形式来完成这个任务。&lt;/p&gt;

&lt;p&gt;像平常在Python中一样，索引是从0开始的。传统上我们用矩形的行和列表示一个二维数组或矩阵，其中沿着0轴的方向被穿过的称作行，沿着1轴的方向被穿过的是列。&lt;sup id=&quot;fnref:9&quot;&gt;&lt;a href=&quot;#fn:9&quot; rel=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;让我们创建数组和矩阵用来切片：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A = arange(12)
&amp;gt;&amp;gt;&amp;gt; A
array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])
&amp;gt;&amp;gt;&amp;gt; A.shape = (3,4)
&amp;gt;&amp;gt;&amp;gt; M = mat(A.copy())
&amp;gt;&amp;gt;&amp;gt; print type(A),&quot;  &quot;,type(M)
&amp;lt;type 'numpy.ndarray'&amp;gt;    &amp;lt;class 'numpy.core.defmatrix.matrix'&amp;gt;
&amp;gt;&amp;gt;&amp;gt; print A
[[ 0  1  2  3]
 [ 4  5  6  7]
 [ 8  9 10 11]]
&amp;gt;&amp;gt;&amp;gt; print M
[[ 0  1  2  3]
 [ 4  5  6  7]
 [ 8  9 10 11]]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在，让我们简单的切几片。基本的切片使用切片对象或整数。例如，&lt;code&gt;A[:]&lt;/code&gt;和&lt;code&gt;M[:]&lt;/code&gt;的求值将表现得和Python索引很相似。然而要注意很重要的一点就是NumPy切片数组&lt;em&gt;不&lt;/em&gt;创建数据的副本;切片提供统一数据的视图。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; print A[:]; print A[:].shape
[[ 0  1  2  3]
 [ 4  5  6  7]
 [ 8  9 10 11]]
(3, 4)
&amp;gt;&amp;gt;&amp;gt; print M[:]; print M[:].shape
[[ 0  1  2  3]
 [ 4  5  6  7]
 [ 8  9 10 11]]
(3, 4)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在有些和Python索引不同的了：你可以同时使用逗号分割索引来沿着多个轴索引。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; print A[:,1]; print A[:,1].shape
[1 5 9]
(3,)
&amp;gt;&amp;gt;&amp;gt; print M[:,1]; print M[:,1].shape
[[1]
 [5]
 [9]]
(3, 1)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;注意最后两个结果的不同。对二维数组使用一个冒号产生一个一维数组，然而矩阵产生了一个二维矩阵。&lt;sup id=&quot;fnref:10&quot;&gt;&lt;a href=&quot;#fn:10&quot; rel=&quot;footnote&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;例如，一个&lt;code&gt;M[2,:]&lt;/code&gt;切片产生了一个形状为(1,4)的矩阵，相比之下，一个数组的切片总是产生一个最低可能维度&lt;sup id=&quot;fnref:11&quot;&gt;&lt;a href=&quot;#fn:11&quot; rel=&quot;footnote&quot;&gt;11&lt;/a&gt;&lt;/sup&gt;的数组。例如，如果C是一个三维数组，&lt;code&gt;C[...,1]&lt;/code&gt;产生一个二维的数组而&lt;code&gt;C[1,:,1]&lt;/code&gt;产生一个一维数组。从这时开始，如果相应的矩阵切片结果是相同的话，我们将只展示数组切片的结果。&lt;/p&gt;

&lt;p&gt;假如我们想要一个数组的第一列和第三列，一种方法是使用列表切片：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[:,[1,3]]
array([[ 1,  3],
       [ 5,  7],
       [ 9, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;稍微复杂点的方法是使用&lt;code&gt;take()&lt;/code&gt;方法(method):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[:,].take([1,3],axis=1)
array([[ 1,  3],
       [ 5,  7],
       [ 9, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果我们想跳过第一行，我们可以这样：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[1:,].take([1,3],axis=1)
array([[ 5,  7],
       [ 9, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;或者我们仅仅使用&lt;code&gt;A[1:,[1,3]]&lt;/code&gt;。还有一种方法是通过矩阵向量积(叉积)。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[ix_((1,2),(1,3))]
array([[ 5,  7],
       [ 9, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;为了读者的方便，在次写下之前的矩阵：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[ix_((1,2),(1,3))]
array([[ 5,  7],
       [ 9, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;现在让我们做些更复杂的。比如说我们想要保留第一行大于1的列。一种方法是创建布尔索引：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[0,:]&amp;gt;1
array([False, False, True, True], dtype=bool)
&amp;gt;&amp;gt;&amp;gt; A[:,A[0,:]&amp;gt;1]
array([[ 2,  3],
       [ 6,  7],
       [10, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;就是我们想要的！但是索引矩阵没这么方便。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; M[0,:]&amp;gt;1
matrix([[False, False, True, True]], dtype=bool)
&amp;gt;&amp;gt;&amp;gt; M[:,M[0,:]&amp;gt;1]
matrix([[2, 3]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这个过程的问题是用“矩阵切片”来切片产生一个矩阵&lt;sup id=&quot;fnref:12&quot;&gt;&lt;a href=&quot;#fn:12&quot; rel=&quot;footnote&quot;&gt;12&lt;/a&gt;&lt;/sup&gt;，但是矩阵有个方便的&lt;code&gt;A&lt;/code&gt;属性，它的值是数组呈现的。所以我们仅仅做以下替代：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; M[:,M.A[0,:]&amp;gt;1]
matrix([[ 2,  3],
        [ 6,  7],
        [10, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;如果我们想要在矩阵两个方向有条件地切片，我们必须稍微调整策略，代之以：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[A[:,0]&amp;gt;2,A[0,:]&amp;gt;1]
array([ 6, 11])
&amp;gt;&amp;gt;&amp;gt; M[M.A[:,0]&amp;gt;2,M.A[0,:]&amp;gt;1]
matrix([[ 6, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;我们需要使用向量积&lt;code&gt;ix_&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; A[ix_(A[:,0]&amp;gt;2,A[0,:]&amp;gt;1)]
array([[ 6,  7],
       [10, 11]])
&amp;gt;&amp;gt;&amp;gt; M[ix_(M.A[:,0]&amp;gt;2,M.A[0,:]&amp;gt;1)]
matrix([[ 6,  7],
        [10, 11]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-21&quot;&gt;技巧和提示&lt;/h2&gt;

&lt;p&gt;下面我们给出简短和有用的提示。&lt;/p&gt;

&lt;h3 id=&quot;section-22&quot;&gt;“自动”改变形状&lt;/h3&gt;

&lt;p&gt;更改数组的维度，你可以省略一个尺寸，它将被自动推导出来。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; a = arange(30)
&amp;gt;&amp;gt;&amp;gt; a.shape = 2,-1,3  # -1 means &quot;whatever is needed&quot;
&amp;gt;&amp;gt;&amp;gt; a.shape
(2, 5, 3)
&amp;gt;&amp;gt;&amp;gt; a
array([[[ 0,  1,  2],
        [ 3,  4,  5],
        [ 6,  7,  8],
        [ 9, 10, 11],
        [12, 13, 14]],
       [[15, 16, 17],
        [18, 19, 20],
        [21, 22, 23],
        [24, 25, 26],
        [27, 28, 29]]])
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;stacking&quot;&gt;向量组合(stacking)&lt;/h3&gt;

&lt;p&gt;我们如何用两个相同尺寸的行向量列表构建一个二维数组？在MATLAB中这非常简单：如果x和y是两个相同长度的向量，你仅仅需要做&lt;code&gt;m=[x;y]&lt;/code&gt;。在NumPy中这个过程通过函数&lt;code&gt;column_stack&lt;/code&gt;、&lt;code&gt;dstack&lt;/code&gt;、&lt;code&gt;hstack&lt;/code&gt;和&lt;code&gt;vstack&lt;/code&gt;来完成，取决于你想要在那个维度上组合。例如：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;x = arange(0,10,2)                     # x=([0,2,4,6,8])
y = arange(5)                          # y=([0,1,2,3,4])
m = vstack([x,y])                      # m=([[0,2,4,6,8],
                                       #     [0,1,2,3,4]])
xy = hstack([x,y])                     # xy =([0,2,4,6,8,0,1,2,3,4])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;二维以上这些函数背后的逻辑会很奇怪。&lt;/p&gt;

&lt;p&gt;参考&lt;a href=&quot;http://scipy.org/NumPy_for_Matlab_Users&quot;&gt;写个Matlab用户的NumPy指南&lt;/a&gt;并且在这里添加你的新发现: )&lt;/p&gt;

&lt;h3 id=&quot;histogram&quot;&gt;直方图(histogram)&lt;/h3&gt;

&lt;p&gt;NumPy中&lt;code&gt;histogram&lt;/code&gt;函数应用到一个数组返回一对变量：直方图数组和箱式向量。注意：&lt;code&gt;matplotlib&lt;/code&gt;也有一个用来建立直方图的函数(叫作&lt;code&gt;hist&lt;/code&gt;,正如matlab中一样)与NumPy中的不同。主要的差别是&lt;code&gt;pylab.hist&lt;/code&gt;自动绘制直方图，而&lt;code&gt;numpy.histogram&lt;/code&gt;仅仅产生数据。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;import numpy
import pylab
# Build a vector of 10000 normal deviates with variance 0.5^2 and mean 2
mu, sigma = 2, 0.5
v = numpy.random.normal(mu,sigma,10000)
# Plot a normalized histogram with 50 bins
pylab.hist(v, bins=50, normed=1)       # matplotlib version (plot)
pylab.show()
# Compute the histogram with numpy and then plot it
(n, bins) = numpy.histogram(v, bins=50, normed=True)  # NumPy version (no plot)
pylab.plot(.5*(bins[1:]+bins[:-1]), n)
pylab.show()
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-23&quot;&gt;参考文献&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;The &lt;a href=&quot;http://docs.python.org/tut/tut.html&quot;&gt;Python tutorial&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;http://scipy.org/Numpy_Example_List&quot;&gt;Numpy Example List&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;The nonexistent &lt;a href=&quot;http://scipy.org/NumPy_Tutorial&quot;&gt;NumPy Tutorial&lt;/a&gt; at scipy.org, where we can find the old Numeric documentation.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;http://www.tramy.us/&quot;&gt;Guide to NumPy&lt;/a&gt; book.&lt;/li&gt;
  &lt;li&gt;The &lt;a href=&quot;http://scipy.org/SciPy_Tutorial&quot;&gt;SciPy Tutorial&lt;/a&gt; and a &lt;a href=&quot;http://www.rexx.com/~dkuhlman/scipy_course_01.html&quot;&gt;SciPy course online&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://scipy.org/NumPy_for_Matlab_Users&quot;&gt;NumPy for Matlab Users&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;A &lt;a href=&quot;http://mathesaurus.sf.net/&quot;&gt;matlab, R, IDL, NumPy/SciPy dictionary&lt;/a&gt;. &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;在python的交互环境或ipython中&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;0轴&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;即self，它自己&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;形参&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;0轴&lt;a href=&quot;#fnref:5&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot;&gt;
      &lt;p&gt;我也不知道在翻译什么了……&lt;a href=&quot;#fnref:6&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot;&gt;
      &lt;p&gt;上面最后一个例子，b1和b2中的true个数必须一致&lt;a href=&quot;#fnref:7&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:8&quot;&gt;
      &lt;p&gt;我不怎么明白……总之避免创建一个很大的数组。&lt;a href=&quot;#fnref:8&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:9&quot;&gt;
      &lt;p&gt;水平是1轴，垂直是0轴。&lt;a href=&quot;#fnref:9&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:10&quot;&gt;
      &lt;p&gt;&lt;code&gt;type(M[:,1])&lt;/code&gt;和&lt;code&gt;type(A[:,1])&lt;/code&gt;你可以看到是这样。&lt;a href=&quot;#fnref:10&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:11&quot;&gt;
      &lt;p&gt;什么叫尽可能低的维度？不懂。&lt;a href=&quot;#fnref:11&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:12&quot;&gt;
      &lt;p&gt;用矩阵切片&lt;a href=&quot;#fnref:12&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>To Be An Epicurean</title>
   <link href="http://reverland.org/Life/2012/08/17/to-be-an-epicurean"/>
   <updated>2012-08-17T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/08/17/to-be-an-epicurean</id>
   <content type="html">
&lt;p&gt;&lt;strong&gt;胡言乱语，请随意喷。&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;起&lt;/h2&gt;

&lt;p&gt;晚上我正对着一堆python的东西不知所措时，室友自习回来，怒斥着考研太难过，表示不想考了。瞬间我们寝室便从四人考研将要沦落到我一个人了，这不是什么问题，也就是将来一个人困难更多些而已。然后他补充了一句：人活了为了什么？不就是为了爽吗？&lt;/p&gt;

&lt;p&gt;我忽然感觉语塞，不知如何应答。说不出有什么问题，但心中拼命有个声音在问着：是吗是吗是这样吗？&lt;/p&gt;

&lt;p&gt;感觉不对劲，很不对劲。&lt;/p&gt;

&lt;p&gt;我不是一个反享乐主义者，事实上，我觉得每一个人都应该尽力享受他们的生命。若干月前我在图书馆看到一本享乐主义手册，书中虽然罗列了史上臭名昭著的享乐主义者，但极力鼓励人们享受自己的生活，过一个轻松愉快的人生。&lt;/p&gt;

&lt;p&gt;但总感觉有哪里不对劲，但又理不清究竟是哪里不对。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;承&lt;/h2&gt;

&lt;p&gt;于是心神不宁地去操场跑步，仰头看着久违的美丽星空。矛盾在心中一直萦绕，这无关紧要的问题为什么让我如此心神不宁？&lt;/p&gt;

&lt;p&gt;我也许不是个纯粹的享乐主义者，甚至在很多方面我都倾向于苦修主义者，希望借以磨砺自己的意志。&lt;/p&gt;

&lt;p&gt;但我只是跟他人方向不同罢了，互联网和文字使那些与自我时空千里之遥的思想在我心之土壤生根发芽，比周边的人更多塑造了我。我只是把自己的执迷不悟和强烈的欲望发泄在了我因此所感兴趣的领域上——数学、艺术、计算机。但我依然在他人不关心的方面贪嗔痴怪，不觉不慧。&lt;/p&gt;

&lt;p&gt;我寻找、追寻、计划、妄想，依然也是使我感觉更“爽”，像在技术上的成就感、hack的乐趣，艺术的美和数学的美和精致。&lt;/p&gt;

&lt;p&gt;既然我亦如是，到底哪里感觉不对劲？&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;转&lt;/h2&gt;

&lt;p&gt;我凝视天空，为城市光污染而星光黯淡的星空扼腕，&lt;/p&gt;

&lt;p&gt;忽然寒颤，忽然明白&lt;/p&gt;

&lt;p&gt;我怕那些极端的享乐主义者，怕他们的“爽”硬要强加在自己头上。&lt;/p&gt;

&lt;p&gt;怕自己的信念与执着被自以为是的享乐主义者们扼杀。&lt;/p&gt;

&lt;p&gt;怕众人只看见自己所见。&lt;/p&gt;

&lt;p&gt;怕抬头再没了那份好奇的冲动，&lt;/p&gt;

&lt;p&gt;探索的精神与好奇心。&lt;/p&gt;

&lt;p&gt;虽然也勉强算是一个epicurean，&lt;/p&gt;

&lt;p&gt;但有比那更得吾心的&lt;/p&gt;

&lt;p&gt;我无法想象上千年来我们都酒池肉林&lt;/p&gt;

&lt;p&gt;还以为我们看到的就如同所看到的世界&lt;/p&gt;

&lt;p&gt;还以为自己是万物中心的世界&lt;/p&gt;

&lt;p&gt;总之，我痛恨醉生梦死的世界和止步不前的死水。&lt;/p&gt;

&lt;p&gt;然而我依然还是个享乐主义者。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;合&lt;/h2&gt;

&lt;p&gt;我思索整个开源社区，没有利益支持却如何发展起来&lt;/p&gt;

&lt;p&gt;我思索这些年来让我着迷的东西&lt;/p&gt;

&lt;p&gt;思索那些明明让我疲乏而孤独的东西怎么能让我夜以继日的迷恋其中。&lt;/p&gt;

&lt;p&gt;思索那些为某种信念忘我的人&lt;/p&gt;

&lt;p&gt;思索那些为了某种乐趣迷失到另一个世界的人&lt;/p&gt;

&lt;p&gt;他们选择了怎样的人生。世人又怎么看他们。&lt;/p&gt;

&lt;p&gt;其实所有的人都是享乐主义者，但又如此不同&lt;/p&gt;

&lt;p&gt;享乐主义不只是食色。这世界神赐给人类的乐趣如此之多&lt;/p&gt;

&lt;p&gt;以致生命如此之精彩&lt;/p&gt;

&lt;p&gt;我只是希望，不同的人、不同信念的人、不同乐趣的人&lt;/p&gt;

&lt;p&gt;把目光从自身移向更广阔的宇宙，更多理解和包容。&lt;/p&gt;

&lt;p&gt;我所言所为&lt;/p&gt;

&lt;p&gt;未必能改变世界，只是撒下思想的种子。&lt;/p&gt;

&lt;p&gt;如若有缘，它会在合适的地方于合适的时间生根发芽，&lt;/p&gt;

&lt;p&gt;甚至结成硕果，繁育成林。&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>GALGAME</title>
   <link href="http://reverland.org/Life/2012/08/15/galgame"/>
   <updated>2012-08-15T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/08/15/galgame</id>
   <content type="html">
&lt;h1 id=&quot;galgame&quot;&gt;GALGAME&lt;/h1&gt;

&lt;h2 id=&quot;galgameair&quot;&gt;Galgame初体验——AIR&lt;/h2&gt;

&lt;p&gt;第一次接触galgame&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;大概是一年以前，忽然看到当年痴迷动漫时看过&lt;a href=&quot;http://baike.baidu.com/view/4449.htm#sub6281444&quot;&gt;《AIR》&lt;/a&gt;的游戏原作下载，正好闲的……于是便莫名开始了GALGAME初体验。到头也不记得剧情什么什么的了，只记得最后把某条线一气照着网上胡乱搜来的攻略通关，然后就是那什么什么h图的CG&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;对这个galgame经典之作总体印象不怎么样,感觉画面有些古老，音乐也没什么印象&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;,现在剧情早忘的一干二净，连有没有配音都不记得了。反正后来很久很久都觉得，这种游戏貌似也没什么意思嘛。&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;之后接触linux，兴趣开始泛滥&lt;sup id=&quot;fnref:6&quot;&gt;&lt;a href=&quot;#fn:6&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;，没时间和心思干其它的了。&lt;/p&gt;

&lt;h2 id=&quot;another-galgame-one-year-later&quot;&gt;Another Galgame one year later&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;_我怎么就没想到我又开始玩Galgame了！！！_&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;前几天在arch论坛上看到有人推荐&lt;a href=&quot;http://katawa-shoujo.com/&quot;&gt;katawa shoujo&lt;/a&gt;&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; rel=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;，然后在archlinux贴吧看到有人贴图。感觉画面做得挺精致的，又渐渐听说国际团队制作，Creative Commons协议发布，原生linux支持……&lt;/p&gt;

&lt;p&gt;好吧，总之我手贱了，花了一点时间和精力让它运行在我的linux x86_64之上。&lt;/p&gt;

&lt;p&gt;然后想，费力劳神折腾好，难道不玩玩看？&lt;/p&gt;

&lt;p&gt;于是作为考研党可耻地花时间开始攻略Galgame……&lt;/p&gt;

&lt;p&gt;片首动画直接把我震惊了，做的真精致。&lt;/p&gt;

&lt;p&gt;音轨也很棒&lt;/p&gt;

&lt;p&gt;故事也……只能说有种很奇怪的感觉，似乎remind me of something，反正最后打算每天花近一个小时读读这个视觉小说。虽然一句话有两个单词不认识，开着电子词典查个不停.&lt;/p&gt;

&lt;p&gt;上游戏效果图，这个场景忽然有种耳目一新的感觉，也许是因为画面，色调，音乐，或者是出乎意料的剧情：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrfmn.com/fmn058/20120815/1740/p_large_COVT_6e6d000009051263.jpg&quot; alt=&quot;katawa-shoujo&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;选择&lt;/h2&gt;

&lt;p&gt;galgame这种游戏基本是依靠玩家的选择来决定剧情和结局的，每当做完选择，对未选之事便浮想联翩。老感觉自己错过了什么重要而不同的精彩剧情。自己的人生有何尝不是，选择之前它充满可能性。选择之后却一切都不能回头，只能浮想联翩，当初我若是做出了不同的选择，我将会是怎样的我，遇到怎样的人。一切都必将变化很多，万事都是缘分，发生后便是刻骨铭心的命运。&lt;/p&gt;

&lt;p&gt;不知道准备把兴趣转变成自己的工作是个什么结果、也许当作兴趣更好、工作反而会把所有的乐趣毁掉。长恨此生非我有、何时忘却营营。准备到最后可能是踏遍铁鞋无觅处，无心插柳却成荫。不关福祸、做现在的打算。&lt;/p&gt;

&lt;p&gt;To-do list：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;learning python the hard way&lt;/li&gt;
  &lt;li&gt;htdp&lt;/li&gt;
  &lt;li&gt;prolog&lt;/li&gt;
  &lt;li&gt;common lisp&lt;/li&gt;
  &lt;li&gt;gimp/krita/inkscape&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;^o^ go for it!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;之前的选择，已经让我踏上看不清未来的路，福兮？祸兮？&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;
&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;美少女游戏。其实您一定知道什么意思，就算不知道也可以google/baidu。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://baike.baidu.com/view/4406.htm#sub8281901&quot;&gt;百度百科解释&lt;/a&gt;&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;鸟之诗？&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;好吧，其实我总共就接触过两个Galgame，所以见识浅薄，口出狂言，见谅。&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot;&gt;
      &lt;p&gt;泛滥，数学、计算机、一堆计算机语言、数据挖掘与可视化、计算软件、文本处理、web前端、linux系统及工具集、动态及静态博客系统、图像处理……&lt;a href=&quot;#fnref:6&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;片轮少女，即残疾少女的意思。&lt;a href=&quot;#fnref:5&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>随笔——关于学习</title>
   <link href="http://reverland.org/Life/2012/08/11/"/>
   <updated>2012-08-11T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/08/</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;近日简记&lt;/h2&gt;

&lt;p&gt;自从回家没把本带回去，半个月隔绝linux，隔绝各类和计算机相关的东西。在这里的日志便从每三四天一篇缩减到似乎不再维护似的。其实现在倒一点没闲下来，只是没以前那么有大把大把的时间了。六点半起床，打开电脑看奥运新闻，洗衣服，早饭、去自习，中午午饭回来上网看看、学学python，小憩一下，滚到教室继续自习，偶尔会去实验室打打酱油。晚饭回来，继续打开电脑折腾。其实这一天天就这么过去了。半个月之前晚上八点去操场慢跑一个小时，现在缩短到九点跑个半小时……日子就这么一天天过去。&lt;/p&gt;

&lt;h2 id=&quot;learn-python&quot;&gt;Learn Python&lt;/h2&gt;

&lt;p&gt;从一个月之前断断续续地，竟然把A Byte of Python看完了，虽然很多东西也不甚明白，而且忘了大半。但总有了个轻松愉快的开端，总之这本书看起来令人愉快。之后看看《learn python the hard way》，作者的很多话我深以为然，反正那篇NB哄哄的序言把我吸引进来了，结果发现有之前那本书的底子之后看起来太简单了点……但作者关于学习一样东西的许多见解确是很值得一看的。&lt;/p&gt;

&lt;h3 id=&quot;the-hard-way-is-easier&quot;&gt;The Hard Way Is Easier&lt;/h3&gt;

&lt;p&gt;这里有段很精彩的关于练习和坚持的言论，我真得很喜欢它：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;a-note-on-practice-and-persistence&quot;&gt;A Note On Practice And Persistence&lt;/h2&gt;
  &lt;p&gt;While you are studying programming, I’m studying how to play guitar. I practice it every day for at least 2 hours a day. I play scales, chords, and arpeggios for an hour at least and then learn music theory, ear training, songs and anything else I can. Some days I study guitar and music for 8 hours because I feel like it and it’s fun. To me repetitive practice is natural and just how to learn something. I know that to get good at anything you have to practice every day, even if I suck that day (which is often) or it’s difficult. Keep trying and eventually it’ll be easier and fun.&lt;/p&gt;

  &lt;p&gt;As you study this book, and continue with programming, remember that anything worth doing is difficult at first. Maybe you are the kind of person who is afraid of failure so you give up at the first sign of difficulty. Maybe you never learned self-discipline so you can’t do anything that’s “boring”. Maybe you were told that you are “gifted” so you never attempt anything that might make you seem stupid or not a prodigy. Maybe you are competitive and unfairly compare yourself to someone like me who’s been programming for 20+ years.&lt;/p&gt;

  &lt;p&gt;Whatever your reason for wanting to quit, keep at it. Force yourself. If you run into an Extra Credit you can’t do, or a lesson you just do not understand, then skip it and come back to it later. Just keep going because with programming there’s this very odd thing that happens.&lt;/p&gt;

  &lt;p&gt;At first, you will not understand anything. It’ll be weird, just like with learning any human language. You will struggle with words, and not know what symbols are what, and it’ll all be very confusing. Then one day BANG your brain will snap and you will suddenly “get it”. If you keep doing the exercises and keep trying to understand them, you will get it. You might not be a master coder, but you will at least understand how programming works.&lt;/p&gt;

  &lt;p&gt;If you give up, you won’t ever reach this point. You will hit the first confusing thing (which is everything at first) and then stop. If you keep trying, keep typing it in, trying to understand it and reading about it, you will eventually get it.&lt;/p&gt;

  &lt;p&gt;But, if you go through this whole book, and you still do not understand how to code, at least you gave it a shot. You can say you tried your best and a little more and it didn’t work out, but at least you tried. You can be proud of that.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这的确是本很“简单的书”，我觉得作者以下的话可以送给那些妄想走捷径自大而不愿付出的人(No pains,no gains):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Empty before you fill. You will have a hard time learning from someone with more knowledge if you already know everything.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;当然还有这一句玩笑话……&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Go learn Lisp. I hear people who know everything really like Lisp.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;关于一个看上去很艰巨的大任务或者大项目，比如面临考研复习的自己，作者送出了这么一段句话：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;One final word of advice: Every programmer becomes paralyzed by irrational fear starting a new large project. They then use procrastination to avoid confronting this fear and end up not getting their program working or even started. I do this. Everyone does this. The best way to avoid this is to make a list of things you should do, and then do them one at a time.&lt;/p&gt;

  &lt;p&gt;Just start doing it, do a small version, make it bigger, keep a list of things to do, and do them.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;好像人们常说的细化目标，日积月累，步步为营。更关键的在于——开始去做。&lt;/p&gt;

&lt;p&gt;就像当你决定做什么时，空想除了让你更好受永远不会有任何作用，但当你走出房门的那一刻，虽然什么也没做，情况确彻底地改变了。&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;作者经常让你花上几乎一整周的时间来&lt;em&gt;记忆&lt;/em&gt;,记忆一定是学习一样东西时非常重要的东西，不管怎样，基本的东西你要记住。这些东西像英语中的词汇一样，是一切开始的基础。所以不要偷懒，&lt;em&gt;No pains, no gains&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;在学习的过程中我们经常性挫败感十足，这很糟糕。因为就我目前体验来说，要没有之前安装配置linux那种成就感让我如此上瘾，我真不会如此视折腾为乐事“坚持”到现在。所以，想办法让自己充满成就感。&lt;/p&gt;

&lt;p&gt;尝试受挫会让自己感觉很蠢，but&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The most important thing when doing this exercise is: “There is no failure, only trying.”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;学习一段时间会很累？感觉有些不明白？作者经常安慰吾等菜鸟读者说：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Just take it slow and do not hurt your brain. Hopefully by now these symbols are natural for you so this isn’t a big effort. It’s best to take 15 minutes at a time with your list and then take a break. Giving your brain a rest will help you learn faster with less frustration.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;很多credits都要求读者去自己求助于搜索引擎、文档，我觉得这才是学习，这才是zen，这才会有乐趣。&lt;/p&gt;

&lt;p&gt;除了非常重要一致不能跳过的东西&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;,大多东西都可以先跳过的，总之不要让自己挫败感十足。充满自信和乐趣是持续前进的动力。&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Happy hacking,happy learning&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-1&quot;&gt;这是题外话&lt;/h2&gt;

&lt;p&gt;很多想得很好却没做到的事情。只能说自己想得太多：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn065/20120811/2210/p_large_KvH1_63ff00004f3c1263.jpg&quot; hight=&quot;400&quot; width=&quot;200&quot; alt=&quot;梦想很美&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在weibo上说，我现在在学python。于是一位common lisp造诣很高的高人问我？你不学scheme了？我这才想起来从图书馆借的htdp，看着还不算累，但东西实在多。之后因为sagemath和自己在学校的创新项目和python的千丝万缕，又碰到python简明教材这本令人愉快的读物，投到scheme的热情便完全转移到python上了。&lt;/p&gt;

&lt;p&gt;忽然便想起最近背的单词passion。激情、喜爱简直是一码事。虽然生活如此如此那般，但有passion的人生还是幸福的。&lt;/p&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;我其实在说晚上去跑步的情况。有时候会拖到很晚才去。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;比如说python的安装……&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>这只是篇随笔</title>
   <link href="http://reverland.org/Life/2012/08/04/"/>
   <updated>2012-08-04T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/08/</id>
   <content type="html">
&lt;h1 id=&quot;section&quot;&gt;2012年08月04日随笔&lt;/h1&gt;

&lt;p&gt;其实是好久没在这写东西了。&lt;code&gt;^o^&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;无锡的夜&lt;/h2&gt;

&lt;p&gt;晚上去跑步时，JNU的夜shocked me.当站在宽阔的操场上，凝视着安详高远的天空，宁静平和的初升明月,南边一溜美丽祥和的云朵,东边若隐若现的城市灯火，黑暗中飒飒作响的树影，西边绵延而沉默的山峦，头顶点点的星辰。夏夜的晚风穿过身旁，撩拨着我的衣裳，也撩拨着我的神经。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;好像那片云&lt;/h2&gt;

&lt;p&gt;云千奇百怪，诡奇壮丽，它们是天空最亮丽的风景线。它洁白如雪过，它压抑阴沉的想要坠落过,它曾排山倒海压来，也曾宁静的好像不变的山峦。&lt;/p&gt;

&lt;p&gt;然而它最终要散，无影无踪。&lt;/p&gt;

&lt;p&gt;就像我所追求的，我所喜爱的，我所经历的，我所拥有的。&lt;/p&gt;

&lt;p&gt;在生命经历一个个奇幻的形态后烟消云散。&lt;/p&gt;

&lt;p&gt;曾经的美丽只留存在他人的记忆之中。&lt;/p&gt;

&lt;p&gt;跑完步时，南边的云散得无影无踪，好像从未存在。&lt;/p&gt;

&lt;h2 id=&quot;linuxer&quot;&gt;linuxer周年记&lt;/h2&gt;

&lt;p&gt;入门是件很奇特的事，我视之为缘分,思之为注定。&lt;/p&gt;

&lt;p&gt;一切在阴差阳错间成就，也许像从前曾有缘过的一样缘尽于某日&lt;/p&gt;

&lt;p&gt;然而就这么改变了我一年的人生&lt;/p&gt;

&lt;p&gt;之前生命中点点阴差阳错点点成线，汇集成今&lt;/p&gt;

&lt;p&gt;那个轨迹，就是人们所说的命运？&lt;/p&gt;

&lt;p&gt;是否在他人眼里是彻头彻尾的宅loser？&lt;/p&gt;

&lt;p&gt;是否被看成不通世情的sb？&lt;/p&gt;

&lt;p&gt;It dosen’t matter.&lt;/p&gt;

&lt;p&gt;我喜欢开源社区的氛围，开放、共享、自由与进步。&lt;/p&gt;

&lt;p&gt;我认同黑客的精神，自强、求索、执着、包容。&lt;/p&gt;

&lt;p&gt;我相信人生有很多值得去体验和经历的事，有很多有趣的东西：哲学、文学、艺术、数学、计算机、还有风景，还有girl……&lt;/p&gt;

&lt;p&gt;我相信世界充满乐趣和值得探索的问题。&lt;/p&gt;

&lt;p&gt;感谢上苍让我看到一个热心、分享、积极探索、奉献的社区。&lt;/p&gt;

&lt;p&gt;很高兴与那些富有创造力、执着、热心、积极探索、充满趣味、积极进步的人交流、从他们那里学习，被他们鞭策、鼓励。&lt;/p&gt;

&lt;p&gt;我觉得这是神赐给我此生的礼物，让我在尘世呼吸到不一样的自由气息，好像来自天堂，重新refresh被功利的世界奴役的疲惫的身躯与心灵。&lt;/p&gt;

&lt;p&gt;那些contributors,是最可爱的人。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;21&lt;/h2&gt;

&lt;p&gt;21岁了，爱也好，恨也好，时间不等人。&lt;/p&gt;

&lt;p&gt;看着静美的夜色，忽然想起牡丹亭中几句话，萦绕耳畔：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;原来姹紫嫣红开遍，似这般都付与断井颓垣。良辰美景奈何天，便赏心乐事谁家院？朝飞暮卷，云霞翠轩，雨丝风片，烟波画船。锦屏人忒看的这韶光贱！ &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;光阴不在，这些逝去的日子。&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>回忆</title>
   <link href="http://reverland.org/Life/2012/07/13/"/>
   <updated>2012-07-13T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/07/</id>
   <content type="html">
&lt;h1 id=&quot;section&quot;&gt;回忆&lt;/h1&gt;

&lt;p&gt;我向来厌恶回忆，当被它的触角在夜幕中拉住，你永远别指望从中抽身，回忆越陷越深，一层一层向过去延伸，好像永远没有终点。&lt;/p&gt;

&lt;p&gt;我向来厌恶面对过去，过去的哀伤与委屈，过去的快乐与迷恋，都在回忆中幻化成不可抑制的情愫与遗憾。回忆越陷越深，它在你的心头缠绕了一圈又一圈，当回忆越行越远，往事便像猴子头上的紧箍咒一样越来越紧，让人压抑的喘不过气。&lt;/p&gt;

&lt;p&gt;不知为什么，感觉往事不堪回首。虽然它普通的不能再普通，虽然它平淡的不能再平淡，但我不愿回头.让记忆随着光阴越流越远吧，我希望永远不要再见到它。&lt;/p&gt;

&lt;p&gt;可是它总是找上我。终有一天，还是要面对自己的懦弱，愚蠢与自私。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;有一种被人抛诸脑后的过去，包含一些不该遗忘的点点滴滴。欢笑之余，我将故旧拾起，才刹见自己的薄情。人世间似乎存在着某种公平，每个人都曾被抛掷在他人的遗忘中；而今你所有哽咽难宣的话语，也正是你曾为人所期盼，却永远听不见的字句。&lt;/p&gt;

  &lt;p&gt;赫曼· 赫塞—-&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;section-1&quot;&gt;大学之前&lt;/h2&gt;

&lt;p&gt;不想多说，封尘的不想重启。简单的写下，简单地卸下，轻装面对未来。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;大学&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;所谓大学者,非谓有大楼之谓也,有大师之谓也。&lt;/p&gt;

  &lt;p&gt;梅贻琦1931年在清华的就职演说—-&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;说什么好呢，本来没想到来这里。高考之前想去南京大学，考完试知道毁了，打点好好准备了一堆要报的二本大学，一本随手填了个江南大学，只因为作为革命老区的朴素人民，觉得无锡这地方比较发达。报专业的时候报的教育技术，因为自己虽然是学理科的，但一直想搞文科&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。但老爸是搞教育的，想这行业尼玛有个毛前途啊，别报这个。我那时当然无所谓了，反正谁知道将来大学毕业做什么，那就这啥 &lt;strong&gt;光信息科学与技术&lt;/strong&gt; 吧。&lt;/p&gt;

&lt;p&gt;关于这牛b的专业名我要唠叨两句：还记得去派出所开国防生证明的时候，那位警察大叔来句，唉，你这专业不错啊。我想是么？然后去招生办查分的时候招生办大叔也来了句，你这个专业高科技，有前途。我想看样子没差了。&lt;strong&gt;来到传说中江南第一学府，尼玛来到理学院，再上了三年学，我算知道这是什么玩意了&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;于是乎阴差阳错来到无锡这地方。初来乍到，这里商业气息以排山倒海之势扑面而来。各路江湖骗子、学长学姐、商业机构、云集此地…… 然后我就不多说了，三年过去，我已经不把这里当大学看了。&lt;/p&gt;

&lt;p&gt;其实也不想黑咱亲爱的大江大，学校风景秀丽，一看就是花大力气大资金维护打造初来的，基本上这个大花园是各路情侣、闲人饭后闲逛的良处。学校四周也到处都是公园，总之风景不错就是了。有这么种感觉，咱大江大就是环蠡湖绿化带的一部分。&lt;/p&gt;

&lt;p&gt;不该跑题的，虽然有很多怨念，但也不是一无是处，好歹教育部直属211大学，有心报这里的别这么就被我的胡言乱语吐槽走了，也许其它地方还不如这儿。&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;外联&lt;/h3&gt;

&lt;p&gt;大一上学期，外联还是比较忙的。然后又身在两个组织的外联，于是打了一个学期的酱油&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。最后的结果是一分钱没有拉到，不过那时候真是勇气十足啊，跑商店，闯大楼，进政府，当然，脾气好点的会听你说完，脾气差点的也没到轰我的地步…… 然后尼玛有赞助商了宣传也是我们的事，遍历宿舍做宣传，食堂门口发传单，四处张贴海报……&lt;/p&gt;

&lt;p&gt;说到底，我那时不是很给力，不过很有&lt;strong&gt;勇气&lt;/strong&gt;。&lt;/p&gt;

&lt;h3 id=&quot;section-4&quot;&gt;骑迹&lt;/h3&gt;

&lt;p&gt;也不知为何了，加了个名为骑迹的组织，买了辆 Giant ATX690&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;，准备暑假远征。没想到暗暗影响了舍友，四个人先花了几天骑车游遍了江南六大古镇，然后我知道我脾气有多差了……总之，因为脾气不好和室友别扭了很抱歉，但一直没说出过口。暑假和社团的兄弟们从学校骑车出发远征北京，难忘的七月啊。然后我又体验到自己脾气有多不好了，然而，抱歉的话一直没说出口，一路都给大家拖后腿了。&lt;/p&gt;

&lt;p&gt;远征之前和骑迹，室友出去都比较多，无锡周边什么的总是去逛逛。到远征结束，基本上再没怎么出去了。最后一次出行在2011年4月26日，骑迹的24小时环太湖活动，光荣的做了压队。没想到之后，再也没骑车出去过了。&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-5&quot;&gt;泡图书馆&lt;/h3&gt;

&lt;p&gt;大一经常泡图书馆，别人都以为我在学习，其实都是在看闲书。因为好奇很多偏见、歧视从何而来，为什么人们会这样会那样，好奇人的本性，所以看了好多心理学社会学的书。现在都忘了，当时的笔记可是做了一本又一本……&lt;/p&gt;

&lt;p&gt;最后的相关结论是，基本都是假说……&lt;/p&gt;

&lt;p&gt;那时我第一次认识到人是有多健忘，后来问我一个天天看数学和计算机学科国外论著的室友，你看这能记住吗？他说不行，我问那看了有什么用？他说很多思想会内化成为你的一部分。当时感觉这话安慰的意思多余实际的意义，两年后接触另一个神奇的领域时我才体味到这个意思。&lt;/p&gt;

&lt;h3 id=&quot;section-6&quot;&gt;动漫&lt;/h3&gt;

&lt;p&gt;在室友旁边看死神，然后感觉不错。然后开始动漫宅化一发不可收拾，先后看了一堆新番旧番。当时痴迷的，借室友mp4看空之境界，借室友电脑看Monster，寒假在家天天看eva。去郑州病房陪父亲的时候，当时还买了本《动感新势力》，没想到那本10年三月的85期，是我唯一买的动漫相关的东西。&lt;/p&gt;

&lt;p&gt;最后，忘记是何年何月，看完Lain、攻壳机动队和虫师之后，口味越来越小众，再未找到入的了法眼的动漫，也就再也没兴致看其它的动漫了。&lt;/p&gt;

&lt;h3 id=&quot;section-7&quot;&gt;小说&lt;/h3&gt;

&lt;p&gt;忘记何时，迷过一阵日系推理小说。大概是远征前的假期，当时图书馆所有能借到的东野圭吾的、京极夏彦的、宫部美雪的……推理小说，到后来痴迷上整个日系文学，村上村树、松本清张、太宰治&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;……，唯一遗憾没看《丰饶之美》和《源氏物语》，再后来因为信长之野望这个游戏对整个日本战国史产生兴趣好好研究了一番，扯淡的是又找了本叫《中国历代军事战略（上、下）》&lt;sup id=&quot;fnref:6&quot;&gt;&lt;a href=&quot;#fn:6&quot; rel=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;的看了一遍。&lt;/p&gt;

&lt;p&gt;好了不跑题了，还是说小说。当时手机可以上网，经常用手机上轻小说论坛看小说。《文学少女》那阵真是让我痴迷上了各种小说了，好多图书馆都没有，当时我是疯狂荐购，图书馆方面的回复倒很简单：&lt;em&gt;不适合本馆收藏&lt;/em&gt;&lt;sup id=&quot;fnref:7&quot;&gt;&lt;a href=&quot;#fn:7&quot; rel=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;总之，那段日子是动漫、小说、甚至还玩过air的游戏交错的日子。很虚空不是？我只是想从那里发现意义，寻找意义。他人的作品改变了我，启发了我。但意义也仅限于此。我放弃动漫小说、文学时，心头一点感觉都没有。&lt;/p&gt;

&lt;p&gt;对了，忘了讲讲科幻小说。在郑州病房的夜晚，看着阿西莫夫的科幻小说打发漫漫长夜，我才知道科幻小说还可以写得这么棒这么有深度。后来去年寒假，看了遍《光明王》，那种宗教和科技交织的奇幻感觉让我激动万分，于是我找来txt版的把它用&lt;em&gt;LaTeX&lt;/em&gt;重新排了一遍。那个时候，又有个东西影响了我。&lt;/p&gt;

&lt;h3 id=&quot;dota&quot;&gt;Dota&lt;/h3&gt;

&lt;p&gt;现在，我旁边的室友还在每日忙着dota。&lt;/p&gt;

&lt;p&gt;这是个迷人的游戏，有几个月很喜欢。我在一个游戏中寻找意义，体悟人生，有很多对现实有启发的思想渐渐影响和融入自我。更重要的，拉近了孤独的自己和很多人的关系，一致多年以来我第一次觉得和好多人有的聊的了。然而，仅此而已。之后遇见的东西，让我走火入魔了，几乎彻底把它扔掉了。&lt;/p&gt;

&lt;h3 id=&quot;ted&quot;&gt;TED&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Ideas worth spreading.&lt;/p&gt;

  &lt;p&gt;TED理念—-&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;TED&lt;a href=&quot;http://www.ted.com/&quot;&gt;1&lt;/a&gt;是什么？Technology、Entertainment、Design，有阵对这个特着迷,它展示了一个新奇的世界，你看到这里还有一群人相信思想的力量，充满热情，相信能通过传播思想和理念改变世界，你会不激动吗？当你身边充满着成天感慨无所事事，生命缺乏激情之时你会不喜欢它吗？那时的TED展示给我很多很棒的理念。TEDxWuxi第一场面向大众的分享会当然要去了，设计学院一个学长关于设计的演讲在我心中埋下了”设计友好”的种子，现在看待很多产品和服务，都要想好多……&lt;/p&gt;

&lt;h3 id=&quot;section-8&quot;&gt;数学建模&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;当然我在大学的时候，还不可能把从前的点点滴滴串连起来，但是当我十年后回顾这一切的时候，真的豁然开朗了。 &lt;/p&gt;

  &lt;p&gt;Steve Jobs—-&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;数学建模对我来说是个阴差阳错的事，如果不是某人这么一晃：我们组队去吧。我绝对不会想着去参加它的，甚至大学两年间从未考虑过数学建模这种事。&lt;/p&gt;

&lt;p&gt;然而晃我的人没有参加，我一个人过去了。&lt;/p&gt;

&lt;p&gt;细节不想多说，黑学校黑这个比赛的也懒得说。总之，从那时开始，人生开始巨变，而这种变化是我的选择，不是身不由己。&lt;/p&gt;

&lt;p&gt;组队时，本来和一个同学说好同队，结果组队时莫名的负了她。慌忙组队之时慌忙组了队，连声抱歉也没说。我觉得自己的一生总是错过了太多道谢和道歉的机会，腼腆的性格也让我无法说出口。&lt;/p&gt;

&lt;p&gt;前面半个月集训很爽，我第一次知道计算机不只是游戏机、影碟机和上网本，第一次发现自己有多强大，从无基础的是写代码越写越high，感觉我们那个房间里那些物联网学院的都没我强大&lt;sup id=&quot;fnref:8&quot;&gt;&lt;a href=&quot;#fn:8&quot; rel=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;。然后也算第一次喜欢上了数学，特别是数据挖掘与数据分析。&lt;/p&gt;

&lt;p&gt;后半个月越来越觉得这比赛是在扯淡，痛苦的感觉一天到晚就做题了什么也学不到。&lt;/p&gt;

&lt;p&gt;然后的比赛是我在大学打的又一次酱油，还不好意思地拉着两名想拿成绩的队友一起酱油了。&lt;/p&gt;

&lt;p&gt;最后比赛那天很抱歉没很给力，把本带去蹭学校的网更新ubuntu了，第二天早上正要忙的时候头晕脑胀的睡着了。&lt;/p&gt;

&lt;h3 id=&quot;gnulinux&quot;&gt;GNU/Linux&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Keep it simple,Stupid.&lt;/p&gt;

  &lt;p&gt;KISS哲学—-&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;数学建模时用了一个叫SAS的统计软件，老师表示买不起。买不起？于是我上网查了查，一年几十万。&lt;/p&gt;

&lt;p&gt;这不是重点，重点在于一种叫R的统计语言走进了我的世界，它带我进入了开源的世界。&lt;/p&gt;

&lt;p&gt;也就这么一阴差阳错，无意瞥见的一种和我从来没什么关系的东西吸引了我的注意力，我想找一个做统计分析的强大软件，而SAS盗版都不安逸。然而R的口碑很好&lt;sup id=&quot;fnref:9&quot;&gt;&lt;a href=&quot;#fn:9&quot; rel=&quot;footnote&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;,据说也很强大，而且开源。嗯？开源是个什么玩意，能吃吗？然后我开始递归的google起来&lt;sup id=&quot;fnref:10&quot;&gt;&lt;a href=&quot;#fn:10&quot; rel=&quot;footnote&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;另外数学建模那阵老见一群飞在天上的大牛们黑word吹&lt;a href=&quot;http://www.latex-project.org/&quot;&gt;LaTeX&lt;/a&gt;，我心说LaTeX是什么？于是也开始了在google的递归搜索。&lt;/p&gt;

&lt;p&gt;结果很简单，先是装了个火狐，感觉不错，又阴差阳错装个YLMF OS&lt;sup id=&quot;fnref:11&quot;&gt;&lt;a href=&quot;#fn:11&quot; rel=&quot;footnote&quot;&gt;11&lt;/a&gt;&lt;/sup&gt;，然后某次本上的XP蓝屏了，我就把windows格了。&lt;/p&gt;

&lt;p&gt;接下来的一年，是折腾的一年。从计算软件到服务器架设，从建站到前端，从排版到图形处理，从文本编辑到设计真是无所不折腾……也渐渐见识了很多领域的东西，没有什么比这个更开阔视野了，人生也从未这么丰富多彩过&lt;sup id=&quot;fnref:12&quot;&gt;&lt;a href=&quot;#fn:12&quot; rel=&quot;footnote&quot;&gt;12&lt;/a&gt;&lt;/sup&gt;。设计、哲学、人性、科技、信仰从未这么复杂的交错起来，才明白世界很大，人生很短&lt;sup id=&quot;fnref:13&quot;&gt;&lt;a href=&quot;#fn:13&quot; rel=&quot;footnote&quot;&gt;13&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;h2 id=&quot;section-9&quot;&gt;然后呢&lt;/h2&gt;

&lt;p&gt;还有一些愿望,这是关于未来的：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;我想去从事并非光科相关的行业，如果身体条件允许的话，我想从事互联网或者数据挖掘的工作&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;全程马拉松，把跑步变成自己的人生习惯之一&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;想学习绘画，图像处理，视觉设计的东西，但并不靠它吃饭&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;想学会弹吉他，因为还有想唱的歌&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;希望将来有空余时间，把那些自己想看的书看完。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;空闲时能参加开源项目，从中体会hack的乐趣&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-10&quot;&gt;我的家&lt;/h2&gt;

&lt;p&gt;随便一想就像收不住的闸，不想了。我不能哭丧着脸回去，人生苦短，我要试着带回去快乐与活力。&lt;/p&gt;

&lt;p&gt;作文一篇，向过去告别，向无锡暂别，我已经&lt;em&gt;21&lt;/em&gt;了。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;当年文理分科违心的选了理科，因为我讨厌考政治和历史，估计按我的风格考那个大学都考不上。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;打酱油？按很多人的标准来说，我大学打的酱油真是数不胜数啊。&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;当时社团团购，整个学校就我一个…… 一直没感谢我当时技术部的部长和当时的会长。&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;因为再后来车丢了，想去也没机会了。不丢也懒得出去了。&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;《人间失格》是最震撼我的小说之一，另一本是加缪的《局外人》&lt;a href=&quot;#fnref:5&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot;&gt;
      &lt;p&gt;很棒的一本书，纯粹的历史书，很少有这么好看的&lt;a href=&quot;#fnref:6&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot;&gt;
      &lt;p&gt;历史的讽刺在于，它后来买了一大堆我荐购过和没荐购过的轻小说&lt;a href=&quot;#fnref:7&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:8&quot;&gt;
      &lt;p&gt;我自大了，见笑。之前虽然开过matlab课，对计算机毫无兴趣的我都在后面打魔兽的……&lt;a href=&quot;#fnref:8&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:9&quot;&gt;
      &lt;p&gt;即使现在在国际也是很流行，搞统计的八成特别学术上的八成用它。前阵看到本12年2月出的新书讲R做数据挖掘的，作者竟然一个是政治学家一个是生物学家，给跪了。&lt;a href=&quot;#fnref:9&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:10&quot;&gt;
      &lt;p&gt;要问我为何不用baidu，我真想不留情面的说那玩意是个垃圾。但鉴于很多人拿他搜盗版搜游戏还凑合，就不黑它了。如果你查的资料是英语居多，或者偏重技术，google基本是唯一的选择。但国内的google一直都不好用，每次搜到东西打不开时或google被重置时，我都想说： &lt;em&gt;fuck gfw&lt;/em&gt; 。&lt;a href=&quot;#fnref:10&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:11&quot;&gt;
      &lt;p&gt;一种国人做的linux系统&lt;a href=&quot;#fnref:11&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:12&quot;&gt;
      &lt;p&gt;副作用是社交基本封闭，与旁人基本没得聊，基本不会接触妹子……以前还会和同学去打打网球什么的，某次受伤后现在只能自己默默跑步了。&lt;a href=&quot;#fnref:12&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:13&quot;&gt;
      &lt;p&gt;请珍惜自己的生命，遵从自己的心。人的生命体验，只有经历过才会明白。就像毛姆《人生的枷锁》中所说：答案只有自己找出才有意义。&lt;a href=&quot;#fnref:13&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>这两天的二逼日子</title>
   <link href="http://reverland.org/test/2012/07/11/"/>
   <updated>2012-07-11T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/test/2012/07/</id>
   <content type="html">
&lt;h1 id=&quot;section&quot;&gt;这几天我都干啥了&lt;/h1&gt;

&lt;p&gt;这几天我都干些啥了呢，在这个幻灯片中，我将做个小结&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn063/20120708/1320/p_large_lamv_658f000005f61261.jpg&quot; alt=&quot;dt的tweak&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-1&quot;&gt;为啥我要宅两天&lt;/h2&gt;

&lt;p&gt;前几天的考研复习那个不亦乐乎，高数终于看了三章不到，概率论终于看了不到三章。我想想怎么着回家前的这几天也得好好学习一阵，可你妹的 &lt;em&gt;我感冒了&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-2&quot;&gt;那卧病寝室这几天在干吗？&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;普通说法叫折腾&lt;/li&gt;
  &lt;li&gt;文艺说法叫hack&lt;/li&gt;
  &lt;li&gt;说得二逼一点我其实就是蛋疼&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-3&quot;&gt;水人人水贴吧水论坛&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;好吧，你之前看到的那个win7 图吧，其实就是我闲的蛋疼用archlinux+kde伪装的，然后到baidu的win8 吧发截图玩&lt;/li&gt;
  &lt;li&gt;貌似人人也没少水&lt;/li&gt;
  &lt;li&gt;貌似论坛也没少去，什么byr啊，jnrain啊，u 坛啊&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;python&quot;&gt;学习python&lt;/h2&gt;

&lt;h3 id=&quot;why-python&quot;&gt;Why python&lt;/h3&gt;

&lt;p&gt;本来是学习sage的，因为看到ustc有个&lt;a href=&quot;http://home.ustc.edu.cn/~wyfyw/iSL/&quot;&gt;创新项目&lt;/a&gt;就是推广这个的。最后发现很多python的东西，于是学python去了。&lt;/p&gt;

&lt;h3 id=&quot;section-4&quot;&gt;折腾大略&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;首先配置vim找到了&lt;a href=&quot;https://github.com/klen/python-mode&quot;&gt;python-mode&lt;/a&gt;,看视频demo很棒，于是折腾了一天，终于能比较方便的使用了，结果是把supertab插件废掉，系统默认python改成2了，x输入法在vim中用不了了，暂时也许永久地用起了神奇的vimim.&lt;/li&gt;
  &lt;li&gt;见byr坛上有连两个帖子热议python,结果是先选了python2&lt;/li&gt;
  &lt;li&gt;看看&lt;a href=&quot;http://woodpecker.org.cn/abyteofpython_cn/chinese/&quot;&gt;python 简明教程&lt;/a&gt;感觉看着很平滑，没有这么挫败感。一口气看到第九章&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;os&quot;&gt;搜集OS娘&lt;/h2&gt;

&lt;p&gt;是的，我好好学习了OS娘的相关知识，并搜集了&lt;a href=&quot;http://photo.renren.com/photo/306127150/album-647659933?curPage=1&quot;&gt;一大堆OS娘的图片&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn065/20120710/1325/p_large_8tXz_2508000054681263.jpg&quot; alt=&quot;OS girl&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-5&quot;&gt;总结一下吧&lt;/h2&gt;

&lt;p&gt;这两天过得及其惨不忍睹，为什么每天跑一个小时步说感冒就感冒？我在电脑前时间太长了吧……所以&lt;em&gt;回家不带电脑&lt;/em&gt;，最好明天也别碰&lt;/p&gt;

&lt;p&gt;这两天过得及其二逼，一早起床坐到电脑前，到晚上念念不舍上床，偶尔吃饭出去下，喝水活动下，上厕所闲逛下……目测旁边忙着dota的和我一样……&lt;/p&gt;

&lt;p&gt;身子更弱了……&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#这段代码测试高亮&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;珍爱生命，远离折腾&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;靠，我该洗洗睡了……&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>land of lisp读书笔记</title>
   <link href="http://reverland.org/lisp/2012/07/09/land-of-lisp"/>
   <updated>2012-07-09T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/07/09/land-of-lisp</id>
   <content type="html">
&lt;h1 id=&quot;happy-hacking&quot;&gt;Happy Hacking&lt;/h1&gt;

&lt;p&gt;我第一次读这本书，便被其浓郁的黑客风格与幽默所吸引，它向我展示了common lisp这门语言强大与趣味的一面。之前从来没有试着度过原版图书，但看到这么可爱一本书，竟然吸引我一边用着取词软件一边用着google翻译给看完了。&lt;/p&gt;

&lt;p&gt;说是看完了，其实有很多地方都是略略而过，与其说我是学习了一遍common lisp，不如说是大致了解了一下它。很多东西像AI，程序设计，算法的东西都是云里雾里，好在作者假设读者什么也不知道，详细而幽默的解说引人入胜，看起来虽然很累但趣味性十足。所以，即使是lisp菜鸟，这本书也是很推荐。&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;说说我学到的：学到了很多优秀而强大的common lisp技术，在有些地方还进行了自己的hack，甚至学到了服务器、http协议、svg和html、博弈算法的一些东西。&lt;/p&gt;

&lt;p&gt;也说说从这本书中衍生的新想法：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;lisp做web应用还是蛮好的，正好弥补lisp缺乏图形界面库的短版，&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;common lisp强大但复杂，也许scheme才是我心仪的语言&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;语言障碍仍然是个很大的问题，要好好学习英语这门世界性语言。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;将我4月26日至7月7日的读书笔记集合在这里,虽然水平很烂但斗胆放在这里，希望对他人有帮助&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;a href=&quot;http://reverland.org/tags.html#land-of-lisp-ref&quot;&gt;land of lisp读书笔记&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;忽然发现这个还在草稿里……&lt;/p&gt;

&lt;p&gt;2012年09月22日 星期六 13时26分44秒&lt;/p&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;好像此书就是为了初学者设计的……&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;对一个信奉KISS原则的人尤其如此想，特别是崇尚极简主义的人呢&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>Dice of Doom v4</title>
   <link href="http://reverland.org/lisp/2012/07/07/dice-of-doom-v4"/>
   <updated>2012-07-07T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/07/07/dice-of-doom-v4</id>
   <content type="html">
&lt;h1 id=&quot;dice-of-doom&quot;&gt;最终版的Dice of Doom&lt;/h1&gt;

&lt;p&gt;这个游戏终于结束了，基本上这本书的主要内容也算看完了。实际上，我根本就写不出这些东西，源码也读的云里雾里。但这是一本很有趣的书，我想看完htdp之后用htdp推荐风格重新处理下这本书的代码，顺便也复习一下。&lt;/p&gt;

&lt;h2 id=&quot;dice-of-doom-&quot;&gt;让Dice of Doom 更加的有趣&lt;/h2&gt;

&lt;p&gt;我们上回完成的版本虽然很棒，但总缺乏些什么。因为之前程序的设计，我们可以很轻易的扩展它，让它变得更有趣&lt;/p&gt;

&lt;p&gt;先加载我们之前的游戏&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dice-v3&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section&quot;&gt;增加玩家数&lt;/h3&gt;

&lt;p&gt;因为我们之前的架构，增加玩家数很简单。为了增加玩家数后计算机能反应敏捷，让它变“傻”一点。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*num-players*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*die-colors*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-dice*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*ai-level*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-1&quot;&gt;建立概率节点&lt;/h3&gt;

&lt;p&gt;我们本质上是向游戏树中加入几率节点，先升级attacking-moves函数，增加个board-attack-fail分支。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;attacking-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-attack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                                             &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;
                                                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                                             &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-attack-fail&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                                             &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;
                                                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                                             &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt;
                                  &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;board-attack-fail函数遍历所有位置。如果这个位置是攻击方就只能留下一个骰子&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board-attack-fail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                     &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;across&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;
                     &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-2&quot;&gt;让骰子滚动起来&lt;/h3&gt;

&lt;p&gt;一下程序让一堆骰子滚动起来，并判断谁赢了&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;rolling the dice&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;roll-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice-num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;total&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dice-num&lt;/span&gt;
                     &lt;span class=&quot;nv&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;On ~a dice rolled ~a. &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dice-num&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;total&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;total&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;roll-against&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;src-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;roll-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;roll-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我们还需要在游戏引擎中调用让骰子滚动的代码,选出正确的子树&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pick-chance-branch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;roll-against&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;更新handle-computer函数让它调用选择几率分支的函数&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;choose your move:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a. &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a -&amp;gt; ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;end turn&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-chance-branch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;同样我们可以处理handle-computer函数&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*ai-level*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-chance-branch&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;ai&quot;&gt;升级AI&lt;/h3&gt;

&lt;p&gt;但现在还有个问题，AI还没有考虑骰子的滚动，依然认为骰子多的一定获胜。因此需要更新AI。&lt;/p&gt;

&lt;p&gt;根据概率论原理，我们可以得到这样一个矩阵来表征攻击成功的概率&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;防守方\攻击方&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;2&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;3&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;4&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;5&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.84&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.97&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1.0&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.44&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.78&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.94&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.99&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.15&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.45&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.74&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.91&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.04&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.19&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.46&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.72&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.01&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.06&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.22&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;0.46&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;现在把这个概率交给计算机，更新get-ratings函数,给评分加权&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take-all&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;odds&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dice-odds*&lt;/span&gt;
                                                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;odds&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;odds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                          &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;为了让修剪游戏树的函数能工作，还需要做些修改让它能处理新的游戏树。同时为了简化不再使用alpha-beta算法。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;We mapcar across the tail of each move, so trimming is performed on&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;both branches of any chance nodes.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-3&quot;&gt;改进增援方案&lt;/h3&gt;

&lt;p&gt;之前是依据消灭敌人多少来决定增援骰子数。现在我们换一种方法：依据占据的最大领地来决定增援多少。这使游戏的地缘性更加复杂。&lt;/p&gt;

&lt;p&gt;回想我们之前在&lt;a href=&quot;http://reverland.org/Tech/2012/05/01/grand-theft-wumpus/&quot;&gt;wumpus游戏&lt;/a&gt;里写过的相似函数&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-connected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;check-pos&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;check-neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;check-neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;check-neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;check-pos&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;check-pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;获得最大的集群,最后添加援军，注意，spare-dice仍然作为参数传递但已经不再被add-new-dice使用了。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;largest-cluster-size&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cluster&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-connected&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cluster&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cluster&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-new-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cur-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-dice&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-dice*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;largest-cluster-size&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;享受你的劳动成果吧&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;serve&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dod-request-handleer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-4&quot;&gt;疑问&lt;/h2&gt;

&lt;p&gt;我发现我可以选中任何自己的领地，只要上面的骰子数大于2。我可以攻击任何强大的敌人，而且一定能成功。不知道哪里的更改或错误！！&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;对从官网下载的源码和书中的源码可能需要修改，具体参见前几篇读书笔记。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>概率论与数理统计基础</title>
   <link href="http://reverland.org/math/2012/07/05/"/>
   <updated>2012-07-05T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/math/2012/07/</id>
   <content type="html">
&lt;h1 id=&quot;section&quot;&gt;概率论与数理统计基础&lt;/h1&gt;

&lt;h2 id=&quot;section-1&quot;&gt;为什么有了这篇文章&lt;/h2&gt;

&lt;p&gt;按以往的风格，大概是我想做什么所以就做了什么。但这次不太一样，首先是代人上数学实验课，matlab搞得我云里雾里，一年前深以为然并给我很大影响的东西都忘到九霄云外了，老师布置个聚类分析的练习一点都不会，完全不知怎么下手。其次加上忙着准备考研，无心折腾这折腾那，虽然很有意思……，再次网上看到满天的牛，飞过来飞过去，那个自惭形晦。好了，我胡言乱语，莫深究什么意思。&lt;/p&gt;

&lt;p&gt;想想一年了，在各个领域摸爬滚打之后发现自己一无是处，收获在哪里？只能说开阔了视野，告诉自己很多东西我曾经也知道过，思考过，选择过。&lt;/p&gt;

&lt;p&gt;下午看了看概率论与统计，想到自己当初拿着好几本讲R的书学习的日子，现在连个痕迹都没有留下，数学建模学到的东西也忘的精光，唉，先看看基础吧。然后回到寝室，忽然就想试试sagemath和markdown……&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;概率论基本概念&lt;/h2&gt;

&lt;p&gt;先来个全概率公式：
     设实验E的样本空间为S，A为E的事件，$B_1,\cdots,B_n $为S的一个划分，且 $P(B_i) &amp;gt; 0 (i = 1,2,\cdots,n)$,则&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
P(A)=\sum_{i=1}^n P(A \vert B_i)P(B_i)
&lt;/script&gt;

&lt;p&gt;再来个贝叶斯公式：&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
P(B_i \vert A) = \frac{P(A \vert B_i)P(B_i)}{\sum_{j=1}^n P(A|B_j)P(B_j)} , i=1,2,\cdots ,n.
&lt;/script&gt;

&lt;p&gt;A,B,C三个事件相互独立&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\begin{equation*}
\left.
\begin{array}{l}
P(AB)=P(A)P(B) \\
P(BC)=P(B)P(C) \\
P(AC)=P(A)P(C) \\
P(ABC)=P(A)P(B)P(C)
\end{array}
\right\}
\end{equation*}
&lt;/script&gt;

&lt;h2 id=&quot;section-3&quot;&gt;离散随机变量常见分布&lt;/h2&gt;

&lt;p&gt;先来个(0-1)分布&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;X&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;0&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;1&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;$P_k$&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1-p&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;p&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;二项分布,记为$X \sim b(n,p)$&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
P{X=k}=\binom{n}{k}p^kq^{n-k},k=0,1,2,\cdots,n.
&lt;/script&gt;

&lt;p&gt;泊松分布,记做$X \sim \pi(\lambda)$&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
P{X = k}=\frac{\lambda^ke^{-\lambda}}{k!},k=0,1,2,\cdots,
&lt;/script&gt;

&lt;p&gt;泊松定理&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\lim\limits_{n\to \infty} \binom{n}{k}p_n^k(1-p_n)^{n-k} = \frac{\lambda^ke^{-\lambda}}{k!}
&lt;/script&gt;

&lt;h2 id=&quot;section-4&quot;&gt;三种连续型随机变量&lt;/h2&gt;

&lt;h3 id=&quot;section-5&quot;&gt;均匀分布&lt;/h3&gt;

&lt;p&gt;概率密度函数，图中取$b=2,a=1$。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

\begin{equation}
f(x)=\left\{
\begin{array}{l}
\frac{1}{b-a},a &lt; x &lt; b \\
0, else
\end{array}
\right.
\end{equation}
 %]]&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrfmn.com/fmn058/20120705/2310/p_large_Wt1C_4925000043391261.jpg&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;均匀分布概率密度&quot; /&gt;&lt;/p&gt;

&lt;p&gt;其分布函数为&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

\begin{equation}
F(x)=\left\{
\begin{array}{l}
0,  x&lt;a \\
\frac{x-a}{b-a}, a \leq x &lt; b \\
1, x \geq b
\end{array}
\right.
\end{equation}
 %]]&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn059/20120705/2310/p_large_DfWR_4925000043381261.jpg&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;均匀分布分布函数&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-6&quot;&gt;指数分布&lt;/h2&gt;

&lt;p&gt;概率分布函数，图像中红、蓝、绿三种颜色曲线分别是$\theta$取0.5、1、2时所绘制。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\begin{equation}
f(x)=\left\{
\begin{array}{l}
\frac{1}{\theta}e^{-\frac{x}{\theta}}, x &gt; 0,\\
0, else,
\end{array}
\right.
\end{equation}
&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn056/20120705/2310/p_large_sWxZ_49250000433a1261.jpg&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;指数分布概率密度&quot; /&gt;&lt;/p&gt;

&lt;p&gt;分布函数&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
\begin{equation}
F(x)=\left\{
\begin{array}{l}
1-e^{-\frac{x}{\theta}}, x &gt; 0,\\
0, else,
\end{array}
\right.
\end{equation}
&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrfmn.com/fmn058/20120705/2310/p_large_KHxd_49250000433b1261.jpg&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;指数函数分布函数&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-7&quot;&gt;正态分布&lt;/h2&gt;

&lt;p&gt;概率密度函数,图中$\mu$为0,红、蓝、绿三种颜色图像分别取$\sigma=0.5,1,2$。&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[

f(x)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^2}{2\sigma^2}},-\infty &lt; x &lt;\infty
 %]]&gt;&lt;/script&gt;

&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn059/20120705/2310/p_large_PZvg_49250000433c1261.jpg&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;正态分布概率密度函数&quot; /&gt;&lt;/p&gt;

&lt;p&gt;分布函数&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
F(x)=\frac{1}{\sqrt{2\pi}\sigma}\int_{-\infty}^x e^{-\frac{(x-\mu)^2}{2\sigma^2}} dt
&lt;/script&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-8&quot;&gt;后记&lt;/h2&gt;

&lt;p&gt;markdown+mathjax不是一般蛋疼啊……，&lt;code&gt;\$B_i,B_j\$&lt;/code&gt;总把&lt;code&gt;i,B&lt;/code&gt;给强调了，让它以代码形式mathjax又不解析了……最近看不进英文的文档了，mathjax的文档胡乱翻了半天什么也没记住……&lt;/p&gt;

&lt;p&gt;textile倒好，可没想到出现更奇葩的&lt;code&gt;P(C)&lt;/code&gt;竟然解析成P © ……&lt;code&gt;= =&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;总之，I hate math，以后再也不自己瞎折腾了……&lt;/p&gt;

&lt;h2 id=&quot;changelog&quot;&gt;Changelog&lt;/h2&gt;

&lt;h3 id=&quot;section-9&quot;&gt;2012年07月06日 星期五 08时18分46秒&lt;/h3&gt;

&lt;p&gt;早上爬起来看看mathjax文档，然后试试发现昨天的奇葩问题消失了……懒得折腾的孩子们参考这里处理：&lt;a href=&quot;http://doswa.com/2011/07/20/mathjax-in-markdown.html&quot;&gt;MathJax in Markdown&lt;/a&gt;,想折腾的可以去折腾什么pandoc&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;的……&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;表格做的好难看……有空再改吧&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;据说是haskell写的&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>基于web的Dice of Doom</title>
   <link href="http://reverland.org/lisp/2012/07/02/webdice-of-doom"/>
   <updated>2012-07-02T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/07/02/webdice-of-doom</id>
   <content type="html">&lt;h1&gt;基于web的Dice of Doom游戏&lt;/h1&gt;
&lt;p&gt;眼看最后两章了,虽然AI那里云山雾罩,然而看到web又精神为之一震,真是看得高潮迭起啊。作者也很给力，直接用html5来编写web应用，把svg直接嵌入到html中。可惜作者用的是firefox3.7 alpha，为了在我的archlinux x86_64的firefox12上运行良好，还是多废了些心机。这章看着很爽。&lt;/p&gt;
&lt;h2&gt;绘制游戏元素&lt;/h2&gt;
&lt;p&gt;毋庸置疑，所有游戏界面要用svg画出来，于是我们之前写得 &lt;a href=&quot;/lisp/2012/06/16/dsl/&quot;&gt;svg库&lt;/a&gt; 要派上用场了。什么？已经没有了？那么从该书主页上下载 &lt;a href=&quot;http://landoflisp.com/source.html&quot;&gt;svg.lisp&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;由于要创建个基于web的应用程序，之前的 &lt;a href=&quot;/lisp/2012/05/12/web-server-written-in-lisp/&quot;&gt;webserver&lt;/a&gt; 也需要加载。&lt;/p&gt;
&lt;p&gt;当然还有我们的游戏新引擎 &lt;a href=&quot;/lisp/2012/06/29/dice-of-doom-v2/&quot;&gt;Dice of Doom v2&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~/Documents/lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dice_of_doom_v2&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;webserver&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;svg.lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后需要先设定一些常数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-width*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;900&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;面板宽度&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-height*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;面板高度&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-scale*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;面板缩放比例&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*top-offset*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;两摞起来的骰子相对位移&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dice-scale*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;骰子缩放比例&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dot-size*&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;骰子上点的大小&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;接下来画骰子&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-die-svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;calc-pt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dice-scale*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dice-scale*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pol&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;polygon&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;calc-pt&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-0.6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-0.6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-0.6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.75&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.6&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;polygon&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;calc-pt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dot-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dot-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
                             &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                             &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                     &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-0.05&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.125&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.3&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.3&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.125&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.05&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.45&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.45&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.45&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;-0.875&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.80&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.725&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.775&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.70&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.625&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.35&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.05&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.45&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.15&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.45&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.05&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(with-open-file (*standard-output* &amp;quot;die.svg&amp;quot; :direction :output :if-exists :supersede) (svg 100 100 (draw-die-svg 50 50 &amp;#39;(255 0 0)))) &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;再画一小块面板&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-tile-svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen-tile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;polygon&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-scale*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-scale*&lt;/span&gt;
                                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;-0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eql&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen-tile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;second&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-die-svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dice-scale*&lt;/span&gt;
                               &lt;span class=&quot;mf&quot;&gt;0.3&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;oddp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                 &lt;span class=&quot;mf&quot;&gt;-0.3&lt;/span&gt;
                                 &lt;span class=&quot;mf&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*dice-scale*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;(with-open-file (*standard-output* &amp;quot;tile.svg&amp;quot; :direction :output) (svg 300 300 (draw-tile-svg 0 0 0 &amp;#39;(0 3) 100 150 &amp;#39;(255 0 0) nil)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;接下来是整个面板&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Draw the Board&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*die-colors*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-board-svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen-tile&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;legal-tiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-scale*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-scale*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*top-offset*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*die-colors*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-15&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;legal-tiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;xlink:href&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-game-link&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-tile-svg&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen-tile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-tile-svg&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xx&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen-tile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;make-game-link&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/game.html?chosen=~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(with-open-file (*standard-output* &amp;quot;board.svg&amp;quot; :direction :output :if-exists :supersede) (svg *board-width* *board-height* (draw-board-svg (gen-board) nil nil)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这有个问题，之前我们svg宏不是像上文中那样定义的，svg宏需要稍加修改，具体参见本书的 &lt;a href=&quot;http://landoflisp.com/errata.html&quot;&gt;errata&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;建立Web服务器&lt;/h2&gt;
&lt;p&gt;先写游戏的驱动&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;初始化当前游戏树&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;选择的一片面板&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dod-request-handler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;game.html&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;                  &amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;                  &amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;center&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Welcome to DICE OF DOOM!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;br&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chosen&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;chosen&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;web-initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;web-announce-winner&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;web-handle-human&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-from-string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chosen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;web-handle-computer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;br&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-dod-page&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; 
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Sorry... I don&amp;#39;t know that page.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;在这里我稍作修改，更改了服务器返回给浏览器的信息，使它更加符合标准能在firefox12中运行正常。&lt;/p&gt;
&lt;p&gt;我们只做了一个超级简化的服务器，功能弱爆了，但作者许诺能在最后一章很轻易的扩展。之后我们处理些基于webserver的函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;web-initialize&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gen-board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;宣布胜者web version&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;web-announce-winner&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;winners&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The game is a tie between ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-letter&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The winner is ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-letter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;href&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;game.html&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; play again&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;处理人类玩家&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;web-handle-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Please choose a hex to move from:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;pass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Your reinforcements have been placed.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;href&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-game-link&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;continue&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Now choose a destination:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Move cancelled.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-find-if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*from-tile*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You may now &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;href&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-game-link&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;pass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;pass&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; or make another move:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;处理计算机玩家&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;web-handle-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cur-game-tree*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The computer has moved. &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;&amp;quot;window.setTimeout(&amp;#39;window.location=\&amp;quot;game.html?chosen=NIL\&amp;quot;&amp;#39;,3000)&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;javascript，改成3秒了，感觉5秒在我这里太慢了&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后在html中绘制svg游戏面板时有些tweak，首先是svg，你遵照之前errata提到的修正svg宏后才能正常显示，否则只显示一小块或完全看不到时可别吃惊。另外是作者定义两次点击同一片游戏面板代表取消，但它的legal-tile（合法面板）中却没有包含本身，以致于不能正常取消选中。我做了如下修改，把当前选中的游戏面板添加进合法面板中。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;caXXXXXXXdr……以后我要用firstsecond改写&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-dod-page&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;selected-tile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-width*&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;svg要更改！！&lt;/span&gt;
       &lt;span class=&quot;vg&quot;&gt;*board-height*&lt;/span&gt; 
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-board-svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;nv&quot;&gt;selected-tile&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;selected-tile&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;what I add &lt;/span&gt;
                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take-all&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;selected-tile&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eql&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                  &lt;span class=&quot;nv&quot;&gt;selected-tile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后很显然，enjoy我们基于网络的游戏吧&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;serve&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dod-request-handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;hr /&gt;
&lt;h2&gt;游戏截图&lt;/h2&gt;
&lt;p&gt;截个图看看效果&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://fmn.rrimg.com/fmn064/20120702/1345/p_large_vHyz_01a000007c271262.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Dice of Doom v2</title>
   <link href="http://reverland.org/lisp/2012/06/29/dice-of-doom-v2"/>
   <updated>2012-06-29T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/29/dice-of-doom-v2</id>
   <content type="html">&lt;h1&gt;Dice of Doom v2&lt;/h1&gt;
&lt;p&gt;我已经不怎么看得懂在讲什么了，所以胡言乱语请见谅,有几个问题:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;记不起之前的游戏树什么样了，我又懒得回头去看。是不是某种决策树？&lt;/li&gt;
	&lt;li&gt;不停的函数接着函数扩展看起来很方便，但又要求你时刻记得之前实现的细节，以实现正确的改进&lt;/li&gt;
	&lt;li&gt;作者的编程风格，以后还是按htdp里说的玩去吧，起码不会像现在这样晕。&lt;/li&gt;
	&lt;li&gt;英语还是障碍啊，有时候看完一大段文字后不知道在讲什么，囧了。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Dice of Doom v2&lt;/h2&gt;
&lt;p&gt;首先加载之前我们完成的 &lt;a href=&quot;/lisp/2012/05/23/dice-of-doom/&quot;&gt;Dice of Doom&lt;/a&gt; 源码和为惰性求值所实现的一系列库文件。没有的话就从land of lisp网站上下载吧，话说这本书真贵要40刀左右，豆瓣上竟然380元人民币……&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dice_of_doom_v1.lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;lazy.lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后先把游戏board扩大到4x4。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;下面把Dice of Doom游戏全面lazy化吧&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-passing-move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;first-move&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;first-move&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-new-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
                                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*num-players*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                                &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;attacking-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-attack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;
                                                       &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;
                                                       &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;
                                                       &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;
                                                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;
                                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                         &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt;
                       &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;注意lazy-mapcan要求被创建的列表是惰性的，现在你知道htdp标明每个函数输入输出的习惯多好了吧……&lt;/p&gt;
&lt;p&gt;lazy化handle-human函数和play-vs-human函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;choose your move:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a. &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a -&amp;gt; ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;end turn&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;play-vs-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-info&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;announce-winner&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在你可以试试人人对战了，速度不错。&lt;/p&gt;
&lt;h2&gt;让AI运行在更大的游戏区域&lt;/h2&gt;
&lt;p&gt;对AI的惰性化之前，我们先做一些修剪的工作，这是对AI决策树/游戏树算法的优化&lt;sup class=&quot;footnote&quot; id=&quot;fnr1&quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;
&lt;p&gt;我们现在的AI很尽职尽责的搜索计算所有的可能的结果。但在大的游戏面板中这样很累，为了在效率上取得平衡，限制AI的考虑决策树深度&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*ai-level*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*ai-level*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-info&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;announce-winner&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;我没看懂……已经深深迷失在car cadr caddr的海洋之中，总之它限制了AI的思考深度，让它把评分限制在4步之内。&lt;sup class=&quot;footnote&quot; id=&quot;fnr2&quot;&gt;&lt;a href=&quot;#fn2&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;h3&gt;启发算法&lt;sup class=&quot;footnote&quot; id=&quot;fnr3&quot;&gt;&lt;a href=&quot;#fn3&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;
&lt;p&gt;让AI只思考较少的深度来实现投入和产出的统一。&lt;/p&gt;
&lt;p&gt;让我们用更复杂的启发算法来重新对游戏面板评分:对一个自己的地盘，如果附近有比自己强大的敌人则评分1,否则则评分2。若该地盘属于对手则评分为-1&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;score-board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;across&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;threatened&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;附近有更多骰子的位置有威胁&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;threatened&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nhex&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nplayer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nhex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ndice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nhex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nplayer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ndice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;有意思的是，关于启发式作者这么说：在开发这个例子时，我模拟了使用不同版本score-board的各种对手，这个版本效果很好，开发启发式算法不是什么科学。囧～&lt;/p&gt;
&lt;p&gt;惰性化get-ratings和rate-position函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take-all&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;
               &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;score-board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在可以试试和计算机过招了。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gen-board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;据说先行者有优势，计算机大概有3/4的几率获胜。&lt;/p&gt;
&lt;h3&gt;alpha-beta 算法&lt;sup class=&quot;footnote&quot; id=&quot;fnr4&quot;&gt;&lt;a href=&quot;#fn4&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;
&lt;code&gt;此部分不只所云，请见谅。&lt;/code&gt;
&lt;p&gt;AI实际上执行一种深度优先搜索。&lt;/p&gt;
&lt;p&gt;alpha-beta算法是把已知的一定更差的子树从决策树中剪掉的算法，熟称剪枝算法。&lt;/p&gt;
&lt;p&gt;本游戏中游戏树的顶端上是最大最小算法，非顶端上是score-board评分……&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ab-get-ratings-max&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ab-rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ab-get-ratings-min&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ab-rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ab-rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ab-get-ratings-max&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ab-get-ratings-min&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;upper-limit&lt;/span&gt;
                                         &lt;span class=&quot;nv&quot;&gt;lower-limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;score-board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这三个函数怎么实现及实现什么……不知道，深感自己英语不行啊，大段大段看完不知道在讲什么，哪天有兴致了对照对弈程序基本技术再看吧……I am confused now.&lt;sup class=&quot;footnote&quot; id=&quot;fnr6&quot;&gt;&lt;a href=&quot;#fn6&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;改进我们的handle-computer函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ab-get-ratings-max&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;limit-tree-depth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*ai-level*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                     &lt;span class=&quot;nv&quot;&gt;most-positive-fixnum&lt;/span&gt;
                                     &lt;span class=&quot;nv&quot;&gt;most-negative-fixnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在把游戏面板扩大到5x5&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;由于我们记忆化的原因，之前的4x4面板会被缓存。为了修正这个问题重新定义neighbors函数即可。&lt;/p&gt;
&lt;p&gt;实验新的经过改进的游戏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gen-board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;小结&lt;/h2&gt;
&lt;p&gt;本章我们使用惰性求值方法改进我们的游戏，同时通过一些优化限制AI引擎搜索的决策树数目，我们学到了以下几点：&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;惰性列表使你有可能使用无穷的列表和数据结构，并且很有效率&lt;/li&gt;
	&lt;li&gt;一旦你有了lazy宏和force函数，你就可以基于此创造更复杂的惰性列表库&lt;/li&gt;
	&lt;li&gt;启发性算法是不完美的算法，通过一些创造性的想法可以显著提高代码的性能。在我们的例子中我们使用启发式的算法来为游戏树的顶端评分。&lt;/li&gt;
	&lt;li&gt;一旦我们把游戏转化为惰性树，为了限制AI思考的移动的深度我们可以优雅地&lt;sup class=&quot;footnote&quot; id=&quot;fnr5&quot;&gt;&lt;a href=&quot;#fn5&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;修剪游戏树。&lt;/li&gt;
	&lt;li&gt;Alpha-beta算法让我们更多地优化了性能，通过修剪不会影响AI最后所思考的移动的评分。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn1&quot;&gt;&lt;a href=&quot;#fnr1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; 我胡扯的，个人理解。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn2&quot;&gt;&lt;a href=&quot;#fnr2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; Note在讲什么我也不知道，只知道作者说这个虽然做的不够精细，但已经足够优化了。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn3&quot;&gt;&lt;a href=&quot;#fnr3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; 参见 &lt;a href=&quot;http://en.wikipedia.org/wiki/Heuristic_(computer_science)&quot; title=&quot;computer_science&quot;&gt;http://en.wikipedia.org/wiki/Heuristic_&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn4&quot;&gt;&lt;a href=&quot;#fnr4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt; 参见 &lt;a href=&quot;http://en.wikipedia.org/wiki/Alpha-beta_pruning&quot;&gt;http://en.wikipedia.org/wiki/Alpha-beta_pruning&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn5&quot;&gt;&lt;a href=&quot;#fnr5&quot;&gt;&lt;sup&gt;5&lt;/sup&gt;&lt;/a&gt; 编写新的函数，看上去很优雅……&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn6&quot;&gt;&lt;a href=&quot;#fnr6&quot;&gt;&lt;sup&gt;6&lt;/sup&gt;&lt;/a&gt; 可以先看看 &lt;a href=&quot;http://www.xqbase.com/computer/search_alphabeta.htm&quot;&gt;alpha-beta剪枝算法&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;废话&lt;/h2&gt;
&lt;p&gt;说实话，看不懂了，愈发的看不懂。生命中某种虚空感强烈的袭来，明知自己做的是“没有意义”，也没有人在意的的东西，可我就是关心那些。&lt;/p&gt;
&lt;p&gt;有时候真是不想理人，与很多人不怎么谈得来，我不喜欢到头来毫无建树的胡扯，也不喜欢扯不喜欢的东西。可有时无话可说无人可诉，人与人的差别就是这么大，不知何时。&lt;/p&gt;
&lt;p&gt;有时侯如此疯狂，讨厌别人的干扰，不能容忍自己浪费生命。在他人眼里我不也是在浪费生命？我不知道，安慰我的人永远安慰我，另一个部分人永远看不起我。&lt;/p&gt;
&lt;p&gt;我应该追求哪个世界与人生？一边是迷人的，我不知道余生还有多长，不想放手错过它，但它只在我的梦中。一条在横亘在这个世界，我却没有一丝爱意。&lt;/p&gt;
&lt;p&gt;也许一切都是宿命。&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Google glasses</title>
   <link href="http://reverland.org/others/2012/06/28/google-glasses"/>
   <updated>2012-06-28T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/others/2012/06/28/google-glasses</id>
   <content type="html">&lt;p&gt;最近耳闻google I/O大会，看到个消息： &lt;a href=&quot;http://www.guao.hk/posts/google-glass-pre-order.html&quot;&gt;开发版 Google 眼镜开始接受限量预定，1500 刀超高价格明年年初发货&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;然后随便上网查查，奇怪为啥这么多人吹捧。&lt;/p&gt;
&lt;p&gt;先看看google的宣传片吧，有种未来触手可及的感觉。下一步就该把眼镜和人的视觉系统整合了吧，攻壳机动队全义体化的假想要实现了么？&lt;/p&gt;
&lt;p&gt;&lt;embed src=&quot;http://player.youku.com/player.php/sid/XMzc2MzY0ODQ4/v.swf&quot; allowFullScreen=&quot;true&quot; quality=&quot;high&quot; width=&quot;480&quot; height=&quot;400&quot; align=&quot;middle&quot; allowScriptAccess=&quot;always&quot; type=&quot;application/x-shockwave-flash&quot;&gt;&lt;/embed&gt;&lt;/p&gt;
&lt;p&gt;还有个国内吐槽版：&lt;/p&gt;
&lt;p&gt;&lt;embed src=&quot;http://player.youku.com/player.php/sid/XMzgxNzY5OTcy/v.swf&quot; allowFullScreen=&quot;true&quot; quality=&quot;high&quot; width=&quot;480&quot; height=&quot;400&quot; align=&quot;middle&quot; allowScriptAccess=&quot;always&quot; type=&quot;application/x-shockwave-flash&quot;&gt;&lt;/embed&gt;&lt;/p&gt;
&lt;p&gt;真欢乐……&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>Common lisp菜鸟指南(译)</title>
   <link href="http://reverland.org/lisp/2012/06/26/common-lisp"/>
   <updated>2012-06-26T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/26/common-lisp</id>
   <content type="html">&lt;h1&gt;Common Lisp菜鸟指南&lt;/h1&gt;
&lt;p&gt;翻译自:&lt;a href=&quot;http://ghostopera.org/blog/2012/06/24/the-newbie-guide-to-common-lisp/&quot;&gt;http://ghostopera.org/blog/2012/06/24/the-newbie-guide-to-common-lisp/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;进入Common Lisp的世界可能非常让人退缩，甚至对有经验的程序猿也是这样。这个语言兼有力与美，但也有许多清晰的边界和没有真正被普遍理解的开端。&lt;/p&gt;
&lt;p&gt;这个指南可能将持续一段时间，但是希望它将使踏入Common Lisp的任务变得不那么可怕。&lt;/p&gt;
&lt;h2&gt;理解Common Lisp&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://labs.ariel-networks.com/cl-style-guide.html&quot;&gt;Ariel Networks&lt;/a&gt; 有个适当形式的 Common Lisp 指南。&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;http://www.lispworks.com/documentation/HyperSpec/Front/index.htm&quot;&gt;HyperSpec&lt;/a&gt; 有完整的 Common Lisp 文档。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://clqr.boundp.org/&quot;&gt;&lt;span class=&quot;caps&quot;&gt;CLQR&lt;/span&gt;&lt;/a&gt; 是一个好的课下载的 Common Lisp 快速参考手册。&lt;/p&gt;
&lt;h2&gt;了解你的工具&lt;/h2&gt;
&lt;h3&gt;Emacs&lt;sup class=&quot;footnote&quot; id=&quot;fnr1&quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.gnu.org/software/emacs/&quot;&gt;Emacs&lt;/a&gt; 是一个可实用lisp高度定制的编辑器&lt;sup class=&quot;footnote&quot; id=&quot;fnr2&quot;&gt;&lt;a href=&quot;#fn2&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。它可以为lisp提供一个非常独特的实时开发流程。查看 &lt;a href=&quot;http://dto.github.com/notebook/&quot;&gt;David O&amp;#8217;Toole&lt;/a&gt; 在通过Emacs和他的 &amp;#8220;Blocky.io&amp;#8221; 游戏开发系统在一个游戏中的 &lt;a href=&quot;http://blocky.io/blocky-lightning-talk-4.ogv&quot;&gt;lightning talk&lt;/a&gt; ，来查看实时开发实例。很酷不是吗？&lt;/p&gt;
&lt;h3&gt;Steel Bank Common Lisp&lt;/h3&gt;
&lt;p&gt;当这世界上有很多可用的 Common Lisp 实现时，&amp;quot;SBCL&amp;quot;:sbcl 是非常标准的实现。它很积极的被开发着，有适合的调试器、原生线程、多平台支持。&lt;/p&gt;
&lt;h3&gt;Quicklisp&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.quicklisp.org/&quot;&gt;Quicklisp&lt;/a&gt; 使得从一套丰富的由社区发展的 Common Lisp 库开始变得更容易。它允许你仅仅通过几个简单命令下载、安装和加载任何700多库中的库。它完全取代了它的前任asdf-install,如果你熟悉RubyGems，这非常相似。&lt;/p&gt;
&lt;h3&gt;CL-Project&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/fukamachi/cl-project&quot;&gt;CL-Project&lt;/a&gt; 是白手起家一个新的 Common Lisp 项目的最佳现代方法。虽然它肯定不是必须的，但是它提供了一个创建新项目的合理起点。&lt;/p&gt;
&lt;h3&gt;Buildapp&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.xach.com/lisp/buildapp/&quot;&gt;Buildapp&lt;/a&gt; 使得创建SBCL的可执行文件更加方便&lt;/p&gt;
&lt;h3&gt;&lt;span class=&quot;caps&quot;&gt;ASDF&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;http://www.xach.com/lisp/buildapp/&quot;&gt;&lt;span class=&quot;caps&quot;&gt;ASDF&lt;/span&gt;&lt;/a&gt; 允许你定义你的项目的结构和依赖。你可以把它当作Ruby世界中Rake和Gemfile的杂交。&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;创建你的第一个应用程序&lt;/h2&gt;
&lt;p&gt;我将把获取Emacs和SBCL的任务留给你自己，你可以找到所有Linux、Windows和MacOS的版本。&lt;/p&gt;
&lt;h3&gt;安装Quicklisp和SLIME&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl -O http://beta.quicklisp.org/quicklisp.lisp
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sbcl --load quicklisp.lisp
This is SBCL 1.0.42.52, an implementation of ANSI Common Lisp.
More information about SBCL is available at &amp;lt;http://www.sbcl.org/&amp;gt;.

SBCL is free software, provided as is, with absolutely no warranty.
It is mostly in the public domain; some portions are provided under
BSD-style licenses.  See the CREDITS and COPYING files in the
distribution &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;more information.

  &lt;span class=&quot;o&quot;&gt;====&lt;/span&gt; quicklisp quickstart &lt;span class=&quot;nv&quot;&gt;loaded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;====&lt;/span&gt;

    To &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;, evaluate: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;quicklisp-quickstart:install&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quicklisp-quickstart:install&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ql:add-to-init-file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ql:quickload&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;quicklisp-slime-helper&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h3&gt;创建应用程序&lt;/h3&gt;
&lt;p&gt;载入Emacs并键入&lt;esc&gt; x slime &lt;enter&gt;。你现在应该可以看到REPL——一个交互的lisp提示符。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ql:quickload&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;cl-project&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cl-project:make-project&lt;/span&gt; &lt;span class=&quot;l-Other&quot;&gt;#p&amp;quot;myapp&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:author&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Your name&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:email&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;your@email.com&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;ss&quot;&gt;:license&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;BSD or whatever&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ql:quickload&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;myapp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;in-package&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:myapp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在在Emacs有scratch标签的窗口键入&lt;esc&gt; x cd &lt;enter&gt; myapp &lt;enter&gt; 紧接着输入 &lt;control&gt;x &lt;control&gt;f src/myapp.lisp &lt;enter&gt; 。你应该拥有了一个为准备极棒的编码新建立的myapp.lisp文件。&lt;/p&gt;
&lt;p&gt;让我们继续添加一些东西然后试试结果&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hello-world&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Hello world.~%&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;现在我们可以把我们的更改注入REPL，通过把光标放到最后一行并键入&lt;control&gt;c &lt;control&gt;c。通过切换到REPL键入以下内容执行我们的新函数：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hello-world&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;恭喜你！你在通过 Common Lisp 编程&lt;/p&gt;
&lt;h3&gt;重启Emacs后加载你的应用&lt;sup class=&quot;footnote&quot; id=&quot;fnr3&quot;&gt;&lt;a href=&quot;#fn3&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/h3&gt;
&lt;p&gt;CL-Project 在运行时更改了当前路径，使得第一次加载你的应用很简单。&lt;/p&gt;
&lt;p&gt;你有3种方法把应用放到你的加载路径：&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;为了让应用在你的当前路径，或者从应用路径启动你的Emacs或者在加载slime之前更改目录。&lt;/li&gt;
	&lt;li&gt;把你的应用移动到 ~/quicklisp/local-projects 它将总是有用。&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://common-lisp.net/project/asdf/asdf/Controlling-where-ASDF-searches-for-systems.html#Controlling-where-ASDF-searches-for-systems&quot;&gt;向你的加载路径添加项目&lt;/a&gt; 。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;个人选择对应用选择方法1对库文件选择方法2。&lt;/p&gt;
&lt;h3&gt;创建可执行文件&lt;/h3&gt;
&lt;p&gt;虽然做出有用的 Common Lisp 程序不必要创建可执行文件，它却肯定可以方便发布独立的应用。你生成的可执行文件将内嵌整个lisp环境，所以不要因二进制文件的体积感到吃惊……&lt;/p&gt;
&lt;p&gt;首先，定义可执行文件的切入点&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hello-world&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cl-user::quit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;你将需要下载 &lt;a href=&quot;http://www.xach.com/lisp/buildapp/&quot;&gt;buildapp工具&lt;/a&gt; ，指导在它的网站上。&lt;/p&gt;
&lt;p&gt;现在从你的myapp目录我们可以在命令行运行buildapp去编译你的程序！&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;buildapp --asdf-tree &lt;span class=&quot;nv&quot;&gt;$HOME&lt;/span&gt;/quicklisp/dists/quicklisp/software &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --load-system myapp --entry myapp:main --output hello
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;在程序所在目录运行你的程序&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./hello
Hello World.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;下一步是什么？&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://www.gigamonkeys.com/book/&quot;&gt;实用Common Lisp编程&lt;/a&gt; &lt;sup class=&quot;footnote&quot; id=&quot;fnr4&quot;&gt;&lt;a href=&quot;#fn4&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;很好的介绍Common Lisp的书。是我看的第一本对该语言介绍的书。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cs.cmu.edu/Groups/AI/html/cltl/cltl2.html&quot;&gt;Common Lisp the Language,2nd Edition&lt;/a&gt; Common Lisp的权威书籍&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.paulgraham.com/onlisp.html&quot;&gt;On Lisp&lt;/a&gt; &lt;sup class=&quot;footnote&quot; id=&quot;fnr5&quot;&gt;&lt;a href=&quot;#fn5&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;提供全面的高级Lisp技术&lt;/p&gt;
&lt;p&gt;你应该看看 &lt;a href=&quot;http://landoflisp.com/&quot;&gt;Land of Lisp&lt;/a&gt; 。它非常有趣，会是个相当愉快的阅读。&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn1&quot;&gt;&lt;a href=&quot;#fnr1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; 当然可以用vim，vim中slimv正是为此而生，可参考译者的 &lt;a href=&quot;http://reverland.org/lisp/2012/02/23/vimlisp/&quot;&gt;在Vim中使用lisp&lt;/a&gt; 一文。本文中操作都可以在vim中完成,只是不要尝试用那个quicklisp-slime-helper了。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn2&quot;&gt;&lt;a href=&quot;#fnr2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; Emacs内置elisp解释器。elisp是lisp的一个变种。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn3&quot;&gt;&lt;a href=&quot;#fnr3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; Vim中类似。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn4&quot;&gt;&lt;a href=&quot;#fnr4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt; 有中文版，田春译。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn5&quot;&gt;&lt;a href=&quot;#fnr5&quot;&gt;&lt;sup&gt;5&lt;/sup&gt;&lt;/a&gt; 有中文版，有兴趣的同学也许可以看看 &lt;a href=&quot;http://115.com/folder/faujangp#lisp&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Changelog&lt;/h2&gt;
&lt;ul&gt;
	&lt;li&gt;2012年06月27日 星期三 11时03分37秒 更正一些错误。加译作者更新内容&lt;/li&gt;
&lt;/ul&gt;



















</content>
 </entry>
 
 <entry>
   <title>宽容</title>
   <link href="http://reverland.org/reviews/2012/06/23/"/>
   <updated>2012-06-23T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/reviews/2012/06/</id>
   <content type="html">&lt;h1&gt;宽容&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;http://img3.douban.com/lpic/s3967007.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
&lt;p&gt;昨天是个具有双重意义的一天，其一在于它是中国纪念诗人 &lt;a href=&quot;http://zh.wikipedia.org/zh/%E5%B1%88%E5%8E%9F&quot;&gt;屈原&lt;/a&gt; 的端午节，它也是 &lt;a href=&quot;http://zh.wikipedia.org/zh/%E5%B1%88%E5%8E%9F&quot;&gt;阿兰·图灵&lt;/a&gt; 诞辰一百周年。两个人类社会异类的天才，忽然间让我想起了房龙的宽容，于是找来看了看。&lt;/p&gt;
&lt;h2&gt;Who&lt;/h2&gt;
&lt;p&gt;一串熠熠生辉的名字，他们从先辈那里接过宽容思想的火种，勇敢的传承下去。他们有的在有生之年成为众矢之的，有得英勇地站在了断头台和柴火堆，有的却得以尽享天年。他们也许有心，或许无意，但结果都做了一件事，忤逆强权，倡导宽容。&lt;/p&gt;
&lt;h2&gt;Why&lt;/h2&gt;
&lt;p&gt;简单的说：为了生存。千万年人类谋生存求发展的模式使我们继承下来不宽容的基因。为了生存，前辈们必须团结一致，结成某种集体。个性被压制，集体的利益高于一切，一切胆敢忤逆集体权威的行为都将被视为严重如外来威胁，结果就是人类集体对异端残忍的迫害。&lt;/p&gt;
&lt;p&gt;时代在进步，世界在变化。宽容能让我们融入世界和发展自己。全球化的经济推倒了很多壁垒，个人第一次有能力以个人身份参与全球市场竞争，不同的思想和文化都频繁接触和碰撞。&lt;sup class=&quot;footnote&quot; id=&quot;fnr1&quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;因此这时候再为了集体压制个人是不可取的，是对生产力的压制，也是对社会进步的阻碍。&lt;/p&gt;
&lt;p&gt;如果说千年之前残酷的生存与恐惧造就了今日不宽容的我们，造就了高度的集体话与社会化的我们。如今我希望看到一个尊重和鼓励个性、解放个性的世界，正如佛教所认为的，每个人都有佛性，每个人都值得尊重都不应该被集体压制，那个时代已经过去，新的时代已经到来。&lt;/p&gt;
&lt;h3&gt;What&lt;/h3&gt;
&lt;p&gt;我不想罗列书中的细节，但很少有人不着眼于帝王将相的家谱来叙述历史，仅此来说，此书就值得一看。说下看完个人感想：&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;社会蓬勃发展的地方都是那些思想自由的地方。而思想自由的地方一般都是贸易异常发达的地方，比如古希腊、文艺复兴时期的意大利、17世纪的荷兰。贸易的发达要求各种人都平等的对待对方、各种思想得到尊重、一致来自四面八方被迫害的人群涌入自由之邦，思想的繁荣促进了社会进步。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;顺天者昌，逆天者亡。可怜的罗马帝国尤利安大帝，过早的推行宗教宽容，结果只被视为异教徒敌人被暗杀，他的梦想知道几个世纪之后才终于再有人提出。还有许多妄想以一己之力推行各种不合大势的思想的人，都出师未捷身先死，长使英雄泪满襟。房龙的笔下，历史有种大势所趋，一发不可收拾的感觉。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;有意栽花花不放，无意插柳柳成阴。千年的历史看起来循环往复，人们却经常做违反初衷的事。被压迫者一边指责强者呼吁宽容，一边成为强者后却比前者更加变本加厉。他们自以为是的相信恐怖和杀戮能够扑灭思想的火种，反而思想却更加高尚和为人所知，造成极大的反作用力。世界就是这样～初衷和结果往往不一致。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;柔之胜刚，弱之胜强。很多对思想自由压制的巨大破坏，并非来自暴力革命，而是来自思想的解放和传播。哪些柔弱的思想和只有柔弱思想的脆弱个人，用某种温柔的方式推进了宽容的梦想，像那许多登上断头台的烈士一样值得尊重。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;How&lt;/h2&gt;
&lt;p&gt;有把人们统一起来的精神。无论是基督教、儒家伦理、还是抵御外寇、还是贸易、还是自由博爱平等的普世价值观。对生活在两个世界的人谈宽容就是扯淡。&lt;/p&gt;
&lt;p&gt;能做到的，只是尽力宽以待人，宽以待己。不以己度人。但大多人会么？&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn1&quot;&gt;&lt;a href=&quot;#fnr1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; 世界是平的&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>A Mathjax Test</title>
   <link href="http://reverland.org/web/2012/06/22/a-mathjax-test"/>
   <updated>2012-06-22T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/web/2012/06/22/a-mathjax-test</id>
   <content type="html">&lt;h1&gt;TeX Samples&lt;/h1&gt;
&lt;p&gt;以下公式以HTML源代码呈现LaTeX表达式。&lt;/p&gt;
&lt;h2&gt;洛伦兹公式&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
\begin{aligned}&lt;br /&gt;
\dot{x} &amp;amp; = \sigma(y-x) \\&lt;br /&gt;
\dot{y} &amp;amp; = \rho x &amp;#8211; y &amp;#8211; xz \\&lt;br /&gt;
\dot{z} &amp;amp; = -\beta z + xy&lt;br /&gt;
\end{aligned}&lt;br /&gt;
$$&lt;/p&gt;
&lt;h2&gt;柯西-施瓦茨不等式&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
\left( \sum_{k=1}^n a_k b_k \right)^2 \leq \left( \sum_{k=1}^n a_k^2 \right) \left( \sum_{k=1}^n b_k^2 \right)&lt;br /&gt;
$$&lt;/p&gt;
&lt;h2&gt;叉积公式&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
\mathbf{V}_1 \times \mathbf{V}_2 =  \begin{vmatrix}&lt;br /&gt;
\mathbf{i} &amp;amp; \mathbf{j} &amp;amp; \mathbf{k} \\&lt;br /&gt;
\frac{\partial X}{\partial u} &amp;amp;  \frac{\partial Y}{\partial u} &amp;amp; 0 \\&lt;br /&gt;
\frac{\partial X}{\partial v} &amp;amp;  \frac{\partial Y}{\partial v} &amp;amp; 0&lt;br /&gt;
\end{vmatrix}&lt;br /&gt;
$$&lt;/p&gt;
&lt;h2&gt;n次实验k次成功的概率&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
P(E) = {n \choose k} p^k (1-p)^{ n-k}&lt;br /&gt;
$$&lt;/p&gt;
&lt;h2&gt;拉马努金恒等式&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
\frac{1}{\Bigl(\sqrt{\phi \sqrt{5}}-\phi\Bigr) e^{\frac25 \pi}} =&lt;br /&gt;
1+\frac{e^{-2\pi}} {1+\frac{e^{-4\pi}} {1+\frac{e^{-6\pi}}&lt;br /&gt;
{1+\frac{e^{-8\pi}} {1+\ldots} } } }&lt;br /&gt;
$$&lt;/p&gt;
&lt;h2&gt;Rogers–Ramanujan恒等式&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
1 +  \frac{q^2}{(1-q)}+\frac{q^6}{(1-q)(1-q^2)}+\cdots =&lt;br /&gt;
\prod_{j=0}^{\infty}\frac{1}{(1-q^{5j+2})(1-q^{5j+3})},&lt;br /&gt;
\quad\quad \text{for $|q|&amp;lt;1$}.&lt;br /&gt;
$$&lt;/p&gt;
&lt;h2&gt;麦克斯韦方程组&lt;/h2&gt;
&lt;p&gt;$$&lt;br /&gt;
\begin{aligned}&lt;br /&gt;
\nabla \times \vec{\mathbf{B}} -\, \frac1c\, \frac{\partial\vec{\mathbf{E}}}{\partial t} &amp;amp; = \frac{4\pi}{c}\vec{\mathbf{j}} \\   \nabla \cdot \vec{\mathbf{E}} &amp;amp; = 4 \pi \rho \\&lt;br /&gt;
\nabla \times \vec{\mathbf{E}}\, +\, \frac1c\, \frac{\partial\vec{\mathbf{B}}}{\partial t} &amp;amp; = \vec{\mathbf{0}} \\&lt;br /&gt;
\nabla \cdot \vec{\mathbf{B}} &amp;amp; = 0 \end{aligned}&lt;br /&gt;
$$&lt;/p&gt;
&lt;p&gt;最后，当呈现整页看上去很棒的例子后，把数学公式与文本混合&lt;sup class=&quot;footnote&quot; id=&quot;fnr1&quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;同样重要。这个表达式$\sqrt{3x-1}+(1+x)^2$是一个行内等式例子。正如你所见，MathJax中这种等式也可以试用的很好，而不必变更行间距。&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Footnotes&lt;/h2&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn1&quot;&gt;&lt;a href=&quot;#fnr1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; 应该指行内公式&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>罗列下linux的好处</title>
   <link href="http://reverland.org/reviews/2012/06/21/linux"/>
   <updated>2012-06-21T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/reviews/2012/06/21/linux</id>
   <content type="html">&lt;h1&gt;是什么把你留在了linux下&lt;/h1&gt;
&lt;p&gt;不懂者请自行google，不喜者请自行绕道&lt;/p&gt;
&lt;p&gt;和windows和mac OS相比，linux桌面可谓默默无闻，小众的一塌糊涂。经常能在各种相关论坛看到各种抱怨。驱动、flash、游戏、不稳定、不用户友好……千宗之罪，不可胜数。不过既然linux桌面这么“不堪”，是什么把你留在了这里？&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;它是黑客友好的，透明性无与伦比。它是靠无数有热情的人们用智慧和激情维系的世界，它的价值观是开放、自由、进步和共享的。它追求平等，赋予每个人以平等的机会和权利&lt;sup class=&quot;footnote&quot; id=&quot;fnr1&quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。它不会莫名弹窗，不会各种流氓。事实上，在firefox adblock的护佑下我都感觉不到网络世界广告的存在&lt;sup class=&quot;footnote&quot; id=&quot;fnr2&quot;&gt;&lt;a href=&quot;#fn2&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。这里是天堂&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;它适于DIY。你要愿意，可以搞得天花乱坠秒杀苹果，可以搞得特立独行到让人认不出这是个人电脑，也可以弄得朴素平实得像win98，也可以搞得非常大众&lt;sup class=&quot;footnote&quot; id=&quot;fnr3&quot;&gt;&lt;a href=&quot;#fn3&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。有兴趣看截图的请自行google&lt;sup class=&quot;footnote&quot; id=&quot;fnr4&quot;&gt;&lt;a href=&quot;#fn4&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。各种配置都可以自己DIY或选择发行版轻快的使用。不满意还可以自己手动hack，当然只要你有能力和精力……&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;懒人的包管理器。曾经linux程序的依赖关系完全可以把一个正常人逼疯，时过境迁，现在回到windows装软件人完全会疯，虽然windows有那啥360来着&lt;sup class=&quot;footnote&quot; id=&quot;fnr5&quot;&gt;&lt;a href=&quot;#fn5&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;百毒不侵。可怜的windows……不知道mac怎么样。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;稳定。稳定在于你想稳定，天天像作者一样更新可不好。想稳定，用debian、用bsd。服务器系统的稳定不是盖的。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;vim，被称做编辑器之神的东西、广泛出现在各种文艺作品中的东西，会让人上瘾的东西。用过之后再也不想在其它编辑器里写东西了，不管是网页中、软件中、终端下，无法忍受在其它环境下编辑任何东西。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;ssh 其实只是想举例说linux的网络透明性。这些东西用过就知道好了。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;脚本。熟话说，想偷懒，写脚本。文字相对图形有好处大概就是效率吧。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;git 这个不解释，我用它管理博客。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;好吧，以上个人观点，无关任何集体与他人，所有内容以 &lt;a href=&quot;http://creativecommons.org/licenses/by-nc/3.0/&quot;&gt;CC BY-NC 3.0 License&lt;/a&gt; 协议发布。&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Footnote&lt;/h2&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn1&quot;&gt;&lt;a href=&quot;#fnr1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; 不像腾迅和renren这jb玩意净搞什么等级特权各种砖石什么烂玩意。净想着赚钱去了。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn2&quot;&gt;&lt;a href=&quot;#fnr2&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt; 虽然这和linux没什么关系……但你起码不用理会讨厌的各种软件弹窗。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn3&quot;&gt;&lt;a href=&quot;#fnr3&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt; 比如像我，搞得像windows vista似的……其实当年折腾不少，后来觉得dock是华而不实的家伙，灭之。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn4&quot;&gt;&lt;a href=&quot;#fnr4&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt; 别给我说baidu，普遍认为baidu是用来搜广告的。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn5&quot;&gt;&lt;a href=&quot;#fnr5&quot;&gt;&lt;sup&gt;5&lt;/sup&gt;&lt;/a&gt; 糊弄人的软件，也就觉得软件管家方便些。&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>惰性求值</title>
   <link href="http://reverland.org/lisp/2012/06/19/"/>
   <updated>2012-06-19T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/</id>
   <content type="html">&lt;h1&gt;惰性求值&lt;/h1&gt;
&lt;h2&gt;啥叫惰性求值&lt;/h2&gt;
&lt;p&gt;具体的含义可以参看这里 &lt;a href=&quot;http://zh.wikipedia.org/zh/%E6%83%B0%E6%80%A7%E6%B1%82%E5%80%BC&quot;&gt;惰性求值&lt;/a&gt; 。我的看法就是一种延迟计算方法，好像一个懒汉，只计算需要计算的东西。&lt;/p&gt;
&lt;h2&gt;为什么要惰性求值&lt;/h2&gt;
&lt;p&gt;因为惰性求值能极大优化程序的性能，想想那个 &lt;a href=&quot;/lisp/2012/05/23/dice-of-doom/&quot;&gt;Dice of Doom&lt;/a&gt; 的游戏，如果不需要每次都生成不需要的游戏树，将会节省多少时间和电力。同时，惰性求值能做到一些几乎不可能的事，构造无穷的东西。&lt;/p&gt;
&lt;h3&gt;在common lisp中实现一整套惰性求值函数库&lt;/h3&gt;
&lt;p&gt;据作者说，像Haskell和Clojure这样的预言直接把惰性求值作为语言默认的一部分，common lisp则没有这样，不过实现一整套惰性求值库也没有什么难度&lt;/p&gt;
&lt;p&gt;延迟求值我们想要得到这样的东西：lazy和force.lazy只返回函数。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;&amp;lt;FUNCTION...&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;force&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;lazy可以用宏这么实现&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forced&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gensym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gensym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forced&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forced&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;unless，when后是并行结构&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;forced&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;force可以直接用简单的函数实现&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;force&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;但我们需要的不只这些，要完成惰性求值需要一整套相应的函数比如延迟的cons、cdr、car、nth、mapcar等等等等。建立延迟的cons和相应的cdr和car&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;force&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;force&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;猜猜这是在干什么&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*integers*&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*integers*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*integers*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;我们还需要延迟生成lazy-nil和判断空延迟求值的列表的lazy-null&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(force (lazy-nil)) &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;force&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后是将常规列表和惰性列表相互转换的函数make-lazy、take、take-all.注意take-all只能返回有限列表。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;take-all&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take-all&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*integers*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take-all&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;是不是看不懂？作者说它深邃如禅宗公案，需要凝神细视许久才能了悟。&lt;/p&gt;
&lt;p&gt;然后是遍历和搜索整个惰性列表的mapcar、mapcan、find-if和nth函数。mapcar和mapcan返回的也是惰性列表，find-if和nth则返回原子。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;现在我还是得看着Hyperspec来分辨这一堆map&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst-cur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst-cur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;force&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst-cur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst-cur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-find-if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-find-if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;使用也很直观&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sqrt&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*integers*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;evenp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                      &lt;span class=&quot;vg&quot;&gt;*integers*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-find-if&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;oddp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lazy-nth&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-lazy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;最后的废话&lt;/h2&gt;
&lt;p&gt;不爽的事很多，人与人之间的差别太大，根本不能相互理解。上无聊的课，听老师扯淡，做无聊的事，这就是世界，这就是生活？&lt;/p&gt;
&lt;p&gt;老师说你该下定决心了，可我带着多少不舍与怀疑，甚至畏惧。&lt;/p&gt;
&lt;p&gt;室友dota视频依然放的很欢，还有想一暑假打dota的人。然而无关对错，谁也无法预言未来。&lt;/p&gt;
&lt;p&gt;然而我想珍惜我的生命，珍惜令我着迷的事物。不想在这里那里被各种无聊的人和事磨灭激情，唉……&lt;/p&gt;
&lt;p&gt;别人都在想些什么呢？别人想得差别怎么这么大？&lt;/p&gt;
&lt;p&gt;走下去，哪怕是条孤苦的路，此生不后悔。&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>传说中的DSL</title>
   <link href="http://reverland.org/lisp/2012/06/16/dsl"/>
   <updated>2012-06-16T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/16/dsl</id>
   <content type="html">&lt;h1&gt;lisp中的dsl&lt;/h1&gt;
&lt;h2&gt;什么是dsl，为什么要dsl&lt;/h2&gt;
&lt;p&gt;显然对于特定的领域，特定的程序是更好的解决方案，这个程序就是DSL&lt;sup class=&quot;footnote&quot; id=&quot;fnr1&quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.lisp非常方便来实现DSL。在land of lisp一书中进行了两种dsl，一种是生成xml或html，另一种是对我们之前 &lt;a href=&quot;/lisp/2012/04/26/a-text-game-engine-written-by-lisp/&quot;&gt;wizard游戏的&lt;/a&gt; 中的游戏命令进行dsl。&lt;/p&gt;
&lt;h2&gt;生成svg文件&lt;/h2&gt;
&lt;p&gt;关于svg文件不加以详述，读者可以参考 &lt;a href=&quot;http://zh.wikipedia.org/zh/SVG&quot;&gt;这里&lt;/a&gt; 。这非常重要，只有理解了xml文件的格式才能继续我们的dsl。svg采用xml格式，顺便我们也说说生成网页的dsl。&lt;/p&gt;
&lt;p&gt;首先写一个辅助函数，&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Creating XML and HTML with the tag Macro&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Writing a Macro Helper Function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;print-tag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;alst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;closingp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\&amp;lt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;closingp&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string-downcase&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;att&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;使用mapc是为了副作用。它总返回第一个参数&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; ~a=\&amp;quot;~a\&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string-downcase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;att&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;att&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;alst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;可以试试&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-tag&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;mytag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后创造生成标签的宏，宏能在以下几个方面提供不可替代的改善：&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;标签总是成对的，如果想要嵌套标签，函数办不到。因为它要求我们在嵌套标签被求值之前和之后执行代码。这在宏中是可能的，函数却做不到。&lt;/li&gt;
	&lt;li&gt;标签名和属性名通常不必通过动态方式改变。因此，把标签名通过单引号引用是多余的。换句话说，标签名应该默认被对待为想数据模式一样。&lt;/li&gt;
	&lt;li&gt;不像标签名，属性值则应该动态生成。我们的宏将拥有这么一个语法去把属性值放到代码模式，让我们可以执行lisp代码去生成这些值。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;总之我们想让我们的宏看上去这样：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mytag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;blue&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;&amp;lt;mytag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;BLUE&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;9&amp;quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;&amp;gt;&amp;lt;mytag&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;我们这么做：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;atts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-tag&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,name&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                       &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pairs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;atts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                     &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-tag&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,name&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;很好的实现了以上要求，可以展开看看：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;macroexpand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mytag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;blue&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;可以看看如何实现嵌套的：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mytag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;blue&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;big&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;first_inner_tag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;second_inner_tag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;我们还可以用来生成html&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;比之前我们生成html的版本好看多了……&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;html的标签是特定的，我们还能为特定的html标签编写宏：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Hi boys&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;好了，不跑题了，开始写生成svg的宏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Creating SVG-Specific Macros and Functions &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xmlns&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;http://www.w3.org/2000/svg&amp;quot;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;声明标准在哪里&lt;/span&gt;
             &lt;span class=&quot;s&quot;&gt;&amp;quot;xmlns:xlink&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;http://www.w3.org/1999/xlink&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;链接&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;写一个函数专门加深色彩，方便我们绘图&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;amt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;amt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;使用一个svg样式函数生成颜色属性，边比内部颜色深.注意～{和～}可以起遍历的作用。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;svg-style&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;&amp;quot;~{fill:rgb(~a,~a,~a);stroke:rgb(~a,~a,~a)~}&amp;quot;&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;边界比内部颜色更深&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brightness&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;于是得到生成圆的一个函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;circle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;center&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;radius&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;circle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;center&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                  &lt;span class=&quot;nv&quot;&gt;cy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;center&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                  &lt;span class=&quot;nv&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;radius&lt;/span&gt;
                  &lt;span class=&quot;nv&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;svg-style&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;最后可以简单的得到svg文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;circle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;.50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;circle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;还可以写些更复杂的svg例子，比如一个多边形&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Building a More Complicated SVG Example&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;polygon&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;points&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;polygon&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;points&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;
                               &lt;span class=&quot;s&quot;&gt;&amp;quot;~{~a,~a ~}&amp;quot;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;~{允许我们迭代&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;mapcan是有append的mapcar&lt;/span&gt;
                                       &lt;span class=&quot;nv&quot;&gt;points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                       &lt;span class=&quot;nv&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;svg-style&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;写个random-walk函数，我想读者应该知道是干什么的&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;random-walk&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-walk&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-walk&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;测试&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;写进一个文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;*standard-output*&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;random_walk.svg&amp;quot;&lt;/span&gt;
                                   &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:output&lt;/span&gt;
                                   &lt;span class=&quot;ss&quot;&gt;:if-exists&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:supersede&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;svg&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
             &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;polygon&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;又是这种风格，sbcl识别不了啊&lt;/span&gt;
                                       &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-walk&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                       &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                 &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
                               &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;用你的浏览器打开random_walk.svg看看吧，生成大概这样的图像:&lt;br /&gt;
&lt;a href=&quot;/images/random_walk.svg&quot;&gt;random_walk&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;对先前的游戏进行dsl&lt;/h2&gt;
&lt;p&gt;首先别忘了加载那个游戏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Creating Custom Game Commands for Wizard&amp;#39;s Adventure Game&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;wizards_game&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;添加两个命令，一个把链条和篮子焊接在一起，另一个用焊好的篮子从井里打水。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Creating New Game Commands by Hand&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;A Command for Welding&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;inventory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;weld&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;attic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;chain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obejct&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;chain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chain&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;securely&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;welded&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cannot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;weld&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;like&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;weld&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;chain&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(game-repl)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pushnew&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;weld&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;这很关键，不是吗？&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;A Command for Dunking&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bucket-filled*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dunk&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;garden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;well&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bucket-filled*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;full&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;water&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cannot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dunk&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;like&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pushnew&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;dunk&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;发现没？这两种命令很相似，我们来dsl,重新用我们的宏来重新添加上两个命令，另为我们还添加了一个更复杂的命令splash，把水泼到巫师脸上……&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;The game-action Macro&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-action&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;subj&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;place&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gensym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gensym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,place&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;subject&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,subj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,subj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt; 
            &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cant&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;like&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pushnew&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;,command&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;rewrite&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-action&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;weld&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chain&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bucket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chain&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;securely&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;welded&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bucket-filled*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-action&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dunk&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;well&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*chain-welded*&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bucket-filled*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;full&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;water&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;water&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;level&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;too&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;low&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;reach.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-action&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;splash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wizard&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bucket-filled*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;has&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nothing&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;it.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;have&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;frog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wizard&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;awakens&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sees&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;stole&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;his&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;frog.&lt;/span&gt;
                            &lt;span class=&quot;nv&quot;&gt;he&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;so&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upset&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;he&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;banishes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt;
                            &lt;span class=&quot;nv&quot;&gt;netherworlds-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lose!&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;end.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wizard&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;awakens&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;his&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;slumber&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;greets&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;warmly.&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;he&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hands&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;magic&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;low-carb&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;donut-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;win!&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;end.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;试试我们的新游戏，很棒不是？&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-repl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;小结&lt;/h2&gt;
&lt;ul&gt;
	&lt;li&gt;当你需要一些特定领域的古怪的程序，宏是很棒的方案。通过它们，你可以创建自己的dsl。&lt;/li&gt;
	&lt;li&gt;通常，首先为宏写一个辅助函数，然后写宏来提供宏能提供的提升。这些提高通常关乎能更清晰更安全地语法来使用代码。&lt;/li&gt;
	&lt;li&gt;你可以混合DSL和常规Lisp 程序。lisp程序可以更方便你调试。&lt;/li&gt;
	&lt;li&gt;DSL非常有用，当你需要写下非常特定代码——无论是生成网页，代码，或是画图，或是建立特殊的游戏命令的代码。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;&lt;/hr&gt;
&lt;h2&gt;照例的废话&lt;/h2&gt;
&lt;p&gt;寝室的室友在看dota比赛，不要这么激情好么，吵死了。晚上试着跑了将近一个小时步，感觉不错。&lt;/p&gt;
&lt;p class=&quot;footnote&quot; id=&quot;fn1&quot;&gt;&lt;a href=&quot;#fnr1&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; domian-specific language&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Macro in lisp</title>
   <link href="http://reverland.org/lisp/2012/06/13/macro-in-lisp"/>
   <updated>2012-06-13T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/13/macro-in-lisp</id>
   <content type="html">&lt;h1&gt;lisp宏的魔力&lt;/h1&gt;
&lt;h2&gt;lisp的宏&lt;/h2&gt;
&lt;p&gt;注意：此宏远与cpp中的宏有着天壤之别，而且远复杂很多倍。&lt;br /&gt;
宏编程允许你创造自己的语言。当面对一个复杂编程挑战时，有经验的程序猿会问自己：那种语言适合解决这个问题？然后他用宏把lisp变成了那种语言。太扯了……&lt;/p&gt;
&lt;p&gt;先举例说明什么是宏&lt;/p&gt;
&lt;p&gt;看这个例子&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The sum is ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;有没有感觉括号太多了？我们定义个let1宏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&amp;amp;body表示剩下的部分是表达式，而且隐含着一个progn的并行表达式，回忆&amp;quot;`&amp;#8220;与&amp;#8221;,&amp;#8220;的作用&amp;#8221;,@&amp;quot;相对于&amp;quot;，&amp;quot;用来表征并行表达式。&lt;/p&gt;
&lt;p&gt;试试你的宏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The sum is ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h2&gt;宏展开&lt;/h2&gt;
&lt;p&gt;宏的展开发生在运行期前，它把你非标准的程序转换成标准的lisp语言,然后传递给标准lisp解释器&lt;/p&gt;
&lt;p&gt;你可以用macroexpand来展开宏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;macroexpand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这将是很有效的调试方法。&lt;/p&gt;
&lt;h2&gt;更复杂一些的宏&lt;/h2&gt;
&lt;p&gt;回忆下之前我们定义的尾递归优化length函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;正如所见，我们反复使用cdr，反复检查列表是否为空。我们用冗长的工作去创造局部函数f，我们可以用宏让它更简洁一些。&lt;/p&gt;
&lt;h3&gt;一个分割列表的宏&lt;/h3&gt;
&lt;p&gt;一个能把列表分开，并能把列表头和尾提供给我们用split宏非常有用。我们可以得到这么一个有bug的宏：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Warning!Containing Bugs!&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
       &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;列表的car和cdr分别保存在head和tail中。如果列表不能split，将不会创建head和tail变量。&lt;/p&gt;
&lt;p&gt;于是my-length函数整洁些了&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h3&gt;避免重复的执行&lt;/h3&gt;
&lt;p&gt;试试这样：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Lisp rocks!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This can be split into ~a and ~a.&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This cannot be split.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;哦～为什么会执行三次打印Lisp rocks！展开宏看看&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;macroexpand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Lisp rocks!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;THis can be split into ~a and ~a.&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This cannot be split&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;你看到了什么……某动作被执行了三次。&lt;/p&gt;
&lt;p&gt;我很惊异的是这种情况common lisp也接受，还可以这样把命令写在函数中。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Lisp rocks!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Lisp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rocks!&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;为了避免这种情况我们重新改写split宏，注意，还是有bug的版本&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Warning! Still contains a bug!&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt; 
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; 
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
         &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;可以在宏内使用其它宏，像这里我们用了之前的let1宏。我们用一个变量绑定表达式，这时就不会重复执行了。但有了个新问题。&lt;/p&gt;
&lt;h3&gt;避免变量捕获&lt;/h3&gt;
&lt;p&gt;问题在哪里呢？试试下面的式子&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;什么情况，竟然报错了！！我们展开它看看&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;macroexpand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;split意外地捕获了外部变量x并且覆盖了前者。怎么避免这个问题？？&lt;br /&gt;
这个函数专门用来解决这类问题&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gensym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;它返回随机的名字，并且一定不会和已有的变量重复。使用它我们可以获得最终能安全使用的split版本&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gensym&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;val&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;no&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;两次绑定，先随机生成一个变量名，在把具体的值绑在这个随机生成的变量名上。可以展开看看&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;Each time is different&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;macroexpand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;每次结果都不同。&lt;/p&gt;
&lt;h2&gt;递归宏&lt;/h2&gt;
&lt;p&gt;再次考虑我们的my-length函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;局部函数f重复的建立。我们可以通过宏来简化它。想象这么一个recurse宏：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;recurse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;lift-off!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;lift-off!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;为了将列表奇数项作为变量偶数项作为值，可以写一个函数来生成cons对。像这样&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pairs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;D&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;E&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;函数可以这样定义,看着真绕……&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;tail-call-optimized list-eater&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pairs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;reverse&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;reverse&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;然后可以写出recurse宏&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmacro&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;recurse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;vars&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;amp;body&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;let1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pairs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;vars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;重新定义我们的my-length函数&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;recurse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;split&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                  &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;作者费了一大圈后认为现在看着很简洁，你觉得呢？&lt;/p&gt;
&lt;h2&gt;宏的危险与其它选择&lt;/h2&gt;
&lt;p&gt;把语言定义成任意你想要的模式，这当然很危险。若干岁月后回头都看不懂你自己写的什么，何况别人！所以，能用函数式解决的问题就别用宏来解决吧，骚年。看看我们的my-length函数，可以用高阶函数reduce轻松简化。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;reduce&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
          &lt;span class=&quot;ss&quot;&gt;:initial-value&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;reduce可以连续调用上次结果并与当前列表项一同运算。i代表当前为第几项，对我们没什么用，最后x初值为0一定要加上。&lt;/p&gt;
&lt;p&gt;然而仍然有些问题用函数式并不能很好解决而用宏可以轻易处理。下一章？拭目以待吧。&lt;/p&gt;
&lt;h2&gt;小结&lt;/h2&gt;
&lt;ul&gt;
	&lt;li&gt;宏允许你用代码生成代码，通过宏，你可以创造自己的语言，并在lisp解释器解释之前转化成标准lisp。&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;宏允许你摆脱一种既视感。摆脱各种括号和重复&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;当你写宏的时候你必须小心，这样才不会导致意外的重复执行的代码&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;你需要避免变量捕获，这可以通过gensym来解决&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;如果一个宏创造的变量故意暴露，作为宏的一个特性，这种宏叫做anaphoric macros&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;宏编程是非常有力的技术。然而，尽量使用函数式编程代替宏来解决问题。宏是最后的法宝。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;最后的废话&lt;/h2&gt;
&lt;p&gt;今天难得去图书馆了，三楼看到本real world haskell，只能感慨自己没空看了，二楼空无一人，看着散乱而泛黄的旧书顿生悲凉。一楼人倒挺多，都是来为四六级托福雅思考研等等等等自习的，很少有看书的。三楼人也有些，不过都集中在文学小说和艺术的区域。&lt;/p&gt;
&lt;p&gt;不知为什么，总有种世风日下的感觉。回忆起当初在图书馆看书的日子……&lt;/p&gt;</content>
 </entry>
 
 <entry>
   <title>近日简记</title>
   <link href="http://reverland.org/Life/2012/06/12/"/>
   <updated>2012-06-12T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/06/</id>
   <content type="html">
&lt;h1 id=&quot;section&quot;&gt;近日简记&lt;/h1&gt;

&lt;h2 id=&quot;section-1&quot;&gt;荒废的一天又一天&lt;/h2&gt;

&lt;p&gt;这一个月感冒两次，一次是为了重装arch&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; ，然后我就感冒了，一次是自习了几天，然后又感冒了。感冒的几天一直及其不爽的宅在寝室，天天晕头转向，不知道自己在做什么。也不想做什么，有许多感慨，可每次打开编辑器就兴味全无。不想荒废时间试着学学计算机的什么东西，完全看不进去，自己的论文作业什么的就更不用说了。&lt;/p&gt;

&lt;p&gt;每天上各种linux论坛贴吧，却也没心情灌水，也懒得帮新手解决问题。干脆玩起各种当年玩过的无敌版小游戏，疯狂的敲击键盘和鼠标，看看室友放的电影，生活索然无味。&lt;/p&gt;

&lt;p&gt;亲戚联系说暑假要到南京，要我一起买票回去。然后发短信说行程发q上了，我一天能检查三次邮箱可是从来不看q的……于是头昏脑胀中又忘了这事。也没给父母说感冒了，说了也没用，我一不想让他们徒担心，二不想给自己找责难。&lt;/p&gt;

&lt;p&gt;学不进东西，什么都干不进去，lisp宏那章终究看不下去，scheme竟也没兴致看下去，以前嫌宿舍吵耽误我专心，现在如此安静我却心神不宁。&lt;/p&gt;

&lt;p&gt;日子便这样一天天荒废了。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;净整些那些没用的&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;天下熙熙，皆为利来。天下攘攘，皆为利往。
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我自觉是个有热情的人，尽管受尽了冷水，依然不愿意熄灭自己的热情。折腾linux快一年，终究没有放弃。不指望它能帮我混口饭吃，不指望能帮我带来什么好运，但终究不会放弃。&lt;/p&gt;

&lt;p&gt;即使有人说我净整些没用的东西，即使有时会被迫忙于我认为远没技术有意义的东西，即使没有钱途没有桃花运，我还是会忠于会厮守，我心目中有意思的东西，我心目中的最爱，我的信仰，我的青春，我心中眼中的未来……&lt;/p&gt;

&lt;p&gt;我为什么学这些，因为我相信真正的黑客（&lt;em&gt;拜托各位搞清楚什么是黑客再来理解，我就不把放脚注里了&lt;/em&gt;）应该学这些，一个人应该学这些，面向未来应该学这些。&lt;/p&gt;

&lt;p&gt;我学linux，学html/css，学vim，学latex，学lisp，学虚拟技术，学各种数学软件和语言，学gimp，学wp，学vnc/rdp/nfs，因为我觉得有意思，我觉得他们会有用。而且事实上，受益良多，我庆幸自己没有虚度光阴。&lt;/p&gt;

&lt;p&gt;我学到如何设计、学到如何选择、学到如何解决问题、学到如何提问、学到社区礼仪、学到文档写作、学到文档翻译、学到阅读理解、学到细心与耐心、学到足以影响一生的哲学理念。我的生活为之改变。&lt;/p&gt;

&lt;p&gt;我获得了信心、开阔了视野、获得莫大的乐趣、看到许多人不曾看到甚至可能永远看不到的、丰富了自我的阅历。有种凤凰涅磐的感觉，然而过程却如此痛苦。&lt;/p&gt;

&lt;p&gt;然而我说出来，没有人明白，没有人理解，没有人能认同。我享受着一个人的思考与孤独。&lt;/p&gt;

&lt;p&gt;只有亲身经历者才能体悟，正如毛姆的《人生的枷锁》所言，答案只有自己找出才有意义。道，是靠自己悟的。&lt;/p&gt;

&lt;p&gt;最后想反驳下那些觉得我做无用之事的，你以为实验室那些linux机器能整好那么容易？以为各种文件格式转换是件容易的事？？以为每个人都知道出问题不要问baidu而是去看手册问google？？以为没有积累能很多东西能摸索出来？？我都很震惊我的积累这么快就用上一部分！！&lt;/p&gt;

&lt;p&gt;没用？始终相信一个学姐给我说的，大学里没有什么学了是没用的！！&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;打了三次米饭&lt;/h2&gt;

&lt;p&gt;我自知长的比较瘦弱，记得因此被欺负被嘲笑过，记忆久远，却永远不会忘记。还记得当年各种怕被嘲笑，怕被当作异类，怕被大多数人遗忘抛弃。哈，不自揭伤疤了，不跑题了。&lt;/p&gt;

&lt;p&gt;今天去打米饭，在一食二楼第一次打饭的阿姨如愿给我了大致够吃的米饭。想想之前的这些岁月，真是难过，每次都要打两三次米饭，每次我上前说八两米饭并一再强调时，大妈给我他妈的还不到人家四两的量，妈的我恨不得以后就说两边打满得了。我想，因为我看上去吃不了八两？&lt;/p&gt;

&lt;p&gt;同学也说，你吃得了么？我擦，事实在那里啊……我都当过你们面吃过多少次了……&lt;/p&gt;

&lt;p&gt;我举这个例子是想说，人，是成见很重的动物&lt;/p&gt;

&lt;p&gt;然而却无法改变，这说到底是人类智能的一步分，是人千百年进化而来的高级功能——模式识别和推理。如今却成为人类和谐的阻碍之一。&lt;/p&gt;

&lt;p&gt;很多事，并不是他们必将成为那样，而是由于人们希望成为那样。&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;我讨厌成见，却不得不忍受成见，还要面临各种负面期望。&lt;/p&gt;

&lt;p&gt;我想给那些做自己的事不被人理解的人说：&lt;/p&gt;

&lt;p&gt;大家都认为你错的时候，不要放弃，不然你就真的错了，坚持到胜利你就是对的，胜利之前你就是怙恶不悛。这就是成王败寇的道理。&lt;/p&gt;

&lt;p&gt;不要与人争辩，talk is useless&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt; ，专心做你的事，做你爱的事。能说服自己足够了，自己喜欢就足够了，没什么理由，每天还有成天上万人荒废在游戏和各种娱乐之中而不自责，何况尔乎？&lt;/p&gt;

&lt;p&gt;卡耐基说，人是不能下定论的，评判人的是非的事，只有神能够做到。&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;所以，不管别人怎么不看好你，怎么冷落你，相信你自己，相信你的上帝。没什么能阻挡你，事情也没想象的难，你终将做到，而不是沦为成见的牺牲品。&lt;/p&gt;

&lt;h2 id=&quot;section-4&quot;&gt;就是不一样&lt;/h2&gt;

&lt;p&gt;有同学对我说，别人都用windows，你用什么linux。&lt;/p&gt;

&lt;p&gt;我：……擦，尼玛比为什么老在那lol……&lt;/p&gt;

&lt;p&gt;开源社区经常出现的话题是：你们用linux为了什么？linux这不好那不好……&lt;/p&gt;

&lt;p&gt;我以前还想说说，现在懒得理，顶多回个装13让用win/mac的优越党赶紧满意地滚蛋&lt;/p&gt;

&lt;p&gt;是啊，我们为什么要不一样？？以为我们觉得大多数人的选择于我不对！！因为我们有了自己的选择？这也是罪？？然而总是会遭受各种误解，因大多数人认为计算机是拿来娱乐的。这真尼玛不爽，linux真是神赐给我们的学习机，单系统后你大概基本不会去玩游戏看电影啥了，为什么？试试就知道了。相反，你会在技术上突飞猛进……英文上猛进突飞……能力上猛飞突进……&lt;/p&gt;

&lt;p&gt;接触很多东西之后，才发现世界上有这么多有趣的东西我都不知道，这么多优秀的，美的事物我不知道，唉，说实话，感慨无聊的人我就感觉奇怪，因为他们没所喜欢的东西。&lt;/p&gt;

&lt;p&gt;也有不好，我变宅了，变得喜欢一个人了。有时真心羡慕那些未曾为什么走火入魔的人，他们只要跟着别人走就是了。&lt;/p&gt;

&lt;h2 id=&quot;section-5&quot;&gt;我为什么考研&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;同学说：考研不就是为了找好工作。

我说：额……是么？

便问我：你考研为了什么？别给我讲为了学知识！！

我：……为了去北京……

同学：……
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我为何考研，不为学什么知识。早对天朝的大学失望至极&lt;/p&gt;

&lt;p&gt;为了离开这里，因为这里弱爆了。&lt;/p&gt;

&lt;p&gt;为了在大都市寻发展&lt;/p&gt;

&lt;p&gt;最关键是我想在通信或互联网行业有好的发展，&lt;/p&gt;

&lt;p&gt;不仅要有技术，还必须有人脉&lt;/p&gt;

&lt;p&gt;现在我毕业什么都没有。&lt;/p&gt;

&lt;p&gt;我希望去北邮结交许多志同道合的人&lt;/p&gt;

&lt;p&gt;而不是一个人瞎折腾&lt;/p&gt;

&lt;p&gt;我希望找到一个小型的能做事的团队&lt;/p&gt;

&lt;p&gt;我希望做我想做的事。&lt;/p&gt;

&lt;p&gt;所以我考研，不二战。&lt;/p&gt;

&lt;p&gt;我相信即使我转那么一大圈&lt;/p&gt;

&lt;p&gt;终究回到我凝视的方向。&lt;/p&gt;

&lt;h2 id=&quot;section-6&quot;&gt;计划&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;工作日，只要没在下大雨，每天早上跑半个小时步，晚上一个小时。节假日每日保证一个上午或下午的至少三个小时的活动时间。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;保证早餐一个鸡蛋、肉夹膜或那啥饺子。午餐八两+米饭，晚饭随意，但要吃饱。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;限制上机时间，2小时强制关机。上机自己看着办，要折腾什么的，作业什么的，考研什么的，自己看着办上机前安排好。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;每天四个小时自习考研时间&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;保证三天写一次博客，主要关于lisp/html/life或什么的。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;坚持&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnote&quot;&gt;Footnote:&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;一种轻量级操作系统，遵循Kiss(keep it simple stupid)哲学。&lt;a href=&quot;#fnref:1&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;可以参看一些教育心理学实验&lt;a href=&quot;#fnref:2&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;王垠的一个老师给王垠说的&lt;a href=&quot;#fnref:3&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;我记得有这么意思的话，好像还是来自圣经&lt;a href=&quot;#fnref:4&quot; rel=&quot;reference&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</content>
 </entry>
 
 <entry>
   <title>用gimp画了两幅画</title>
   <link href="http://reverland.org/art/2012/06/09/gimp"/>
   <updated>2012-06-09T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/art/2012/06/09/gimp</id>
   <content type="html">
&lt;p&gt;刚考完试，也不想去复习考研的东西，也不想写两天后要交的论文，感冒了又很难受，用gimp画了两幅画&lt;/p&gt;

&lt;h2 id=&quot;mystery&quot;&gt;Mystery&lt;/h2&gt;

&lt;p&gt;几乎全是用路径+动态画笔完成的&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://imgur.com/muFuE.png&quot; hight=&quot;150&quot; width=&quot;300&quot; alt=&quot;star&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;sandglass&quot;&gt;Sandglass&lt;/h2&gt;

&lt;p&gt;路径+图层色彩增益，动态画笔，选区。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://imgur.com/FU3p8.png&quot; hight=&quot;150&quot; width=&quot;300&quot; alt=&quot;sandglass&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;2012年06月10日 星期日 17时10分54秒 补&lt;/p&gt;

&lt;h2 id=&quot;running&quot;&gt;Running&lt;/h2&gt;

&lt;p&gt;一个残疾人赛跑截图，纯gimp制作，路径+滤镜+图层模式。激励自己.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://i.imgur.com/FcIjH.png&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;running&quot; /&gt;&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>First AI in lisp</title>
   <link href="http://reverland.org/lisp/2012/06/08/first-ai-in-lisp"/>
   <updated>2012-06-08T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/08/first-ai-in-lisp</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;创造一个智能的对手&lt;/h2&gt;

&lt;p&gt;我们的&lt;a href=&quot;/lisp/2012/05/23/dice-of-doom/&quot;&gt;Dice of Doom&lt;/a&gt;游戏树代码有个分开的游戏树生成使向游戏引擎添加AI很容易。事实上，让我们跟着作者添加23行代码来实现AI！！&lt;/p&gt;

&lt;p&gt;让我们先看看AI如何决定移动：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;查看每个可允许的移动&lt;/li&gt;
  &lt;li&gt;对每一步的后的board评分&lt;/li&gt;
  &lt;li&gt;选择分值最高的移动&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;看起来很容易，那么怎么实现评分？如果一步后就赢了，很容易评分。如果不是的话怎么办？我们的移动将取决于对手的移动，为了不陷入不断考虑对手的境地中，提出一种算法。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;最小最大算法&lt;/h2&gt;

&lt;p&gt;当赛场上只有两个玩家时，有这么个规则：对他人好的对我不好。这意味着我们可以采取如下模式决定对手的移动：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;查看每个可行移动&lt;/li&gt;
  &lt;li&gt;对每一步后的board评分&lt;/li&gt;
  &lt;li&gt;选择最小的评分的移动&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;综上，这就是最大最小算法。这很关键，结果是我们可以避免分别为自己和对手计算评分，然后向下搜索游戏树中好的移动变得更简单和更快。为了让算法成为代码，还需要做少许调整。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;将最大最小算法转化为代码&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;
               &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;winners&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;ai&quot;&gt;创造一个有AI的游戏循环&lt;/h2&gt;

&lt;p&gt;先写个电脑处理函数，像我们的handle-human函数,首先找出每个移动的评分，然后选择评分最高的移动。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-ratings&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ratings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;最后，创造一个游戏环境即游戏循环&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-info&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;announce-winner&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;因为游戏中player1即代码0为人类玩家&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-computer&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;finished!!&lt;/p&gt;

&lt;h2 id=&quot;vs&quot;&gt;试试人类vs电脑游戏&lt;/h2&gt;

&lt;p&gt;在repl中输入&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-computer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gen-board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-3&quot;&gt;写在最后&lt;/h2&gt;

&lt;p&gt;终于考完试了，好久没看这本书。发现很多东西都生疏了，还好作者每次解释都很详细。这一章一看了好久，回头看看common lisp，东西真是相当之多……正好从图书馆找到HTDP的中文版，看完这本书全面转向scheme。&lt;/p&gt;

&lt;p&gt;最后引用首爱默生《人生苦旅》中的诗：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;我们把美归于简单
不含多余部分
边界清晰
与一切相关联
是中庸之道
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</content>
 </entry>
 
 <entry>
   <title>Scheme初体验</title>
   <link href="http://reverland.org/scheme/2012/06/05/scheme"/>
   <updated>2012-06-05T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/scheme/2012/06/05/scheme</id>
   <content type="html">
&lt;h2 id=&quot;racket&quot;&gt;racket&lt;/h2&gt;

&lt;p&gt;这几天试了试racket&lt;/p&gt;

&lt;p&gt;相当漂亮，&lt;a href=&quot;http://racket-lang.org/&quot;&gt;racket&lt;/a&gt;是以前的PLT Scheme。是著名的scheme实现之一。&lt;/p&gt;

&lt;p&gt;drracket是racket图形环境。很漂亮，很图形化，功能很全面。采用分级教学，不同级别时返回不同错误信息，对初学者极度友好。非常适合配合&lt;a href=&quot;http://www.htdp.org/&quot;&gt;How to Design Programs&lt;/a&gt;学习scheme。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Memoization in Functional Style</title>
   <link href="http://reverland.org/lisp/2012/06/02/memoization-in-functional-style"/>
   <updated>2012-06-02T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/06/02/memoization-in-functional-style</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;函数式的记忆优化&lt;/h2&gt;

&lt;p&gt;记忆利用闭包。这种优化只对函数式有用。函数的行为只受输入参数约束，函数所做的仅仅是计算并将结果返回给调用者。&lt;/p&gt;

&lt;p&gt;优化的地方在于：记住每次传递的参数和计算的结果。&lt;/p&gt;

&lt;p&gt;我们的&lt;a href=&quot;/lisp/2012/05/23/dice-of-doom/&quot;&gt;Dice of Doom&lt;/a&gt;游戏可以做如下优化：&lt;/p&gt;

&lt;h3 id=&quot;neighbors-function&quot;&gt;记忆neighbors Function&lt;/h3&gt;

&lt;p&gt;正如你所记得的，neighbors函数重复检查board的所有边。然而board的形状比赛中从来不变化，这个函数的结果不会变化！&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;old-neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;symbol-function&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;neighbors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;old-neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;首先我们把老的neighbors函数保存在局部变量old-neighbors中。symbol-function命令仅仅取得绑在这个符号上的函数。&lt;/p&gt;

&lt;p&gt;接下来，我们定义一个局部变量previous，用来存放所有先前的参数和结果。&lt;/p&gt;

&lt;p&gt;然后我们把先前的neighbors覆盖掉，然后？很显然，每调用一次后检查是否previous已有，若没有则调用老函数并保存参数和结果。&lt;/p&gt;

&lt;p&gt;注意……这种函数处理行为可能搞的很乱……&lt;/p&gt;

&lt;h3 id=&quot;game-tree&quot;&gt;记忆Game Tree&lt;/h3&gt;

&lt;p&gt;game tree的生成是整个程序最大的开销，可以这样优化。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;old-game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;symbol-function&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;game-tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equalp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;&amp;amp;rest&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;old-game-tree&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;因为哈希表中的对象是array，所以我们用&lt;code&gt;equalp&lt;/code&gt;代替&lt;code&gt;eql&lt;/code&gt;。&lt;code&gt;&amp;amp;rest&lt;/code&gt;接受任意数量参数。&lt;/p&gt;

&lt;h3 id=&quot;rate-position&quot;&gt;记忆rate-position函数&lt;/h3&gt;

&lt;p&gt;这是用lisp实现人工智能中minmax算法中的一个函数，我好像还没纪录人工智能那部分。
如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;old-rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;symbol-function&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;rate-position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rate-position&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;old-rate-position&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我们需要做些特殊的东西，因为传递进rate-position中的参数。游戏树将非常之大，所以我们必定不要用equal或相似的这种比较大列表相当慢的函数来比较一个游戏树，取而代之，我们用eql，因此我们分开处理函数的两个参数，通过内嵌哈希表实现。&lt;/p&gt;

&lt;p&gt;首先创建一个用eql比较的外部哈希表，然后定义一个tab变量在外部哈希表中查找我们的其中一个参数player，获取内部hash表。如果外部没查找到，我们建一个空的内建哈希表，用同样的键保存在外部哈希表中，剩下的例子和先前一样，除了我们使用内嵌哈希表，把tree这个参数作为键值。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;注意&lt;/h2&gt;

&lt;p&gt;记忆化可以优化函数式程序，然而记忆化本身一点也不函数式。所以说函数式必然效率低么？其实这种优化我倒希望编译器能自动完成。&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;补记&lt;/h2&gt;

&lt;p&gt;这些日子忙着准备考试，然而考试当天剩一小时写完果断交卷。对大学考试已经没任何想法了，浪费我时间而已。&lt;/p&gt;

&lt;p&gt;land of lisp根本这几天就没看，试了试&lt;a href=&quot;http://racket-lang.org/&quot;&gt;racket&lt;/a&gt;，相当有意思，库也挺强大。我还是喜欢只有47页规范的scheme啊，所以看完land of lisp想先看看&lt;a href=&quot;http://htdp.org&quot;&gt;How to Design Programms&lt;/a&gt;,common lisp上前页的规范真不是newbie friendly。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Tail Call Optimization</title>
   <link href="http://reverland.org/lisp/2012/05/31/tail-call-optimization"/>
   <updated>2012-05-31T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/31/tail-call-optimization</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;什么是尾递归&lt;/h2&gt;

&lt;p&gt;尾递归作为一种函数式编程优化方法。为了理解这个奇怪的名字，看下面这个计算列表长度函数的例子:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;首先，它会检查列表是否是空的，如果不是，它递归地调用自身计算剩下列表的长度并加上1,如果是空的则返回0.&lt;/p&gt;

&lt;p&gt;结果是这个函数相当没有效率…………我们可以试试一个“大列表”：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*biglist*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100000&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在clisp中试试……&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*biglist*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;vg&quot;&gt;***&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Program&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;overflow.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;RESET&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;stack overflow！！问题出现在&lt;code&gt;+1&lt;/code&gt;函数上，它告诉lisp解释器：“首先计算列表的长度，然后对结果调用&lt;code&gt;+1&lt;/code&gt;。”
问题是每次我们递归调用&lt;code&gt;my-length&lt;/code&gt;时，lisp必须记住我们之后要向结果添加1。由于列表有100000项长，lisp在它能&lt;code&gt;+1&lt;/code&gt;之前要记住99999次！！clisp的做法是在堆栈中放个提示符，这导致最后堆栈溢出。&lt;/p&gt;

&lt;p&gt;我们如何避免这个问题呢？我们重新定义我们的&lt;code&gt;my-length&lt;/code&gt;函数&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;lineno&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;2&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;3&lt;/span&gt;               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;4&lt;/span&gt;                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;5&lt;/span&gt;                  &lt;span class=&quot;nv&quot;&gt;acc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;6&lt;/span&gt;      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;我们定义了一个局部函数&lt;code&gt;f&lt;/code&gt;作为list-eater,但同时多了个acc累加器。这个累加器累加遇到的列表数目，最开始调用f时acc置0.&lt;/p&gt;

&lt;p&gt;通过使用累加器，递归调用f不再需要向结果&lt;code&gt;+1&lt;/code&gt;。当我们到达列表尾部（lst is nil），acc即为列表项数目，所以我们返回它。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;f&lt;/code&gt;最后做的是，当列表没到结尾时不断,调用自己。这种函数调用自身或其它函数的行为叫做&lt;em&gt;尾递归&lt;/em&gt;,lisp解释器足够哦聪明去认出这种尾递归，它知道可以直接调用自身而不用等着把当前程序推入堆栈。&lt;/p&gt;

&lt;p&gt;有点像Basic中的goto和c++中的longjmp，但lisp中尾递归十分安全。&lt;/p&gt;

&lt;h2 id=&quot;clisp&quot;&gt;clisp中的尾递归优化&lt;/h2&gt;

&lt;p&gt;并非所有的lisp解释器并不会进行尾递归优化，因为尾递归这种减少使用堆栈的方式不适合调试。&lt;/p&gt;

&lt;p&gt;为了在clisp中使用尾递归，我们可以这样&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;compile&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;my-length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-length&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*biglist*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;有没有感觉速度超快？&lt;/p&gt;

&lt;h2 id=&quot;variable-shadowing&quot;&gt;Variable Shadowing&lt;/h2&gt;

&lt;p&gt;注意&lt;code&gt;my-length&lt;/code&gt;函数中参数lst和f中的lst，在每次递归调用中后者将取代前者，这种处理方式叫做Variable Shadowing.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Archlinux下合并pdf</title>
   <link href="http://reverland.org/linux-tech/2012/05/28/archlinuxpdf"/>
   <updated>2012-05-28T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/linux-tech/2012/05/28/archlinuxpdf</id>
   <content type="html">
&lt;h2 id=&quot;linuxpdf&quot;&gt;linux下合并pdf&lt;/h2&gt;

&lt;p&gt;写激光原理论文，老师给了个封面。需要将封面和内容弄到一个文件中。&lt;/p&gt;

&lt;p&gt;以前用过pdfmod什么的，结果发现我用XeLaTeX编译出来的是乱码。&lt;/p&gt;

&lt;p&gt;后来试过源里的pdfeditor，这个……kde下太难看了，功能倒挺强，看上去好复杂，点几下鼠标没弄懂，于是也放弃了。&lt;/p&gt;

&lt;p&gt;再后来听说了pdfjam，pdfsam，pdftk……&lt;/p&gt;

&lt;p&gt;多多少少有些洁癖好么，不喜欢一堆一堆的软件，有这么些时候命令很得心应手，像用ffmpeg转转视频格式啊，用sox转转音频格式啊。&lt;/p&gt;

&lt;p&gt;linux下总是有好工具的，有两种方法：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;新建一个TeX文件，使用pdfpages宏包，这种方法可以指定页码。参见&lt;a href=&quot;http://latex.yo2.cn/articles/tex-merg-pdf.html&quot;&gt;用TeX合并pdf&lt;/a&gt;。一定要用pdflatex编译。&lt;/li&gt;
  &lt;li&gt;使用ghostscript工具,一般这个都被pdf阅读器依赖的。参见&lt;a href=&quot;http://latex.yo2.cn/articles/gs-pdfwrite.html&quot;&gt;合并 ps/pdf 文件&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;gs -q -dNOPAUSE -dBATCH -sDEVICE&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;pdfwrite -sOutputFile&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bar.pdf -f foo1.pdf foo2.pdf
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section&quot;&gt;之外的废话&lt;/h2&gt;
&lt;p&gt;这几天一直忙着复习，几天时间把一学期老师讲的东西预习一遍，然后就要吊儿郎当的开卷考试了。又有那激光原理期末大作业，我是当然要用LaTeX来写了，虽然不准备再研究这个，但用word总是让我有些无法忍受。&lt;/p&gt;

&lt;p&gt;上手才发现，东西基本都忘了。好久没用过基本的命令都忘的一干二净。还好有以前的自己做的模板，打开chinatex数学排版问题集边查边写，在开着vim-latex插件的手册随时查阅，实在不行还有google大神，总算最后凑合着写完了。&lt;/p&gt;

&lt;p&gt;自从见识到mathjax项目后，又在人大那群搞R的人的博客上听说用html做幻灯片的项目，我便日觉LaTeX将没什么前途了。上网还查到现在还有把自己简历写成html的，html前途光明的印象便越发深刻。虽然mathjax还有些问题，但不管是学术和非学术界，本地化的文档正在走向灭绝估计已成定论。&lt;/p&gt;

&lt;p&gt;因为这个网站的问题，看了点介绍html5的书，书中激情澎湃的介绍了html5的各种强大应用，栩栩如生的描绘出了一个属于网络的未来世界。看完之后，对LaTeX更没有热情了。&lt;/p&gt;

&lt;p&gt;但作业还是要写的，老师很体贴的只收pdf，不像上学期一样还肯收word文档了，也不像cpp老师一样只收word文档了。所以又复习了下LaTeX，还不忘最后加上proudly powered by LaTeX，虽然没什么意思。&lt;/p&gt;

&lt;p&gt;前几天一个学数学的同学找我帮他调教LaTeX，因为他们要发论文。模板多老我就不说了，中文断字都没做好，更纠结的是他们的文章，都是在word03和mathtype中写的，然后转成TeX……&lt;/p&gt;

&lt;p&gt;时光滚滚向前，我本以为世界进步地很快，然而它的惯性出乎意料的大。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>失望</title>
   <link href="http://reverland.org/Life/2012/05/26/"/>
   <updated>2012-05-26T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/05/</id>
   <content type="html">
&lt;p&gt;有一堆感慨，杂乱不堪，删了写，写了删。总之挺失望，又不好写出来，这势力的社会、无聊的学校。&lt;/p&gt;

&lt;p&gt;算了，罗列下我的打算：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;继续维护自己的网站，慢慢精通html5和css.也许会学点javascript&lt;/li&gt;
  &lt;li&gt;学手绘，同时继续我的gimp之旅，某人用krita做的图真是震惊到我了。&lt;/li&gt;
  &lt;li&gt;学学lisp，估计慢慢会从common lisp到scheme。可能还会看看clojure，c2真是做的漂亮，而且是用clojure做数据可视化的，深合吾意，我是不打算回头学R、processing什么的了。&lt;/li&gt;
  &lt;li&gt;c++。随便看看，lisp这东西如果有个强大的库就好了&lt;/li&gt;
  &lt;li&gt;可能随便看看ruby，现在的网站就是ruby驱动的，虽然我什么都不会。也可能看看python，只是可能&lt;/li&gt;
  &lt;li&gt;试着用linux搞搞集群什么的。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;还有些其它不着边的梦想：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;去希腊跑次全程马拉松&lt;/li&gt;
  &lt;li&gt;去CERN工作&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;不要问我他妈的能不能赚钱，能不能养家糊口，这只是个人兴趣和想法。老子很多事不在乎，能给我一口饭让我把想做的事做完此生就不算白来。其它的尼玛见鬼去吧&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Dice of Doom</title>
   <link href="http://reverland.org/lisp/2012/05/23/dice-of-doom"/>
   <updated>2012-05-23T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/23/dice-of-doom</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;照例前面来些废话&lt;/h2&gt;

&lt;p&gt;前一阵忙着看通信原理，近来各科都陆续结课，又接连有这么几科让写个什么论文，忙忙碌碌之后发现lisp就没怎么看了，以致于这一章都看快一星期了还没看完。不过回头多看几次后，因为对游戏要生成个什么样的game tree有了整体上的把握，理解起来简单多了。所以奉劝其它读者先搞清楚要生成个什么样的game tree和作者的设计方案，再来看后面的代码部分。&lt;/p&gt;

&lt;p&gt;昨天还激动终于看到用lisp来实现人工智能了，结果一看几行代码实现个&lt;a href=&quot;http://en.wikipedia.org/wiki/Minimax&quot;&gt;minmax&lt;/a&gt;算法的问题……失望了。&lt;/p&gt;

&lt;h2 id=&quot;dice-of-doom&quot;&gt;Dice of Doom&lt;/h2&gt;

&lt;h3 id=&quot;section-1&quot;&gt;游戏规则&lt;/h3&gt;

&lt;p&gt;这是个怎么样的游戏？看看&lt;a href=&quot;http://www.gamedesign.jp/flash/dice/dice.html&quot;&gt;这里&lt;/a&gt;就知道了。我们现在就要用函数式编程风格写一个这样的游戏，当然，从简单的开始。简单到只有两个玩家，只以骰子数目多少来决定能否“占领”对方的领地。&lt;/p&gt;

&lt;p&gt;本想举个例子，不过画图挺麻烦的，现在没什么空。有空再补上。&lt;/p&gt;

&lt;p&gt;有这么一些规则：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;两个玩家占据着六边形阵列上的各个六边形。每个六边形都有一些立方体骰子，被两个玩家分别占有。&lt;/li&gt;
  &lt;li&gt;在一个回合内，玩家可以执行任意数目的移动，但至少移动一次。如果他不能移动那么他就输了。&lt;/li&gt;
  &lt;li&gt;移动包括攻击邻近的对方六边形。玩家发动攻击的六边形必须比要攻击的对方的六边形拥有更多骰子。将来可能我们会真的“转动”这些骰子。&lt;/li&gt;
  &lt;li&gt;攻击结束后，输者在被攻击六边形的骰子被移除，发动攻击的六边形留下一个骰子，将其它所有骰子移到占领的新地方。&lt;/li&gt;
  &lt;li&gt;当玩家完成他所有的移动，将获得他消灭的骰子总数减一的增援。增援从左上角开始给每个己方六角形增加一个骰子。若达到每个六边形的最大骰子数则跳过。&lt;/li&gt;
  &lt;li&gt;如果玩家都不能移动，游戏结束，占据最多六边形的玩家获胜。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-2&quot;&gt;然后是漫长的源码……&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;Defining Some Global Variables&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;玩家数二&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*num-players*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;一个六边形最多3个骰子&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-dice*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;2x2的board&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;将list转化为array，为今后优化做准备&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board-array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-array&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:initial-contents&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;dirty&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;生成随机的玩家分布和力量&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gen-board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt;
                     &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*num-players*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-dice*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;将玩家名由数字转换成字母&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player-letter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;code-char&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;97&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;dirty&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;通过两层循环控制输出，绘制board&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;
                        &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a-~a &amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-letter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;second&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Decoupling Dice of Doom’s Rules from the Rest of the Game&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Generating a Game Tree&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;产生一个game-tree，形如(player board (moves))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;first-move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-passing-move&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;
                          &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;
                          &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;
                          &lt;span class=&quot;nv&quot;&gt;first-move&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attacking-moves&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Calculating Passing Moves&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;如果是第一次移动则返回原tree的moves，如果不是则添加nil表示&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;无法移动，并递归调用game-tree添加玩家移动树&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-passing-move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;first-move&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;first-move&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-new-dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*num-players*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                           &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                           &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Calculating Attacking Moves&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;生成攻击可行的攻击game-tree中的moves&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;attacking-moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-attack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                               &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt;
                                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                               &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt;
              &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Finding the Neighbors&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;返回邻近的pos列表&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;down&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;down&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;up&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-size*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;down&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
          &lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*board-hexnum*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Attacking&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;生成attack后的board&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;第一个for为位置&lt;/span&gt;
                     &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;across&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;数组用across&lt;/span&gt;
                     &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Reinforcements&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;clean&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;根据spare-dice添加骰子,返回新的board（数组）&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-new-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cur-dice&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-dice&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-dice*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cur-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board-array&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;spare-dice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Playing Dice of Doom Against Another Human&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;The Main Loop&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;dirty&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;人人对战主函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;play-vs-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;print-info&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;announce-winner&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Giving Information About the State of the Game&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;dirty&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;打印当前信息，包括当前玩家和board&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;print-info&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;current player = ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-letter&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-board&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Handling Input from Human Players&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;dirty&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;处理人的行动的函数，根据人的输入返回不同move的子树&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;choose your move:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
          &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a. &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~a -&amp;gt; ~a&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;end turn&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;moves&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;Determining the Winner&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;winners&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tally&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;across&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;board&lt;/span&gt;
                      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;totals&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tally&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-duplicates&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tally&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;totals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;best&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                       &lt;span class=&quot;nv&quot;&gt;totals&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在可以试试新游戏：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;play-vs-human&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gen-board&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其中0代表玩家0,第二个0代表刚开始获得的骰子为0,t代表第一次移动。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;写在最后&lt;/h2&gt;

&lt;p&gt;尼玛这怎么设计出来的，看起来倒容易，设计者真值得膜拜……&lt;/p&gt;

&lt;p&gt;着一个函数接着一个函数真是超级强烈的函数式编程风格好不好，我又想起来C语言这种强烈的面向过程风格，难道函数式就是功能式，其实就是过程式？&lt;/p&gt;

&lt;p&gt;要说有什么收获，什么cddrcdar搞得更清楚了，我觉得作者用one two three什么的看起来更方便些。loop for什么for什么的across什么算是开了眼界了。其它，只让我体会到强烈的面向过程风格，作为不能完美计划所有过程的小白我还是继续看c++去比较简单…………&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>这几日</title>
   <link href="http://reverland.org/Life/2012/05/20/"/>
   <updated>2012-05-20T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/05/</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;折腾永无止境&lt;/h2&gt;

&lt;p&gt;真奇怪那天怎么就手痒了，想到去换什么ck内核。从那天下午开始，到现在，自我都一直深深地陷入折腾的巨大快感中不能自拔……神啊，让我安分点吧。&lt;/p&gt;

&lt;p&gt;简单记述下这几天的折腾，首先是ck内核，因为贪图方便直接用了&lt;a href=&quot;http://repo-ck.com/&quot;&gt;repo-ck&lt;/a&gt;的源，然后是懒得看英文的wiki，过度相信pacman的智能程度。最二的事是洁癖般的把以前的内核给废了。于是乎等到进到syslinux界面时我郁闷了，linux原来还没这么全自动……&lt;/p&gt;

&lt;p&gt;折腾之人搬起的石头终将砸到自己的脚。就在arch挂掉的前几天，蛋疼的制作了个debian+kde live usb。可惜8G的U盘被dd成1G了，我那个不爽啊，于是继续折腾下去，把liveusb格了。光驱？长久没用早挂掉了，不过还是抱着残存的幻想借张ubuntu11.10试了5、6次。&lt;/p&gt;

&lt;p&gt;不知何时有个想法，debian stable这种超级稳定物必定合我这种不爱折腾的懒人心意，于是把arch换成debian的想法便如这夏的气息，不知何时早已渗透到心中的每一个角落。于是我借个电脑，写了个debian netinstall usb。&lt;/p&gt;

&lt;p&gt;debian是好东西，安装一路顺利，本来这折腾的事情就该尘埃落定了，折腾之人又开始找事了……尼玛为什么源这么慢，为什么sawfish不会用，为什么没有fcitx，latex好像还是09的没有ctex，火狐怎么改名了还这么老版本，apt用着也没pacman好……很显然，dd了个arch netinstall……&lt;/p&gt;

&lt;p&gt;可惜arch没有debian这么稳定，虽然之前我看到提示备份的消息报以胸有成竹的轻蔑冷笑，等到我发现在格盘时心里却只剩一阵叹息，尼玛连个提醒都没有……&lt;/p&gt;

&lt;p&gt;折腾之人必遭雷劈，一切尘埃落定那刻忽然灵光一显，雷电过身，尼玛不还有sid么……&lt;/p&gt;

&lt;p&gt;回复vim配置时，我忽然觉得之前真有先见之明，竟然知道备份vim的配置，不然现在一定疯了。赶紧在github上建个仓库，我这个懒人，差点把cron都用上了……还好没折腾，不过这个早晚折腾。&lt;/p&gt;

&lt;p&gt;回复各种软件时，莫名地感激linux神奇的包管理器，要在win下我大概累死了&lt;/p&gt;

&lt;p&gt;重新下载考研资料，感谢bt上还在分享的同学，1.1M/s的满宿舍网速让考研公共课几乎瞬间回复。《十二只猴子》还没看完就下完了……&lt;/p&gt;

&lt;p&gt;网盘里lisp资料依然健在，云存储万岁！其实就是某天手贱顺手转存的事&lt;/p&gt;

&lt;p&gt;latex主要是字体，字体损失的真伤，我最可惜的就是那些gimp画笔和平时悉心收集的字体都消失了，本来有个备份结果u盘丢了。还好win下字体和adobe的中文字体都不知我何时传到115网盘了,对了，ctex配置还没改……现在觉得分享是件多么利人利己的事了，好在某天无意间找到并且写道archwiki上了，不然现在怎么也找不到那个文件的位置…………Knowledge for humanbeings&lt;/p&gt;

&lt;p&gt;然后git clone下来我那被我手刃的面目全非的jekyll博客&lt;/p&gt;

&lt;p&gt;装个xp虚拟机，虽然可能几个月才开一次，但人要未雨绸缪，防患于未然，真是要用了也没办法，比如那傻逼的word什么的，或者是二逼的IE什么的……&lt;/p&gt;

&lt;p&gt;然后，去的就让他去吧，卸下过去的包袱就是新的明天，这次系统挂掉未必不是好事。&lt;/p&gt;

&lt;p&gt;但折腾之人依然很残念，尼玛我的Tor挂了，上不了twitter了，上不了youbube了，google邮件组，docs都上不了了，尼玛还天天莫名奇妙的重置，伟大的长城不要什么的误伤吧……这时候一个叫tsocks的神奇东西拯救了我再也连不上的洋葱头，洋葱头这东西会缓存节点，一次连上以后都没问题了。&lt;/p&gt;

&lt;p&gt;我又照着wiki认真的把grub换成grub2,从新增加个ck内核，打开传说中的Brain Fuck queue.哈，运行如飞，kde秒杀一切windows/mac系统，秒开的快感让人欲罢不能。&lt;/p&gt;

&lt;p&gt;其它时间我还干了些什么呢？在论坛上水啊水啊，看c++,看看lisp终于看懂了。&lt;/p&gt;

&lt;p&gt;第一天下午对计算机坐太久了，第二天就感冒了，尼玛……我要匀出更多时间去锻炼身体，反正没有妹子，没有各种应酬，只要我不折腾，时间总会有的。但为什么坐我旁边一天到晚dota的室友就没事…………&lt;/p&gt;

&lt;p&gt;花了几天让arch回血回魔，现在终于满状态了。&lt;/p&gt;

&lt;p&gt;也该花点精力回复自己的状态了。那什么通信原理，好歹继续看吧，不然考毛研……&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>又折腾了</title>
   <link href="http://reverland.org/Life/2012/05/18/"/>
   <updated>2012-05-18T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/05/</id>
   <content type="html">
&lt;h2 id=&quot;ck&quot;&gt;从ck内核开始&lt;/h2&gt;

&lt;p&gt;前天晚上，在推上看到maplebeat在编译ck内核，念ck内核吾亦仰慕已久，再加BFS对我这种点开什么都等两秒的机子吸引力十足。遂有了换内核的想法。&lt;/p&gt;

&lt;p&gt;第二天，贪图方便的我加上了仰慕已久的ck内核源，更新什么都很顺利,然后我顺手把以前的内核给删了……这是悲剧的开始&lt;/p&gt;

&lt;p&gt;然后想就没想就重启了，然后……停在syslinux进不去系统了……&lt;/p&gt;

&lt;p&gt;几天前刚把debian liveusb废掉，光盘送人了……&lt;/p&gt;

&lt;p&gt;不过还是借到了张ubuntu11.10的盘，却悲催的发现大概我光驱废了…………&lt;/p&gt;

&lt;p&gt;怀着对debian的强烈敬仰之情&lt;/p&gt;

&lt;p&gt;借室友电脑下个debian netinstall 做个usb启动盘……&lt;/p&gt;

&lt;p&gt;it works，debian I came！&lt;/p&gt;

&lt;p&gt;痛苦地发现apt不习惯……&lt;/p&gt;

&lt;p&gt;痛苦地发现源的速度只有arch的十分之一……&lt;/p&gt;

&lt;p&gt;先下个小点的桌面环境吧，我望着1.8G的kde想，不知道debian有没拆kde的包&lt;/p&gt;

&lt;p&gt;lxde见过了，要么来个arch上没有的？&lt;/p&gt;

&lt;p&gt;clfswm和stumpwm这种神器我暂时是玩不起&lt;/p&gt;

&lt;p&gt;干脆，sawfish吧&lt;/p&gt;

&lt;p&gt;擦，装上发现不会用……根本就startx不起来……&lt;/p&gt;

&lt;p&gt;算了，openbox……&lt;/p&gt;

&lt;p&gt;终于有X可以用了&lt;/p&gt;

&lt;p&gt;上网怎么办呢，装个火狐吧。&lt;/p&gt;

&lt;p&gt;怎么也找不到…………&lt;/p&gt;

&lt;p&gt;找到个icewesel什么的，我忽然想起了什么&lt;/p&gt;

&lt;p&gt;装上，这玩意相当于firefox3.5…………&lt;/p&gt;

&lt;p&gt;然后呢，输入法得有吧，没有小企鹅…………&lt;/p&gt;

&lt;p&gt;texlive是09的，没有ctex宏包！&lt;/p&gt;

&lt;p&gt;God，我还是回arch去吧&lt;/p&gt;

&lt;p&gt;于是dd出个arch netinstall&lt;/p&gt;

&lt;h2 id=&quot;arch&quot;&gt;手抖在arch结束&lt;/h2&gt;

&lt;p&gt;要说还是debian好，安装过程很清晰明白，我home中的东西都没损失&lt;/p&gt;

&lt;p&gt;装arch时我想很随意嘛，虽然看到之前的建议备份的warning&lt;/p&gt;

&lt;p&gt;arch都装过多少遍了，怕什么&lt;/p&gt;

&lt;p&gt;天有不测风云，安装介质貌似有变……&lt;/p&gt;

&lt;p&gt;当我发现arch正在格盘时我才意识到发生了什么&lt;/p&gt;

&lt;p&gt;妹的连个提示都没！&lt;/p&gt;

&lt;p&gt;抱着侥幸心理停掉安装过程重启&lt;/p&gt;

&lt;p&gt;把硬盘挂载上看看，你妹……&lt;/p&gt;

&lt;p&gt;默默重装&lt;/p&gt;

&lt;h2 id=&quot;post-reinstall&quot;&gt;post reinstall&lt;/h2&gt;

&lt;p&gt;恢复是漫长而漫长的&lt;/p&gt;

&lt;p&gt;好在vim配置有备份&lt;/p&gt;

&lt;p&gt;lisp的资料分布在git和网盘中&lt;/p&gt;

&lt;p&gt;考研的资料分享给同学了^_^&lt;/p&gt;

&lt;p&gt;其它也没什么眷恋的&lt;/p&gt;

&lt;p&gt;可惜我那一堆公共课资料&lt;/p&gt;

&lt;p&gt;wych分享的matlab 2010 for linux&lt;/p&gt;

&lt;p&gt;firefox从去年七月保留至今的历史和书签&lt;/p&gt;

&lt;p&gt;一大堆资料、课件，算了，这个我也不会去怎么看&lt;/p&gt;

&lt;p&gt;几部电影，反正我从来不看，不知道下来干嘛&lt;/p&gt;

&lt;p&gt;一堆音乐，反正是从别人那拷来的，也很少听&lt;/p&gt;

&lt;p&gt;vbox下的lfs和gentoo残迹，没了就没了&lt;/p&gt;

&lt;p&gt;悲催的恢复了一个晚上&lt;/p&gt;

&lt;p&gt;kde反正不怎么配置，除了把特效打开，关掉文件索引&lt;/p&gt;

&lt;p&gt;vim更没事了&lt;/p&gt;

&lt;p&gt;yakuake/sbcl/clisp/krdc/okular……重装就是&lt;/p&gt;

&lt;p&gt;texlive装上就是&lt;/p&gt;

&lt;p&gt;唯一麻烦点的是字体，废力去找了半天，才想起来网盘里有，it sucks！&lt;/p&gt;

&lt;p&gt;vbox下的xp，还得重下，不过没费什么事。&lt;/p&gt;

&lt;p&gt;firefox缓慢恢复中，看到漫篇广告才想起来adblock一直默默无闻的工作&lt;/p&gt;

&lt;p&gt;stardict备过份这么大文件还不如重装……&lt;/p&gt;

&lt;p&gt;折腾了近一天总算回到arch了，速度不错，比以前快多了，有些莫名奇妙的bugs也消失了。&lt;/p&gt;

&lt;p&gt;其实真不该去试debian，更不该开始手贱把内核删了。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;血的教训，前车之鉴，以警来者：&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;关键东西要云备份&lt;/li&gt;
  &lt;li&gt;少折腾谨防，手抖&lt;/li&gt;
  &lt;li&gt;其实折腾到其它地方未必会满意，珍惜眼前&lt;/li&gt;
  &lt;li&gt;自以为是是要付出代价的，不可轻敌&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;唉，reverland写于2012年05月18日 星期五 17时15分05秒&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>函数式编程初体验</title>
   <link href="http://reverland.org/lisp/2012/05/14/"/>
   <updated>2012-05-14T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;跑题的前言&lt;/h2&gt;

&lt;p&gt;光阴飞逝，这本书已经看了半个月了。我没想过会这么啃一本英文书，收获良多，疑惑也多。匆匆学习到这一章时，再回头看前面的，恍若隔世。人的忘性还是很大的，如果不使用，终归一定会忘记的。希望自己能将这个爱好坚持下去，在此祭奠遗忘的R和perl。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-1&quot;&gt;什么是函数式编程&lt;/h2&gt;
&lt;p&gt;我是从来看不进去定义的，实例更符合我认识世界的习惯，所以有人想明白什么是函数式编程，请参看&lt;a href=&quot;http://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B8%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80&quot;&gt;维基百科&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;关于函数式编程的特性和优点，阮一峰的日志有个比较好的笔记:&lt;a href=&quot;http://www.ruanyifeng.com/blog/2012/04/functional_programming.html&quot;&gt;函数式编程初探&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;section-2&quot;&gt;特性&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;函数式编程对同样的参数总会给出同样的值&lt;/li&gt;
  &lt;li&gt;函数式编程不会产生副作用，仅仅返回一个计算的结果&lt;/li&gt;
  &lt;li&gt;还有种像菜谱式的程序被认为是脏的程序，但能直接做很多事。纯函数完全不能做任何事，所以函数式编程通常将这两种程序分开。&lt;/li&gt;
  &lt;li&gt;函数式编程可以写得更快、更紧凑、更少bug。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-3&quot;&gt;实例&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;the clean, functional part&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-widget&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;database&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;widget&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;widget&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;database&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;the dirty, nonfunctional part&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*database*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;main-loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Please enter the name of a new widget:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*database*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-widget&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*database*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The database contains the following: ~a~%&amp;quot;&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*database*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*my-list*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;For demonstration purposes only. A lisper would not write code like this.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*my-list*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*my-list*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*my-list*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;vg&quot;&gt;*my-list*&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-two&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-two&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-two&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;A lisper will use high-order function like this&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</content>
 </entry>
 
 <entry>
   <title>Lisp Web Server</title>
   <link href="http://reverland.org/lisp/2012/05/12/web-server-written-in-lisp"/>
   <updated>2012-05-12T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/12/web-server-written-in-lisp</id>
   <content type="html">
&lt;h2 id=&quot;section&quot;&gt;关于服务器&lt;/h2&gt;

&lt;p&gt;首先我们要知道服务器是怎么工作的。如下图(有没有很熟悉?)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/server.dot.png&quot; alt=&quot;Alt 服务器工作原理&quot; /&gt;&lt;/p&gt;

&lt;p&gt;浏览器负责接收和渲染服务器返回的信息，服务器解析浏览器发送的报文并返回正确的信息。两方通过socket来进行通信。&lt;/p&gt;

&lt;p&gt;浏览器发给服务器的报文应该是这样的，这是我从firebug中复制的：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;GET /greeting HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;X11; Linux x86_64; rv:12.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Gecko/20100101 Firefox/12.0
Accept: text/html,application/xhtml+xml,application/xml;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9,*/*;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8
Accept-Language: zh-cn,zh;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8,en-us;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5,en;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.3
Accept-Encoding: gzip, deflate
DNT: 1
Connection: keep-alive
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其中第一行中间是url，说到url，如果url是这样&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;/greeting?name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;bob
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;？后面的称作参数&lt;/p&gt;

&lt;p&gt;还有种叫作Post请求方法，该方法向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。&lt;/p&gt;

&lt;p&gt;如果是post request,应该像下面这样,最后一行也是参数。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;POST /login.html HTTP/1.1
Host: www.mywebsite.com
User-Agent: Mozilla/5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;X11; U; Linux i686; en-US; rv:1.9.0.5&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Accept: text/html,application/xhtml+xml,application/xml;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.9,*/*;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.8
Accept-Language: en-us,en;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.7,*;q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.7
Keep-Alive: 300
Connection: keep-alive
Content-Length: 39

&lt;span class=&quot;nv&quot;&gt;userid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;foo&amp;amp;password&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;supersecretpassword
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;lisp&quot;&gt;如何以lisp的方式处理&lt;/h2&gt;

&lt;p&gt;在common lisp中，我们可以通过socket stream来完成服务器和浏览器的通信，通过把http报文转换成alist形式存储在clisp webserver中，同时完成对浏览器相应信息的响应。&lt;/p&gt;

&lt;p&gt;因为网络中有许多意料之外的例外错误，为了确保发生错误后程序继续运行，比如说让webserver出错后可以正确关闭socket。可以使用unwind-protect.&lt;/p&gt;

&lt;p&gt;源码如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;;;这是一个简单的lisp服务器示例&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Decoding the Values of Request Parameters&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;将c1和c2两个字符读为16进制数并返回对应ascii码符号&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;http-char&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;&amp;amp;optional&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;parse-integer&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;ss&quot;&gt;:radix&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;
                &lt;span class=&quot;ss&quot;&gt;:junk-allowed&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;code-char&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;分别讨论&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;%后为16进制数，转化为相应ascii码字符&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;+转化位空格&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;decode-param&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;#\%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;http-char&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;#\+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\space&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;otherwise&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;将字符串拆成列表处理再转成字符串&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;可以用以下命令查看效果&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(decode-param &amp;quot;foo&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(decode-param &amp;quot;foo%3F&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(decode-param &amp;quot;foo+bar&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Decoding Lists of Request Parameters&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;store these parameters as an alist&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;递归调用，将形如name=bob&amp;amp;age=25的东西变成&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;((name . &amp;quot;bob&amp;quot;) (age . &amp;quot;25&amp;quot;))这样的alist&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;parse-params&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;intern&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string-upcase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; 
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;decode-param&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;parse-params&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;?后两行经测试完全可以不要……&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;?&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Parsing the Request Header&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;从http报表头中抽取url，并把其余部分保存为alist&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;GET /this/is/url?name=bob&amp;amp;gender=female HTTP/1.1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;parse-url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\space&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\space&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:from-end&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\?&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;parse-params&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;;注意+1所以要分情况讨论&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;可以用以下看看效果&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(parse-url &amp;quot;GET /lolcats.html?name=bob&amp;amp;gender=female HTTP/1.1&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;将http报表的body部分解析成alist形式&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;name: bob-&amp;gt;(name . &amp;quot;bob&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-header&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-line&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;intern&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string-upcase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;h&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-header&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;可以用以下命令看效果&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(get-header (make-string-input-stream &amp;quot;foo: 1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;bar: abc, 123&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;&amp;quot;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Parsing the Request Body&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;解析post request中最后一行,填充进content-length长的字符串中&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-content-params&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;content-length&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;parse-integer&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-sequence&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;parse-params&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;;;The serve function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;serve&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;request-handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket-server&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;unwind-protect&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;错误保护&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-stream&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket-accept&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;parse-url&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-line&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                     &lt;span class=&quot;c1&quot;&gt;;读出stream中第一行并解析出url，留下剩下的行&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-header&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                     &lt;span class=&quot;c1&quot;&gt;;将header解析&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; 
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-content-params&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                     &lt;span class=&quot;c1&quot;&gt;;将post request最后一行解析与url中内容一起放进&lt;/span&gt;
                     &lt;span class=&quot;c1&quot;&gt;;params里&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;*standard-output*&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;request-handler&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket-server-close&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;关闭socket&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Building a Dynamic Website&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hello-request-handler&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;header&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;greeting&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;name&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;form&amp;gt;What is your name?&amp;lt;input name=&amp;#39;name&amp;#39; /&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;/html&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;HTTP/1.1 200 OK&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;Nice to meet you, ~a!&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Sorry... I don&amp;#39;t know that page.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-1&quot;&gt;学到的命令&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;parse-integer&lt;/li&gt;
  &lt;li&gt;code-char&lt;/li&gt;
  &lt;li&gt;position&lt;/li&gt;
  &lt;li&gt;subseq&lt;/li&gt;
  &lt;li&gt;intern&lt;/li&gt;
  &lt;li&gt;make-string&lt;/li&gt;
  &lt;li&gt;read-sequence&lt;/li&gt;
  &lt;li&gt;with-open-stream&lt;/li&gt;
  &lt;li&gt;unwind-protect&lt;/li&gt;
  &lt;li&gt;read-line&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-2&quot;&gt;写在最后&lt;/h2&gt;

&lt;p&gt;其实这个webserver还是有很多疑惑的。&lt;/p&gt;

&lt;p&gt;首先，实际操作中我在firebugs中并没有看到Post request，&lt;strike&gt;邮件组中热心人说可以用telnet来查看交互信息但我不会。所以对content-length的处理就感觉挺蹊跷（liutos同学似乎也这样认为）。可能通信时为了准确性都要验证吧。&lt;/strike&gt;&lt;/p&gt;

&lt;p&gt;其二是照书上源码和网上提供的源码返回给浏览器的是plain text而非解析为html，经参照服务器返回信息添加上&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;HTTP/1.1 200 OK
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;同时保证html5标准，不要漏掉一大堆head、body、html标签。&lt;/p&gt;

&lt;p&gt;最后还有对parse-params的处理，为什么要分三种情况处理?我把后两种去掉后也能正常运行,还是说三种情况容错性好？&lt;strike&gt;我不明白，这个问题留待高人吧。&lt;/strike&gt;&lt;/p&gt;

&lt;p&gt;edit:第二种情况处理末尾，虽然对commonlisp来说没有指定输入nil的情况也会输出nil，秉持着递归时考虑所有情况的lisper们还是会写出来。另外最后一种情况处理错误情况，以防出现中断.&lt;/p&gt;

&lt;p&gt;如果webserver不能正常工作，可以用telnet来测试。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;telnet 127.0.0.1 8080
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;最后对Purity和liuto的解惑与帮助致以诚挚谢意。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Streams in Lisp</title>
   <link href="http://reverland.org/lisp/2012/05/10/streams-in-lisp"/>
   <updated>2012-05-10T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/10/streams-in-lisp</id>
   <content type="html">
&lt;p&gt;lisp中有多种流，不同的流与不同的资源交互。这些流包括控制台流，文件流，socket流和字符串流。&lt;/p&gt;

&lt;p&gt;流的处理方式是popup和push.&lt;/p&gt;

&lt;p&gt;流可依据方向分为输入流和输出流。&lt;/p&gt;

&lt;p&gt;Socket流允许网络上的计算机程序进行通信。我们必须在通信的两端都打开socket并且在程序间建立连接。&lt;/p&gt;

&lt;p&gt;字符串流允许我们使用不需要连接外部资源来使用流的函数来调试，同时能帮我们用优美有效率的方法（with-open-to-string）来建立复杂字符串。但这个宏不符合函数式编程原则，争议很大。&lt;/p&gt;

&lt;p&gt;下面是使用stream的一些例子&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;在做图的那部分已经见识过了&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;to see if we have a valid output stream&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;output-stream-p&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*standard-output*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;;;write a chracter to stream&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;write-char&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\x&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*standard-output*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;;to see if we have a valid stream&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;input-stream-p&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*standard-input*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;pop an item off the stream&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-char&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*standard-input*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;123&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;\#1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;reading and printing can be used too&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;reading and writing with files&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;data.txt&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;my data&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;data.txt&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;some more complicated examples using print and read&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-noises&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dog&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;woof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;meow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;animal-noises.txt&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal-noises&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;animal-noises.txt&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;if exists&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;data.txt&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:output&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:if-exists&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;my data&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;data.txt&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:output&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:if-exists&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:supersede&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;my data&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;stream over a socket&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-socket&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket-server&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4321&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE SERVER&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket-accept&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE SERVER&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;It&amp;#39;s a bidirectional stream&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;princ may cause strange things&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Yo Server!&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE CLIENT&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE SERVER&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;What up, Client!&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE SERVER&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE CLIENT&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;tidying up after ourselves&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;close&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON BOTH&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;socket-server-close&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;ON THE SERVER&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;String Streams: The Oddball Type&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;They are useful for debugging, &lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;as well as for creating complex strings efficiently.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-string-output-stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This will go into foo. &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This will also go into foo. &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;get-output-stream-string&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;with-output-to-string&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-output-to-string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;*standard-output*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;the sum of &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; and &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; is &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;正如你所见，我们之前用过这些流，来完成与外界资源的交互。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;学习到这些命令&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;output-steam-p/input-stream-p&lt;/li&gt;
  &lt;li&gt;write-char/read-char&lt;/li&gt;
  &lt;li&gt;with-open-file&lt;/li&gt;
  &lt;li&gt;make-string-output-stream&lt;/li&gt;
  &lt;li&gt;get-output-stream-string&lt;/li&gt;
  &lt;li&gt;with-output-to-string&lt;/li&gt;
  &lt;li&gt;close&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;clisp中特有：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;socket-server&lt;/li&gt;
  &lt;li&gt;socket-accept&lt;/li&gt;
  &lt;li&gt;socket-server-close&lt;/li&gt;
&lt;/ul&gt;
</content>
 </entry>
 
 <entry>
   <title>Attack of the Robots</title>
   <link href="http://reverland.org/lisp/2012/05/09/attack-of-the-robots"/>
   <updated>2012-05-09T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/09/attack-of-the-robots</id>
   <content type="html">
&lt;h2 id=&quot;powerful-format&quot;&gt;Powerful format&lt;/h2&gt;

&lt;p&gt;format又是一个在common lisp中灵活“过头”，争议超多的一个宏。它十分强大。&lt;/p&gt;

&lt;p&gt;基本用法如下&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;reverse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Add onion rings for only ~$ dollars more!&amp;quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;;;;Control sequences for printing lisp values&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;(prin1 &amp;quot;foo&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~s in the middle of this sentence&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;(princ &amp;quot;foo&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~a in the middle of this sentence&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;第一个参数,右边补白&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~10a within ten spaces of room.&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;第二个参数，分成3部分，补白9格&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~10,3a within ten (or more) spaces of room.&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;第三个参数，右边补白4格&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~,,4a in the middle of this sentence.&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;第四个参数，补充符号&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The world ~,,4,&amp;#39;!a feels very important.&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The world ~,,4,&amp;#39;!@a feels very important.&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Control Sequences for formatting numbers&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Integers&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The number 1000 in hexadrcimal is ~x&amp;quot;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The number 1000 in hexadrcimal is ~b&amp;quot;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The number 1000 in hexadrcimal is ~d&amp;quot;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;digit group separators&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Numbers with commas in them are ~:d times better.&amp;quot;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~10d within ten spaces of room.&amp;quot;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I am printing ~10,&amp;#39;xd within ten spaces of room.&amp;quot;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Control Sequences for formatting Floating-point numbers&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;default&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;PI can be estimated as ~4f&amp;quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3.141593&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;小数点后数位&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;PI can be estimated as ~,4f&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Percentage&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Percentages are ~,,2f percent better than fractions&amp;quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.77&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Format currency&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;I wish I had ~$ dollars in my bank account.&amp;quot;&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1000000.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Print multiple lines of output&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;terpri&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;terpri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;33&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;fresh-line&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;33&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;~% like terpri&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;~&amp;amp; like fresh-line&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This is on one line ~%&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~%This is on another line&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;This is on one line ~&amp;amp;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~&amp;amp;This is on another line&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;there can be a number in front of them&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;this will print ~5%on two lines spread far apart&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;this will print ~5&amp;amp;on two lines spread far apart&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Justifying output&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;for example a function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;dog&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;tick&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;tiger&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;walrus&amp;quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kangaroo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;equally width&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~5t~a ~15t~a ~25t~a~%&amp;quot;&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;equally apart&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~30&amp;lt;~a~;~a~;~a~&amp;gt;~%&amp;quot;&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;center&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~30:@&amp;lt;~a~&amp;gt;~%&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~30:@&amp;lt;~a~;~a~;~a~&amp;gt;~%&amp;quot;&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;still wavy?to make it like this&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~10:@&amp;lt;~a~&amp;gt;~10:@&amp;lt;~a~&amp;gt;~10:@&amp;lt;~a~&amp;gt;~%&amp;quot;&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Iterating Through Lists Using Control Sequences&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Lets create a list of animals&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;loop through sequenses&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~{I see a ~a! ~%~}&amp;quot;&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;;;not only one item&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~{I see a ~a... or was it a ~a?~%~}&amp;quot;&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;A crazy formatting trick for creating pretty tables of data&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;|~{~&amp;lt;|~%|~,33:;~2d ~&amp;gt;~}|&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;可以看到，format的参数多的……而且像perl一样有很多“奇怪”的符号。&lt;/p&gt;

&lt;h2 id=&quot;attack-by-robots&quot;&gt;Attack by robots&lt;/h2&gt;

&lt;p&gt;让我们接下来看看一个被作者称作可怕的游戏，It’s really drive me crazy!!&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;;整个界面大小为16x64，产生个1024长度序列&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;robots&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;named&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;便于跳出&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;;方向&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;directions&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-65&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-63&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;   &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;63&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;65&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;;初始位置&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;544&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;~%qwe/asd/zxc to move, (t)eleport, (l)eave:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;force-output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;clean any output not waiting return&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;directions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;l&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;return-from&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;bye&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;;;获得monster的位置&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
                          &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mpos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mpos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                          &lt;span class=&quot;nv&quot;&gt;mpos&lt;/span&gt;
                          &lt;span class=&quot;c1&quot;&gt;;;都走了一遍。&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;directions&lt;/span&gt;
                                            &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-mpos&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mpos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                            &lt;span class=&quot;c1&quot;&gt;;行与列距离和与新位置cons                                &lt;/span&gt;
                                            &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-mpos&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
                                                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-mpos&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                                                          &lt;span class=&quot;nv&quot;&gt;new-mpos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                      &lt;span class=&quot;ss&quot;&gt;&amp;#39;&amp;lt;&lt;/span&gt;
                                      &lt;span class=&quot;ss&quot;&gt;:key&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
     &lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mpos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;always&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mpos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
     &lt;span class=&quot;nb&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;player-wins&lt;/span&gt;
     &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;
                &lt;span class=&quot;s&quot;&gt;&amp;quot;~%|~{~&amp;lt;|~%|~,65:;~A~&amp;gt;~}|&amp;quot;&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; 
                      &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;
                      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;return-from&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;main&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;player-loses&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                           &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                    &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
                                     &lt;span class=&quot;sc&quot;&gt;#\@&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; 
                                     &lt;span class=&quot;sc&quot;&gt;#\ &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;整个游戏就一个函数，由loop和format这种强大的lisp异类来完成。&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;写在最后&lt;/h2&gt;

&lt;p&gt;挺好玩的一个游戏。挺难理解的代码……&lt;/p&gt;

&lt;p&gt;为了看懂又回头看看作者的loop周期表，再次见识了format和loop的强大之处，也感受到了它们的复杂。&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Using Loop To Evolve</title>
   <link href="http://reverland.org/lisp/2012/05/06/using-loop-to-evolve"/>
   <updated>2012-05-06T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/06/using-loop-to-evolve</id>
   <content type="html">
&lt;h2 id=&quot;loop&quot;&gt;满目的loop&lt;/h2&gt;

&lt;p&gt;loop是lisp中饱受争议的命令，因为它看起来不这么lispy，但它真得很强大。以下列举下基本用法：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;;counting from a starting point to an ending point&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;iterating through values in a list&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;doing stuff in a loop&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;dong stuff under certain conditions&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;oddp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;breaking out of a loop early&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;falafel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;collecting a list of values&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;using multiple for clauses&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;loop 10 times&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;nested loops for 10x10 times&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
                    &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;track the index number of items in a list&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;day&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monday&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tuesday&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wednesday&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;thursday&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;friday&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;saturday&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sunday&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;day&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当然还有很多，这个命令异常灵活，以致于作者做了个&lt;a href=&quot;http://landoflisp.com/&quot;&gt;loop周期表&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;using-loop-to-evolve&quot;&gt;Using Loop to Evolve&lt;/h2&gt;

&lt;p&gt;这个游戏看上去还挺轻松的，很有意思的“生命游戏”。不多说了，上码&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;;The extent of the world&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*width*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*height*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*jungle*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plant-energy*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Growing plants in our world&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;cons cells should be compared with equal&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plants*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Grow new plants&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;random-plant&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;top&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;top&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plants*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-plants&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-plant&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*jungle*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-plant&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*width*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*height*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Creating animals&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;energy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;x,y stand for the position&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;energy represent its energy,when the energy exhausted,it will die&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;dir is the direction it faced&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;genes decide the direction it will choose&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Creating an animal in the center of the map&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-animal&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:x&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;we only use list to traverse animal,&lt;/span&gt;
                     &lt;span class=&quot;c1&quot;&gt;;its efficient enough.&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*width*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;ss&quot;&gt;:y&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*height*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;ss&quot;&gt;:energy&lt;/span&gt;
                     &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;
                     &lt;span class=&quot;ss&quot;&gt;:dir&lt;/span&gt;
                     &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                     &lt;span class=&quot;ss&quot;&gt;:genes&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
                           &lt;span class=&quot;c1&quot;&gt;;collect is OK??&lt;/span&gt;
                           &lt;span class=&quot;nv&quot;&gt;collecting&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Handling animal motion&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-dir&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;如果达到*width*,置0&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;
                                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                          &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                    &lt;span class=&quot;vg&quot;&gt;*width*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                 &lt;span class=&quot;vg&quot;&gt;*width*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;
                                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                          &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                    &lt;span class=&quot;vg&quot;&gt;*height*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                 &lt;span class=&quot;vg&quot;&gt;*height*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-energy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Handling animal turning&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;turn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-genes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;;this was not easy to understand it,&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;;当随机数落在哪个区间就哪个方向的递归描述&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;angle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;xnu&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xnu&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;angle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;xnu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-dir&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-dir&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;angle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-genes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
              &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Handling animal eating&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;eat&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plants*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;incf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-energy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plant-energy*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remhash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plants*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Handling animal reproduction&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义繁殖时需要能量&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*reproduction-energy*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;reproduce&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-energy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*reproduction-energy*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-energy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-nu&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;copy-structure&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;浅复制命令&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;copy-list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-genes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;mutation&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mutation&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;mutation&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;This means the gene value will change plus or minus one, or&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;stay the same.&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-genes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal-nu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;genes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal-nu&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Simulating a day in our world&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;update-world&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-energy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                             &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;turn&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;eat&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;reproduce&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-plants&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Drawing our world&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;This has low performance but will not matters&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-world&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*height*&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; 
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;outputs a newline only if the output-stream&lt;/span&gt;
             &lt;span class=&quot;c1&quot;&gt;;is not already at the start of a line&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;|&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;
                   &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*width*&lt;/span&gt;
                   &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                     &lt;span class=&quot;c1&quot;&gt;;可能不止一个动物&lt;/span&gt;
                                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;animal-y&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                          &lt;span class=&quot;vg&quot;&gt;*animals*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                    &lt;span class=&quot;sc&quot;&gt;#\M&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*plants*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;|&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Creating a user interface&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;evolution&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-world&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;quit&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;Recall Conrad’s Rule of Thumb for Comparing Stuff&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;use eq for symbols&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;use equal for everything else&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;parse-integer&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:junk-allowed&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;
                       &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;
                       &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;update-world&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                       &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                       &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;update-world&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;evolution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这样开始模拟&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;evolution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;回车看看，100次看看，5000000次看看，据作者说5million次sbcl几分钟就可以搞定。我相信我的计算机比作者那时候好，可是….&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;nv&quot;&gt;Evaluation&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;took:&lt;/span&gt;
  &lt;span class=&quot;mf&quot;&gt;789.430&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;seconds&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;real&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;
  &lt;span class=&quot;mf&quot;&gt;459.846682&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;seconds&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;total&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;456.986869&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;user,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.859813&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Run&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;times&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;consist&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;18.864&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;seconds&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;GC&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;440.983&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;seconds&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;non-GC&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;58.25%&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;CPU&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;785&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;005&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;533&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;676&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;processor&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cycles&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;125&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;872&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;778&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;768&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bytes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;consed&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;什么叫手抖竟然开始打成了5billion.这时候科学计数法就发挥作用了，感谢自由建客。
***
Looks good however，&lt;/p&gt;

&lt;p&gt;M代表某无性生殖动物，&lt;code&gt;*&lt;/code&gt;代表某随机生长植物&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://lhtlyybox.googlecode.com/files/%E6%8A%93%E5%9B%BE75.png&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;虚拟进化&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;写在最后&lt;/h2&gt;

&lt;p&gt;资源丰富区自然选择留下了那些逡巡不前的，资源短缺区留下了富于冒险的。&lt;/p&gt;

&lt;p&gt;之后有上网查查其它进化游戏，发现资源丰富时资源消耗小的被淘汰，资源缺乏时资源消耗大的被淘汰&lt;/p&gt;

&lt;p&gt;启发性的游戏啊&lt;/p&gt;

&lt;p&gt;最后看了个有关进化选择的视频，是某研究人员们通过进化设计人工大脑的，感觉很震惊。特别是看到最后对之失控，看到人工大脑进化出意想不到的特性时。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>The Orc Battle Game</title>
   <link href="http://reverland.org/lisp/2012/05/03/the-orc-battle-game"/>
   <updated>2012-05-03T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/03/the-orc-battle-game</id>
   <content type="html">
&lt;h2 id=&quot;lisp&quot;&gt;Lisp中的特殊数据结构&lt;/h2&gt;

&lt;p&gt;引用原文中的话来形容Lisp,&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;Think of the Babel fish in the Hitchhiker’s Guide to the Galaxy trilogy—something 
so impossibly useful that it really has no business existing in the first place.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;现在知道land of lisp的作者为什么把common lisp比作狼狗，为什么说cl强大了。支持list也就算了，支持个array、hash table、OOp、范型(generic)什么乱七八糟一堆其它语言中各种强大的东西，这么逆天的东西根本就不该存在！不过作为代价，丧失了一种纯粹的美。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;nv&quot;&gt;lisp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;symmetry,while&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;common&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lisp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;powerful.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;arrays&quot;&gt;Arrays&lt;/h3&gt;

&lt;p&gt;一些有用的命令&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;make-array&lt;/li&gt;
  &lt;li&gt;aref&lt;/li&gt;
  &lt;li&gt;setf&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;array有比列表更高的效率&lt;/p&gt;

&lt;h3 id=&quot;hash-table&quot;&gt;Hash Table&lt;/h3&gt;

&lt;p&gt;这玩意强到逆天：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;make-hash-table&lt;/li&gt;
  &lt;li&gt;gethash&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section&quot;&gt;返回多值&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;round&lt;/li&gt;
  &lt;li&gt;values&lt;/li&gt;
  &lt;li&gt;multiple-value-bind&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;hash表性能总体还是很高的..比如说我们上回写的wumpus游戏，我们可以分别对hash表和alists运行效率做如下对比。先看alists：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/home/lyy/Documents/lisp/wumpus.lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*edge-num*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*node-num*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dotimes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-connected&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;好吧，我花的时间：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dotimes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-connected&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Real&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;64.1503&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sec.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Run&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;64.025826&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sec.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Space:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;75275184&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Bytes&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GC:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;65&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;GC&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.43664&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sec.&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;NIL&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;下面我们更改之前的wumpus游戏。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;生成hash表的边版本&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hash-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;mapc返回副作用&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;推入新值&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;生成hash表。如果与node相连，则hash表中值为t&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-connected-hash&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-hash-table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;traverse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;非则执行&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;traverse&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;gethash&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;traverse&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;可以看看什么样的&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;看看运行时间&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dotimes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-connected-hash&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hash-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;很显然，效率高多了：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dotimes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-connected-hash&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hash-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Real&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.530112&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sec.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Run&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.526567&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sec.&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;Space:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64337496&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Bytes&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GC:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;GC&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.366641&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sec.&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;NIL&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;structures&quot;&gt;Structures&lt;/h3&gt;

&lt;p&gt;构建structure可以直接用defstruct：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;person&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;age&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;waist-size&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;favorite-color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;然后进行跟改&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bob*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-person&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Bob&amp;quot;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;make-person函数自动生成&lt;/span&gt;
                                 &lt;span class=&quot;ss&quot;&gt;:age&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;35&lt;/span&gt;
                                 &lt;span class=&quot;ss&quot;&gt;:waist-size&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;
                                 &lt;span class=&quot;ss&quot;&gt;:favorite-color&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;vg&quot;&gt;*bob*&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;查看&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;#S(person :name &amp;quot;rob&amp;quot; :age 35 :waist-size 32 :favorite-color &amp;quot;blue&amp;quot;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;person-age&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bob*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;自动生成person-age函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;person-age&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*bob*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;36&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;generical programming&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;也可以直接这样：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*that-guy*&lt;/span&gt; &lt;span class=&quot;l-Other&quot;&gt;#S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;rob&amp;quot;&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:age&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;35&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:waist-size&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;
                                   &lt;span class=&quot;ss&quot;&gt;:favorite-color&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;blue&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*that-guy*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;generical-programming&quot;&gt;Generical Programming&lt;/h3&gt;

&lt;p&gt;有些范函可以接受多种类型参数,典型的sequence函数有：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;length&lt;/li&gt;
  &lt;li&gt;sequence&lt;/li&gt;
  &lt;li&gt;find-if&lt;/li&gt;
  &lt;li&gt;count&lt;/li&gt;
  &lt;li&gt;position&lt;/li&gt;
  &lt;li&gt;some&lt;/li&gt;
  &lt;li&gt;every&lt;/li&gt;
  &lt;li&gt;reduce&lt;/li&gt;
  &lt;li&gt;subseq&lt;/li&gt;
  &lt;li&gt;sort&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;通过类型检验创建generic function是可行的但不太好。有种叫作type dispatching的东西可以让用户自己通过defmethod来定义generic function。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;the-orc-battle-game&quot;&gt;The Orc Battle Game&lt;/h2&gt;

&lt;p&gt;好了，之前全是扯淡。开始进入正题，写我们的新游戏：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;;player的三属性&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;monsters&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;各种怪物&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-num*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;;;;main function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;orc-battle&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;init-monsters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;init-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You have been killed. Game Over.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monsters-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Congratulations! You have vanquished all of your foes.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;define game loop&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monsters-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;show-player&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;依据敏捷计算攻击次数&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dotimes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;truncate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monsters-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;show-monsters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;player-attack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;list&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-attack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-loop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;manage players function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;init-player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player-dead&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;show-player&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You are a valiant knight with a health of &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;, an agility of &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;, and a strength of &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;player-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Attack style: [s]tab [d]ouble swing [r]oundhouse:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;case函数&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-hit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;monster-hit表monster被攻击&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;truncate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Your double swing has a strength of &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-hit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monsters-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;除非第一次攻击就消灭所有怪物&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-hit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;otherwise&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dotimes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;truncate&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;否则一阵乱打&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monsters-dead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;若之中有一次已经消灭所有怪物&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-hit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;产生不小于1的1到n的随机数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;以防n&amp;lt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;Player Attacks的辅助函数&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;随机活着的怪物编号&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;random-monster&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;;;选择特定monster&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pick-monster&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Monster #:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;integerp&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-num*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;That is not a valid monster number.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;aref&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;That monster is alread dead.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pick-monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;Monster Management Functions&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;init-monsters&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;vector&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;I make no sense of it&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                             &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-array&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-num*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monsters-dead&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;every&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;show-monsters&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Your foes:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;list&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;     &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;incf&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;. &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;**dead**&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;(Health=&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;) &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-show&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;怪物描述&lt;/span&gt;
                  &lt;span class=&quot;vg&quot;&gt;*monsters*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义monster的structure&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;health&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;monster被攻击&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-hit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You killed the &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;type-of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You hit the &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;type-of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;, knocking off &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; health points! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;(type-of (make-monster))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;;MONSTER&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;总体定义下&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-show&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A fierce &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;type-of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;占位&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;orc&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;defstruct还可以这样定义&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;orc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:include&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;club-level&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-orc&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-show&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;orc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;something like &amp;quot;defmethod function ((a number) (b string))&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A wicked orc with a level &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;orc-club-level&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; club&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;orc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;orc-club-level&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;An orc swings his club at you and knocks off &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; of your health points. &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;hydra,多头鸟&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hydra&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:include&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-hydra&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-show&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hydra&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A malicious hydra with &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; heads.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-hit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hydra&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;x代表头数&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-dead&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;The corpse of the fully decapitated and decapacitated hydra&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;           falls to the floor!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You lop off &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; of the hydra&amp;#39;s heads! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hydra&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A hydra attacks you with &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot; of its heads! It also grows back one more head! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;incf&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;monster-health&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;slime&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;slime-mold&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:include&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sliminess&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-slime-mold&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-show&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;slime-mold&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A slime mold with a sliminess of &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;slime-mold-sliminess&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;slime-mold&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;randval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;slime-mold-sliminess&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A slime mold wraps around your legs and decreases your agility&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;           by &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;;为了防止进入永无止境的僵持,使slime有几率攻击&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;It also squirts in your face, taking away a health point! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;The Cunning Brigand&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defstruct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;brigand&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:include&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-brigand&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*monster-builders*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defmethod&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;monster-attack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;brigand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A brigand hits you with his slingshot, taking off 2 health&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;                  points! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-health*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A brigand catches your leg with his whip, taking off 2&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;                  agility points! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-agility*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;A brigand cuts your arm with his whip, taking off 2&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;                  strength points! &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;decf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-strength*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后这样开始游戏&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;orc-battle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;不过游戏参数貌似设置的不太好，我基本是出来被秒的！！&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Grand Theft Wumpus</title>
   <link href="http://reverland.org/lisp/2012/05/01/grand-theft-wumpus"/>
   <updated>2012-05-01T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/05/01/grand-theft-wumpus</id>
   <content type="html">
&lt;h2 id=&quot;about-this-game&quot;&gt;About this game&lt;/h2&gt;

&lt;p&gt;假设你是lisp生物，你和一个怪物刚刚抢劫了一家酒品店，并带着战利品窜逃。然而，在逃跑期间，怪物决定出卖你并抢走你的车和钱。虽然他把车开走之前你多次试图截获它。&lt;/p&gt;

&lt;p&gt;现在你别无选择，因为你的“原则”，决定去hunt the wumpus。你知道他受了重伤需要在堵塞的都市中某处静养好几个月。问题是道路十分复杂，即使城市中的老居民也难以判清方向。&lt;/p&gt;

&lt;p&gt;幸好你是个lisp生物，你随身带着计算机……(这……)&lt;/p&gt;

&lt;p&gt;你很了解怪物，知道它藏身之前一定会先侦查两条路内的所有地点，所以那里会留下血迹。&lt;/p&gt;

&lt;p&gt;问题是它有把AK-47,你只有把小手枪和一发子弹。你只有一次机会找到并消灭它。&lt;/p&gt;

&lt;p&gt;不幸的是，城市里有许多3G党，他们是残忍的绑匪，如果你落入他们手中，他们会蒙上你的眼睛，然后把你仍在城市的可能的任何一个地方。&lt;/p&gt;

&lt;p&gt;幸运的是，他们会发光(这……)，你可以在一条路外看见他们发出的光。而且城市里只有三个他们的团伙。&lt;/p&gt;

&lt;p&gt;最后，警察也在四处设卡追捕你们，你会在街区两端听见警笛如果这条街上有警察。&lt;/p&gt;

&lt;p&gt;找到并消灭怪物，拿回你的车和钱很难很难&lt;/p&gt;

&lt;p&gt;是很难，有时候不可能成功……&lt;/p&gt;

&lt;p&gt;如果你认为你足够作为一个能抓住怪物的lisp生物，开始写这个游戏并猎杀怪物！&lt;/p&gt;

&lt;h2 id=&quot;section&quot;&gt;游戏&lt;/h2&gt;

&lt;p&gt;整个游戏lisp代码如下，我们需要上次写的库来可视化lisp的数据&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/home/reverland/Documents/lisp/&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;加载上回写的库&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;graph-util.lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义基本参数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-nodes*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*node-num*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*edge-num*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*worm-num*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cop-odds*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;产生1到30的随机数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*node-num*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;生成形如((a . b) (b . a))的节点对&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-pair&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eql&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;形成45条随机边&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;make-edge-list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;repeat&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*edge-num*&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;合并进一个列表&lt;/span&gt;
                        &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-pair&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;与node直接相连,即以node开头的边&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;direct-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-if-not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eql&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                 &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;返回与node相连的nodes，(node 2 3 4 5 6)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-connected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;traverse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;如果没访问过&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;加入visited中&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                         &lt;span class=&quot;c1&quot;&gt;;递归node的子节点，没访问过则推入visited&lt;/span&gt;
                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;traverse&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct-edges&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;traverse&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;visited&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;返回visited列表&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;找到孤岛，返回((1 2 3) (4 5 6))一类的东西&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;find-islands&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;find-island&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-connected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;unconnected&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set-difference&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;connected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;connected&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;unconnected&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;如果没相连对不相连的部分递归调用&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;find-island&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;unconnected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;find-island&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;把不想连的孤岛连上&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;connect-with-bridges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;如果不止一个island&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-pair&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;想象以下islands，它就是这样&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connect-with-bridges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;islands&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;把新添加的桥加入边的列表((a . b) (c . d))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;connect-all-islands&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connect-with-bridges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;find-islands&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;生成整个城市的边&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;make-city-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*node-num*&lt;/span&gt;
                      &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;c1&quot;&gt;;nodes&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;connect-all-islands&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
         &lt;span class=&quot;c1&quot;&gt;;节点与节点关系，即边((a .b) (b .a) (e. f) (f .e)...) &lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cops&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-if-not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;为什么一定要有个变量？&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zerop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*cop-odds*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                              &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;有cops的边(点对）&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;add-cops&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edges-to-alist&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;将点对转换成(node1 ((1) (2)...))的形式，即alist&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges-to-alist&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;遍历每个node&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node1&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-duplicates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direct-edges&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                             &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;为什么会有重复的？确实可能有,生成是随机的&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-duplicates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(mapcar #&amp;#39;car &amp;#39;((a . b) (c . d)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(a c)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(remove-duplicates &amp;#39;((a . b) (a . b)) :test #&amp;#39;equal)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;((a . b))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;往edge-alist中加入cops,返回形如(a ((b cops) (c)))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;add-cops&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges-with-cops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node1-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node1&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;intersection&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-pair&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                                  &lt;span class=&quot;nv&quot;&gt;edges-with-cops&lt;/span&gt;
                                                  &lt;span class=&quot;ss&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node2&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;cops&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                  &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                            &lt;span class=&quot;nv&quot;&gt;node1-edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(mapcar #&amp;#39;car &amp;#39;((a) (b) (c)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(a b c)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;返回与node相邻的点(a b c)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;判断是否相邻的点&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;within-one&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;是否相差两个的点&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;within-two&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;within-one&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;存在与a相邻的点与b相邻&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;within-one&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;neighbors&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;最终生成这个城市所有的点&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;形如&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;make-city-nodes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;wumpus&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;随机wumpus位置&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;glow-worms&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;below&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*worm-num*&lt;/span&gt;
                          &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;glow-worms位置列表&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*node-num*&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;collect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eql&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wumpus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;wumpus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;within-two&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wumpus&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;blood!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                          &lt;span class=&quot;c1&quot;&gt;;添加血迹&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;glow-worms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                 &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;glow-worm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                &lt;span class=&quot;c1&quot;&gt;;添加glow-worn标志&lt;/span&gt;
                                &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;worm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;within-one&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;worm&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                       &lt;span class=&quot;nv&quot;&gt;glow-worms&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;glow-warms中存在元素在n的withinone范围内，则让n发光&lt;/span&gt;
                                 &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lights!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;添加lights&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge-alist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sirens!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;如果n的alist存在有cops这一项添加警笛&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(some (lambda (n) (= (- n 1) 1)) &amp;#39;(1 2 3 3))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;T&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;定义新游戏&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-game&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-city-edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-nodes*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;make-city-nodes&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-pos*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;find-empty-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-pos*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-known-city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;寻找没有线索的点&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;find-empty-node&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;find-empty-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;根据已知绘图&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-city&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ugraph-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;city&amp;quot;&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-nodes*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;可以先编译看看都什么样的&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(princ *congestion-city-edges*)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(princ *congestion-city-nodes*)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;已知城市节点&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;known-city-nodes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;;若访问过&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eql&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-pos*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;player位置加*号&lt;/span&gt;
                  &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;没访问过则加?&lt;/span&gt;
          &lt;span class=&quot;c1&quot;&gt;;之后一大段返回访问过和与访问过点相邻的点的列表&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-duplicates&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;保留后一个&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;把结果归入一个列表&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt;
                                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;
                                                  &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
                            &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;已知的边&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;known-city-edges&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;yes&lt;/span&gt;
                                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;保留边的信息cops&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;去掉cops&lt;/span&gt;
                               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
          &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(cons 1 &amp;#39;(2 3 4))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;(1 2 3 4)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;绘制已知地图&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;draw-known-city&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ugraph-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;known-city&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;known-city-nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;known-city-edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义walk和charge&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;walk&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-direction&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charge&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-direction&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-direction&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charging&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;原来单元素可以assoc，看作(element,nil)?&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-pos*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-new-place&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charging&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;That location does not exist!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;处理新节点&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;handle-new-place&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charging&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*congestion-city-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;has-worm&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;glow-worm&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;c1&quot;&gt;;第二次访问不会有worm&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pushnew&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*visited-nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*player-pos*&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;draw-known-city&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;cops&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You ran into the cops. Game Over.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;wumpus&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charging&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You found the Wumpus!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You ran into the Wumpus&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;charging&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You wasted your last bullet. Game Over.&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;has-worm&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;new-pos&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;You ran into a Glow Worm Gang! You&amp;#39;re now at &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;handle-new-place&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-pos&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;当然，你可以参照第一章定义自己的interface&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-start&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;quit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-eval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-read&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-from-string&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;concatenate&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;(&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;)&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;my-read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;walk&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charge&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-game&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;quit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;my-eval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;know&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;command.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;在终端中启动clisp，并且加载你的这些代码。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/path/to/wumpus.lisp&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;输入如下命令进入游戏环境：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;game-start&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;没有提示，加个sayhello可能更好，但我们开始新游戏吧&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;new-game
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;用konqureror打开生成的png文件known-city.png，一遍walk/charge一边按住F5疯狂刷新吧。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;看看截图效果&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://lhtlyybox.googlecode.com/files/%E6%8A%93%E5%9B%BE70.png&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;konqureror中玩hunt the wumpus&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-1&quot;&gt;我学到了什么&lt;/h2&gt;

&lt;p&gt;以下命令：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;load&lt;/li&gt;
  &lt;li&gt;random&lt;/li&gt;
  &lt;li&gt;cons&lt;/li&gt;
  &lt;li&gt;apply&lt;/li&gt;
  &lt;li&gt;loop&lt;/li&gt;
  &lt;li&gt;remove-if-not&lt;/li&gt;
  &lt;li&gt;let*&lt;/li&gt;
  &lt;li&gt;push&lt;/li&gt;
  &lt;li&gt;when&lt;/li&gt;
  &lt;li&gt;remove-duplicates&lt;/li&gt;
  &lt;li&gt;mapcan&lt;/li&gt;
  &lt;li&gt;intersection :test equal&lt;/li&gt;
  &lt;li&gt;some&lt;/li&gt;
  &lt;li&gt;pushnew&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;搞得有些乱了，一般alist和本文中的alist不一样。lisp对列表的处理看得我眼花缭乱，自由但复杂。不过lisp没什么语法，这点有些Simple and stupid。&lt;/p&gt;

&lt;p&gt;剩下是对编程的想法了，把各种情况都想清楚并设计好不是件容易的事！！就像前一阵去为一个机器人小车编程，两个传感器四个轮子都研究了半天，何况这个游戏，我只能说能看懂了，自己写就各种错误和手足无措了。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Visualize tree like data in Lisp</title>
   <link href="http://reverland.org/lisp/2012/04/28/visualize-tree-like-data-in-lisp"/>
   <updated>2012-04-28T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/04/28/visualize-tree-like-data-in-lisp</id>
   <content type="html">&lt;h2 id=&quot;lisp&quot;&gt;lisp中的特殊列表结构&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;点状列表&lt;/li&gt;
  &lt;li&gt;pair&lt;/li&gt;
  &lt;li&gt;circular list&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;lisp-1&quot;&gt;可视化lisp数据&lt;/h2&gt;

&lt;p&gt;用graphviz把lisp中数据可视化的方法，代码如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;切换到工作目录&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/home/reverland/Documents/lisp/&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;;有向图&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义节点及描述&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*wizard-nodes*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;living-room.&lt;/span&gt;
					     &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wizard&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;snoring&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;loudly&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;couch.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
			       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;beautiful&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;garden.&lt;/span&gt;
					&lt;span class=&quot;nv&quot;&gt;w&lt;/span&gt;
				       &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;attic.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;there&lt;/span&gt;
					&lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;giant&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;welding&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;torch&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;corner.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义节点与边&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*wizard-edges*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;west&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;door&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upstairs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ladder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
			       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;east&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;door&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
			       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;downstairs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ladder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;转换名函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dot-name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substitute-if&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\_&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;complement&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;alphanumericp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;prin1-to-string&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;将非字母数字的字符转化为下划线 &lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;定义标签长度&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-label-length*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;处理位置描述&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dot-label&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exp&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;write-to-string&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:pretty&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;; :pretty防止换行或加入tab&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-label-length*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;concatenate&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt; 
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;subseq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*max-label-length*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;...&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;;如果标签长度比最长值长，将超长的替换成...&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;strange,why not nil?&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;定义节点和标签函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;mapc不返回列表&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;[label=\&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-label&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\&amp;quot;];&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;定义遍历edges中每个元素，再对每个元素进行遍历&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;-&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;[label=\&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-label&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
		 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\&amp;quot;];&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;生成dot文件内容&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;graph-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;digraph{&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edges-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;}&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;接受一个trunk，得到trunk的输出而非函数的值&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;to keep this dot-&amp;gt;png function as reusable as possible, the graph-&amp;gt;dot&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;function isn’t called directly. Instead, we write dot-&amp;gt;png to accept a thunk&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dot-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;thunk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;with-open-file&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;*standard-output*&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;类比与let&lt;/span&gt;
		  &lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;;输入到fname文件&lt;/span&gt;
		  &lt;span class=&quot;ss&quot;&gt;:direction&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:output&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;keyword symbol即本身,方向输出&lt;/span&gt;
		  &lt;span class=&quot;ss&quot;&gt;:if-exists&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:supersede&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;如果存在覆盖&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;funcall&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;thunk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;nully function&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ext:shell&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;concatenate&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dot -Tpng -O &amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;it&amp;#39;s an O actually!it&amp;#39;s not zero!&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;最后一步&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;graph-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;relay funcion&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;graph-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;which is the trunk,I am not clear.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;最后执行&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;graph-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;wizard.dot&amp;quot;&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*wizard-nodes*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*wizard-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;;无方向图&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;uedges-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;maplist&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;遍历剩下的元素&lt;/span&gt;
	   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;;除非以下不再出现这个位置&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;--&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;[label=\&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-label&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
		   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;\&amp;quot;];&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
	    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdar&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ugraph-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;graph{&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nodes-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uedges-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;}&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ugraph-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;dot-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;fname&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ugraph-&amp;gt;dot&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;;;执行命令&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ugraph-&amp;gt;png&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;uwizard.dot&amp;quot;&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*wizard-nodes*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*wizard-edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;结合上回处理文本，觉得lisp在处理列表和文本时挺方便，虽然没有正则什么的。然后学习到lisp和unix环境交互还是比较方便的。&lt;/p&gt;

&lt;p&gt;学会了一个生成文本数据的技术，把打印到终端而易于调试的输出包装成一个thunk，传递给其它函数。&lt;/p&gt;

&lt;p&gt;学到了很多命令：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;cd(ext)&lt;/li&gt;
  &lt;li&gt;substitute-if&lt;/li&gt;
  &lt;li&gt;complement&lt;/li&gt;
  &lt;li&gt;alphanumericp&lt;/li&gt;
  &lt;li&gt;write-to-string&lt;/li&gt;
  &lt;li&gt;subseq&lt;/li&gt;
  &lt;li&gt;mapc&lt;/li&gt;
  &lt;li&gt;maplist&lt;/li&gt;
  &lt;li&gt;with-open-file&lt;/li&gt;
  &lt;li&gt;funcall&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;参考资料&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.openrays.org/blog.php?do=showone&amp;amp;tid=420&quot;&gt;graphivz中文使用指南&lt;/a&gt;&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>a text game engine written by lisp</title>
   <link href="http://reverland.org/lisp/2012/04/26/a-text-game-engine-written-by-lisp"/>
   <updated>2012-04-26T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/04/26/a-text-game-engine-written-by-lisp</id>
   <content type="html">&lt;h2 id=&quot;lisp-is-amazingisnt-it&quot;&gt;Lisp is amazing,isn’t it?&lt;/h2&gt;

&lt;p&gt;最早的时候，是从emacs听说lisp的，不过emacs这等神器，却并非我的菜，几经折腾最终滚回了简洁的vim。&lt;/p&gt;

&lt;p&gt;最早开始学习lisp，是跟着田春译的《实用common lisp编程》，看了几章越看越累，等到看到讲单元测试那章时，我已经不知道在讲什么了。不过很惊叹lisp自动生成程序的能力倒是，还有种让人着迷的数学感。&lt;/p&gt;

&lt;p&gt;后来看见网上有人在译&lt;a href=&quot;http://readthedocs.org/docs/ansi-common-lisp/en/latest/index.html&quot;&gt;ansi common lisp中文版&lt;/a&gt;，沉寂了两个月的lisp情怀陡升，我又开始看了。看了两章也陷入了越看越累的境地，最后到了能读懂却不能写出的境界，相对之前，也算是进步吧。然而才到高级数据结构那部分，我已没看下去的勇气，我觉得自己这种小白应该先修炼本更循序渐进的。&lt;/p&gt;

&lt;p&gt;然后找啊找在&lt;a href=&quot;http://common-lisp.net/&quot;&gt;common-lisp&lt;/a&gt;上有推荐Land of lisp这本书,虽然很贵，但天朝的孩子们总是有办法的：&lt;a href=&quot;http://115.com/folder/faujangp#lisp&quot;&gt;lisp资料&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;好难得有本图文并茂的书，声称一次一个游戏，我就喜欢这种例子丰富的东西，幽默点不致于无聊更好。找不到中文版，算了，英文版直接上吧。话说还考研，唉，还是想抽空看看这个。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;第一个游戏&lt;/h2&gt;

&lt;p&gt;猜数的小游戏，不解释。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;guess-my-number&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ash&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*big*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*small*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bigger&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*small*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;guess-my-number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;guess-my-number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;smaller&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*big*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;1-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;guess-my-number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;guess-my-number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;start-over&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*small*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*big*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;guess-my-number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-1&quot;&gt;一个简单的文本游戏引擎&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;c1&quot;&gt;;;定义节点及描述&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*nodes*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;living-room.&lt;/span&gt;
                                          &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;wizard&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;snoring&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;loudly&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;couch.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;beautiful&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;garden.&lt;/span&gt;
                                     &lt;span class=&quot;nv&quot;&gt;there&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;well&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;front&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;you.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;attic.&lt;/span&gt;
                                    &lt;span class=&quot;nv&quot;&gt;there&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;giant&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;welding&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;torch&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;corner.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义描述效应位置的函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;describe-location&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义节点-路径&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*edges*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;west&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;door&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;upstairs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ladder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;east&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;door&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;attic&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;downstairs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ladder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义描述路径函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;describe-path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;there&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;caddr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;going&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;here.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义描述对应位置路径的函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;describe-paths&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;describe-path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;edges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义物品列表&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*objects*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;whiskey&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;frog&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;物品-位置对，hash？&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*object-locations*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;whiskey&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;bucket&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;living-room&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;chain&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;frog&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;garden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;得到相应位置物品列表&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;objects-at&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;loc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;objs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obj-locs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;at-loc-p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obj-locs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;remove-if-not&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;at-loc-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;objs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;描述相应位置物品&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;describe-objects&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;loc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;objs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obj-loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;labels&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;describe-obj&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;see&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;obj&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;floor.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;describe-obj&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;objects-at&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;loc&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;objs&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;obj-loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;给定初始位置&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;living-room&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义查看函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;look&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;append&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;describe-location&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*nodes*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;describe-paths&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;describe-objects&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*objects*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*object-locations*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义行走函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;walk&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;direction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;direction&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*edges*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                    &lt;span class=&quot;ss&quot;&gt;:key&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cadr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;next&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;progn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;setf&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;look&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cannot&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;way.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;定义拾起函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pickup&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;objects-at&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*location*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*objects*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*object-locations*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*object-locations*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;carrying&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;you&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cannot&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;查看现有物品的函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;inventory&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;items-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;objects-at&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;body&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*objects*&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*object-locations*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;登入界面&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;say-hello&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Please type your name:&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Nice to meet you, &amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;自定义repl&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-repl&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;quit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-eval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-repl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;自定义的read&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-read&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-from-string&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;concatenate&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;(&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;read-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;)&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;flet&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quote-it&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;quote&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcar&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quote-it&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;给定可执行命令&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defparameter&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;look&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;walk&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;pickup&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;inventory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;自定义eval&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-eval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;*allowed-commands*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;sexp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;know&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;that&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;command.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;转换字符列表大小写函数&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;caps&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;car&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cdr&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cond&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;caps&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;member&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;#\!&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\?&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eq&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;#\&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;caps&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;caps&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;char-upcase&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cons&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;char-downcase&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))))&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;;;自定义print&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;defun&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;game-print&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;princ&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tweak-text&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;coerce&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;string-trim&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;() &amp;quot;&lt;/span&gt;
                                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;prin1-to-string&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lst&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                                     &lt;span class=&quot;ss&quot;&gt;&amp;#39;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                             &lt;span class=&quot;no&quot;&gt;t&lt;/span&gt;
                             &lt;span class=&quot;no&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                 &lt;span class=&quot;ss&quot;&gt;&amp;#39;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fresh-line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后测试游戏引擎，在repl中输入&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;cl&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;game-repl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;首先让我惊异的就repl可以自定义,还有那个quasiquote很好用。&lt;/p&gt;

&lt;p&gt;然后学到了以下一堆命令：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;defparameter/defvar&lt;/li&gt;
  &lt;li&gt;cons&lt;/li&gt;
  &lt;li&gt;assoc&lt;/li&gt;
  &lt;li&gt;caxdxr&lt;/li&gt;
  &lt;li&gt;`/，/quote&lt;/li&gt;
  &lt;li&gt;append&lt;/li&gt;
  &lt;li&gt;mapcar&lt;/li&gt;
  &lt;li&gt;apply&lt;/li&gt;
  &lt;li&gt;labels/flet&lt;/li&gt;
  &lt;li&gt;eq&lt;/li&gt;
  &lt;li&gt;remove-if-not&lt;/li&gt;
  &lt;li&gt;find&lt;/li&gt;
  &lt;li&gt;progn&lt;/li&gt;
  &lt;li&gt;cond&lt;/li&gt;
  &lt;li&gt;if/unless&lt;/li&gt;
  &lt;li&gt;and/or&lt;/li&gt;
  &lt;li&gt;member&lt;/li&gt;
  &lt;li&gt;push&lt;/li&gt;
  &lt;li&gt;print/princ/prin1/prin1-to-string/princ-to-string&lt;/li&gt;
  &lt;li&gt;read/read-from-string/read-line&lt;/li&gt;
  &lt;li&gt;concatenate&lt;/li&gt;
  &lt;li&gt;coerce&lt;/li&gt;
  &lt;li&gt;fresh-line&lt;/li&gt;
  &lt;li&gt;char-upcase/char-downcase&lt;/li&gt;
&lt;/ul&gt;

</content>
 </entry>
 
 <entry>
   <title>折腾</title>
   <link href="http://reverland.org/Life/2012/04/24/"/>
   <updated>2012-04-24T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/Life/2012/04/</id>
   <content type="html">&lt;div class=&quot;audio&quot;&gt;
&lt;audio controls=&quot;controls&quot;&gt;
&lt;source src=&quot;http://lhtlyybox.googlecode.com/files/m.ogg&quot; type=&quot;audio/ogg&quot; /&gt; 
您的浏览器不支持 audio 标签。
&lt;/audio&gt;
音乐：星光伴我心——郑中基
&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;section&quot;&gt;折腾&lt;/h1&gt;

&lt;p&gt;时日多见旧友，每必寒暄，都言相别甚久，近来忙何。吾细思之，并无他言，唯折腾二字也。所折腾何物，唯计算机尔。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;这样的状态已经持续大半年了，整个心百分之七十都在计算机上。&lt;/p&gt;

&lt;p&gt;二月的时候我对自己说，嗯，该准备考研了，停止折腾吧&lt;/p&gt;

&lt;p&gt;三月的时候我对自己说，那个，该准备考研了，下个月开始停止折腾吧&lt;/p&gt;

&lt;p&gt;四月的时候我对自己说，妹的，继续折腾吧，下个月再准备考研吧&lt;/p&gt;

&lt;p&gt;然后四月末到来了&lt;/p&gt;

&lt;p&gt;一学期堆成山的课程稀稀拉拉都准备结课了，留下的是我不堪的到课记录和作业次数，还有准备考试无以名状的感觉。&lt;/p&gt;

&lt;p&gt;我还是在折腾，抽时间看着gimp的文档，没事翻译下wiki，自己折腾折腾写写心得，论坛上回答回答别人问题灌灌水，学习学习lisp……&lt;/p&gt;

&lt;p&gt;好像学校这世界与我无关。&lt;/p&gt;

&lt;p&gt;那些考研的同学都在努力学习，白天自习，晚上自习。报各种班，搜集各种资料，旁听各种课&lt;/p&gt;

&lt;p&gt;那些不考研的同学也在为各种将来的工作努力，做各种激情的事为青春留下难忘的记忆&lt;/p&gt;

&lt;p&gt;我依然在折腾，不离不弃&lt;/p&gt;

&lt;p&gt;然而生活的阴影就这么一点点吞噬自由的生活，越是紧迫，越是想把握住它，怕有生之年再也没机会做这些事，越紧握住这难得的自由不舍得放手。&lt;/p&gt;

&lt;p&gt;然而It’s time to say goodbye&lt;/p&gt;

&lt;p&gt;不忍心，却无奈。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;记忆如此美好，我不会忘记&lt;/p&gt;

&lt;p&gt;自己的坚守与信念，我不会忘记&lt;/p&gt;

&lt;p&gt;那些社区内热情的网友，我不会忘记&lt;/p&gt;

&lt;p&gt;追求自由、开放、分享、进步的心，我不会改变&lt;/p&gt;

&lt;p&gt;说是不会改变，只我不愿改变&lt;/p&gt;

&lt;p&gt;生命如斯，终将改变，思之黯然。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;我curse这个世界&lt;/p&gt;

&lt;p&gt;还有什么选择&lt;/p&gt;

&lt;p&gt;世界一次次让我失望至麻木&lt;/p&gt;

&lt;p&gt;整个世界&lt;/p&gt;

&lt;p&gt;如行尸走肉般的存在&lt;/p&gt;

&lt;p&gt;然而我不愿&lt;/p&gt;

&lt;p&gt;不愿为生计所迫，埋没残缺而小众的兴趣&lt;/p&gt;

&lt;p&gt;不愿熄灭了热情，失去了折腾的动力&lt;/p&gt;

&lt;p&gt;不愿失去了耐心，失去了坚持的信念&lt;/p&gt;

&lt;p&gt;不愿失去了信心，失去了进步的动力&lt;/p&gt;

&lt;p&gt;时光飞逝，依然想要还是那个我&lt;/p&gt;

&lt;p&gt;追随自己的兴趣，追求美，追求卓越&lt;/p&gt;

&lt;p&gt;追求革新&lt;/p&gt;

&lt;p&gt;追寻自我&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;然而我在这里说，&lt;/p&gt;

&lt;p&gt;不再折腾了，考研&lt;/p&gt;

&lt;p&gt;很久前就想说，知道我会食言&lt;/p&gt;

&lt;p&gt;因为心存幻想，明知没有希望，心存侥幸&lt;/p&gt;

&lt;p&gt;没什么馅饼从天而降&lt;/p&gt;

&lt;p&gt;屈从命运？Fuck it.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;thanks&quot;&gt;Thanks&lt;/h3&gt;

&lt;p&gt;Who give my happiness,&lt;/p&gt;

&lt;p&gt;warmful help,&lt;/p&gt;

&lt;p&gt;predictable instruction,&lt;/p&gt;

&lt;p&gt;and who shared with me their philosophizing thoughts.&lt;/p&gt;

&lt;p&gt;Thanks all of you&lt;/p&gt;

&lt;p&gt;And bless my family and relatives who are really supporting me.&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>Half Hacker,Half Artist</title>
   <link href="http://reverland.org/reviews/2012/04/16/half-hackerhalf-artist"/>
   <updated>2012-04-16T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/reviews/2012/04/16/half-hackerhalf-artist</id>
   <content type="html">&lt;h1 id=&quot;section&quot;&gt;《黑客与画家》初体验&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;http://ep.yimg.com/ca/I/paulgraham_2202_3598897&quot; alt=&quot;Alt 黑客与画家&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;前言&lt;/h2&gt;

&lt;p&gt;几天前，我被一个漂亮的个人网站迷住了，于是把他整个网站从github上下载下来改进成自己的。并在推特上follow了这位站长。我清楚地记得他的个人简介里写着：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;half hacker/half artist
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;所以这篇读后感就以这个名字命名，虽然写的文不对题，估计也不会有什么人看。文笔很烂也不管了。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-2&quot;&gt;从误解这本书开始&lt;/h2&gt;

&lt;p&gt;最早听说这本书，是缘于我对&lt;a href=&quot;http://zh.wikipedia.org/wiki/LISP&quot;&gt;lisp&lt;/a&gt;的热衷。听说很多迷上Lisp的人都是因为一本叫作&lt;a href=&quot;http://paulgraham.com/hackpaint.html&quot;&gt;hacker and painter&lt;/a&gt;的奇书……&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;作者是谁？技术人员写的书我们常人看不懂&lt;/h3&gt;

&lt;p&gt;被誉为世界上最懂&lt;a href=&quot;http://zh.wikipedia.org/wiki/LISP&quot;&gt;lisp&lt;/a&gt;编程的人、被尊为硅谷创业之父、第一个互联网应用的作者之一、硅谷著名技术作家&lt;a href=&quot;http://paulgraham.com/&quot;&gt;Paul Graham&lt;/a&gt;。Paul Graham 写了很多文章，他不仅写技术文章，也写很多大众文章，这本《黑客与画家》就是Paul Graham的文集，就我感觉，里面的文章简直是大众到不能再大众了，就跟凤凰传奇一样老少皆宜。除了对黑客的特质进行了描述与赞美之外，更多是其它很闪光的东西。&lt;/p&gt;

&lt;h3 id=&quot;section-4&quot;&gt;黒客，是那些破解银行密码的人?&lt;/h3&gt;

&lt;p&gt;没有几个人现在还记得“黑客”这个词本来的含义了，作者偏偏用了这个词。这本书中的黑客，有这种说法:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;出于兴趣，解决某个难题，不管它有没有用，这就是黑客。
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;它们信仰分享（Sharing）、开放（Openness）、民主（Decentralization）、计算机的自由使用（Free access to computers）、进步（World Improvement）的价值观。说到底，和电影里的那群牛逼的cracker们有个毛线关系。更详细的在这里&lt;a href=&quot;http://www.ruanyifeng.com/blog/2011/04/on_hacker.html&quot;&gt;黑客的含义&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-5&quot;&gt;我对计算机没有兴趣，对艺术也没有兴趣。&lt;/h3&gt;

&lt;p&gt;如果你只对吃喝玩乐有兴趣，我什么也不多说了。好的作品不因你不看它而不会发光。
或者是你很NB，完全不屑这个撼动硅谷的家伙的思想。&lt;/p&gt;

&lt;p&gt;刚看前几章我眼泪都快下来了，简直是本社会学的书，整本书散发着伦理学的光芒，带着很多有预见性的真知灼见。自从《How to win friends and influence people》(人性的弱点)后第一次有本让我真正感兴趣的书。&lt;/p&gt;

&lt;h3 id=&quot;section-6&quot;&gt;我没空&lt;/h3&gt;

&lt;p&gt;嗯，这是个好理由。没有必要要求一个人必读什么书，像小学初中高中那些我们从来没读过的“必读读物”。事实上，这本书中对这个现象有些见解，你会发现美国几十年前和现在的中国多么相像，相像地令人惊异。&lt;/p&gt;

&lt;h3 id=&quot;section-7&quot;&gt;你这是推销！！&lt;/h3&gt;

&lt;p&gt;讲了这么多，搞得像篇专门推销和吹捧此书的水文。实际上我说的很少了，看看这里怎么说&lt;a href=&quot;http://book.douban.com/subject/6021440/&quot;&gt;Douban&lt;/a&gt;。
我完全无利可图，只不过难得碰到一本有共鸣的书兴奋了罢了。这近大半年折腾Linux以来痛苦地摸索与思索结果零零散散映射到书中到角角落落，甚至有许多从小对人生与社会的思考。&lt;/p&gt;

&lt;h2 id=&quot;section-8&quot;&gt;如果你真的有了点兴趣&lt;/h2&gt;

&lt;p&gt;那就去看，生命中最可怕的就是等待，拖延的后果就是遥遥无期。不存在没有时间这种事，这种事只存在于意识中而非现实里，忘了我们高中怎么忙里偷闲的？也许读这些书没用，特别是对于讲求经世致用的我国人民。在我看来，潜意识是有力量的。&lt;/p&gt;

&lt;h3 id=&quot;section-9&quot;&gt;附上链接&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.amazon.cn/%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6-%E7%A1%85%E8%B0%B7%E5%88%9B%E4%B8%9A%E4%B9%8B%E7%88%B6Paul-Graham%E6%96%87%E9%9B%86-%E9%98%AE%E4%B8%80%E5%B3%B0/dp/B004WHZGZQ&quot;&gt;Amazon简体中文&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.amazon.com/Hackers-Painters-Big-Ideas-Computer/dp/0596006624&quot;&gt;Amazon英文&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;写这么多，发现跑题了，本来想写篇读后感的。持续更新中…..&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-10&quot;&gt;那些黑客们&lt;/h2&gt;

&lt;h3 id=&quot;section-11&quot;&gt;为什么书呆子不受欢迎&lt;/h3&gt;
&lt;p&gt;小时候，每当有人夸我爱读书时我都感觉到一股耻辱，恨不得立马把夸我的人撕成碎片。无一例外，这种违心的“夸”总是紧随在我犯sb之后。“爱读书”在那时是很奇怪的，而且从小不知从哪里被灌输了爱读书的人都是呆子的我，大概总是为自己这SB特性感觉自卑。以致多年之后，我也不愿听到哪怕一点点有人在这方面“夸”我。&lt;/p&gt;

&lt;p&gt;童年对我来说仿佛它就是一个人的，一个人看书，一个人玩，一个人闲逛……当时院子里的孩子都比我大两岁，零碎的记忆中充斥着被他们玩弄的片段。虽然也许他们没有恶意，但我恨，家人当然不会管这些，反正每每都很伤心，那是种心灰意冷的感觉。后来有次很畅快的事…..算了跑题了。&lt;/p&gt;

&lt;p&gt;作者说黑客都具有一种追求世界真相的执念，以致与于他们无暇关注其它如社交、运动、交往、装扮等大多数人所追求的东西。不同让他们看上去呆呆的，被其它寻求优越感的人歧视和欺凌。&lt;/p&gt;

&lt;p&gt;我想说，只要和大多数人不一样，就必然被边缘化和孤立，更糟的情况就是欺凌。想想哪些身体有缺陷的人，比大数人胖的人，比大多数人瘦的人，他们有快乐的童年可言吗，没被嘲笑讥讽过吗？（如果你不知道我在说什么就看看毛姆的小说《人性的枷锁》）不只是因为他们的心思在别的地方，人性如是。&lt;/p&gt;

&lt;p&gt;作者把教育贬得一塌糊涂，看得我好爽….嘿嘿。代沟的产生大概也是必然了，教育成为这样，成年人的态度，孩子的态度也是必然了，一切都源于孩子完全“没用”。&lt;/p&gt;

&lt;h3 id=&quot;section-12&quot;&gt;黑客的追求&lt;/h3&gt;

&lt;p&gt;作者认为黑客是创造者，它和画家很像，和研究和科学离的很远。希望是这样，不过目前看搞计算机的普遍被称码农和程序猿，日复一日重复某种机械工作…..我倒更愿意像某位发明perl的语言学家一样，或那个学医的个人电脑之父一样，做个业余或短期玩家。说到底是希望自己的未来是充满各种可能性的，而不是一成不变。话说个人感觉黑客和艺术家、设计师还是挺像的，都是挺具有创造性的过程。&lt;/p&gt;

&lt;p&gt;作者讴歌了黑客具有的追求自由和打破常规的精神。可惜社会不会讴歌这些异端，好吧，与众不同的人该如何应对呢，学习哥白尼还是伽利略？&lt;/p&gt;

&lt;p&gt;我想，作为一个人都应有这些精神，自己思考，注意他人贴的标签与他们的目的关联性（忽然想到一本社会学读物《生活的暗面》，挺好看的）。而不应该被潮流强烈影响，可惜这大概不可能。可以的话也不会有大屠杀了。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-13&quot;&gt;互联网创业的时代&lt;/h2&gt;

&lt;p&gt;文章写于2002年，10年这本书终于有了中文版，但英文版一直可以在&lt;a href=&quot;http://paulgraham.com/&quot;&gt;Paul Graham&lt;/a&gt;的个人网站上得到。这对创业公司是个充满机遇和挑战的时代，而创业公司只能背水一战，通过革新超越与大公司竞争。弱者往往不得不另辟蹊径，或者灭亡。小公司相对大公司有两个优势，革新的必要和个人贡献的可测量性。我感到惊异的是作者在其中对互联网特别是移动互联网的发展挺有预见性。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-14&quot;&gt;关于贫富分化&lt;/h2&gt;

&lt;p&gt;这里穿插了些对贫富分化的讨论，有兴趣的同学可以看看王海明的《伦理学与人生》，他们都有个核心观点：强调利己的社会才会繁荣富足，财富是被创造出来的而非大饼。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-15&quot;&gt;设计&lt;/h2&gt;

&lt;h3 id=&quot;section-16&quot;&gt;好的设计&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;好的设计是简单的&lt;/li&gt;
  &lt;li&gt;好的设计是解决问题的&lt;/li&gt;
  &lt;li&gt;好的设计是启发性的（可定制）&lt;/li&gt;
  &lt;li&gt;好的设计是趣味性的&lt;/li&gt;
  &lt;li&gt;好的设计是艰苦的&lt;/li&gt;
  &lt;li&gt;好的设计是看似容易的（反复修正）&lt;/li&gt;
  &lt;li&gt;好的设计是对称的&lt;/li&gt;
  &lt;li&gt;好的设计是仿自然的&lt;/li&gt;
  &lt;li&gt;好的设计是再设计的（勇于承认错误）&lt;/li&gt;
  &lt;li&gt;好的设计是能复制的&lt;/li&gt;
  &lt;li&gt;好的设计是奇特的&lt;/li&gt;
  &lt;li&gt;好的设计是成批出现的（接近有天赋的团队）&lt;/li&gt;
  &lt;li&gt;好的设计是大胆的&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-17&quot;&gt;设计与研究&lt;/h3&gt;

&lt;p&gt;设计追求好，研究追求新。设计要以人为本，基于用户的。设计师应该是充满热情的。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-18&quot;&gt;技术问题&lt;/h2&gt;

&lt;p&gt;技术问题不多说，基本是围绕Lisp来说的，一个设计很好的，未来的，有竞争力的编程语言应该是什么样的。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>How I built this blog</title>
   <link href="http://reverland.org/web/2012/04/13/How-I-built-this-blog"/>
   <updated>2012-04-13T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/web/2012/04/13/How-I-built-this-blog</id>
   <content type="html">&lt;h2 id=&quot;section&quot;&gt;缘起&lt;/h2&gt;

&lt;p&gt;大概两个月前，曾经折腾过jekyll和Octopress。当时对照&lt;a href=&quot;http://chen.yanping.me/cn/blog/2011/12/15/building-static-sites-with-jekyll/&quot;&gt;【译文】用Jekyll构建静态网站&lt;/a&gt;在archlinux实现了把jekyll。因为rvm的问题，octpress就怎么也搞不定了。再加上当时对vimwiki比较熟悉，jekyll和Octopress再也不曾碰过。&lt;/p&gt;

&lt;p&gt;然而几天前发现vimwiki的语法分析器甚至不支持xhtml，忽然又碰进&lt;a href=&quot;http://www.soimort.org/&quot;&gt;Mort的主页里&lt;/a&gt;.Mort绚丽的jekyll博客瞬时grasp my heart，一股不可抑制的折腾情怀升腾起来。&lt;/p&gt;

&lt;h2 id=&quot;section-1&quot;&gt;经过&lt;/h2&gt;

&lt;h3 id=&quot;ruby&quot;&gt;ruby版本控制&lt;/h3&gt;

&lt;p&gt;当初没有继续折腾的原因之一，就是ruby搞不定。jekyll可以用ruby1.9.1或1.9.2,Octopress则要求1.9.2-p290.而archlinux当前版本的ruby是1.9.3。故使用rvm来控制ruby版本。&lt;/p&gt;

&lt;h4 id=&quot;section-2&quot;&gt;设置代理&lt;/h4&gt;

&lt;p&gt;安装rvm，如果网络良好完全没问题。由于我在学校内使用的是sogou代理，而export http_proxy之流的命令偏偏不顶事，后来发现git和curl的网络链接根本就不继承shell环境的代理。
为了装上rvm，先在curlrc中写入
proxy=127.0.0.1:1998
在gitconfig中写入&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;http&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;proxy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; http://127.0.0.1:1998
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;然后参见文档开始安装就是，我比较悲催，开始不知道可以这样做。直接hack rvm那个安装脚本才搞定&lt;/p&gt;

&lt;h4 id=&quot;ruby-1&quot;&gt;ruby环境搭建&lt;/h4&gt;

&lt;p&gt;因为我既是ruby小白又是python小白，所以选什么都没区别，如果你对python熟悉，&lt;a href=&quot;http://hyde.github.com/index.html&quot;&gt;Hyde&lt;/a&gt;而非jekyll可能是更好的选择。&lt;/p&gt;

&lt;p&gt;装好rvm后，使用ruby1.9.2&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;rvm install 1.9.2 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rvm use 1.9.2
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;使用taobao的gem源&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;gem sources -remove http://rubygem.org/ 
gem sources -a http://ruby.taobao.org/ --http-proxy http://127.0.0.1:1998
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;安装对应的jekyll&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;gem install --http-proxy http://127.0.0.1:1998 jekyll 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其它和官方文档就没什么区别了。&lt;/p&gt;

&lt;p&gt;ps:如果用socks代理请自行配置tsocks。&lt;/p&gt;

&lt;h3 id=&quot;jekyll&quot;&gt;jekyll&lt;/h3&gt;

&lt;p&gt;直接从soimort扒来的源码和jekyllbootstrap的源码经过个人需求重新加工整合，这个过程比较繁琐,此处略去。&lt;/p&gt;

&lt;p&gt;然后就是push…&lt;/p&gt;

&lt;h3 id=&quot;section-3&quot;&gt;后续&lt;/h3&gt;

&lt;h4 id=&quot;section-4&quot;&gt;语法高亮&lt;/h4&gt;

&lt;p&gt;之前我是用pygments解决的，没有按官方文档来，因为装python2-pygments后才有pygmentize命令…&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;sudo pacman -S python2-pygments
pygmentize -S default -f html &amp;gt; ~css/pygments.css
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;后来发现还是syntaxhighlighter好看，于是把vimwiki那一大堆东西迁移过来了。结果搞的网页加载很慢，效果虽好很久出不来，所以先改会pygments&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;section-5&quot;&gt;参考文献&lt;/h3&gt;

&lt;h4 id=&quot;jekyll-1&quot;&gt;关于jekyll&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/mojombo/jekyll/wiki/&quot;&gt;jekyll wiki&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://chen.yanping.me/cn/blog/2011/12/15/building-static-sites-with-jekyll/&quot;&gt;【译文】用Jekyll构建静态网站&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.yangzhiping.com/tech/wordpress-to-jekyll.html&quot;&gt;告别wordpress，拥抱jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.pizn.me/2012/03/01/some-tips-for-jekyll-blog.html&quot;&gt;搭建 Jekyll 博客的一些小技巧&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://jiyinyiyong.blog.163.com/blog/static/64699876201111291856363/&quot;&gt;尝试 Jekyll 博客&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;section-6&quot;&gt;关于语法高亮&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.stehem.net/2012/02/14/how-to-get-pygments-to-work-with-jekyll.html&quot;&gt;How to get Pygments to work with Jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://bbs.laxjyj.com/read-htm-tid-162443.html&quot;&gt;Jekyll的代码高亮&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.v2ex.com/t/28708&quot;&gt;jekyll 是不是不能使用插件啊？&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;section-7&quot;&gt;其它&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/huzhenwei/article/details/4369027&quot;&gt;wget和curl设置代理服务器的命令&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://chenhailong.iteye.com/blog/1340924&quot;&gt;Ruby Gem Proxy 代理设置&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://beginrescueend.com/workflow/proxy/&quot;&gt;Using RVM behind a proxy &lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://beginrescueend.com/rvm/install/&quot;&gt;Installing RVM&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
 </entry>
 
 <entry>
   <title>将Archlinux从32位迁移到64位</title>
   <link href="http://reverland.org/linux-tech/2012/03/25/archlinux3264"/>
   <updated>2012-03-25T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/linux-tech/2012/03/25/archlinux3264</id>
   <content type="html">&lt;h2 id=&quot;archlinux3264&quot;&gt;将archlinux从32位迁移到64位&lt;/h2&gt;

&lt;h3 id=&quot;section&quot;&gt;概要&lt;/h3&gt;

&lt;p&gt;大致过程及要注意的地方,某天顺手把archlinux的中文wiki翻译了下，所以现在有个中文版的。不过有需求的同学们还是看英文wiki吧，不要太相信我翻译的水平……&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;section-1&quot;&gt;过程&lt;/h3&gt;

&lt;h4 id=&quot;section-2&quot;&gt;准备&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;首先确定cpu支持64位，一般近几年的电脑都支持&lt;/li&gt;
  &lt;li&gt;确定磁盘空间足够&lt;/li&gt;
  &lt;li&gt;电力充足&lt;/li&gt;
  &lt;li&gt;回退准备(说是这么说根本就没管)&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-3&quot;&gt;迁移&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;保存旧包&lt;/li&gt;
  &lt;li&gt;改变架构，此时要注意&lt;/li&gt;
  &lt;li&gt;Make sure the server lists in /etc/pacman.conf and /etc/pacman.d/mirrorlist use $arch instead of explicitly specifying i686 or x86_64.&lt;/li&gt;
  &lt;li&gt;下载新包，注意lib32-glibc，在安装kernel之后再装,如果装不上加上-f参数强制安装&lt;/li&gt;
  &lt;li&gt;重启后就进入字符界面了，可以确认内核已经64位了&lt;/li&gt;
  &lt;li&gt;安装pacman，可能有一堆错误或警告。不要重启&lt;/li&gt;
  &lt;li&gt;安装剩余的包&lt;/li&gt;
  &lt;li&gt;清理busybox和lib32-glibc&lt;/li&gt;
  &lt;li&gt;设定makepkg编译标志&lt;/li&gt;
  &lt;li&gt;kde用户注意了，要运行&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;rm -rf /var/tmp/kde-&amp;lt;username&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;之后再startkde,否则会出现从splash直接退回到kdm而无法进入kde的情况。&lt;/p&gt;

&lt;h4 id=&quot;section-4&quot;&gt;后续工作&lt;/h4&gt;

&lt;p&gt;比如说你要wine war3,那么很多lib32的库软件什么的就要装好，比如32位的显卡、lib32-mpg123等等。&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;section-5&quot;&gt;参考文献&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.archlinux.org/index.php/Migrating_Between_Architectures_Without_Reinstalling#Change_Pacman_architecture&quot;&gt;Migrating Between Architectures Without Reinstalling&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://fancyoung.com/blog/migrating-between-architectures-without-reinstalling/&quot;&gt;将Arch Linux从32位升到64位&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://lilydjwg.is-programmer.com/2012/2/23/migrate-to-64bit-archlinux.32230.html&quot;&gt;迁移到64位 ArchLinux&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://bbs.archlinux.org/viewtopic.php?id#79549&quot;&gt;Wine font rendering + libmpg123 question&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://forum.kde.org/viewtopic.php?f#17&amp;amp;t#91736&quot;&gt;Since crash of plasma netbook, no login via kdm&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

</content>
 </entry>
 
 <entry>
   <title>LFS初体验</title>
   <link href="http://reverland.org/linux-tech/2012/03/21/lfs"/>
   <updated>2012-03-21T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/linux-tech/2012/03/21/lfs</id>
   <content type="html">&lt;h2 id=&quot;lfs&quot;&gt;LFS初体验&lt;/h2&gt;

&lt;h3 id=&quot;section&quot;&gt;本文概要&lt;/h3&gt;

&lt;p&gt;简要记述一次LFS&lt;/p&gt;

&lt;h3 id=&quot;lfs-1&quot;&gt;LFS环境&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;在vbox上进行LFS&lt;/li&gt;
  &lt;li&gt;宿主系统是&lt;a href=&quot;http://ftp.osuosl.org/pub/lfs-livecd/&quot;&gt;lfs的livecd&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;参考文档是&lt;a href=&quot;http://lamp.linux.gov.cn/Linux/LFS-6.2/index.html&quot;&gt;LFS6.2中文文档&lt;/a&gt;（金步国译）&lt;/li&gt;
  &lt;li&gt;软件源来自&lt;a href=&quot;http://mirrors.sohu.com/&quot;&gt;sohu开源镜像&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;在终端中SSh到虚拟机上操作&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-1&quot;&gt;过程&lt;/h3&gt;

&lt;p&gt;从开始还看一看到后来的纯copy&amp;amp;paste……&lt;/p&gt;

&lt;p&gt;大体上做了这些事:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;准备分区和挂载文件系统&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;设置工作环境、创建工作目录、添加LFS用户&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;编译工具链&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;编译LFS系统&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;配置系统&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;tips&quot;&gt;tips&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;之前一切顺利，最后编译内核时失败，google后发现前面的findutils竟没安好，重编译解决。&lt;/li&gt;
  &lt;li&gt;LFS通常要个几天，如果断网断电，切记检查&lt;code&gt;$LFS&lt;/code&gt;变量，有时出问题还得chroot来chroot去，此时&lt;code&gt;$LFS&lt;/code&gt;也会变&lt;/li&gt;
  &lt;li&gt;启动时直接出现了kernel panic，经查看FAQ和他人提醒及自己搜索，排除单独/boot分区问题、grub问题、fstab问题。重新在内核中编译进硬盘支持后成功启动。具体参见&lt;a href=&quot;http://www.linuxeden.com/html/newbie/20100220/70680.html&quot;&gt;这里&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;section-2&quot;&gt;截图&lt;/h3&gt;

&lt;p&gt;系统成功启动了！！&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/lfs-1.png&quot; alt=&quot;Alt LFS启动成功截图&quot; /&gt;
&lt;img src=&quot;/images/lfs-2.png&quot; alt=&quot;Alt LFS启动成功截图&quot; /&gt;&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>vrdp初体验</title>
   <link href="http://reverland.org/linux-tech/2012/03/11/vrdp"/>
   <updated>2012-03-11T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/linux-tech/2012/03/11/vrdp</id>
   <content type="html">&lt;h2 id=&quot;vrdp&quot;&gt;安装vrdp功能&lt;/h2&gt;

&lt;p&gt;先确定vbox版本&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;vboxmanage -v
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;先到官网下载对应的extpack，然后运行(以4.0.8为例)&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;sudo vboxmanage extpack install Oracle_VM_VirtualBox_Extension_Pack-4.0.8-71778.vbox-extpack
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;vrdp-1&quot;&gt;使用vrdp功能&lt;/h2&gt;
&lt;p&gt;后台运行虚拟机系统（如xp）&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;vboxheadless -s xp
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;最后返回一行&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;VRDE server is listening on port 3389.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;打开rdp软件比如说krdc连接宿主机ip+3389(默认)&lt;/p&gt;

&lt;p&gt;如果在本机桥接vbox仿问虚拟机可以桥接，需要加载相应模块。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;modprobe vboxnetflt
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;参考文献&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://forum.ubuntu.org.cn/viewtopic.php?f#65&amp;amp;p#2355313#p2355313&quot;&gt;ubuntu中文论坛&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.archlinux.org/index.php/VirtualBox_Extras&quot;&gt;VirtualBox Extras&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

</content>
 </entry>
 
 <entry>
   <title>vbox安装增强工具提示无权限</title>
   <link href="http://reverland.org/linux-tech/2012/03/06/vbox"/>
   <updated>2012-03-06T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/linux-tech/2012/03/06/vbox</id>
   <content type="html">&lt;p&gt;在debian中安装vbox增强工具，提示无权限。chmod也无法改变，google找到以下解决方案：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /media/cdrom/
sudo sh ./VboxLinuxAdditions.run
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这好象是loginshell和非loginshell的原因。&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>在vim中使用lisp</title>
   <link href="http://reverland.org/lisp/2012/02/23/vimlisp"/>
   <updated>2012-02-23T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/lisp/2012/02/23/vimlisp</id>
   <content type="html">&lt;h2 id=&quot;vimlisp&quot;&gt;在Vim中使用lisp&lt;/h2&gt;

&lt;h3 id=&quot;slimv&quot;&gt;安装slimv&lt;/h3&gt;

&lt;p&gt;和普通的vim插件安装方式并无二异。
详情请参见&lt;a href=&quot;http://www.vim.org/scripts/script.php?script_id#2531&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;slimv-1&quot;&gt;使用slimv&lt;/h3&gt;

&lt;p&gt;使用也很简单，教程见这里&lt;a href=&quot;http://kovisoft.bitbucket.org/tutorial.html&quot;&gt;slimv教程&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;wiki&quot;&gt;那我写这个wiki干嘛&lt;/h3&gt;

&lt;p&gt;有些需要注意的地方:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;注意自己python版本.arch用户得手动把&lt;code&gt;swank.py&lt;/code&gt;这个文件的标识行中&lt;code&gt;python&lt;/code&gt;改成&lt;code&gt;python2&lt;/code&gt;.或者在&lt;code&gt;vimrc&lt;/code&gt;中指定&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;   &lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;g:slimv_python &lt;span class=&quot;c&quot;&gt;# &amp;#39;python2&amp;#39;&lt;/span&gt;
   
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;一般slimv会自动搜索你的lisp实现。比如我是clisp，也可以手动指定，在vimrc中：&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;   &lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;g:slimv_impl &lt;span class=&quot;c&quot;&gt;# &amp;#39;clisp&amp;#39;&lt;/span&gt;
   
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;详见手册。
* 确保你有&lt;code&gt;xterm&lt;/code&gt;，虽然手册没说，但这个很重要。请先&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;   &lt;span class=&quot;nb&quot;&gt;echo &lt;/span&gt;g:slimv_swank_cmd
   
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;可以看到&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;  ! xterm -iconic -e &lt;span class=&quot;s2&quot;&gt;&amp;quot;clisp&amp;quot;&lt;/span&gt; -i &lt;span class=&quot;s2&quot;&gt;&amp;quot;/home/lyy/.vim/bundle/slimv/slime/start-swank.lisp&amp;quot;&lt;/span&gt; &amp;amp;
  
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;使用本地hyperspec(lisp手册一类的东西,可以在lispworks上下载或在线使用……名字真奇怪)在vimrc中写入&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;   &lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;g:slimv_clhs_root &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;path/to/HyperSpec/Body/&amp;quot;&lt;/span&gt;
   
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;如果有什么问题，请参看手册。&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;最后上个图&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/slimv.png&quot; hight=&quot;200&quot; width=&quot;400&quot; alt=&quot;slimv环境&quot; /&gt;&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>vim-latex插件对xelatex的配置</title>
   <link href="http://reverland.org/linux-tech/2012/02/07/vim-latexxelatex"/>
   <updated>2012-02-07T00:00:00+08:00</updated>
   <id>hhttp://reverland.org/linux-tech/2012/02/07/vim-latexxelatex</id>
   <content type="html">&lt;h2 id=&quot;vim-latexxelatex&quot;&gt;vim-latex设置xelatex&lt;/h2&gt;

&lt;h3 id=&quot;section&quot;&gt;准备工作&lt;/h3&gt;

&lt;p&gt;首先我的系统配置情况:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;Distributor ID: Arch i686 
Description:    a little light distro
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;使用的arch源中的texlive2011,直接用pacman安装，建议把相关包都安上，不占多少空间。如果要详细了解请见&lt;a href=&quot;https://wiki.archlinux.org/index.php/TeXLive_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29&quot;&gt;这里&lt;/a&gt; ,又是我译的…英文版的都不只多久没更新了，不过可以参考。我安装的如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;texlive-bin 2011.3-1.2 
texlive-core 2011.24722-1 
texlive-langcjk 2011.24689-1 
texlive-latexextra 2011.24718-1 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;因为我用的是xelatex，所以直接生成的就是pdf文件，也就是这个原因，我才花时间折腾vim-latex-suite和okular，目前Linux下似乎也就是okular支持反向搜索…
安装vim-latex过程不细述。别忘了更改ctex字体配置文件,使楷体和仿宋的名称是你系统上的名称。&lt;/p&gt;

&lt;p&gt;安装okular不细述。&lt;/p&gt;

&lt;p&gt;假设你已经把上面两项安装好了，那么进入正题。&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;hack-vimrc&quot;&gt;hack 源码（其实，貌似可以在vimrc中更改）&lt;/h3&gt;

&lt;h4 id=&quot;latex-suite&quot;&gt;修改latex-suite默认的目标文件&lt;/h4&gt;

&lt;p&gt;在~/.vim/ftplugin/latex-suit/texrc中找到:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;has&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;macunix&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   TexLet g:Tex_DefaultTargetFormat &lt;span class=&quot;c&quot;&gt;# &amp;#39;pdf&amp;#39;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else   &lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;   &lt;/span&gt;TexLet g:Tex_DefaultTargetFormat &lt;span class=&quot;c&quot;&gt;# &amp;#39;dvi&amp;#39;&lt;/span&gt;
endif
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;修改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;has&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;macunix&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   TexLet g:Tex_DefaultTargetFormat &lt;span class=&quot;c&quot;&gt;# &amp;#39;pdf&amp;#39;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else   &lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;   &lt;/span&gt;TexLet g:Tex_DefaultTargetFormat &lt;span class=&quot;c&quot;&gt;# &amp;#39;pdf&amp;#39;&lt;/span&gt;
endif
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这个变量告诉latex-suite，你需要的目标文件是pdf&lt;/p&gt;

&lt;h4 id=&quot;pdf&quot;&gt;修改pdf的编译命令&lt;/h4&gt;

&lt;p&gt;同样在texrc文件中找到：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;TexLet g:Tex_CompileRule_pdf &lt;span class=&quot;c&quot;&gt;# &amp;#39;pdflatex -interaction#nonstopmode $*&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;修改为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;TexLet g:Tex_CompileRule_pdf &lt;span class=&quot;c&quot;&gt;# &amp;#39;xelatex --src-specials -interaction#nonstopmode $*&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;这样，你用来编译pdf的命令就有xelatex来负责了，同时也指定了前向搜索所必备的一个参数：&lt;code&gt;--src-specials&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;pdf-1&quot;&gt;修改默认pdf浏览器&lt;/h4&gt;

&lt;p&gt;继续在texrc修改latex-suite默认为各种文件调用的浏览器，找到相应部分修改成以下模样。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;TexLet g:Tex_UseEditorSettingInDVIViewer &lt;span class=&quot;c&quot;&gt;# 1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;executable&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;xdg-open&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   TexLet g:Tex_ViewRule_ps &lt;span class=&quot;c&quot;&gt;# &amp;#39;okular&amp;#39;&lt;/span&gt;
   TexLet g:Tex_ViewRule_pdf &lt;span class=&quot;c&quot;&gt;# &amp;#39;okular&amp;#39;&lt;/span&gt;
   TexLet g:Tex_ViewRule_dvi &lt;span class=&quot;c&quot;&gt;# &amp;#39;okular&amp;#39;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;   &lt;/span&gt;TexLet g:Tex_ViewRule_ps &lt;span class=&quot;c&quot;&gt;# &amp;#39;okular&amp;#39;&lt;/span&gt;
   TexLet g:Tex_ViewRule_pdf &lt;span class=&quot;c&quot;&gt;# &amp;#39;okular&amp;#39;&lt;/span&gt;
   TexLet g:Tex_ViewRule_dvi &lt;span class=&quot;c&quot;&gt;# &amp;#39;okular&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;经过这一步，latex-suite在浏览pdf，dvi，ps的时候都会调用okular.&lt;/p&gt;

&lt;h4 id=&quot;section-1&quot;&gt;设置正向搜索&lt;/h4&gt;

&lt;p&gt;修改~/.vim/ftplugin/latex-suit/compiler.vim，让latex-suite能够以正确的参数在前向搜索和普通模式下打开生成的pdf文件：
找到相应部分做如下修改&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot; We&amp;#39;re either UNIX or Mac and using a UNIX-type viewer&lt;/span&gt;

&lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt; Check &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the special DVI viewers first
.................
elseif &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;viewer &lt;span class=&quot;c&quot;&gt;## &amp;quot;okular&amp;quot;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;execString &lt;span class=&quot;c&quot;&gt;# &amp;#39;silent! !okular --unique &amp;#39;.mainfnameRoot.&amp;#39;.pdf\#src:&amp;#39;.line(&amp;#39;.&amp;#39;).expand(&amp;quot;%&amp;quot;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;section-2&quot;&gt;设置反向搜索&lt;/h4&gt;

&lt;pre&gt;&lt;code&gt;警告！文件名和路径中不要有空格和汉字 打开okular，菜单：setting&amp;gt;&amp;gt;configure okular&amp;gt;&amp;gt;Editor属性页 把里面的Editor下拉到Custom Text Editor，然后在Command:一栏输入：
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;    gvim -c &lt;span class=&quot;s2&quot;&gt;&amp;quot;:RemoteOpen +%l %f&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;注意，系统要有gvim…&lt;/p&gt;

&lt;p&gt;然后在你的tex源文件的preamble部分，加入：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;    &lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ynctex#1
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;大功告成啦，重新用\ll编译一遍你的源文件，然后\ls前向搜索，最后在pdf中想要反向搜索的地方按：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;bash&quot;&gt;    Shift+鼠标左键
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;就会自动的重定位到gvim中源码对应的地方，不过记住，不要开多个gvim，否则很可能用错误的gvim打开源码，然后就会提示交换文件已经存在之类. &lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-3&quot;&gt;参考文献&lt;/h2&gt;

&lt;p&gt;sorry,写的比较早遗忘了，如果有知道的联系我。&lt;/p&gt;

&lt;hr /&gt;

&lt;h6 id=&quot;changelog&quot;&gt;changelog&lt;/h6&gt;
&lt;ul&gt;
  &lt;li&gt;2012年02月07日 星期二 12时54分48秒&lt;/li&gt;
  &lt;li&gt;2012年04月06日 星期五 18时44分54秒 添加ctex字体配置部分，更改高亮&lt;/li&gt;
&lt;/ul&gt;

</content>
 </entry>
 
 
</feed>